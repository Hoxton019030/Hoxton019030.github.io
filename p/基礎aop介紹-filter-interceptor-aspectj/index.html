<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="filter interceptor aspectJ的介紹"><title>基礎AOP介紹-Filter Interceptor AspectJ</title><link rel=canonical href=https://hoxtonhsu.com/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/><script type=text/javascript src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><link rel=stylesheet href=/scss/style.min.b0b89b0dd996a596c4f3b50239e7a6499c1a59da968562fa4649d097368cdb29.css><meta property="og:title" content="基礎AOP介紹-Filter Interceptor AspectJ"><meta property="og:description" content="filter interceptor aspectJ的介紹"><meta property="og:url" content="https://hoxtonhsu.com/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/"><meta property="og:site_name" content="Hoxton"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Spring"><meta property="article:published_time" content="2022-10-07T22:41:52+08:00"><meta property="article:modified_time" content="2022-10-07T22:41:52+08:00"><meta property="og:image" content="https://i.imgur.com/B7GhSw1.png"><meta name=twitter:title content="基礎AOP介紹-Filter Interceptor AspectJ"><meta name=twitter:description content="filter interceptor aspectJ的介紹"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://i.imgur.com/B7GhSw1.png"><link rel="shortcut icon" href=https://cdn-icons-png.flaticon.com/512/92/92031.png><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-9N16MVLR0Q','auto');ga('send','pageview');}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-9N16MVLR0Q"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-9N16MVLR0Q');</script></head><body class=article-page><script>(function(){const colorSchemeKey='StackColorScheme';localStorage.setItem(colorSchemeKey,"dark");})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.documentElement.dataset.scheme='dark';}else{document.documentElement.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avator_hu6a42c31c76a673cb4138239719c1dd56_73650_300x0_resize_box_2.png width=300 height=301 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Hoxton</a></h1><h2 class=site-description>快樂的CRUD Boy</h2></div></header><ol class=social-menu><li><a href=https://discordapp.com/users/840906423076782082 target=_blank title=Discord><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-discord" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M7.5 7.5c3.5-1 5.5-1 9 0"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-1 2.5"/><path d="M8.5 17c0 1-1.356 3-1.832 3-1.429.0-2.698-1.667-3.333-3-.635-1.667-.476-5.833 1.428-11.5C6.151 4.485 7.545 4.16 9 4l1 2.5"/></svg></a></li><li><a href=https://github.com/Hoxton019030 target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0c-2.4-1.6-3.5-1.3-3.5-1.3a4.2 4.2.0 00-.1 3.2 4.6 4.6.0 00-1.3 3.2c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.instagram.com/hoxton_8a31/ target=_blank title=Instagram><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="80" height="80" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="4"/><circle cx="12" cy="12" r="3"/><line x1="16.5" y1="7.5" x2="16.5" y2="7.501"/></svg></a></li><li><a href=https://www.linkedin.com/in/hoxton-hsu-298b22269/ target=_blank title=LinkedIn><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/><img src=https://i.imgur.com/B7GhSw1.png loading=lazy alt="Featured image of post 基礎AOP介紹-Filter Interceptor AspectJ"></a></div><div class=article-details><header class=article-category><a href=/categories/%E7%A8%8B%E5%BC%8F/ style=background-color:#2a9d8f;color:#fff>程式</a>
<a href=/categories/java/ style=background-color:#2a9d8f;color:#fff>Java</a>
<a href=/categories/springboot/ style=background-color:#2a9d8f;color:#fff>SpringBoot</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/>基礎AOP介紹-Filter Interceptor AspectJ</a></h2><h3 class=article-subtitle>filter interceptor aspectJ的介紹</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Oct 07, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h1 id=目錄>目錄</h1><ul><li><a class=link href=#Filter%28%e9%81%8e%e6%bf%be%e5%99%a8%29Interceptor%28%e6%94%94%e6%88%aa%e5%99%a8%29AOP%28%e5%89%96%e9%9d%a2%e5%b0%8e%e5%90%91%e7%a8%8b%e5%bc%8f%e8%a8%ad%e8%a8%88%29%e4%b9%8b%e5%b7%ae%e7%95%b0>Filter(過濾器)Interceptor(攔截器)AOP(剖面導向程式設計)之差異</a><ul><li><a class=link href=#Filter>Filter</a></li><li><a class=link href=#Interceptor>Interceptor</a></li><li><a class=link href=#AspectJ>AspectJ</a></li></ul></li></ul><h1 id=aspectj>AspectJ</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>graph TD;
AOP ---&gt; SpringAop &amp; AspectJ
</code></pre></td></tr></table></div></div><h2 id=aop-概念>AOP (概念)</h2><p>面向切面編程，利用AOP可以對業務邏輯的各個部分進行隔離，使得業務邏輯各部分之間的耦合度降低，提高程式的可重用性，同時提高開發的效率</p><p>不修改原始碼，從而擴充新功能</p><h1 id=filter過濾器interceptor攔截器aspectjaop之差異>Filter(過濾器)Interceptor(攔截器)AspectJ(AOP)之差異</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>flowchart LR;

1((使用者))--發送請求
--&gt;Filter\n+統一設置編碼\n+過濾敏感字\n+登入驗證\n+URL級別的訪問權限控制\n+數據壓縮
--&gt;dispatcher
--&gt;Interceptor\n+權限驗證\n+登入驗證\n+性能檢測
--&gt;AOP\n+日誌紀錄
--&gt;2(Controller)


-1[粗糙]--能處理request的精細程度----&gt;-2[細緻]
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/6rnsYg4.png loading=lazy alt=image-20220913095403747></p><p><img src=https://i.imgur.com/vO1K7ew.png loading=lazy alt=image-20220912164304013></p><p><img src=https://i.imgur.com/jQ4pF5v.png loading=lazy alt=image-20220913100841950></p><h2 id=filter>Filter</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>
flowchart LR;

1[瀏覽器]---&gt;2{過濾器}---&gt;3[Web資源]
3[Web資源]--&gt;2{過濾器}--&gt;1[瀏覽器]

</code></pre></td></tr></table></div></div><p>在HttpServletRequest到達Servlet之前，過濾、處理一些資訊，本身依賴Sevlet容器，不能獲取SpringBean的一些資訊，它是<code>javax.servlet.FilterChain</code>的項目，<strong>不是Springboot</strong></p><p>可以做什麼</p><ul><li>修改Request, Response</li><li>防止xss(Cross-Site-SCripting跨網站指令碼)攻擊</li><li>包裝二進制流</li></ul><h4 id=自定義filter>自定義Filter</h4><ul><li>以註解方式製作Filter</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=cm>/**
</span><span class=cm>* 網路上教學蠻多都是implenments filter，但我建議extend GenericFilterBean
</span><span class=cm>* 會比較方便一點，省去implenments init(), distory()的麻煩 
</span><span class=cm>*/</span>

<span class=nd>@Slf4j</span>
<span class=nd>@Component</span>
<span class=nd>@WebFilter</span><span class=o>(</span><span class=n>filterName</span> <span class=o>=</span> <span class=s>&#34;f1&#34;</span><span class=o>,</span><span class=n>urlPatterns</span> <span class=o>=</span> <span class=o>{</span><span class=s>&#34;*.html&#34;</span><span class=o>,</span><span class=s>&#34;*.jsp&#34;</span><span class=o>,</span><span class=s>&#34;/&#34;</span><span class=o>})</span>  <span class=c1>//filterName就只是一個名稱可以，隨意就好，urlPattern是用來指定哪些url要經過這個過濾器
</span><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>HiFilter</span> <span class=kd>extends</span> <span class=n>GenericFilterBean</span> <span class=o>{</span>
    
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doFilter</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>chain</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ServletException</span> <span class=o>{</span>
      <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Hello Hoxton&#34;</span><span class=o>);</span>
      <span class=n>chain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>request</span><span class=o>,</span><span class=n>response</span><span class=o>);</span> <span class=c1>//代表這個Filter已經作用完畢，可以把request,response交給下一個Filter了
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/R9tNv8y.png loading=lazy alt=image-20220912151657403></p><p>結果如上</p><ul><li>以Java配置方式製作Filter</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Slf4j</span>
<span class=cm>/**
</span><span class=cm>* 網路上教學蠻多都是implenments filter，但我建議extend GenericFilterBean
</span><span class=cm>* 會比較方便一點，省去implenments init(), distory()的麻煩 
</span><span class=cm>*/</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>HiFilter</span> <span class=kd>extends</span> <span class=n>GenericFilterBean</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>doFilter</span><span class=o>(</span><span class=n>ServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>ServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>chain</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>IOException</span><span class=o>,</span> <span class=n>ServletException</span> <span class=o>{</span>
      <span class=n>log</span><span class=o>.</span><span class=na>info</span><span class=o>(</span><span class=s>&#34;Hello Hoxton&#34;</span><span class=o>);</span>
      <span class=n>chain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>request</span><span class=o>,</span><span class=n>response</span><span class=o>);</span>  <span class=c1>//代表這個Filter已經作用完畢，可以把request,response交給下一個Filter了
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Configuration</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FilterConfig</span> <span class=o>{</span>
    <span class=nd>@Bean</span>
    <span class=kd>public</span> <span class=n>FilterRegistrationBean</span> <span class=nf>heFilterRegistration</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>FilterRegistrationBean</span> <span class=n>registration</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FilterRegistrationBean</span><span class=o>(</span><span class=k>new</span> <span class=n>HiFilter</span><span class=o>());</span>
        <span class=n>registration</span><span class=o>.</span><span class=na>addUrlPatterns</span><span class=o>(</span><span class=s>&#34;/*&#34;</span><span class=o>);</span> <span class=c1>//配置相關的路徑
</span><span class=c1></span>        <span class=k>return</span> <span class=n>registration</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><blockquote><p>一些其他的config設置，僅供參考，與上面釋例無關</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Configuration</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>FilterConfig</span> <span class=o>{</span>
<span class=c1>//test
</span><span class=c1></span><span class=nd>@Bean</span>
<span class=kd>public</span> <span class=n>FilterRegistrationBean</span><span class=o>&lt;</span><span class=n>Filter</span><span class=o>&gt;</span> <span class=nf>logProcessTimeFilter</span><span class=o>()</span> <span class=o>{</span>
  <span class=n>FilterRegistrationBean</span><span class=o>&lt;</span><span class=n>Filter</span><span class=o>&gt;</span> <span class=n>bean</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FilterRegistrationBean</span><span class=o>&lt;&gt;();</span>
  <span class=n>bean</span><span class=o>.</span><span class=na>setFilter</span><span class=o>(</span><span class=k>new</span> <span class=n>LogProcessTimeFilter</span><span class=o>());</span> <span class=c1>//設定想要使用哪一個Filter
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>addUrlPatterns</span><span class=o>(</span><span class=s>&#34;/*&#34;</span><span class=o>);</span> <span class=c1>//設置哪些url會觸發Filter，設置成/* 就代表全部都會吃到，/user/*就代表/user開頭的都會吃到
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;logProcessTimeFilter&#34;</span><span class=o>);</span> <span class=c1>//設置要叫什麼名字
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>setOrder</span><span class=o>(</span><span class=n>0</span><span class=o>);</span> <span class=c1>//設定過濾器的執行順序
</span><span class=c1></span>  <span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
<span class=o>}</span>

<span class=nd>@Bean</span>
<span class=kd>public</span> <span class=n>FilterRegistrationBean</span><span class=o>&lt;</span><span class=n>Filter</span><span class=o>&gt;</span> <span class=nf>logApiFilter</span><span class=o>()</span> <span class=o>{</span>
  <span class=n>FilterRegistrationBean</span><span class=o>&lt;</span><span class=n>Filter</span><span class=o>&gt;</span> <span class=n>bean</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FilterRegistrationBean</span><span class=o>&lt;&gt;();</span>
  <span class=n>bean</span><span class=o>.</span><span class=na>setFilter</span><span class=o>(</span><span class=k>new</span> <span class=n>LogApiFilter</span><span class=o>());</span> <span class=c1>//設定想要使用哪一個Filter
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>addUrlPatterns</span><span class=o>(</span><span class=s>&#34;/*&#34;</span><span class=o>);</span> <span class=c1>//設置哪些url會觸發Filter，設置成/* 就代表全部都會吃到，/user/*就代表/user開頭的都會吃到
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;logApiFilter&#34;</span><span class=o>);</span> <span class=c1>//設置要叫什麼名字
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>setOrder</span><span class=o>(</span><span class=n>1</span><span class=o>);</span> <span class=c1>//設定過濾器的執行順序
</span><span class=c1></span>  <span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
<span class=o>}</span>
<span class=nd>@Bean</span>
<span class=kd>public</span> <span class=n>FilterRegistrationBean</span><span class=o>&lt;</span><span class=n>Filter</span><span class=o>&gt;</span> <span class=nf>printResponseRequestFilter</span><span class=o>()</span> <span class=o>{</span>
  <span class=n>FilterRegistrationBean</span><span class=o>&lt;</span><span class=n>Filter</span><span class=o>&gt;</span> <span class=n>bean</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FilterRegistrationBean</span><span class=o>&lt;&gt;();</span>
  <span class=n>bean</span><span class=o>.</span><span class=na>setFilter</span><span class=o>(</span><span class=k>new</span> <span class=n>PrintResponseRequest</span><span class=o>());</span> <span class=c1>//設定想要使用哪一個Filter
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>addUrlPatterns</span><span class=o>(</span><span class=s>&#34;/*&#34;</span><span class=o>);</span> <span class=c1>//設置哪些url會觸發Filter，設置成/* 就代表全部都會吃到，/user/*就代表/user開頭的都會吃到
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>setName</span><span class=o>(</span><span class=s>&#34;printResponseRequestFilter&#34;</span><span class=o>);</span> <span class=c1>//設置要叫什麼名字
</span><span class=c1></span>  <span class=n>bean</span><span class=o>.</span><span class=na>setOrder</span><span class=o>(</span><span class=n>2</span><span class=o>);</span> <span class=c1>//設定過濾器的執行順序
</span><span class=c1></span>  <span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
<span class=o>}</span>

<span class=o>}</span>
</code></pre></td></tr></table></div></div></blockquote><p>SpringBoot本身也提供了許多不同的Filter供使用，參考如下</p><p><img src=https://i.imgur.com/nKZ6Hy1.png loading=lazy alt=image-20220912153023872></p><p>常用的有以下幾個</p><ul><li>CharacterEncodingFilter(用於處理編碼問題)</li><li>HiddenHttpMethodFilter(隱藏Http函數)</li><li>HttpPutFormContentFilter(form表單處理)</li><li>RequesrtContextFilter(請求上下文)</li></ul><p>其他資訊可以詳閱<a class=link href=https://blog.csdn.net/qyp1314/article/details/42023725 target=_blank rel=noopener>Spring MVC中各个filter的用法</a></p><p>其中以<strong>OncePerRequestFilter</strong>最常被使用，這個Filter會去<strong>過濾每一個Request請求，且不會重複執行</strong>，且這個Filter有一個doFilterInternal()的方法，供我們撰寫Filter邏輯<code>因doFilter()的方法已在OncePerRequestFilter裡面實現了</code>，可以用來做Jwtoken的登入驗證，程式如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Component</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>JwtAuthenticationFilter</span> <span class=kd>extends</span> <span class=n>OncePerRequestFilter</span> <span class=o>{</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>JwtService</span> <span class=n>jwtService</span><span class=o>;</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>UserDetailsService</span> <span class=n>userDetailsService</span><span class=o>;</span>

    <span class=c1>//注入JwtService UserDetailsService，分別用來解析Token與查詢使用者詳情
</span><span class=c1></span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doFilterInternal</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>filterChain</span><span class=o>)</span> <span class=kd>throws</span>          <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>authHeader</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getHeader</span><span class=o>(</span><span class=n>HttpHeaders</span><span class=o>.</span><span class=na>AUTHORIZATION</span><span class=o>);</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>authHeader</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>String</span> <span class=n>accessToken</span> <span class=o>=</span> <span class=n>authHeader</span><span class=o>.</span><span class=na>replace</span><span class=o>(</span><span class=s>&#34;Bearer &#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
            <span class=c1>//從請求標頭中取得Authorization欄位中的值
</span><span class=c1></span>            <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>claims</span> <span class=o>=</span> <span class=n>jwtService</span><span class=o>.</span><span class=na>parseToken</span><span class=o>(</span><span class=n>accessToken</span><span class=o>);</span>
            <span class=c1>//擷取出後面的JWT字串，接著解析它
</span><span class=c1></span>            <span class=n>String</span> <span class=n>username</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>claims</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=s>&#34;username&#34;</span><span class=o>);</span>
            <span class=c1>//從claims物件中取得username欄位的值
</span><span class=c1></span>            <span class=n>UserDetails</span> <span class=n>userDetails</span> <span class=o>=</span> <span class=n>userDetailsService</span><span class=o>.</span><span class=na>loadUserByUsername</span><span class=o>(</span><span class=n>username</span><span class=o>);</span>
            <span class=c1>//並透過userDetailService查詢使用者詳情。這也代表JWT的內容(payload)必須包含username這個欄位
</span><span class=c1></span>            <span class=c1>//在filter中查詢使用者的目的，是為了將該次請求所代表的驗證後資料(Authentication)帶進security中的Context。
</span><span class=c1></span>            <span class=c1>//Context是一種較抽象的概念，可以想像成該次請求的身分狀態
</span><span class=c1></span>
            <span class=n>Authentication</span> <span class=n>authentication</span> <span class=o>=</span> <span class=k>new</span> <span class=n>UsernamePasswordAuthenticationToken</span><span class=o>(</span><span class=n>userDetails</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=n>userDetails</span><span class=o>.</span><span class=na>getAuthorities</span><span class=o>());</span>
            <span class=c1>//為了將這個請求的使用者身分告訴伺服器，我們建立UsernamePasswordAuthenticationToken的物件，其中第三個參數放GrantedAuthority的List，              作為API的授權檢查
</span><span class=c1></span>            <span class=c1>//第一個參數(principal)傳入使用者詳請(UserDetails)。
</span><span class=c1></span>            <span class=c1>// 而第二個參數是credential，通常是密碼，但不傳入也無訪
</span><span class=c1></span>            <span class=c1>//經由傳入principal，我們得以在業務邏輯中從Context輕易獲取使用者身分的資料
</span><span class=c1></span>            <span class=n>SecurityContextHolder</span><span class=o>.</span><span class=na>getContext</span><span class=o>().</span><span class=na>setAuthentication</span><span class=o>(</span><span class=n>authentication</span><span class=o>);</span>
        <span class=o>}</span>
        <span class=n>filterChain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>response</span><span class=o>);</span>


    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>配置完後再將這個Filter加入Security的過濾鍊</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@EnableWebSecurity</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span>   <span class=n>UserDetailsService</span> <span class=n>userDetailsService</span><span class=o>;</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>JwtAuthenticationFilter</span> <span class=n>jwtAuthenticationFilter</span><span class=o>;</span>

    <span class=cm>/**
</span><span class=cm>     * 協助帳號密碼認證的東西
</span><span class=cm>     * @return
</span><span class=cm>     */</span>
    <span class=nd>@Override</span>
    <span class=nd>@Bean</span>
    <span class=kd>public</span> <span class=n>AuthenticationManager</span> <span class=nf>authenticationManagerBean</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
            <span class=k>return</span> <span class=kd>super</span><span class=o>.</span><span class=na>authenticationManagerBean</span><span class=o>();</span>

    <span class=o>}</span>
    <span class=c1>//加入Security的過濾鍊
</span><span class=c1></span>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>http</span><span class=o>.</span><span class=na>authorizeHttpRequests</span><span class=o>()</span>
                <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>GET</span><span class=o>,</span> <span class=s>&#34;/users/**&#34;</span><span class=o>).</span><span class=na>hasAuthority</span><span class=o>(</span><span class=n>MemberAuthority</span><span class=o>.</span><span class=na>SYSTEM_ADMIN</span><span class=o>.</span><span class=na>name</span><span class=o>())</span>
<span class=c1>//                .antMatchers(HttpMethod.GET,&#34;/h2/**&#34;).hasAuthority(MemberAuthority.SYSTEM_ADMIN.name())
</span><span class=c1></span>                <span class=o>.</span><span class=na>antMatchers</span><span class=o>(</span><span class=n>HttpMethod</span><span class=o>.</span><span class=na>GET</span><span class=o>,</span><span class=s>&#34;/login/**&#34;</span><span class=o>).</span><span class=na>permitAll</span><span class=o>()</span>
<span class=c1>//                .antMatchers(HttpMethod.POST,&#34;login&#34;).permitAll()
</span><span class=c1>//                .antMatchers(HttpMethod.POST, &#34;/users&#34;).permitAll()
</span><span class=c1></span>                <span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>permitAll</span><span class=o>()</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
                <span class=o>.</span><span class=na>addFilterBefore</span><span class=o>(</span><span class=n>jwtAuthenticationFilter</span><span class=o>,</span> <span class=n>UsernamePasswordAuthenticationFilter</span><span class=o>.</span><span class=na>class</span><span class=o>)</span> <span class=c1>//於UsernamePasswordAuthenticationFilter進行認證
</span><span class=c1></span>                <span class=o>.</span><span class=na>sessionManagement</span><span class=o>()</span>
                <span class=o>.</span><span class=na>sessionCreationPolicy</span><span class=o>(</span><span class=n>SessionCreationPolicy</span><span class=o>.</span><span class=na>STATELESS</span><span class=o>)</span>
                <span class=o>.</span><span class=na>and</span><span class=o>()</span>
                <span class=o>.</span><span class=na>csrf</span><span class=o>().</span><span class=na>disable</span><span class=o>()</span>
                <span class=o>.</span><span class=na>formLogin</span><span class=o>();</span>
        <span class=n>http</span><span class=o>.</span><span class=na>headers</span><span class=o>().</span><span class=na>frameOptions</span><span class=o>().</span><span class=na>disable</span><span class=o>();</span>
        <span class=c1>//讓spring Security可以和h2建立連線
</span><span class=c1></span>    <span class=o>}</span>

    <span class=cm>/**
</span><span class=cm>     *
</span><span class=cm>     * @param auth 配置全局驗證資訊，如Authentication Provider,UserDetailService等等資訊，
</span><span class=cm>     *             authenticationManager會接收到UsernamePasswordAuthenticationToken傳入的資料後
</span><span class=cm>     *             調用SecurityConfig中所配置的userDetailsService,passwordEncoder來協助驗證
</span><span class=cm>     *
</span><span class=cm>     * @throws Exception
</span><span class=cm>     */</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>auth</span><span class=o>.</span><span class=na>userDetailsService</span><span class=o>(</span><span class=n>userDetailsService</span><span class=o>).</span><span class=na>passwordEncoder</span><span class=o>(</span><span class=k>new</span> <span class=n>BCryptPasswordEncoder</span><span class=o>());</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>一些Code的示範</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LogProcessTimeFilter</span> <span class=kd>extends</span> <span class=n>OncePerRequestFilter</span> <span class=o>{</span>
    <span class=cm>/**
</span><span class=cm>     * @param request     請求
</span><span class=cm>     * @param response    回應
</span><span class=cm>     * @param filterChain 過濾鏈 會將現有的filter給串聯起來，當請求進入後端，需要依序經過它們才會達到Controller，相對的，當回應離開Controller，則是按照相反的方向經過那些Filter
</span><span class=cm>     * @throws ServletException
</span><span class=cm>     * @throws IOException
</span><span class=cm>     */</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doFilterInternal</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>filterChain</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=kt>long</span> <span class=n>startTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
        <span class=n>filterChain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>response</span><span class=o>);</span> <span class=c1>//doFilter:相當於將請求送至Controller。
</span><span class=c1></span>        <span class=kt>long</span> <span class=n>endTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
        <span class=kt>long</span> <span class=n>processTime</span> <span class=o>=</span> <span class=n>endTime</span> <span class=o>-</span> <span class=n>startTime</span><span class=o>;</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;processTime = &#34;</span> <span class=o>+</span> <span class=n>processTime</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=cm>/**
</span><span class=cm> * Controller收到的請求主體(RequestBody)和回應主體(ResponseBody)
</span><span class=cm> * 分別由HttpServletRequest與HttpServletResponse的InputStream、OutputStream轉化而來，
</span><span class=cm> * 但資料流只能讀取一次，如果在Filter層就被讀掉，可能會導致後面都收不到資料
</span><span class=cm> * 為了保留主體中的資料，我們將請求主體與回應主體包裝成ContentCachingResponseWrapper ContentCachingRequestWrapper
</span><span class=cm> * 再如同往常傳入FilterChain
</span><span class=cm> *
</span><span class=cm> * 這兩個Wrapper的特色是會在內部備份一個ByteArrayOutputStream，我們只要呼叫這兩個Wrapper的
</span><span class=cm> * getContentAsByteArray就可以無限制地取得主體內容
</span><span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>PrintResponseRequest</span> <span class=kd>extends</span> <span class=n>OncePerRequestFilter</span> <span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doFilterInternal</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>filterChain</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=n>ContentCachingRequestWrapper</span> <span class=n>requestWrapper</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ContentCachingRequestWrapper</span><span class=o>(</span><span class=n>request</span><span class=o>);</span>
        <span class=n>ContentCachingResponseWrapper</span> <span class=n>responseWrapper</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ContentCachingResponseWrapper</span><span class=o>(</span><span class=n>response</span><span class=o>);</span>
        <span class=n>filterChain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>requestWrapper</span><span class=o>,</span> <span class=n>responseWrapper</span><span class=o>);</span>
<span class=c1>//        logApi(request, response);
</span><span class=c1></span>        <span class=n>logBody</span><span class=o>(</span><span class=n>requestWrapper</span><span class=o>,</span><span class=n>responseWrapper</span><span class=o>);</span>

        <span class=n>responseWrapper</span><span class=o>.</span><span class=na>copyBodyToResponse</span><span class=o>();</span>
    <span class=o>}</span>


    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>logApi</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
        <span class=kt>int</span> <span class=n>httpStatus</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=na>getStatus</span><span class=o>();</span> <span class=c1>//200,403,404之類的
</span><span class=c1></span>        <span class=n>String</span> <span class=n>httpMethod</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getMethod</span><span class=o>();</span>
        <span class=n>String</span> <span class=n>uri</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURI</span><span class=o>();</span>
        <span class=n>String</span> <span class=n>params</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getQueryString</span><span class=o>();</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>params</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>uri</span> <span class=o>+=</span> <span class=s>&#34;?&#34;</span> <span class=o>+</span> <span class=n>params</span><span class=o>;</span>
        <span class=o>}</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=n>String</span><span class=o>.</span><span class=na>join</span><span class=o>(</span><span class=s>&#34; &#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>valueOf</span><span class=o>(</span><span class=n>httpStatus</span><span class=o>),</span> <span class=n>httpMethod</span><span class=o>,</span> <span class=n>uri</span><span class=o>));</span>
    <span class=o>}</span>
    <span class=kd>private</span> <span class=kt>void</span> <span class=nf>logBody</span><span class=o>(</span><span class=n>ContentCachingRequestWrapper</span> <span class=n>request</span><span class=o>,</span> <span class=n>ContentCachingResponseWrapper</span> <span class=n>response</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>requestBody</span> <span class=o>=</span> <span class=n>getContent</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getContentAsByteArray</span><span class=o>());</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Request: &#34;</span> <span class=o>+</span> <span class=n>requestBody</span><span class=o>);</span>

        <span class=n>String</span> <span class=n>responseBody</span> <span class=o>=</span> <span class=n>getContent</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getContentAsByteArray</span><span class=o>());</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Response: &#34;</span> <span class=o>+</span> <span class=n>responseBody</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=cm>/**
</span><span class=cm>     * @param content
</span><span class=cm>     * @return 返回JSON字串
</span><span class=cm>     */</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=nf>getContent</span><span class=o>(</span><span class=kt>byte</span> <span class=o>[]</span> <span class=n>content</span><span class=o>){</span>
        <span class=n>String</span> <span class=n>body</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>(</span><span class=n>content</span><span class=o>);</span>
        <span class=k>return</span> <span class=n>body</span><span class=o>.</span><span class=na>replaceAll</span><span class=o>(</span><span class=s>&#34;[\n\t]&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span> <span class=c1>//去除換行\n與定位符號\t
</span><span class=c1></span>    <span class=o>}</span>


<span class=o>}</span>
</code></pre></td></tr></table></div></div><h2 id=interceptor>Interceptor</h2><p>本身是AOP的一種應用，其實攔截器跟過濾器是可以互相替換的，功能其實差不多，只是<strong>攔截器可以在請求到達Controller或是回應回傳出Contrller時進行攔截</strong>，攔截成功時可以實做一些自定義的業務邏輯進行修改，且Interceptor是Springboot下的一個功能<code>org.springframework.web.servlet.HandlerInterceptor</code></p><p>可以用來</p><ul><li>性能監控：紀錄請求的處理時間，比如說請求處理太久（超過500毫秒）</li><li>登入檢測</li><li></li></ul><p><img src=https://i.imgur.com/1qACg6a.png loading=lazy alt=image-20220912164539364></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>graph LR;
request--&gt;id1
id1--&gt;id2--&gt;id4--&gt;id3--&gt;id6--&gt;id5

subgraph  攔截器1
direction TB
id1[&#34;preHandle()&#34;] 
id3[&#34;postHandler()&#34;]
id5[&#34;afterCompletion()&#34;]
 end
subgraph  攔截器2
direction TB
id2[&#34;preHandle()&#34;]
id4[&#34;postHandler()&#34;]
id6[&#34;afterCompletion()&#34;]
 end
</code></pre></td></tr></table></div></div><p>要實現interceptor有兩種方式</p><ol><li>實作HandlerInterceptor</li><li>繼承HandlerInterceptorAdapter</li></ol><p>釋例</p><ul><li>自定義攔截器</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LogInterceptor</span> <span class=kd>extends</span> <span class=n>HandlerInterceptorAdapter</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>preHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=kt>long</span> <span class=n>startTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;\n-------- LogInterception.preHandle --- &#34;</span><span class=o>);</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Request URL: &#34;</span> <span class=o>+</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURL</span><span class=o>());</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Start Time: &#34;</span> <span class=o>+</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>());</span>

        <span class=n>request</span><span class=o>.</span><span class=na>setAttribute</span><span class=o>(</span><span class=s>&#34;startTime&#34;</span><span class=o>,</span> <span class=n>startTime</span><span class=o>);</span>

        <span class=k>return</span> <span class=kc>true</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>postHandle</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>,</span> <span class=n>ModelAndView</span> <span class=n>modelAndView</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;\n-------- LogInterception.postHandle --- &#34;</span><span class=o>);</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Request URL: &#34;</span> <span class=o>+</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURL</span><span class=o>());</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>afterCompletion</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>Object</span> <span class=n>handler</span><span class=o>,</span> <span class=n>Exception</span> <span class=n>ex</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;\n-------- LogInterception.afterCompletion --- &#34;</span><span class=o>);</span>

        <span class=kt>long</span> <span class=n>startTime</span> <span class=o>=</span> <span class=o>(</span><span class=n>Long</span><span class=o>)</span> <span class=n>request</span><span class=o>.</span><span class=na>getAttribute</span><span class=o>(</span><span class=s>&#34;startTime&#34;</span><span class=o>);</span>
        <span class=kt>long</span> <span class=n>endTime</span> <span class=o>=</span> <span class=n>System</span><span class=o>.</span><span class=na>currentTimeMillis</span><span class=o>();</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Request URL: &#34;</span> <span class=o>+</span> <span class=n>request</span><span class=o>.</span><span class=na>getRequestURL</span><span class=o>());</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;End Time: &#34;</span> <span class=o>+</span> <span class=n>endTime</span><span class=o>);</span>

        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Time Taken: &#34;</span> <span class=o>+</span> <span class=o>(</span><span class=n>endTime</span> <span class=o>-</span> <span class=n>startTime</span><span class=o>));</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><ul><li>註冊攔截器</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Configuration</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>WebConfig</span> <span class=kd>implements</span> <span class=n>WebMvcConfigurer</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>addInterceptors</span><span class=o>(</span><span class=n>InterceptorRegistry</span> <span class=n>registry</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>registry</span><span class=o>.</span><span class=na>addInterceptor</span><span class=o>(</span><span class=k>new</span> <span class=n>LogInterceptor</span><span class=o>());</span>

        <span class=n>registry</span><span class=o>.</span><span class=na>addInterceptor</span><span class=o>(</span><span class=k>new</span> <span class=n>OldLoginInterceptor</span><span class=o>()).</span><span class=na>addPathPatterns</span><span class=o>(</span><span class=s>&#34;/admin/oldLogin&#34;</span><span class=o>);</span>

        <span class=n>registry</span><span class=o>.</span><span class=na>addInterceptor</span><span class=o>(</span><span class=k>new</span> <span class=n>AdminInterceptor</span><span class=o>()).</span><span class=na>addPathPatterns</span><span class=o>(</span><span class=s>&#34;/admin/*&#34;</span><span class=o>).</span><span class=na>excludePathPatterns</span><span class=o>(</span><span class=s>&#34;/admin/oldLogin&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h2 id=aspectj-1>AspectJ</h2><p>屬於一種AOP框架</p><ul><li>動態代理(Spring5本身已經封裝了)<ul><li>有兩種情況的動態代理<ul><li><p>有介面(JDK動態代理)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>interface</span> <span class=nc>UserDao</span><span class=o>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>login</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>class</span> <span class=nc>UserDaoImpl</span> <span class=kd>implements</span>　<span class=n>UserDao</span><span class=o>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>login</span><span class=o>(){</span>  
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>創建UserDao介面實現類的代理對象，代理對象會有被代理對象的所有方法，並且增強</p></li><li><p>無介面(CGLIB動態代理)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>class</span> <span class=nc>User</span><span class=o>{</span>
 <span class=kd>public</span> <span class=kt>void</span> <span class=nf>add</span> <span class=o>(){</span>
               
 <span class=o>}</span>   
<span class=o>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>class</span> <span class=nc>Person</span> <span class=kd>extends</span> <span class=n>User</span><span class=o>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>add</span><span class=o>(){</span>
        <span class=kd>super</span><span class=o>.</span><span class=na>add</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li></ul></li></ul></li></ul><h3 id=aopjdk動態代理>AOP(JDK動態代理)</h3><p>使用JDK的動態代理，要使用Proxy類裡面的方法來創建出代理對象 <code>newProxyInstance(類加載器,增強方法所在的類，這個類實現的介面,實現這個接口(InvocationHandler)</code></p><p><img src=https://raw.githubusercontent.com/Hoxton019030/image/main/data/202209061536485.png loading=lazy></p><p>編寫JDK動態代碼</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserDao</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>add</span> <span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span><span class=kt>int</span> <span class=n>b</span><span class=o>);</span>

    <span class=kd>public</span> <span class=n>String</span> <span class=nf>update</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>);</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserDaoImpl</span> <span class=kd>implements</span> <span class=n>UserDao</span><span class=o>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>int</span> <span class=nf>add</span><span class=o>(</span><span class=kt>int</span> <span class=n>a</span><span class=o>,</span> <span class=kt>int</span> <span class=n>b</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;add方法執行了&#34;</span><span class=o>);</span>
        <span class=k>return</span> <span class=n>a</span><span class=o>+</span><span class=n>b</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>update</span><span class=o>(</span><span class=n>String</span> <span class=n>id</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>id</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>

</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kn>package</span> <span class=nn>com.example.aop</span><span class=o>;</span>

<span class=kn>import</span> <span class=nn>java.lang.reflect.InvocationHandler</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.Method</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.lang.reflect.Proxy</span><span class=o>;</span>
<span class=kn>import</span> <span class=nn>java.util.Arrays</span><span class=o>;</span>

<span class=cm>/**
</span><span class=cm> * @author Hoxton
</span><span class=cm> * @version 1.1.0
</span><span class=cm> */</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>JDKProxy</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>Class</span><span class=o>[]</span> <span class=n>interfaces</span> <span class=o>=</span> <span class=o>{</span><span class=n>UserDao</span><span class=o>.</span><span class=na>class</span><span class=o>};</span>
        <span class=n>UserDaoImpl</span> <span class=n>userDao</span> <span class=o>=</span> <span class=k>new</span> <span class=n>UserDaoImpl</span><span class=o>();</span>
        <span class=n>UserDao</span> <span class=n>dao</span> <span class=o>=</span> <span class=o>(</span><span class=n>UserDao</span><span class=o>)</span> <span class=n>Proxy</span><span class=o>.</span><span class=na>newProxyInstance</span><span class=o>(</span><span class=n>JDKProxy</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getClassLoader</span><span class=o>(),</span> <span class=n>interfaces</span><span class=o>,</span> <span class=k>new</span> <span class=n>UserDaoProxy</span><span class=o>(</span><span class=n>userDao</span><span class=o>));</span>
        <span class=c1>//此dao已經不是原本的dao，而是新的代理類dao了
</span><span class=c1></span>        <span class=kt>int</span> <span class=n>result</span> <span class=o>=</span> <span class=n>dao</span><span class=o>.</span><span class=na>add</span><span class=o>(</span><span class=n>1</span><span class=o>,</span> <span class=n>2</span><span class=o>);</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;result = &#34;</span> <span class=o>+</span> <span class=n>result</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
<span class=c1>//創建代理對象的代碼
</span><span class=c1></span><span class=kd>class</span> <span class=nc>UserDaoProxy</span> <span class=kd>implements</span> <span class=n>InvocationHandler</span> <span class=o>{</span>

    <span class=c1>//1. 把創建的是誰的代理對象，把誰傳遞進來
</span><span class=c1></span>    <span class=c1>// 有參建構子
</span><span class=c1></span>    <span class=kd>private</span> <span class=n>Object</span> <span class=n>obj</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>UserDaoProxy</span><span class=o>(</span><span class=n>Object</span> <span class=n>obj</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>obj</span> <span class=o>=</span> <span class=n>obj</span><span class=o>;</span>
    <span class=o>}</span>


    <span class=c1>//增強的邏輯
</span><span class=c1></span>    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>Object</span> <span class=nf>invoke</span><span class=o>(</span><span class=n>Object</span> <span class=n>proxy</span><span class=o>,</span> <span class=n>Method</span> <span class=n>method</span><span class=o>,</span> <span class=n>Object</span><span class=o>[]</span> <span class=n>methodArgs</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Throwable</span> <span class=o>{</span>

        <span class=c1>//方法之前
</span><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法之前執行...&#34;</span> <span class=o>+</span> <span class=n>method</span><span class=o>.</span><span class=na>getName</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;傳遞的參數...&#34;</span> <span class=o>+</span> <span class=n>Arrays</span><span class=o>.</span><span class=na>toString</span><span class=o>(</span><span class=n>methodArgs</span><span class=o>));</span>
        <span class=c1>//被增強的方法執行
</span><span class=c1></span>        <span class=n>Object</span> <span class=n>res</span> <span class=o>=</span> <span class=n>method</span><span class=o>.</span><span class=na>invoke</span><span class=o>(</span><span class=n>obj</span><span class=o>,</span> <span class=n>methodArgs</span><span class=o>);</span>
        <span class=c1>//方法之後
</span><span class=c1></span>        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;方法之後執行...&#34;</span> <span class=o>+</span> <span class=n>obj</span><span class=o>);</span>

        <span class=k>return</span> <span class=n>res</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><h3 id=aop專業術語>AOP專業術語</h3><ol><li><p>連接點</p><p>一個類裡面中，能被增強的方法就叫連接點，下面這個類就有四個連接點</p><p><img src=https://raw.githubusercontent.com/Hoxton019030/image/main/data/202209121200728.png loading=lazy alt=image-20220912120043665></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>class</span> <span class=nc>User</span><span class=o>{</span>
    <span class=n>add</span><span class=o>();</span>
    <span class=n>update</span><span class=o>();</span>
    <span class=n>select</span><span class=o>();</span>
    <span class=n>delete</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li><li><p>切入點</p><p>實際被增強的方法，就叫切入點</p></li><li><p>通知(增強)</p><ol><li><p>實際增強的邏輯部分稱為通知(增強)</p></li><li><p>通知有多種類型</p><ol><li><p>前置通知</p><p>在切入點前執行</p></li><li><p>後置通知</p><p>在切入點後執行</p></li><li><p>環繞通知</p><p>在切入點前後執行</p></li><li><p>異常通知</p><p>出現異常時執行</p></li><li><p>最終通知</p><p>執行到try&mldr;catch的final時執行</p></li></ol></li></ol></li><li><p>切面</p><p>是一個動作</p><ol><li>把通知應用到切入點的過程，就叫切面</li></ol></li></ol><h3 id=aop準備>AOP(準備)</h3><ol><li><p>Spring 框架一般都是基於AspectJ實現的AOP操作</p><ol><li><p>什麼是AspectJ</p><ul><li>AspectJ不是Spring的組成部分，是一個獨立的AOP框架， 一般把AspectJ和Spring框架一起使用，進行AOP操作</li></ul></li><li><p>基於Aspect實現AOP操作</p><ol><li>xml配置文件實現</li><li>基於註解方法實現(主要使用)</li></ol></li><li><p>再專案裡面引入AOP依賴</p></li><li><p>切入點表達式</p><ol><li><p>切入點表達式的作用: 知道對哪個類的哪個方法進行增強</p></li><li><p>語法結構:</p><p>execution( [權限修飾符] [返回類型] [類全路徑] [方法名稱] ( [參數列表] ) )</p><ul><li><p>權限修飾符: public, private, *(代表不論是public, private 都選)</p></li><li><p>返回類型: String, int</p></li><li><p>類全路徑: com.hoxton&mldr;&mldr;.</p></li><li><p>方法名稱: 就方法名稱</p></li><li><p>參數列表: 有哪些參數</p><p>舉例</p><ol><li><p>對com.hoxton.dao.BookDao類裡面的add方法進行增強</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>execution</span><span class=o>(*</span> <span class=n>com</span><span class=o>.</span><span class=na>hoxton</span><span class=o>.</span><span class=na>dao</span><span class=o>.</span><span class=na>BookDao</span><span class=o>.</span><span class=na>add</span><span class=o>(..)</span> <span class=o>)</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p>對com.hoxton.dao.BookDao類的所有方法進行增強</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>execution</span><span class=o>(*</span> <span class=n>com</span><span class=o>.</span><span class=na>hoxton</span><span class=o>.</span><span class=na>dao</span><span class=o>.</span><span class=na>BookDao</span><span class=o>.*(..))</span>
</code></pre></td></tr></table></div></div></li></ul></li><li><p>對com.hoxton.dao包裡的所有類，類裡面的髓有方法進行增強</p><ul><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=n>excution</span><span class=o>(*</span> <span class=n>com</span><span class=o>.</span><span class=na>hoxton</span><span class=o>.</span><span class=na>dao</span><span class=o>.*.*(..))</span>
</code></pre></td></tr></table></div></div></li></ul></li></ol></li></ul><p>within([package名].* )或( [package名]..*)</p><p>舉例</p><ol><li></li><li></li></ol></li></ol></li></ol></li></ol><h3 id=aop操作aspect-j--註解>AOP操作(Aspect J 註解)</h3><ol><li>創建類，在類裡面定義方法</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>add</span><span class=o>(){</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;add&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div><ol start=2><li><p>創建增強類(編寫增強邏輯)</p><ol><li><p>在增強類的裡面，創建方法，讓不同方法代表不同通知類型</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserProxy</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>before</span><span class=o>(){</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;before&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table></div></div></li></ol></li><li><p>進行通知的配置</p><ol><li>在Spring</li></ol></li></ol><h1 id=log4j-2>Log4j 2</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>flowchart TD;

8[&#34;ALL(全輸出不留情)&#34;]---&gt;7[&#34;Trace(更細的除錯資訊，通常用來追蹤城市流程的日誌)&#34;]---&gt;6[&#34;DEBUG(除錯資訊的日志)推薦★&#34;]---&gt;5[&#34;INFO(一般資訊的日志)推薦★&#34;]---&gt;4[&#34;WARN(可能導致錯誤的日志)&#34;]---&gt;3[&#34;ERROR(造成應用錯誤停止的日志)&#34;]---&gt;2[&#34;FETAL(造成應用程式停止的日志)&#34;]---&gt;1[&#34;OFF(不輸出任何日志)&#34;]

</code></pre></td></tr></table></div></div><h1 id=參考>參考</h1><p><a href=https://www.cnblogs.com/itlihao/p/14329905.html>https://www.cnblogs.com/itlihao/p/14329905.html</a></p><p><a href=https://blog.csdn.net/fly910905/article/details/86537648>https://blog.csdn.net/fly910905/article/details/86537648</a></p><p><a class=link href=https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/712557/ target=_blank rel=noopener>SpringBoot攔截器(Interceptor)詳解</a></p><p><a class=link href=https://www.zendei.com/article/52571.html target=_blank rel=noopener>Spring Boot使用過濾器和攔截器分別實現REST介面簡易安全認證</a></p><blockquote></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/spring/>Spring</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true}]});})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E8%99%95%E7%90%86-mybatis%E5%B0%8E%E8%87%B4%E7%9A%84-parameter-1-of-constructor-in-...required-a-bean-of-type-...-that-could-not-be-found./><div class=article-image><img src=https://i.imgur.com/M3MOdZm.png loading=lazy data-key data-hash=https://i.imgur.com/M3MOdZm.png></div><div class=article-details><h2 class=article-title>處理 Mybatis導致的 Parameter 1 of constructor in ...required a bean of type ... that could not be found.</h2></div></a></article><article class=has-image><a href=/p/java%E7%95%B0%E6%AD%A5%E5%9F%B7%E8%A1%8C%E5%B0%8F%E7%B2%BE%E9%9D%88-completablefuture%E4%BB%8B%E7%B4%B9/><div class=article-image><img src=https://i.imgur.com/bbIoOnR.png loading=lazy data-key data-hash=https://i.imgur.com/bbIoOnR.png></div><div class=article-details><h2 class=article-title>Java異步執行小精靈 CompletableFuture介紹</h2></div></a></article><article class=has-image><a href=/p/java%E4%B8%AD%E5%9B%9E%E5%82%B3%E5%80%BC%E5%89%8D%E7%9A%84%E6%B3%9B%E5%9E%8B%E6%A8%99%E8%AD%98%E7%AC%A6%E6%98%AF%E4%BB%80%E9%BA%BC%E6%84%8F%E6%80%9D%E5%91%A2/><div class=article-image><img src=https://i.imgur.com/Y9pLlYY.png loading=lazy data-key data-hash=https://i.imgur.com/Y9pLlYY.png></div><div class=article-details><h2 class=article-title>Java中回傳值前的泛型標識符是什麼意思呢</h2></div></a></article><article class=has-image><a href=/p/%E7%B5%90%E5%90%88lombok%E5%AF%AB%E5%87%BA%E6%9B%B4%E6%95%B4%E6%BD%94%E7%9A%84%E7%A8%8B%E5%BC%8F%E7%A2%BC/><div class=article-image><img src=https://i.imgur.com/1OBx1AG.png loading=lazy data-key data-hash=https://i.imgur.com/1OBx1AG.png></div><div class=article-details><h2 class=article-title>結合Lombok寫出更整潔的程式碼</h2></div></a></article><article class=has-image><a href=/p/%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E4%BD%A0%E5%AF%ABsprintboot%E6%A1%86%E6%9E%B6/><div class=article-image><img src=https://i.imgur.com/1G2G1o4.png loading=lazy data-key data-hash=https://i.imgur.com/1G2G1o4.png></div><div class=article-details><h2 class=article-title>手把手教你寫SprintBoot框架</h2></div></a></article></div></div></aside><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:"bf152013e92e48c1495f",clientSecret:"bed32f8438cb1e00d8628d9b6d148003bb4bf25d",repo:"comment",owner:"Hoxton019030",admin:["Hoxton019030"],distractionFreeMode:false,id:md5(location.pathname),});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk-container").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return;}
gitalk.render("gitalk-container");})();</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Hoxton</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.14.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#目錄>目錄</a></li><li><a href=#aspectj>AspectJ</a><ol><li><a href=#aop-概念>AOP (概念)</a></li></ol></li><li><a href=#filter過濾器interceptor攔截器aspectjaop之差異>Filter(過濾器)Interceptor(攔截器)AspectJ(AOP)之差異</a><ol><li><a href=#filter>Filter</a><ol><li><ol><li><a href=#自定義filter>自定義Filter</a></li></ol></li></ol></li><li><a href=#interceptor>Interceptor</a></li><li><a href=#aspectj-1>AspectJ</a><ol><li><a href=#aopjdk動態代理>AOP(JDK動態代理)</a></li><li><a href=#aop專業術語>AOP專業術語</a></li><li><a href=#aop準備>AOP(準備)</a></li><li><a href=#aop操作aspect-j--註解>AOP操作(Aspect J 註解)</a></li></ol></li></ol></li><li><a href=#log4j-2>Log4j 2</a></li><li><a href=#參考>參考</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>