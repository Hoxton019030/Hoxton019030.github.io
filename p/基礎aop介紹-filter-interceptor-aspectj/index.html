<!DOCTYPE html>
<html lang="zh" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='filter interceptor aspectJçš„ä»‹ç´¹ '><title>åŸºç¤AOPä»‹ç´¹-Filter Interceptor AspectJ</title>

<link rel='canonical' href='https://Hoxton019030.github.io/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/'>

<link rel="stylesheet" href="/scss/style.min.b0b89b0dd996a596c4f3b50239e7a6499c1a59da968562fa4649d097368cdb29.css"><meta property='og:title' content='åŸºç¤AOPä»‹ç´¹-Filter Interceptor AspectJ'>
<meta property='og:description' content='filter interceptor aspectJçš„ä»‹ç´¹ '>
<meta property='og:url' content='https://Hoxton019030.github.io/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/'>
<meta property='og:site_name' content='Hoxton'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Spring' /><meta property='article:published_time' content='2022-10-07T22:41:52&#43;08:00'/><meta property='article:modified_time' content='2022-10-07T22:41:52&#43;08:00'/><meta property='og:image' content='https://i.imgur.com/B7GhSw1.png' />
<meta name="twitter:title" content="åŸºç¤AOPä»‹ç´¹-Filter Interceptor AspectJ">
<meta name="twitter:description" content="filter interceptor aspectJçš„ä»‹ç´¹ "><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://i.imgur.com/B7GhSw1.png' />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9N16MVLR0Q"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9N16MVLR0Q', { 'anonymize_ip': false });
}
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avator_hu6a42c31c76a673cb4138239719c1dd56_73650_300x0_resize_box_3.png" width="300"
                            height="301" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ®</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Hoxton</a></h1>
            <h2 class="site-description">ç”¨ä¾†è¨˜éŒ„ç¨‹å¼çš„ä¸€äº›ç­†è¨˜ï¼Œé‚„æœ‰ä¸€äº›æ—¥å¸¸ç‘£äº‹çš„ç´€éŒ„</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/Hoxton019030'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/hoxton_8a31/'
                        target="_blank"
                        title="Instagram"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="80" height="80" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="4" />
  <circle cx="12" cy="12" r="3" />
  <line x1="16.5" y1="7.5" x2="16.5" y2="7.501" />
</svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/">
                
                    <img src="https://i.imgur.com/B7GhSw1.png" loading="lazy" alt="Featured image of post åŸºç¤AOPä»‹ç´¹-Filter Interceptor AspectJ" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E7%A8%8B%E5%BC%8F/" >
                ç¨‹å¼
            </a>
        
            <a href="/categories/java/" >
                Java
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/%E5%9F%BA%E7%A4%8Eaop%E4%BB%8B%E7%B4%B9-filter-interceptor-aspectj/">åŸºç¤AOPä»‹ç´¹-Filter Interceptor AspectJ</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            filter interceptor aspectJçš„ä»‹ç´¹ 
        </h3>
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Oct 07, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h1 id="ç›®éŒ„">ç›®éŒ„</h1>
<ul>
<li><a class="link" href="#Filter%28%e9%81%8e%e6%bf%be%e5%99%a8%29Interceptor%28%e6%94%94%e6%88%aa%e5%99%a8%29AOP%28%e5%89%96%e9%9d%a2%e5%b0%8e%e5%90%91%e7%a8%8b%e5%bc%8f%e8%a8%ad%e8%a8%88%29%e4%b9%8b%e5%b7%ae%e7%95%b0" >Filter(éæ¿¾å™¨)Interceptor(æ””æˆªå™¨)AOP(å‰–é¢å°å‘ç¨‹å¼è¨­è¨ˆ)ä¹‹å·®ç•°</a>
<ul>
<li><a class="link" href="#Filter" >Filter </a></li>
<li><a class="link" href="#Interceptor" >Interceptor</a></li>
<li><a class="link" href="#AspectJ" >AspectJ</a></li>
</ul>
</li>
</ul>
<h1 id="aspectj">AspectJ</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph TD;
</span></span><span class="line"><span class="cl">AOP ---&gt; SpringAop &amp; AspectJ
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="aop-æ¦‚å¿µ">AOP (æ¦‚å¿µ)</h2>
<p>é¢å‘åˆ‡é¢ç·¨ç¨‹ï¼Œåˆ©ç”¨AOPå¯ä»¥å°æ¥­å‹™é‚è¼¯çš„å„å€‹éƒ¨åˆ†é€²è¡Œéš”é›¢ï¼Œä½¿å¾—æ¥­å‹™é‚è¼¯å„éƒ¨åˆ†ä¹‹é–“çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹å¼çš„å¯é‡ç”¨æ€§ï¼ŒåŒæ™‚æé«˜é–‹ç™¼çš„æ•ˆç‡</p>
<p>ä¸ä¿®æ”¹åŸå§‹ç¢¼ï¼Œå¾è€Œæ“´å……æ–°åŠŸèƒ½</p>
<h1 id="filteréæ¿¾å™¨interceptoræ””æˆªå™¨aspectjaopä¹‹å·®ç•°">Filter(éæ¿¾å™¨)Interceptor(æ””æˆªå™¨)AspectJ(AOP)ä¹‹å·®ç•°</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart LR;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1((ä½¿ç”¨è€…))--ç™¼é€è«‹æ±‚
</span></span><span class="line"><span class="cl">--&gt;Filter\n+çµ±ä¸€è¨­ç½®ç·¨ç¢¼\n+éæ¿¾æ•æ„Ÿå­—\n+ç™»å…¥é©—è­‰\n+URLç´šåˆ¥çš„è¨ªå•æ¬Šé™æ§åˆ¶\n+æ•¸æ“šå£“ç¸®
</span></span><span class="line"><span class="cl">--&gt;dispatcher
</span></span><span class="line"><span class="cl">--&gt;Interceptor\n+æ¬Šé™é©—è­‰\n+ç™»å…¥é©—è­‰\n+æ€§èƒ½æª¢æ¸¬
</span></span><span class="line"><span class="cl">--&gt;AOP\n+æ—¥èªŒç´€éŒ„
</span></span><span class="line"><span class="cl">--&gt;2(Controller)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-1[ç²—ç³™]--èƒ½è™•ç†requestçš„ç²¾ç´°ç¨‹åº¦----&gt;-2[ç´°ç·»]
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/6rnsYg4.png"
	
	
	
	loading="lazy"
	
		alt="image-20220913095403747"
	
	
></p>
<p><img src="https://i.imgur.com/vO1K7ew.png"
	
	
	
	loading="lazy"
	
		alt="image-20220912164304013"
	
	
></p>
<p><img src="https://i.imgur.com/jQ4pF5v.png"
	
	
	
	loading="lazy"
	
		alt="image-20220913100841950"
	
	
></p>
<h2 id="filter">Filter</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">flowchart LR;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">1[ç€è¦½å™¨]---&gt;2{éæ¿¾å™¨}---&gt;3[Webè³‡æº]
</span></span><span class="line"><span class="cl">3[Webè³‡æº]--&gt;2{éæ¿¾å™¨}--&gt;1[ç€è¦½å™¨]
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨HttpServletRequeståˆ°é”Servletä¹‹å‰ï¼Œéæ¿¾ã€è™•ç†ä¸€äº›è³‡è¨Šï¼Œæœ¬èº«ä¾è³´Sevletå®¹å™¨ï¼Œä¸èƒ½ç²å–SpringBeançš„ä¸€äº›è³‡è¨Šï¼Œå®ƒæ˜¯<code>javax.servlet.FilterChain</code>çš„é …ç›®ï¼Œ<strong>ä¸æ˜¯Springboot</strong></p>
<p>å¯ä»¥åšä»€éº¼</p>
<ul>
<li>ä¿®æ”¹Request, Response</li>
<li>é˜²æ­¢xss(Cross-Site-SCriptingè·¨ç¶²ç«™æŒ‡ä»¤ç¢¼)æ”»æ“Š</li>
<li>åŒ…è£äºŒé€²åˆ¶æµ</li>
</ul>
<h4 id="è‡ªå®šç¾©filter">è‡ªå®šç¾©Filter</h4>
<ul>
<li>ä»¥è¨»è§£æ–¹å¼è£½ä½œFilter</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">* ç¶²è·¯ä¸Šæ•™å­¸è »å¤šéƒ½æ˜¯implenments filterï¼Œä½†æˆ‘å»ºè­°extend GenericFilterBean
</span></span></span><span class="line"><span class="cl"><span class="cm">* æœƒæ¯”è¼ƒæ–¹ä¾¿ä¸€é»ï¼Œçœå»implenments init(), distory()çš„éº»ç…© 
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="nd">@WebFilter</span><span class="o">(</span><span class="n">filterName</span> <span class="o">=</span> <span class="s">&#34;f1&#34;</span><span class="o">,</span><span class="n">urlPatterns</span> <span class="o">=</span> <span class="o">{</span><span class="s">&#34;*.html&#34;</span><span class="o">,</span><span class="s">&#34;*.jsp&#34;</span><span class="o">,</span><span class="s">&#34;/&#34;</span><span class="o">})</span>  <span class="c1">//filterNameå°±åªæ˜¯ä¸€å€‹åç¨±å¯ä»¥ï¼Œéš¨æ„å°±å¥½ï¼ŒurlPatternæ˜¯ç”¨ä¾†æŒ‡å®šå“ªäº›urlè¦ç¶“éé€™å€‹éæ¿¾å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HiFilter</span> <span class="kd">extends</span> <span class="n">GenericFilterBean</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hello Hoxton&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span> <span class="c1">//ä»£è¡¨é€™å€‹Filterå·²ç¶“ä½œç”¨å®Œç•¢ï¼Œå¯ä»¥æŠŠrequest,responseäº¤çµ¦ä¸‹ä¸€å€‹Filteräº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://i.imgur.com/R9tNv8y.png"
	
	
	
	loading="lazy"
	
		alt="image-20220912151657403"
	
	
></p>
<p>çµæœå¦‚ä¸Š</p>
<ul>
<li>ä»¥Javaé…ç½®æ–¹å¼è£½ä½œFilter</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Slf4j</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">* ç¶²è·¯ä¸Šæ•™å­¸è »å¤šéƒ½æ˜¯implenments filterï¼Œä½†æˆ‘å»ºè­°extend GenericFilterBean
</span></span></span><span class="line"><span class="cl"><span class="cm">* æœƒæ¯”è¼ƒæ–¹ä¾¿ä¸€é»ï¼Œçœå»implenments init(), distory()çš„éº»ç…© 
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HiFilter</span> <span class="kd">extends</span> <span class="n">GenericFilterBean</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="n">ServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">ServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">ServletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">&#34;Hello Hoxton&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">      <span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>  <span class="c1">//ä»£è¡¨é€™å€‹Filterå·²ç¶“ä½œç”¨å®Œç•¢ï¼Œå¯ä»¥æŠŠrequest,responseäº¤çµ¦ä¸‹ä¸€å€‹Filteräº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">FilterRegistrationBean</span> <span class="nf">heFilterRegistration</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">FilterRegistrationBean</span> <span class="n">registration</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">(</span><span class="k">new</span> <span class="n">HiFilter</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">registration</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">&#34;/*&#34;</span><span class="o">);</span> <span class="c1">//é…ç½®ç›¸é—œçš„è·¯å¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="n">registration</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ä¸€äº›å…¶ä»–çš„configè¨­ç½®ï¼Œåƒ…ä¾›åƒè€ƒï¼Œèˆ‡ä¸Šé¢é‡‹ä¾‹ç„¡é—œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterConfig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl"><span class="c1">//test
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="nf">logProcessTimeFilter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="n">bean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">LogProcessTimeFilter</span><span class="o">());</span> <span class="c1">//è¨­å®šæƒ³è¦ä½¿ç”¨å“ªä¸€å€‹Filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">&#34;/*&#34;</span><span class="o">);</span> <span class="c1">//è¨­ç½®å“ªäº›urlæœƒè§¸ç™¼Filterï¼Œè¨­ç½®æˆ/* å°±ä»£è¡¨å…¨éƒ¨éƒ½æœƒåƒåˆ°ï¼Œ/user/*å°±ä»£è¡¨/useré–‹é ­çš„éƒ½æœƒåƒåˆ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;logProcessTimeFilter&#34;</span><span class="o">);</span> <span class="c1">//è¨­ç½®è¦å«ä»€éº¼åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">0</span><span class="o">);</span> <span class="c1">//è¨­å®šéæ¿¾å™¨çš„åŸ·è¡Œé †åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="nf">logApiFilter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="n">bean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">LogApiFilter</span><span class="o">());</span> <span class="c1">//è¨­å®šæƒ³è¦ä½¿ç”¨å“ªä¸€å€‹Filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">&#34;/*&#34;</span><span class="o">);</span> <span class="c1">//è¨­ç½®å“ªäº›urlæœƒè§¸ç™¼Filterï¼Œè¨­ç½®æˆ/* å°±ä»£è¡¨å…¨éƒ¨éƒ½æœƒåƒåˆ°ï¼Œ/user/*å°±ä»£è¡¨/useré–‹é ­çš„éƒ½æœƒåƒåˆ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;logApiFilter&#34;</span><span class="o">);</span> <span class="c1">//è¨­ç½®è¦å«ä»€éº¼åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">1</span><span class="o">);</span> <span class="c1">//è¨­å®šéæ¿¾å™¨çš„åŸ·è¡Œé †åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="nf">printResponseRequestFilter</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">FilterRegistrationBean</span><span class="o">&lt;</span><span class="n">Filter</span><span class="o">&gt;</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilterRegistrationBean</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">  <span class="n">bean</span><span class="o">.</span><span class="na">setFilter</span><span class="o">(</span><span class="k">new</span> <span class="n">PrintResponseRequest</span><span class="o">());</span> <span class="c1">//è¨­å®šæƒ³è¦ä½¿ç”¨å“ªä¸€å€‹Filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">addUrlPatterns</span><span class="o">(</span><span class="s">&#34;/*&#34;</span><span class="o">);</span> <span class="c1">//è¨­ç½®å“ªäº›urlæœƒè§¸ç™¼Filterï¼Œè¨­ç½®æˆ/* å°±ä»£è¡¨å…¨éƒ¨éƒ½æœƒåƒåˆ°ï¼Œ/user/*å°±ä»£è¡¨/useré–‹é ­çš„éƒ½æœƒåƒåˆ°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">&#34;printResponseRequestFilter&#34;</span><span class="o">);</span> <span class="c1">//è¨­ç½®è¦å«ä»€éº¼åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="n">bean</span><span class="o">.</span><span class="na">setOrder</span><span class="o">(</span><span class="n">2</span><span class="o">);</span> <span class="c1">//è¨­å®šéæ¿¾å™¨çš„åŸ·è¡Œé †åº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></blockquote>
<p>SpringBootæœ¬èº«ä¹Ÿæä¾›äº†è¨±å¤šä¸åŒçš„Filterä¾›ä½¿ç”¨ï¼Œåƒè€ƒå¦‚ä¸‹</p>
<p><img src="https://i.imgur.com/nKZ6Hy1.png"
	
	
	
	loading="lazy"
	
		alt="image-20220912153023872"
	
	
></p>
<p>å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å¹¾å€‹</p>
<ul>
<li>CharacterEncodingFilter(ç”¨æ–¼è™•ç†ç·¨ç¢¼å•é¡Œ)</li>
<li>HiddenHttpMethodFilter(éš±è—Httpå‡½æ•¸)</li>
<li>HttpPutFormContentFilter(formè¡¨å–®è™•ç†)</li>
<li>RequesrtContextFilter(è«‹æ±‚ä¸Šä¸‹æ–‡)</li>
</ul>
<p>å…¶ä»–è³‡è¨Šå¯ä»¥è©³é–±<a class="link" href="https://blog.csdn.net/qyp1314/article/details/42023725"  target="_blank" rel="noopener"
    >Spring MVCä¸­å„ä¸ªfilterçš„ç”¨æ³•</a></p>
<p>å…¶ä¸­ä»¥<strong>OncePerRequestFilter</strong>æœ€å¸¸è¢«ä½¿ç”¨ï¼Œé€™å€‹Filteræœƒå»<strong>éæ¿¾æ¯ä¸€å€‹Requestè«‹æ±‚ï¼Œä¸”ä¸æœƒé‡è¤‡åŸ·è¡Œ</strong>ï¼Œä¸”é€™å€‹Filteræœ‰ä¸€å€‹doFilterInternal()çš„æ–¹æ³•ï¼Œä¾›æˆ‘å€‘æ’°å¯«Filteré‚è¼¯<code>å› doFilter()çš„æ–¹æ³•å·²åœ¨OncePerRequestFilterè£¡é¢å¯¦ç¾äº†</code>ï¼Œå¯ä»¥ç”¨ä¾†åšJwtokençš„ç™»å…¥é©—è­‰ï¼Œç¨‹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Component</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtAuthenticationFilter</span> <span class="kd">extends</span> <span class="n">OncePerRequestFilter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">JwtService</span> <span class="n">jwtService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">UserDetailsService</span> <span class="n">userDetailsService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//æ³¨å…¥JwtService UserDetailsServiceï¼Œåˆ†åˆ¥ç”¨ä¾†è§£æTokenèˆ‡æŸ¥è©¢ä½¿ç”¨è€…è©³æƒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span>          <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">authHeader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="n">HttpHeaders</span><span class="o">.</span><span class="na">AUTHORIZATION</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">authHeader</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">authHeader</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="s">&#34;Bearer &#34;</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å¾è«‹æ±‚æ¨™é ­ä¸­å–å¾—Authorizationæ¬„ä½ä¸­çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">claims</span> <span class="o">=</span> <span class="n">jwtService</span><span class="o">.</span><span class="na">parseToken</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//æ“·å–å‡ºå¾Œé¢çš„JWTå­—ä¸²ï¼Œæ¥è‘—è§£æå®ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">username</span> <span class="o">=</span> <span class="o">(</span><span class="n">String</span><span class="o">)</span> <span class="n">claims</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;username&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//å¾claimsç‰©ä»¶ä¸­å–å¾—usernameæ¬„ä½çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">UserDetails</span> <span class="n">userDetails</span> <span class="o">=</span> <span class="n">userDetailsService</span><span class="o">.</span><span class="na">loadUserByUsername</span><span class="o">(</span><span class="n">username</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//ä¸¦é€éuserDetailServiceæŸ¥è©¢ä½¿ç”¨è€…è©³æƒ…ã€‚é€™ä¹Ÿä»£è¡¨JWTçš„å…§å®¹(payload)å¿…é ˆåŒ…å«usernameé€™å€‹æ¬„ä½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//åœ¨filterä¸­æŸ¥è©¢ä½¿ç”¨è€…çš„ç›®çš„ï¼Œæ˜¯ç‚ºäº†å°‡è©²æ¬¡è«‹æ±‚æ‰€ä»£è¡¨çš„é©—è­‰å¾Œè³‡æ–™(Authentication)å¸¶é€²securityä¸­çš„Contextã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//Contextæ˜¯ä¸€ç¨®è¼ƒæŠ½è±¡çš„æ¦‚å¿µï¼Œå¯ä»¥æƒ³åƒæˆè©²æ¬¡è«‹æ±‚çš„èº«åˆ†ç‹€æ…‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="n">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UsernamePasswordAuthenticationToken</span><span class="o">(</span><span class="n">userDetails</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="n">userDetails</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//ç‚ºäº†å°‡é€™å€‹è«‹æ±‚çš„ä½¿ç”¨è€…èº«åˆ†å‘Šè¨´ä¼ºæœå™¨ï¼Œæˆ‘å€‘å»ºç«‹UsernamePasswordAuthenticationTokençš„ç‰©ä»¶ï¼Œå…¶ä¸­ç¬¬ä¸‰å€‹åƒæ•¸æ”¾GrantedAuthorityçš„Listï¼Œ              ä½œç‚ºAPIçš„æˆæ¬Šæª¢æŸ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//ç¬¬ä¸€å€‹åƒæ•¸(principal)å‚³å…¥ä½¿ç”¨è€…è©³è«‹(UserDetails)ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// è€Œç¬¬äºŒå€‹åƒæ•¸æ˜¯credentialï¼Œé€šå¸¸æ˜¯å¯†ç¢¼ï¼Œä½†ä¸å‚³å…¥ä¹Ÿç„¡è¨ª
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//ç¶“ç”±å‚³å…¥principalï¼Œæˆ‘å€‘å¾—ä»¥åœ¨æ¥­å‹™é‚è¼¯ä¸­å¾Contextè¼•æ˜“ç²å–ä½¿ç”¨è€…èº«åˆ†çš„è³‡æ–™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®å®Œå¾Œå†å°‡é€™å€‹FilteråŠ å…¥Securityçš„éæ¿¾éŠ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@EnableWebSecurity</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SecurityConfig</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span>   <span class="n">UserDetailsService</span> <span class="n">userDetailsService</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">JwtAuthenticationFilter</span> <span class="n">jwtAuthenticationFilter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * å”åŠ©å¸³è™Ÿå¯†ç¢¼èªè­‰çš„æ±è¥¿
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">AuthenticationManager</span> <span class="nf">authenticationManagerBean</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kd">super</span><span class="o">.</span><span class="na">authenticationManagerBean</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//åŠ å…¥Securityçš„éæ¿¾éŠ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span><span class="o">.</span><span class="na">authorizeHttpRequests</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span> <span class="s">&#34;/users/**&#34;</span><span class="o">).</span><span class="na">hasAuthority</span><span class="o">(</span><span class="n">MemberAuthority</span><span class="o">.</span><span class="na">SYSTEM_ADMIN</span><span class="o">.</span><span class="na">name</span><span class="o">())</span>
</span></span><span class="line"><span class="cl"><span class="c1">//                .antMatchers(HttpMethod.GET,&#34;/h2/**&#34;).hasAuthority(MemberAuthority.SYSTEM_ADMIN.name())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="n">HttpMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">,</span><span class="s">&#34;/login/**&#34;</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="c1">//                .antMatchers(HttpMethod.POST,&#34;login&#34;).permitAll()
</span></span></span><span class="line"><span class="cl"><span class="c1">//                .antMatchers(HttpMethod.POST, &#34;/users&#34;).permitAll()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">.</span><span class="na">anyRequest</span><span class="o">().</span><span class="na">permitAll</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">addFilterBefore</span><span class="o">(</span><span class="n">jwtAuthenticationFilter</span><span class="o">,</span> <span class="n">UsernamePasswordAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">//æ–¼UsernamePasswordAuthenticationFilteré€²è¡Œèªè­‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">.</span><span class="na">sessionManagement</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">sessionCreationPolicy</span><span class="o">(</span><span class="n">SessionCreationPolicy</span><span class="o">.</span><span class="na">STATELESS</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">                <span class="o">.</span><span class="na">formLogin</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">http</span><span class="o">.</span><span class="na">headers</span><span class="o">().</span><span class="na">frameOptions</span><span class="o">().</span><span class="na">disable</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è®“spring Securityå¯ä»¥å’Œh2å»ºç«‹é€£ç·š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param auth é…ç½®å…¨å±€é©—è­‰è³‡è¨Šï¼Œå¦‚Authentication Provider,UserDetailServiceç­‰ç­‰è³‡è¨Šï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">     *             authenticationManageræœƒæ¥æ”¶åˆ°UsernamePasswordAuthenticationTokenå‚³å…¥çš„è³‡æ–™å¾Œ
</span></span></span><span class="line"><span class="cl"><span class="cm">     *             èª¿ç”¨SecurityConfigä¸­æ‰€é…ç½®çš„userDetailsService,passwordEncoderä¾†å”åŠ©é©—è­‰
</span></span></span><span class="line"><span class="cl"><span class="cm">     *
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws Exception
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="n">AuthenticationManagerBuilder</span> <span class="n">auth</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">auth</span><span class="o">.</span><span class="na">userDetailsService</span><span class="o">(</span><span class="n">userDetailsService</span><span class="o">).</span><span class="na">passwordEncoder</span><span class="o">(</span><span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€äº›Codeçš„ç¤ºç¯„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogProcessTimeFilter</span> <span class="kd">extends</span> <span class="n">OncePerRequestFilter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param request     è«‹æ±‚
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param response    å›æ‡‰
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param filterChain éæ¿¾éˆ æœƒå°‡ç¾æœ‰çš„filterçµ¦ä¸²è¯èµ·ä¾†ï¼Œç•¶è«‹æ±‚é€²å…¥å¾Œç«¯ï¼Œéœ€è¦ä¾åºç¶“éå®ƒå€‘æ‰æœƒé”åˆ°Controllerï¼Œç›¸å°çš„ï¼Œç•¶å›æ‡‰é›¢é–‹Controllerï¼Œå‰‡æ˜¯æŒ‰ç…§ç›¸åçš„æ–¹å‘ç¶“éé‚£äº›Filter
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws ServletException
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @throws IOException
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span> <span class="c1">//doFilter:ç›¸ç•¶æ–¼å°‡è«‹æ±‚é€è‡³Controllerã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">processTime</span> <span class="o">=</span> <span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;processTime = &#34;</span> <span class="o">+</span> <span class="n">processTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Controlleræ”¶åˆ°çš„è«‹æ±‚ä¸»é«”(RequestBody)å’Œå›æ‡‰ä¸»é«”(ResponseBody)
</span></span></span><span class="line"><span class="cl"><span class="cm"> * åˆ†åˆ¥ç”±HttpServletRequestèˆ‡HttpServletResponseçš„InputStreamã€OutputStreamè½‰åŒ–è€Œä¾†ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä½†è³‡æ–™æµåªèƒ½è®€å–ä¸€æ¬¡ï¼Œå¦‚æœåœ¨Filterå±¤å°±è¢«è®€æ‰ï¼Œå¯èƒ½æœƒå°è‡´å¾Œé¢éƒ½æ”¶ä¸åˆ°è³‡æ–™
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ç‚ºäº†ä¿ç•™ä¸»é«”ä¸­çš„è³‡æ–™ï¼Œæˆ‘å€‘å°‡è«‹æ±‚ä¸»é«”èˆ‡å›æ‡‰ä¸»é«”åŒ…è£æˆContentCachingResponseWrapper ContentCachingRequestWrapper
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å†å¦‚åŒå¾€å¸¸å‚³å…¥FilterChain
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * é€™å…©å€‹Wrapperçš„ç‰¹è‰²æ˜¯æœƒåœ¨å…§éƒ¨å‚™ä»½ä¸€å€‹ByteArrayOutputStreamï¼Œæˆ‘å€‘åªè¦å‘¼å«é€™å…©å€‹Wrapperçš„
</span></span></span><span class="line"><span class="cl"><span class="cm"> * getContentAsByteArrayå°±å¯ä»¥ç„¡é™åˆ¶åœ°å–å¾—ä¸»é«”å…§å®¹
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PrintResponseRequest</span> <span class="kd">extends</span> <span class="n">OncePerRequestFilter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ContentCachingRequestWrapper</span> <span class="n">requestWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentCachingRequestWrapper</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ContentCachingResponseWrapper</span> <span class="n">responseWrapper</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentCachingResponseWrapper</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">requestWrapper</span><span class="o">,</span> <span class="n">responseWrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//        logApi(request, response);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">logBody</span><span class="o">(</span><span class="n">requestWrapper</span><span class="o">,</span><span class="n">responseWrapper</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">responseWrapper</span><span class="o">.</span><span class="na">copyBodyToResponse</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">logApi</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">httpStatus</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatus</span><span class="o">();</span> <span class="c1">//200,403,404ä¹‹é¡çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">httpMethod</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">params</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getQueryString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">params</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">uri</span> <span class="o">+=</span> <span class="s">&#34;?&#34;</span> <span class="o">+</span> <span class="n">params</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="s">&#34; &#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">httpStatus</span><span class="o">),</span> <span class="n">httpMethod</span><span class="o">,</span> <span class="n">uri</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">logBody</span><span class="o">(</span><span class="n">ContentCachingRequestWrapper</span> <span class="n">request</span><span class="o">,</span> <span class="n">ContentCachingResponseWrapper</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">requestBody</span> <span class="o">=</span> <span class="n">getContent</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">getContentAsByteArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Request: &#34;</span> <span class="o">+</span> <span class="n">requestBody</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">getContent</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getContentAsByteArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Response: &#34;</span> <span class="o">+</span> <span class="n">responseBody</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @param content
</span></span></span><span class="line"><span class="cl"><span class="cm">     * @return è¿”å›JSONå­—ä¸²
</span></span></span><span class="line"><span class="cl"><span class="cm">     */</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="nf">getContent</span><span class="o">(</span><span class="kt">byte</span> <span class="o">[]</span> <span class="n">content</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">content</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">body</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&#34;[\n\t]&#34;</span><span class="o">,</span> <span class="s">&#34;&#34;</span><span class="o">);</span> <span class="c1">//å»é™¤æ›è¡Œ\nèˆ‡å®šä½ç¬¦è™Ÿ\t
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="interceptor">Interceptor</h2>
<p>æœ¬èº«æ˜¯AOPçš„ä¸€ç¨®æ‡‰ç”¨ï¼Œå…¶å¯¦æ””æˆªå™¨è·Ÿéæ¿¾å™¨æ˜¯å¯ä»¥äº’ç›¸æ›¿æ›çš„ï¼ŒåŠŸèƒ½å…¶å¯¦å·®ä¸å¤šï¼Œåªæ˜¯<strong>æ””æˆªå™¨å¯ä»¥åœ¨è«‹æ±‚åˆ°é”Controlleræˆ–æ˜¯å›æ‡‰å›å‚³å‡ºContrlleræ™‚é€²è¡Œæ””æˆª</strong>ï¼Œæ””æˆªæˆåŠŸæ™‚å¯ä»¥å¯¦åšä¸€äº›è‡ªå®šç¾©çš„æ¥­å‹™é‚è¼¯é€²è¡Œä¿®æ”¹ï¼Œä¸”Interceptoræ˜¯Springbootä¸‹çš„ä¸€å€‹åŠŸèƒ½<code>org.springframework.web.servlet.HandlerInterceptor</code></p>
<p>å¯ä»¥ç”¨ä¾†</p>
<ul>
<li>æ€§èƒ½ç›£æ§ï¼šç´€éŒ„è«‹æ±‚çš„è™•ç†æ™‚é–“ï¼Œæ¯”å¦‚èªªè«‹æ±‚è™•ç†å¤ªä¹…ï¼ˆè¶…é500æ¯«ç§’ï¼‰</li>
<li>ç™»å…¥æª¢æ¸¬</li>
<li></li>
</ul>
<p><img src="https://i.imgur.com/1qACg6a.png"
	
	
	
	loading="lazy"
	
		alt="image-20220912164539364"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">graph LR;
</span></span><span class="line"><span class="cl">request--&gt;id1
</span></span><span class="line"><span class="cl">id1--&gt;id2--&gt;id4--&gt;id3--&gt;id6--&gt;id5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">subgraph  æ””æˆªå™¨1
</span></span><span class="line"><span class="cl">direction TB
</span></span><span class="line"><span class="cl">id1[&#34;preHandle()&#34;] 
</span></span><span class="line"><span class="cl">id3[&#34;postHandler()&#34;]
</span></span><span class="line"><span class="cl">id5[&#34;afterCompletion()&#34;]
</span></span><span class="line"><span class="cl"> end
</span></span><span class="line"><span class="cl">subgraph  æ””æˆªå™¨2
</span></span><span class="line"><span class="cl">direction TB
</span></span><span class="line"><span class="cl">id2[&#34;preHandle()&#34;]
</span></span><span class="line"><span class="cl">id4[&#34;postHandler()&#34;]
</span></span><span class="line"><span class="cl">id6[&#34;afterCompletion()&#34;]
</span></span><span class="line"><span class="cl"> end
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å¯¦ç¾interceptoræœ‰å…©ç¨®æ–¹å¼</p>
<ol>
<li>å¯¦ä½œHandlerInterceptor</li>
<li>ç¹¼æ‰¿HandlerInterceptorAdapter</li>
</ol>
<p>é‡‹ä¾‹</p>
<ul>
<li>è‡ªå®šç¾©æ””æˆªå™¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">LogInterceptor</span> <span class="kd">extends</span> <span class="n">HandlerInterceptorAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;\n-------- LogInterception.preHandle --- &#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Request URL: &#34;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Start Time: &#34;</span> <span class="o">+</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">&#34;startTime&#34;</span><span class="o">,</span> <span class="n">startTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;\n-------- LogInterception.postHandle --- &#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Request URL: &#34;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;\n-------- LogInterception.afterCompletion --- &#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">startTime</span> <span class="o">=</span> <span class="o">(</span><span class="n">Long</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;startTime&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">long</span> <span class="n">endTime</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Request URL: &#34;</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;End Time: &#34;</span> <span class="o">+</span> <span class="n">endTime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;Time Taken: &#34;</span> <span class="o">+</span> <span class="o">(</span><span class="n">endTime</span> <span class="o">-</span> <span class="n">startTime</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>è¨»å†Šæ””æˆªå™¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Configuration</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WebConfig</span> <span class="kd">implements</span> <span class="n">WebMvcConfigurer</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addInterceptors</span><span class="o">(</span><span class="n">InterceptorRegistry</span> <span class="n">registry</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">LogInterceptor</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">OldLoginInterceptor</span><span class="o">()).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/admin/oldLogin&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">registry</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="k">new</span> <span class="n">AdminInterceptor</span><span class="o">()).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&#34;/admin/*&#34;</span><span class="o">).</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="s">&#34;/admin/oldLogin&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="aspectj-1">AspectJ</h2>
<p>å±¬æ–¼ä¸€ç¨®AOPæ¡†æ¶</p>
<ul>
<li>å‹•æ…‹ä»£ç†(Spring5æœ¬èº«å·²ç¶“å°è£äº†)
<ul>
<li>æœ‰å…©ç¨®æƒ…æ³çš„å‹•æ…‹ä»£ç†
<ul>
<li>
<p>æœ‰ä»‹é¢(JDKå‹•æ…‹ä»£ç†)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nc">UserDao</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span>ã€€<span class="n">UserDao</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">(){</span>  
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å‰µå»ºUserDaoä»‹é¢å¯¦ç¾é¡çš„ä»£ç†å°è±¡ï¼Œä»£ç†å°è±¡æœƒæœ‰è¢«ä»£ç†å°è±¡çš„æ‰€æœ‰æ–¹æ³•ï¼Œä¸¦ä¸”å¢å¼·</p>
</li>
<li>
<p>ç„¡ä»‹é¢(CGLIBå‹•æ…‹ä»£ç†)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">User</span><span class="o">{</span>
</span></span><span class="line"><span class="cl"> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span> <span class="o">(){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="o">}</span>   
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">Person</span> <span class="kd">extends</span> <span class="n">User</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="kd">super</span><span class="o">.</span><span class="na">add</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="aopjdkå‹•æ…‹ä»£ç†">AOP(JDKå‹•æ…‹ä»£ç†)</h3>
<p>ä½¿ç”¨JDKçš„å‹•æ…‹ä»£ç†ï¼Œè¦ä½¿ç”¨Proxyé¡è£¡é¢çš„æ–¹æ³•ä¾†å‰µå»ºå‡ºä»£ç†å°è±¡ <code>newProxyInstance(é¡åŠ è¼‰å™¨,å¢å¼·æ–¹æ³•æ‰€åœ¨çš„é¡ï¼Œé€™å€‹é¡å¯¦ç¾çš„ä»‹é¢,å¯¦ç¾é€™å€‹æ¥å£(InvocationHandler)</code></p>
<p><img src="https://raw.githubusercontent.com/Hoxton019030/image/main/data/202209061536485.png"
	
	
	
	loading="lazy"
	
	
></p>
<p>ç·¨å¯«JDKå‹•æ…‹ä»£ç¢¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDao</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span> <span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span><span class="kt">int</span> <span class="n">b</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDaoImpl</span> <span class="kd">implements</span> <span class="n">UserDao</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">b</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;addæ–¹æ³•åŸ·è¡Œäº†&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">update</span><span class="o">(</span><span class="n">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.aop</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @author Hoxton
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @version 1.1.0
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JDKProxy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Class</span><span class="o">[]</span> <span class="n">interfaces</span> <span class="o">=</span> <span class="o">{</span><span class="n">UserDao</span><span class="o">.</span><span class="na">class</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">UserDaoImpl</span> <span class="n">userDao</span> <span class="o">=</span> <span class="k">new</span> <span class="n">UserDaoImpl</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">UserDao</span> <span class="n">dao</span> <span class="o">=</span> <span class="o">(</span><span class="n">UserDao</span><span class="o">)</span> <span class="n">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">JDKProxy</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span> <span class="n">interfaces</span><span class="o">,</span> <span class="k">new</span> <span class="n">UserDaoProxy</span><span class="o">(</span><span class="n">userDao</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ­¤daoå·²ç¶“ä¸æ˜¯åŸæœ¬çš„daoï¼Œè€Œæ˜¯æ–°çš„ä»£ç†é¡daoäº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">1</span><span class="o">,</span> <span class="n">2</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;result = &#34;</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å‰µå»ºä»£ç†å°è±¡çš„ä»£ç¢¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">class</span> <span class="nc">UserDaoProxy</span> <span class="kd">implements</span> <span class="n">InvocationHandler</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//1. æŠŠå‰µå»ºçš„æ˜¯èª°çš„ä»£ç†å°è±¡ï¼ŒæŠŠèª°å‚³éé€²ä¾†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// æœ‰åƒå»ºæ§‹å­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Object</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">UserDaoProxy</span><span class="o">(</span><span class="n">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="o">.</span><span class="na">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">//å¢å¼·çš„é‚è¼¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="n">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="n">Method</span> <span class="n">method</span><span class="o">,</span> <span class="n">Object</span><span class="o">[]</span> <span class="n">methodArgs</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Throwable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//æ–¹æ³•ä¹‹å‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ–¹æ³•ä¹‹å‰åŸ·è¡Œ...&#34;</span> <span class="o">+</span> <span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&#34;å‚³éçš„åƒæ•¸...&#34;</span> <span class="o">+</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">methodArgs</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è¢«å¢å¼·çš„æ–¹æ³•åŸ·è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">Object</span> <span class="n">res</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">methodArgs</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ–¹æ³•ä¹‹å¾Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;æ–¹æ³•ä¹‹å¾ŒåŸ·è¡Œ...&#34;</span> <span class="o">+</span> <span class="n">obj</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">res</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="aopå°ˆæ¥­è¡“èª">AOPå°ˆæ¥­è¡“èª</h3>
<ol>
<li>
<p>é€£æ¥é»</p>
<p>ä¸€å€‹é¡è£¡é¢ä¸­ï¼Œèƒ½è¢«å¢å¼·çš„æ–¹æ³•å°±å«é€£æ¥é»ï¼Œä¸‹é¢é€™å€‹é¡å°±æœ‰å››å€‹é€£æ¥é»</p>
<p><img src="https://raw.githubusercontent.com/Hoxton019030/image/main/data/202209121200728.png"
	
	
	
	loading="lazy"
	
		alt="image-20220912120043665"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">class</span> <span class="nc">User</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">add</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">update</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">select</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">delete</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>åˆ‡å…¥é»</p>
<p>å¯¦éš›è¢«å¢å¼·çš„æ–¹æ³•ï¼Œå°±å«åˆ‡å…¥é»</p>
</li>
<li>
<p>é€šçŸ¥(å¢å¼·)</p>
<ol>
<li>
<p>å¯¦éš›å¢å¼·çš„é‚è¼¯éƒ¨åˆ†ç¨±ç‚ºé€šçŸ¥(å¢å¼·)</p>
</li>
<li>
<p>é€šçŸ¥æœ‰å¤šç¨®é¡å‹</p>
<ol>
<li>
<p>å‰ç½®é€šçŸ¥</p>
<p>åœ¨åˆ‡å…¥é»å‰åŸ·è¡Œ</p>
</li>
<li>
<p>å¾Œç½®é€šçŸ¥</p>
<p>åœ¨åˆ‡å…¥é»å¾ŒåŸ·è¡Œ</p>
</li>
<li>
<p>ç’°ç¹é€šçŸ¥</p>
<p>åœ¨åˆ‡å…¥é»å‰å¾ŒåŸ·è¡Œ</p>
</li>
<li>
<p>ç•°å¸¸é€šçŸ¥</p>
<p>å‡ºç¾ç•°å¸¸æ™‚åŸ·è¡Œ</p>
</li>
<li>
<p>æœ€çµ‚é€šçŸ¥</p>
<p>åŸ·è¡Œåˆ°try&hellip;catchçš„finalæ™‚åŸ·è¡Œ</p>
</li>
</ol>
</li>
</ol>
</li>
<li>
<p>åˆ‡é¢</p>
<p>æ˜¯ä¸€å€‹å‹•ä½œ</p>
<ol>
<li>æŠŠé€šçŸ¥æ‡‰ç”¨åˆ°åˆ‡å…¥é»çš„éç¨‹ï¼Œå°±å«åˆ‡é¢</li>
</ol>
</li>
</ol>
<h3 id="aopæº–å‚™">AOP(æº–å‚™)</h3>
<ol>
<li>
<p>Spring æ¡†æ¶ä¸€èˆ¬éƒ½æ˜¯åŸºæ–¼AspectJå¯¦ç¾çš„AOPæ“ä½œ</p>
<ol>
<li>
<p>ä»€éº¼æ˜¯AspectJ</p>
<ul>
<li>AspectJä¸æ˜¯Springçš„çµ„æˆéƒ¨åˆ†ï¼Œæ˜¯ä¸€å€‹ç¨ç«‹çš„AOPæ¡†æ¶ï¼Œ ä¸€èˆ¬æŠŠAspectJå’ŒSpringæ¡†æ¶ä¸€èµ·ä½¿ç”¨ï¼Œé€²è¡ŒAOPæ“ä½œ</li>
</ul>
</li>
<li>
<p>åŸºæ–¼Aspectå¯¦ç¾AOPæ“ä½œ</p>
<ol>
<li>xmlé…ç½®æ–‡ä»¶å¯¦ç¾</li>
<li>åŸºæ–¼è¨»è§£æ–¹æ³•å¯¦ç¾(ä¸»è¦ä½¿ç”¨)</li>
</ol>
</li>
<li>
<p>å†å°ˆæ¡ˆè£¡é¢å¼•å…¥AOPä¾è³´</p>
</li>
<li>
<p>åˆ‡å…¥é»è¡¨é”å¼</p>
<ol>
<li>
<p>åˆ‡å…¥é»è¡¨é”å¼çš„ä½œç”¨: çŸ¥é“å°å“ªå€‹é¡çš„å“ªå€‹æ–¹æ³•é€²è¡Œå¢å¼·</p>
</li>
<li>
<p>èªæ³•çµæ§‹:</p>
<p>execution( [æ¬Šé™ä¿®é£¾ç¬¦] [è¿”å›é¡å‹] [é¡å…¨è·¯å¾‘] [æ–¹æ³•åç¨±] ( [åƒæ•¸åˆ—è¡¨] ) )</p>
<ul>
<li>
<p>æ¬Šé™ä¿®é£¾ç¬¦: public, private, *(ä»£è¡¨ä¸è«–æ˜¯public, private éƒ½é¸)</p>
</li>
<li>
<p>è¿”å›é¡å‹: String, int</p>
</li>
<li>
<p>é¡å…¨è·¯å¾‘: com.hoxton&hellip;&hellip;.</p>
</li>
<li>
<p>æ–¹æ³•åç¨±: å°±æ–¹æ³•åç¨±</p>
</li>
<li>
<p>åƒæ•¸åˆ—è¡¨: æœ‰å“ªäº›åƒæ•¸</p>
<p>èˆ‰ä¾‹</p>
<ol>
<li>
<p>å°com.hoxton.dao.BookDaoé¡è£¡é¢çš„addæ–¹æ³•é€²è¡Œå¢å¼·</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="o">(*</span> <span class="n">com</span><span class="o">.</span><span class="na">hoxton</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">BookDao</span><span class="o">.</span><span class="na">add</span><span class="o">(..)</span> <span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>å°com.hoxton.dao.BookDaoé¡çš„æ‰€æœ‰æ–¹æ³•é€²è¡Œå¢å¼·</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">execution</span><span class="o">(*</span> <span class="n">com</span><span class="o">.</span><span class="na">hoxton</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">BookDao</span><span class="o">.*(..))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>å°com.hoxton.daoåŒ…è£¡çš„æ‰€æœ‰é¡ï¼Œé¡è£¡é¢çš„é«“æœ‰æ–¹æ³•é€²è¡Œå¢å¼·</p>
<ul>
<li>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">excution</span><span class="o">(*</span> <span class="n">com</span><span class="o">.</span><span class="na">hoxton</span><span class="o">.</span><span class="na">dao</span><span class="o">.*.*(..))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ol>
</li>
</ul>
<p>within([packageå].* )æˆ–( [packageå]..*)</p>
<p>èˆ‰ä¾‹</p>
<p>1. 
1.</p>
</li>
</ol>
</li>
</ol>
</li>
</ol>
<h3 id="aopæ“ä½œaspect-j--è¨»è§£">AOPæ“ä½œ(Aspect J  è¨»è§£)</h3>
<ol>
<li>å‰µå»ºé¡ï¼Œåœ¨é¡è£¡é¢å®šç¾©æ–¹æ³•</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;add&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>
<p>å‰µå»ºå¢å¼·é¡(ç·¨å¯«å¢å¼·é‚è¼¯)</p>
<ol>
<li>
<p>åœ¨å¢å¼·é¡çš„è£¡é¢ï¼Œå‰µå»ºæ–¹æ³•ï¼Œè®“ä¸åŒæ–¹æ³•ä»£è¡¨ä¸åŒé€šçŸ¥é¡å‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserProxy</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">before</span><span class="o">(){</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;before&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
</li>
<li>
<p>é€²è¡Œé€šçŸ¥çš„é…ç½®</p>
<ol>
<li>åœ¨Spring</li>
</ol>
</li>
</ol>
<h1 id="log4j-2">Log4j 2</h1>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">flowchart TD;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">8[&#34;ALL(å…¨è¼¸å‡ºä¸ç•™æƒ…)&#34;]---&gt;7[&#34;Trace(æ›´ç´°çš„é™¤éŒ¯è³‡è¨Šï¼Œé€šå¸¸ç”¨ä¾†è¿½è¹¤åŸå¸‚æµç¨‹çš„æ—¥èªŒ)&#34;]---&gt;6[&#34;DEBUG(é™¤éŒ¯è³‡è¨Šçš„æ—¥å¿—)æ¨è–¦â˜…&#34;]---&gt;5[&#34;INFO(ä¸€èˆ¬è³‡è¨Šçš„æ—¥å¿—)æ¨è–¦â˜…&#34;]---&gt;4[&#34;WARN(å¯èƒ½å°è‡´éŒ¯èª¤çš„æ—¥å¿—)&#34;]---&gt;3[&#34;ERROR(é€ æˆæ‡‰ç”¨éŒ¯èª¤åœæ­¢çš„æ—¥å¿—)&#34;]---&gt;2[&#34;FETAL(é€ æˆæ‡‰ç”¨ç¨‹å¼åœæ­¢çš„æ—¥å¿—)&#34;]---&gt;1[&#34;OFF(ä¸è¼¸å‡ºä»»ä½•æ—¥å¿—)&#34;]
</span></span></code></pre></td></tr></table>
</div>
</div><h1 id="åƒè€ƒ">åƒè€ƒ</h1>
<p><a class="link" href="https://www.cnblogs.com/itlihao/p/14329905.html"  target="_blank" rel="noopener"
    >https://www.cnblogs.com/itlihao/p/14329905.html</a></p>
<p><a class="link" href="https://blog.csdn.net/fly910905/article/details/86537648"  target="_blank" rel="noopener"
    >https://blog.csdn.net/fly910905/article/details/86537648</a></p>
<p><a class="link" href="https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/712557/"  target="_blank" rel="noopener"
    >SpringBootæ””æˆªå™¨(Interceptor)è©³è§£</a></p>
<p><a class="link" href="https://www.zendei.com/article/52571.html"  target="_blank" rel="noopener"
    >Spring Bootä½¿ç”¨éæ¿¾å™¨å’Œæ””æˆªå™¨åˆ†åˆ¥å¯¦ç¾RESTä»‹é¢ç°¡æ˜“å®‰å…¨èªè­‰</a></p>
<blockquote>
</blockquote>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/spring/">Spring</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/java%E5%85%A7%E7%9A%84%E7%89%8C%E7%A8%8B%E5%99%A8%E4%BB%8B%E7%B4%B9/">
        
        
            <div class="article-image">
                
                    <img src="https://i.imgur.com/9or5BzU.png" loading="lazy" data-key="" data-hash="https://i.imgur.com/9or5BzU.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Javaå…§çš„ç‰Œç¨‹å™¨ä»‹ç´¹</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div id="gitalk-container"></div>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"
/>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: "bf152013e92e48c1495f",
        clientSecret: "bed32f8438cb1e00d8628d9b6d148003bb4bf25d",
        repo: "comment",
        owner: "Hoxton019030",
        admin: ["Hoxton019030"],
        distractionFreeMode: false, 
        id: md5(location.pathname), 
    });
    (function () {
        if (
            ["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1
        ) {
            document.getElementById("gitalk-container").innerHTML =
                "Gitalk comments not available by default when the website is previewed locally.";
            return;
        }
        gitalk.render("gitalk-container");
    })();
</script>



    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Hoxton
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.14.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#aop-æ¦‚å¿µ">AOP (æ¦‚å¿µ)</a></li>
  </ol>

  <ol>
    <li><a href="#filter">Filter</a>
      <ol>
        <li>
          <ol>
            <li><a href="#è‡ªå®šç¾©filter">è‡ªå®šç¾©Filter</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#interceptor">Interceptor</a></li>
    <li><a href="#aspectj-1">AspectJ</a>
      <ol>
        <li><a href="#aopjdkå‹•æ…‹ä»£ç†">AOP(JDKå‹•æ…‹ä»£ç†)</a></li>
        <li><a href="#aopå°ˆæ¥­è¡“èª">AOPå°ˆæ¥­è¡“èª</a></li>
        <li><a href="#aopæº–å‚™">AOP(æº–å‚™)</a></li>
        <li><a href="#aopæ“ä½œaspect-j--è¨»è§£">AOPæ“ä½œ(Aspect J  è¨»è§£)</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
