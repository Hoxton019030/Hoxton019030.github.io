<!doctype html><html lang=zh dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ä½œæ¥­ç³»çµ±çš„ç­†è¨˜"><title>ä½œæ¥­ç³»çµ±ç­†è¨˜</title><link rel=canonical href=https://hoxtonhsu.com/p/%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1%E7%AD%86%E8%A8%98/><link rel=stylesheet href=/scss/style.min.b0b89b0dd996a596c4f3b50239e7a6499c1a59da968562fa4649d097368cdb29.css><meta property="og:title" content="ä½œæ¥­ç³»çµ±ç­†è¨˜"><meta property="og:description" content="ä½œæ¥­ç³»çµ±çš„ç­†è¨˜"><meta property="og:url" content="https://hoxtonhsu.com/p/%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1%E7%AD%86%E8%A8%98/"><meta property="og:site_name" content="Hoxton"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content><meta property="article:published_time" content="2022-10-08T03:02:43+08:00"><meta property="article:modified_time" content="2022-10-08T03:02:43+08:00"><meta property="og:image" content="https://i.imgur.com/HJLk11O.png"><meta name=twitter:title content="ä½œæ¥­ç³»çµ±ç­†è¨˜"><meta name=twitter:description content="ä½œæ¥­ç³»çµ±çš„ç­†è¨˜"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://i.imgur.com/HJLk11O.png"><link rel="shortcut icon" href=https://cdn-icons-png.flaticon.com/512/92/92031.png><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','G-9N16MVLR0Q','auto');ga('send','pageview');}</script></head><body class=article-page><script>(function(){const colorSchemeKey='StackColorScheme';localStorage.setItem(colorSchemeKey,"dark");})();</script><script>(function(){const colorSchemeKey='StackColorScheme';const colorSchemeItem=localStorage.getItem(colorSchemeKey);const supportDarkMode=window.matchMedia('(prefers-color-scheme: dark)').matches===true;if(colorSchemeItem=='dark'||colorSchemeItem==='auto'&&supportDarkMode){document.documentElement.dataset.scheme='dark';}else{document.documentElement.dataset.scheme='light';}})();</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avator_hu6a42c31c76a673cb4138239719c1dd56_73650_300x0_resize_box_2.png width=300 height=301 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Hoxton</a></h1><h2 class=site-description>ä¸€æ¯èŒ¶ä¸€åŒ…è¸ï¼Œä¸€è¡Œç¨‹å¼å¯«ä¸€å¤© ğŸš¬</h2></div></header><ol class=social-menu><li><a href=https://discordapp.com/users/840906423076782082 target=_blank title=Discord><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-discord" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M7.5 7.5c3.5-1 5.5-1 9 0"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/><path d="M15.5 17c0 1 1.5 3 2 3 1.5.0 2.833-1.667 3.5-3 .667-1.667.5-5.833-1.5-11.5-1.457-1.015-3-1.34-4.5-1.5l-1 2.5"/><path d="M8.5 17c0 1-1.356 3-1.832 3-1.429.0-2.698-1.667-3.333-3-.635-1.667-.476-5.833 1.428-11.5C6.151 4.485 7.545 4.16 9 4l1 2.5"/></svg></a></li><li><a href=https://github.com/Hoxton019030 target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0c-2.4-1.6-3.5-1.3-3.5-1.3a4.2 4.2.0 00-.1 3.2 4.6 4.6.0 00-1.3 3.2c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.instagram.com/hoxton_8a31/ target=_blank title=Instagram><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram" width="80" height="80" viewBox="0 0 24 24" stroke-width="1.5" stroke="#6f32be" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="4" width="16" height="16" rx="4"/><circle cx="12" cy="12" r="3"/><line x1="16.5" y1="7.5" x2="16.5" y2="7.501"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><div class=menu-bottom-section></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1%E7%AD%86%E8%A8%98/><img src=https://i.imgur.com/HJLk11O.png loading=lazy alt="Featured image of post ä½œæ¥­ç³»çµ±ç­†è¨˜"></a></div><div class=article-details><header class=article-category><a href=/categories/%E7%A8%8B%E5%BC%8F/ style=background-color:#2a9d8f;color:#fff>ç¨‹å¼</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E4%BD%9C%E6%A5%AD%E7%B3%BB%E7%B5%B1%E7%AD%86%E8%A8%98/>ä½œæ¥­ç³»çµ±ç­†è¨˜</a></h2><h3 class=article-subtitle>ä½œæ¥­ç³»çµ±çš„ç­†è¨˜</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Oct 08, 2022</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>58 minute read</time></div></footer></div></header><section class=article-content><p>[TOC]</p><h1 id=chapter1-intruduction>Chapter1 Intruduction</h1><p>ç®¡ç†ç¡¬é«”çš„è»Ÿé«”å°±æ˜¯ä½œæ¥­ç³»çµ±ï¼Œç¡¬é«”åŒ…å«CPUï¼ŒMemoryï¼ŒI/Oè¨­å‚™ç­‰ç­‰â€¦ä½œæ¥­ç³»çµ±å°±æ˜¯è² è²¬ç®¡ç†é€™äº›ç¡¬é«”çš„ç³»çµ±ã€‚ä¸€å€‹é›»è…¦ç³»çµ±å¯ä»¥è¢«ç²—ç•¥çš„åŠƒåˆ†æˆä¸‹é¢å››å€‹çµ„ä»¶ï¼š</p><ul><li>ç¡¬é«”(hardware)</li><li>ä½œæ¥­ç³»çµ±(operating system)</li><li>æ‡‰ç”¨ç¨‹å¼(application programs)</li><li>ä½¿ç”¨è€…(user)</li></ul><p><img src=https://i.imgur.com/PZiePn0.png loading=lazy alt=image-20220918222340597></p><h2 id=hardware>Hardware</h2><p>åŒ…æ‹¬CPU(Central Processing Unit)ï¼Œè¨˜æ†¶é«”(Memory)ï¼ŒInput/outputè¨­å‚™â€¦æä¾›çµ¦ç³»çµ±åŸºæœ¬çš„è¨ˆç®—è³‡æº</p><h2 id=operating-system>Operating System</h2><p>è² è²¬å”èª¿ç¡¬é«”èˆ‡æ‡‰ç”¨ç¨‹å¼ï¼Œçµ¦ä¸åŒçš„ä½¿ç”¨è€…</p><h2 id=application-programs>Application Programs</h2><p>ä¾‹å¦‚Wordï¼ŒExcelï¼ŒChromeä¹‹é¡çš„æ‡‰ç”¨ç¨‹å¼ï¼Œä¾†è™•ç†ä½¿ç”¨è€…çš„è¨ˆç®—å•é¡Œ(Computing Problems)</p><p>è£œå……ï¼š</p><ol><li>Bare Machine(è£¸æ©Ÿ): ç´”ç²¹åªæœ‰ç¡¬é«”çµ„æˆï¼Œæ²’æœ‰OSåŠSystem Programs</li><li>Extended Machine: Bare MachineåŠ ä¸ŠOS/system programs</li></ol><p><img src=https://i.imgur.com/inlIZJo.png loading=lazy alt=image-20221029143145761></p><ul><li>In Memory<ul><li>Command Interpreter(å‘½ä»¤è§£è­¯å™¨)</li></ul></li></ul><h2 id=multiprogramming-system>Multiprogramming System</h2><ol><li>å®šç¾©ï¼šç³»çµ±å…è¨±å¤šå€‹Jobs(Process)åŒæ™‚åŸ·è¡Œï¼Œå³æ˜¯Multiprogramming</li></ol><ul><li>ä¸»è¦ç›®çš„ï¼šæé«˜CPU Utilization</li><li>ä½œæ³•ï¼šé€éJob Scheduling or CPU SchedulingæŠ€è¡“é”æˆ</li></ul><p>exampleï¼šç•¶åŸ·è¡Œä¸­çš„process waiting for I/O completed, å‰‡OSå¯å°‡CPUåˆ‡æ›çµ¦å¦ä¸€å€‹processåŸ·è¡Œï¼Œé¿å…CPU idle ã€‚</p><p>å³åªè¦ç³»çµ±å…§æœ‰å¤ å¤šçš„å·¥ä½œå­˜åœ¨ï¼Œå‰‡CPU IDLEçš„æ©Ÿæœƒå°±ä¸‹é™</p><ol start=2><li>Mulitiprogramming Degreeä¹‹å®šç¾©</li></ol><ul><li>ç³»çµ±å…§çš„Processçš„æ•¸ç›®ï¼šä¸€èˆ¬è€Œè¨€ï¼ŒDegreeè¶Šé«˜ï¼ŒCPUåˆ©ç”¨ç‡å°±è¶Šé«˜ã€‚</li></ul><p><strong>(Noteï¼šVirtual Memory Thrashingç‹€æ³é™¤å¤–)</strong></p><ol start=3><li><p>å¤šå€‹Processçš„å®šç¾©ã€ä»¥åŠå¦‚ä½•åŸ·è¡Œ</p><ol><li>Concurrent execution(ä¸¦è¡Œ)ï¼šä¸€é¡†CPUï¼Œå¤§å®¶ä¸€èµ·è¼ªç•ªä½¿ç”¨</li></ol><p><img src=https://i.imgur.com/JUSKW04.png loading=lazy alt=image-20221102220045970></p><ol><li>Parallel execution(å¹³è¡Œ)ï¼šå¤šé¡†CPUæˆ–æ˜¯Multi-core(å¤šæ ¸)ï¼Œå„è‡ªåŸ·è¡Œ</li></ol></li></ol><p><img src=https://i.imgur.com/CELncNq.png loading=lazy alt=image-20221102220202298></p><h2 id=time-sharing-system>Time-Sharing System</h2><p>åˆ†æ™‚ç³»çµ±</p><p>å®šç¾©ï¼šåˆå«Multitasking[æé¾æœ¬å¦‚æ˜¯èªª]</p><blockquote><p>It&rsquo;s a logical extension of Multiprogeamming system</p></blockquote><p>èˆ‡Multiprogrammingçš„æœ€å¤§å·®ç•°ï¼š<strong>CPUçš„åˆ‡æ›é »ç‡æ¥µé«˜</strong></p><ul><li><p>Time-Sharing System features</p><ul><li>å¼·èª¿å°<strong>User Responseçš„æ™‚é–“</strong>è¦<strong>çŸ­</strong>(&lt;1ç§’)</li><li>é©ç”¨æ–¼user interactiveçš„Computing/ Environment</li><li>å°æ¯ä¸€å€‹processéƒ½å…¬å¹³</li></ul></li></ul><p>Main Frame(ä¸»æ©Ÿ)</p><p><img src=https://i.imgur.com/dHbi3Pr.png loading=lazy alt=image-20221102223550343></p><ul><li>CPU Schedulingæ¡å–RRçš„æ’ç­æ³•å‰‡(ç¬¬å››ç« æœƒä»‹ç´¹)</li><li>ä½¿ç”¨Virtual Memoryçš„æŠ€è¡“ï¼Œæ“´å±•Logical Memory Space</li><li>ä½¿ç”¨Spoolingçš„æŠ€è¡“(ä¸å¤ªæœƒè€ƒ)å¯¦ç¾I/O Deviceçš„å…±ç”¨ï¼Œé¡ä¼¼ç¾ä»£çš„BufferingæŠ€è¡“ï¼Œè®“æ¯å€‹userï¼Œçš†ä»¥ç‚ºè‡ªå·±æœ‰å°ˆå±¬çš„çš„Computer</li></ul><h2 id=multiprocessors-system>Multiprocessors System</h2><p>å®šç¾©ï¼šåˆå«Multiprocessing or Paraller or Tightly-coupled system(ç·Šå¯†è€¦åˆç³»çµ±)</p><p>faetureï¼š</p><ol><li>ä¸€å€‹æ©Ÿå™¨(or MotherBoard)å…§ï¼Œæœ‰å¤šå€‹Processors(or CPUs)</li><li>é€™äº›CPUså½¼æ­¤å…±äº«æ­¤æ©Ÿå™¨çš„Memory,Bus,I/O-Device, power-supplier etc&mldr;</li><li>é€šå¸¸å—åŒä¸€Clockä¹‹æ™‚è„ˆæ§åˆ¶</li><li>ç”±åŒä¸€å€‹OSç®¡ç†</li><li>processorsä¹‹é–“çš„æºé€šå¤§éƒ½æ¡shared Memoryæ–¹å¼</li></ol><p><img src=https://i.imgur.com/hvugyDq.png loading=lazy alt=image-20221106193948248></p><p>Benefits(å¥½è™•)ï¼š</p><ol><li>Increased Throughputï¼šç”¢èƒ½å¢åŠ </li><li>Increased Reliabilityï¼šå¯é åº¦çš„æå‡</li><li>Economy Of Scaleï¼šé‹ç®—èƒ½åŠ›çš„æ“´å……æ¯”è¼ƒå¥½</li></ol><p>ã€€åˆ†æå¦‚ä¸‹ï¼š</p><p><strong>Increased Throughputï¼š</strong></p><p>å¯æ”¯æŒå¤šå€‹å·¥ä½œåœ¨ä¸åŒCPUä¸Šå¹³è¡ŒåŸ·è¡Œ(paraller Computing)ï¼Œ<strong>æ³¨æ„ï¼ŒNé¡†CPUä¹‹ç”¢èƒ½çµ•å°å°æ–¼1é¡†CPUç”¢èƒ½xNå€</strong>ï¼Œæ„å³CPUæ•¸é‡çš„æå‡èˆ‡ç”¢èƒ½çš„æå‡ä¸¦éç·šæ€§æˆé•·ã€‚åŸå› æ˜¯å› ç‚º</p><ol><li>Resource Contetion(è³‡æºçš„ç«¶çˆ­)</li><li>Processorsé–“çš„CommunicationæœƒæŠµæ¶ˆç”¢èƒ½</li></ol><p><strong>Increased Reliability:</strong></p><p>æŸä¸€é¡†CPUå£äº†ï¼Œå‰‡Systemä¸æœƒå› æ­¤è€Œåœé “ï¼Œå› ç‚ºå…¶ä»–CPUä»å¯é‹ä½œ</p><ol><li>Graceful degradation(æ¼¸é€²å¼çš„æ»…äº¡)</li></ol><ul><li>Systemä¸è‡³å› ç‚ºæŸäº›Hardward/Softwareä¹‹å…ƒä»¶æ•…éšœè€Œåœé “ï¼Œä»ç„¶ä¿æœ‰æŒçºŒé‹ä½œçš„èƒ½åŠ›ï¼Œé€™æ€§è³ªå°±ç¨±ç‚ºfail-soft</li></ul><ol start=2><li><p>Fault-Tolerant system(å®¹éŒ¯ç³»çµ±)<strong>è€ƒè©¦ä¸å¤ªæœƒè€ƒ</strong></p><ul><li>å…·æœ‰graceful degradationæ€§è³ªä¹‹ç³»çµ±å°±å«åšFault-Tolerant systemï¼Œæƒ³è¦é”æˆå®¹éŒ¯çš„æŠ€è¡“éœ€è¦æœ‰å…©ä»¶äº‹æƒ…çš„æ”¯æ´</li></ul><ol><li>è¦æœ‰backupçš„ç³»çµ±ï¼Œåˆ‡æ›ä¹Ÿè¦æµæš¢</li></ol></li></ol><p><strong>Economy of Scale:</strong></p><p>é‹ç®—èƒ½åŠ›æ“´å……ç¬¦åˆç¶“æ¿Ÿæ•ˆç›Š</p><ul><li>âˆµNé¡†CPUåœ¨ä¸€éƒ¨æ©Ÿå™¨å…§ï¼Œèˆ‡Néƒ¨æ©Ÿå™¨ç›¸æ¯”ï¼Œæˆæœ¬è¼ƒä¾¿å®œâˆµé€™äº›CPUså…±äº«åŒä¸€æ©Ÿå™¨ä¹‹Memory, Bus, I/O-Device, etc</li></ul><h3 id=two-subtype-in-multiprocessors-system>Two SubType in Multiprocessors System</h3><ol><li>SMP(Symmetric MultiProcessors) å°ç¨±çš„</li><li>ASMP(Asymmetric MultiProcessors) éå°ç¨±çš„</li></ol><p><strong>SMP</strong></p><p>å®šç¾©ï¼šæ¯å€‹Processorçš„å·¥ä½œèƒ½åŠ›æ˜¯ç›¸åŒçš„(Identical)ï¼Œä¸”æ¯å€‹CPUéƒ½æœ‰å°ç­‰ã€å¹³ç­‰çš„æ¬Šåˆ©ä¾†å­˜å–è³‡æº</p><p>å„ªé»ï¼š</p><ol><li>å¯é åº¦è¼ƒASMPé«˜ï¼Œå› å·¥ä½œèƒ½åŠ›ç›¸åŒï¼Œå³ä½¿å…¶ä¸­ä¸€å€‹cpuæ›äº†ä¹Ÿå¯ä»¥è¢«ç«‹åˆ»å–ä»£</li><li>æ•ˆèƒ½è¼ƒé«˜</li></ol><p>ç¼ºé»ï¼š</p><ol><li>SMPçš„OSè¨­è¨ˆé–‹ç™¼è¼ƒç‚ºè¤‡é›œ(äº’æ–¥å­˜å–çš„æ©Ÿåˆ¶è¨­è¨ˆ,è³‡æºçš„ç«¶çˆ­)</li></ol><p><strong>ASMP</strong></p><p>å®šç¾©ï¼šæ¯å€‹Processorä¹‹å·¥ä½œèƒ½åŠ›<strong>ä¸ç›¡ç›¸åŒ</strong>ï¼Œé€šå¸¸æ˜¯æ¡å–<strong>Master-Slave</strong>çš„æ¶æ§‹(æé¾æœ¬æœ‰æ™‚å€™æœƒå¯«æˆBoss-Employee</p><p>Master-Processorè² è²¬å·¥ä½œåˆ†æ´¾åŠè³‡æºåˆ†é…ï¼Œç›£ç£Slavesç­‰ç®¡ç†å·¥ä½œ</p><p>Slave Processorsè² è²¬åŸ·è¡Œå·¥ä½œ</p><p>å„ªé»ï¼šASMPçš„OSè¨­è¨ˆé–‹ç™¼è¼ƒç‚ºSimpleï¼Œâˆµèˆ‡Simple-Cpu Osç‰ˆé¡ä¼¼</p><p>ç¼ºé»ï¼š</p><ol><li>å¯é åº¦ä½ï¼ŒMaster CPUå¦‚æœå£äº†ï¼Œå°±æœƒåœæ“ºï¼Œç›´åˆ°å¦ä¸€é¡†CPUè¢«Trainæ¥æ‰‹</li><li>æ•ˆèƒ½è¼ƒä½âˆµMaster CPUæ˜¯ç“¶é ¸</li></ol><p><img src=https://i.imgur.com/wo1RhWy.png loading=lazy alt=image-20221108212149764></p><h3 id=multiprocessors-system-vs-multicores-cpu>Multiprocessors System VS MultiCores CPU</h3><p>å¾ä½œæ¥­ç³»çµ±ä¾†çœ‹å·®ç•°ä¸å¤§ï¼Œä¸»è¦å·®ç•°æ˜¯<strong>ç¡¬é«”çš„å·®ç•°(ä¸»è¦)</strong>ï¼Œä»¥OSä¾†çœ‹ï¼Œä½ è£äº†ä¸€é¡†å…©æ ¸çš„CPUï¼ŒOSæœƒè¦–ä½œå…©é¡†CPUï¼›è£å››æ ¸çš„è¦–ä½œå››é¡†CPU</p><ol><li>MultiProcessors</li></ol><p><img src=https://i.imgur.com/BhjZbvk.png loading=lazy alt=image-20221108214627937></p><ol start=2><li>MultiCores CPU</li></ol><p><img src=https://i.imgur.com/HNuJgLM.png loading=lazy alt=image-20221108214639509></p><p>å„ªé»</p><ol><li>Power Savingï¼šç›¸è¼ƒMultiProcessorï¼Œåœ¨ä¸€å€‹CPUä¸Šæä¾›å…©å€‹Coreçš„èƒ½æºè€—ææœƒæ¯”åœ¨ä¸€å¼µæ¿å­ä¸Šæä¾›å…©é¡†CPUçš„èƒ½æºè€—æé‚„ä¾†å¾—ä½ã€‚</li><li>Speedæ¯”è¼ƒå¿«(âˆµè™•åœ¨åŒä¸€å€‹æ™¶ç‰‡å…§è³‡æ–™å‚³è¼¸é€Ÿåº¦è¼ƒå¿«)</li></ol><h2 id=distribute-system>Distribute System</h2><p>å®šç¾©ï¼šåˆå«Loosely-Coupled system(é¬†æ•£è€¦åˆç³»çµ±)ï¼Œä¸»è¦çš„Featureå¦‚ä¸‹</p><ol><li><p>å¤šéƒ¨æ©Ÿå™¨å½¼æ­¤é€éNetwork(or Bus)ç›¸äº’ä¸²é€£</p></li><li><p>æ¯éƒ¨æ©Ÿå™¨ä¹‹CPUæœ‰å„è‡ªç§æœ‰çš„Memory, Bus, I/O-Device, etc ä¸¦éå…±äº«</p></li><li><p>å„CPUä¹‹Clockæ™‚è„ˆæ§åˆ¶ä¸ä¸€å®šç›¸åŒ</p></li><li><p>å„CPUä¸Šä¹‹OSä¹Ÿä¸ä¸€å®šç›¸åŒ</p></li><li><p>å„Processorsä¹‹é–“çš„æºé€šå¤§éƒ½æ¡**&ldquo;Message Passing&rdquo;**æ–¹å¼</p><blockquote><p>Message Passing (é¡ä¼¼è¬›é›»è©±)</p><p>Step</p><ol><li>å»ºç«‹Communication Link</li><li>Message ç›¸äº’å‚³è¼¸</li><li>é‡‹æ”¾Link</li></ol></blockquote></li></ol><p><img src=https://i.imgur.com/6gSkGlg.png loading=lazy alt=image-20221110232152377></p><h3 id=advantage-of-distribute-system>Advantage of Distribute-System</h3><ol><li>Increased Throughput(æ”¯æŒParaller Computing)</li><li>Increased Reliability(ä¸€å€‹æ›æ‰ï¼Œé‚„æœ‰å…¶ä»–å¯ä»¥æ“‹)</li><li>Resource Sharing(è³‡æºå…±äº«å› æ­¤æˆæœ¬é™ä½)</li></ol><blockquote><p>æ”¯æŒ"Client-Server" Computing Modelä¹‹å¯¦æ–½</p><ol><li>Server(ä¼ºæœå™¨)ï¼šæä¾›æŸäº›æœå‹™çš„æ©Ÿå™¨ example: mail server, file server ,DNS,printer server, computing server &mldr;</li><li>Clientï¼šæœ¬èº«ä¸æä¾›æœå‹™ï¼Œä¸”å®ƒéœ€è¦æŸäº›æœå‹™æ™‚ï¼Œå‰‡ç™¼è«‹æ±‚è‡³Server, Serveræœå‹™å®Œå†å°‡çµæœå›å‚³Client</li></ol></blockquote><blockquote><p>Note</p><p>Peer-to-Peer modelï¼špeeræ„æŒ‡åŒæ™‚å…·æœ‰serveråŠClientçš„è§’è‰²ï¼Œè‹±æ–‡æ„æ€æ˜¯åŒç­‰çš„ã€å°ç­‰çš„</p></blockquote><ol start=4><li>Remote sites Communicationçš„éœ€æ±‚è¢«æ»¿è¶³ exampleï¼šemail, FTP via Internet</li></ol><h2 id=real-time-system>Real-Time System</h2><p>(å³æ™‚ç³»çµ±)</p><p>åˆ†æˆå…©ç¨®</p><ol><li>Hard real-time System</li><li>Soft real-time System</li></ol><h3 id=hard-real-time-system>Hard real-time system</h3><p>å®šç¾©ï¼šThis system must ensure the critical tasks complete on timeï¼Œå³å·¥ä½œå¿…é ˆåœ¨è¦å®šçš„æ™‚é–“é™åˆ¶å…§å®Œæˆï¼Œå¦å‰‡å³ç®—å¤±æ•—</p><p>èˆ‰ä¾‹ï¼šè»äº‹é˜²è¡›ç³»çµ±ã€æ ¸èƒ½å®‰æ§ç³»çµ±ã€å·¥å» è‡ªå‹•åŒ–ç”Ÿç”¢&mldr;</p><p><img src=https://i.imgur.com/cPuSbro.png loading=lazy alt=image-20221114224122357></p><p>è¨­è¨ˆè€ƒé‡ï¼š</p><ul><li><strong>æ‰€æœ‰æ™‚é–“å»¶é²ä¹‹å› ç´ çš†é ˆç´å…¥è€ƒé‡</strong> egï¼šsensor data å‚³è¼¸é€Ÿåº¦ã€é‹ç®—é€Ÿåº¦ã€Signalçš„å‚³è¼¸ etcï¼Œç¢ºä¿é€™äº›æ™‚é–“çš„åŠ ç¸½èƒ½å¤ æ»¿è¶³æ™‚é–“deadlineçš„è¦æ±‚</li><li>æ‰€æœ‰æœƒé€ æˆè™•ç†æ™‚é–“éä¹…æˆ–ç„¡æ³•é æ¸¬ä¹‹è¨­å‚™æˆ–æ©Ÿåˆ¶ï¼Œç›¡é‡å°‘æ¡ç”¨æˆ–ä¸ç”¨ egï¼š<strong>Disk</strong>ä¸ç”¨æˆ–å°‘ç”¨ã€<strong>Virtual Memory çµ•å°ä¸æ¡ç”¨</strong></li><li>å°±CPU Schedulingè¨­è¨ˆ(Ch4)è€Œè¨€ï¼Œéœ€å…ˆè€ƒé‡Schedulableèˆ‡å¦ï¼Œå†é€²è¡Œæ’ç¨‹(eg rate-monotonic, EDF scheduling)ï¼Œç¢ºå®šCPUèƒ½è² è·å†é€²è¡Œæ’ç¨‹</li><li><strong>Time Sharing system ç„¡æ³•èˆ‡ä¹‹ä¸¦å­˜(Time sharingæ˜¯å±¬æ–¼Multitaskingï¼Œå¯ä»¥åŒæ™‚åŸ·è¡Œå¤šå€‹ç¨‹åºï¼Œä¸¦é€éä¸€äº›é¢¨å‹¢å»å„ªå…ˆåŸ·è¡ŒæŸäº›ç¨‹åºï¼Œè€ŒHard real-timeæ¯”è¼ƒåƒå–®é‹ç®—ç³»çµ±ï¼Œè¦æ±‚åœ¨æŒ‡å®šæ™‚é–“å…§å®Œæˆï¼Œå› æ­¤æ›´å°ˆæ³¨æ–¼å–®ä¸€ç¨‹åºçš„åŸ·è¡Œï¼Œç”±æ–¼é€™å…©å€‹ç³»çµ±æœ‰é€™æ¨£çš„å·®ç•°ï¼Œå› æ­¤ç„¡æ³•å…±æ¦®)</strong></li><li>OSæ‰€é€ æˆçš„Dispatch latency etc. å®œé™ä½(interruptçš„è™•ç†, system callçš„è«‹æ±‚)ï¼Œä¸€èˆ¬å¯¦å‹™ä¸Šï¼Œhard-real-time systemï¼Œé®®å°‘æœ‰OSçš„å­˜åœ¨(å¹¾ä¹ä¸å­˜åœ¨)ï¼Œå°¤å…¶æ˜¯embedded real-time systemï¼Œå› éœ€è¦<strong>åŠæ™‚çš„éŸ¿æ‡‰</strong></li><li>ç¾è¡Œçš„å•†ç”¨OS<u>ä¸æ”¯æ´</u>Hard real-time features é€šå¸¸éƒ½æ˜¯å®¢è£½åŒ–çš„ç‰¹æ®Šè¨­è¨ˆeg : Linux, Unix, Window, Apple Os, Solaris etc</li></ul><p>â€‹</p><h3 id=soft-real-time-system>Soft real-time system</h3><p>å®šç¾©ï¼š<strong>This system must ensure the real-time process get the hightest priority than the others and retain(ç¶­æŒ) this priority level unit it completed</strong></p><p>èˆ‰ä¾‹ï¼šMultimedia System, Simulation system, VR system, etc</p><p>è¨­è¨ˆè€ƒé‡ï¼š</p><ul><li>å°± CPU Scheduling è¨­è¨ˆ(ch4)è€Œè¨€ï¼Œ<ol><li>å¿…é ˆæ”¯æŒpreemptive priority scheduling</li><li><strong>ä¸å¯æä¾›AgingæŠ€è¡“</strong>(æ´»å¾—è¶Šä¹…ï¼Œpriorityè¶Šé«˜)</li></ol></li><li>ç›¡é‡é™ä½kernelçš„Dispatch latency time</li><li>å¯æ”¯æ´virtual memory ä¸¦å­˜ï¼Œä½†å‰ææ˜¯real-time-processçš„å…¨éƒ¨pageså¿…é ˆçš†å¾…åœ¨memoryä¸­ï¼Œç›´åˆ°å®Œå·¥ï¼Œé«˜å„ªå…ˆæ¬Šçš„Processä¸è¦ä½¿ç”¨virtual memory</li><li>èˆ‡Time-sharing system å¯ä»¥ä¸¦å­˜ï¼Œegï¼šsolaris</li><li>ä¸€èˆ¬å•†ç”¨OSéƒ½æ”¯æ´Soft-real-time system</li></ul><h3 id=batch-system>Batch System</h3><p>å®šç¾©ï¼šå°‡ä¸€äº›è¼ƒä¸ç·Šæ€¥ï¼Œå®šæœŸæ€§ã€éäº¤è«‡äº’å‹•æ€§çš„Jobï¼Œç´¯ç©æˆå †ï¼Œå†åˆ†æ‰¹æ¬¡ï¼Œé€å…¥ç³»çµ±è™•ç†</p><p>èˆ‰ä¾‹ï¼šåº«å­˜ç³»çµ±ã€å ±ç¨…ç³»çµ±ã€æƒæ¯’ã€ç£ç¢Ÿé‡çµ„ã€æ¸…ç®—ç³»çµ±&mldr;</p><p>ä¸»è¦ç›®çš„ï¼šæé«˜resource utilizationï¼Œ<strong>å°¤å…¶æ˜¯åœ¨å†·é–€æ™‚æ®µ</strong>ï¼Œä¸é©åˆç”¨åœ¨real-time-system, user-interactive application egï¼šé›»è…¦éŠæˆ²</p><h3 id=hand-held--system>Hand Held system</h3><p>å®šç¾©ï¼šå–®æ‰‹å¯æŒæ¡æ“ä½œçš„ç³»çµ±</p><ul><li>Hardware å¤©ç”Ÿä¹‹é™åˆ¶ï¼Œå¸¶ä¾†softwareå¿…é ˆé…åˆä¹‹è™•</li></ul><div class=table-wrapper><table><thead><tr><th>Hardwareå¤©ç”Ÿé™åˆ¶</th><th>Softwareå¿…é ˆé…åˆä¹‹è¨­è¨ˆ</th></tr></thead><tbody><tr><td><u>Slower</u> processor<br>(èƒŒå¾Œä¹‹é™åˆ¶)<br>1. power ä¾›æ‡‰çš„å•é¡Œï¼Œé›»ä¾›ä¸è¶³<br>2. æ•£ç†±ç³»çµ±çš„è¨­è¨ˆ</td><td>é‹ç®—ä¸èƒ½å¤ªè¤‡é›œï¼Œè¦ç°¡å–®</td></tr><tr><td>Memoryç©ºé–“æœ‰é™</td><td>ç¨‹å¼çš„Sizeè¦å°ï¼Œä¸ç”¨çš„è¨˜æ†¶é«”è¦ç«‹åˆ»é‡‹æ”¾</td></tr><tr><td>DisplayMonitorå¾ˆå°</td><td>é¡¯ç¤ºçš„å…§å®¹è¦æœ‰æ‰€åˆªæ¸›</td></tr></tbody></table></div><h1 id=chapter2-computer-system-architecture>Chapter2 Computer System Architecture</h1><h2 id=io-operating-and-hardware-resources-protection>I/O Operating And Hardware Resources Protection</h2><ul><li>å­¸ç¿’è·¯ç·š</li></ul><blockquote><p>I/Oé‹ä½œæ–¹å¼</p><blockquote><p>Polling I/O</p><p>Interrupted I/O</p><p>DMA</p></blockquote><p>Interruptæ©Ÿåˆ¶è™•ç†èˆ‡ç¨®é¡</p><p>HW Resource Protection</p><blockquote><p>åŸºç¤å»ºè¨­</p><blockquote><p>Dual Model Operation</p><p>Privileged Instruction</p></blockquote><p>I/O</p><p>Memory Protection</p><p>CPU</p></blockquote></blockquote><h2 id=io-operating>I/O Operating</h2><h3 id=polling-io-io>Polling I/O I/O</h3><p>Polling(è¼ªå·¡,è©¢å•å¼) I/O</p><p>å®šç¾©ï¼šåˆå«Busy_waiting I/O or Programmed I/O</p><p>æ­¥é©Ÿå¦‚ä¸‹</p><ol><li>I/O Request çµ¦ OS (åŸ·è¡Œä¸­çš„Processä¸æœƒè‡ªå·±åšI/O)</li><li>OSæ”¶åˆ°è«‹æ±‚å¾Œï¼Œ(å¯èƒ½)æœƒæš«åœæ­¤ProcessåŸ·è¡Œï¼Œä¸¦åŸ·è¡Œå°æ‡‰çš„System Calls.</li><li>Kernel çš„ <u>I/O-subsystem</u>(å°ˆé–€ç”¨ä¾†è™•ç†I/Oçš„è«‹æ±‚ï¼Œåªæ˜¯å€‹éæ°´è€Œå·²)æœƒPassæ­¤è«‹æ±‚çµ¦<u>Device driver</u></li><li>Divice Driver ä¾æ­¤è«‹æ±‚ï¼Œè¨­å®šå°æ‡‰çš„I/O Commandsåƒæ•¸çµ¦<u>Device Controller</u></li><li>Device Controller å•Ÿå‹•ç›£ç£I/O-Deviceä¹‹I/Oé‹ä½œé€²è¡Œ</li><li>åœ¨é€™æ®µæ™‚é–“å…§ï¼ŒOS(å¯èƒ½)å°‡CPUåˆ‡çµ¦å¦ä¸€å€‹processåŸ·è¡Œ</li><li><strong>ç„¶è€Œï¼Œæ²’äººä¸»å‹•å»å‘Šè¨´CPU I/Oçš„åŸ·è¡Œç‹€æ³ï¼Œå› æ­¤CPUåœ¨åŸ·è¡Œprocesså·¥ä½œéç¨‹ä¸­ï¼Œå»è¦ä¸æ–·å»Polling Device Controllerï¼Œå·²ç¢ºå®šI/Oé‹ä½œæ˜¯å¦å®Œæˆæˆ–æœ‰I/O error</strong></li></ol><p><img src=https://i.imgur.com/PrvPBLP.png loading=lazy alt=image-20221116231017998></p><p>ç¼ºé»ï¼š</p><ul><li>CPUè€—è²»å¤§é‡æ™‚é–“ç”¨æ–¼polling I/O Device Controllerä¸Šï¼Œä¸¦æœªå…¨ç”¨æ–¼process executeä¸Šï¼Œæ•…<u>CPU utilizationä½</u>ã€<u>throughputä¸é«˜</u></li></ul><h3 id=interrupted-io>Interrupted I/O</h3><p>Interrupted (ä¸­æ–·,ä¸­æ–·å¼)I/O I/O</p><p>å®šç¾©ï¼š</p><p>æ­¥é©Ÿå¦‚ä¸‹ï¼š</p><ol><li><p>I/O Request çµ¦ OS (åŸ·è¡Œä¸­çš„Processä¸æœƒè‡ªå·±åšI/O)</p></li><li><p>OSæ”¶åˆ°è«‹æ±‚å¾Œï¼Œ(å¯èƒ½)æœƒæš«åœæ­¤ProcessåŸ·è¡Œï¼Œä¸¦åŸ·è¡Œå°æ‡‰çš„System Calls.</p></li><li><p>Kernel çš„ <u>I/O-subsystem</u>(å°ˆé–€ç”¨ä¾†è™•ç†I/Oçš„è«‹æ±‚ï¼Œåªæ˜¯å€‹éæ°´è€Œå·²)æœƒPassæ­¤è«‹æ±‚çµ¦<u>Device driver</u></p></li><li><p>Divice Driver ä¾æ­¤è«‹æ±‚ï¼Œè¨­å®šå°æ‡‰çš„I/O Commandsåƒæ•¸çµ¦<u>Device Controller</u></p></li><li><p>Device Controller å•Ÿå‹•ç›£ç£I/O-Deviceä¹‹I/Oé‹ä½œé€²è¡Œ</p></li><li><p>åœ¨é€™æ®µæ™‚é–“å…§ï¼ŒOS(å¯èƒ½)å°‡CPUåˆ‡çµ¦å¦ä¸€å€‹processåŸ·è¡Œ</p></li><li><p><strong>ç•¶I/Oé‹ä½œå®Œæˆï¼ŒDevice Controller æœƒç™¼å‡º I/O-Completed Interrupt é€šçŸ¥OS(CPU)</strong></p></li><li><p><strong>OSæ”¶åˆ°ä¸­æ–·å¾Œ(å¯èƒ½)æœƒæš«åœç›®å‰Processçš„åŸ·è¡Œ(å› æœ‰äº›Interruptå„ªå…ˆæ¬Šå¯èƒ½å¾ˆä½ï¼Œå¯ä»¥å…ˆæš«æ™‚ä¸è™•ç†)</strong></p></li><li><p><strong>OSå¿…é ˆæŸ¥è©¢ <u>Interrupt Vector</u>ï¼Œç¢ºèªä½•ç¨®ä¸­æ–·ç™¼ç”Ÿï¼ŒåŒæ™‚ä¹Ÿè¦æ‰¾åˆ°è©²ä¸­æ–·çš„æœå‹™è™•ç†ç¨‹å¼(ISRï¼šInterrupt Service Routine)çš„ä½å€(æ¯ä¸€å€‹ä¸­æ–·éƒ½æœ‰ä¸€å€‹å°æ‡‰çš„ä¸­æ–·è™•ç†æœå‹™ç¨‹å¼</strong></p></li><li><p>Jump to ISRä½å€ åŸ·è¡ŒISR</p></li><li><p>ISRå®Œæˆå¾Œï¼Œreturn control to <u>kernel</u>ï¼Œkernelä¹Ÿè¨±åšä¸€äº›é€šçŸ¥å·¥ä½œ</p></li><li><p>æ¢å¾©(resume)åŸå…ˆä¸­æ–·å‰çš„å·¥ä½œåŸ·è¡Œæˆ–äº¤ç”±CPU Scheduleræ±ºå®š</p></li></ol><p>å„ªé»ï¼šCPU<u>ä¸é ˆ</u>è€—è²»æ™‚é–“ç”¨æ–¼Polling I/O-Deviceï¼Œè€Œæ˜¯å¯ä»¥ç”¨æ–¼Process executeä¸Šï¼ŒCPU utilizationæå‡ï¼Œthroughoutæé«˜ï¼Œimprove the system performance</p><p>ç¼ºé»ï¼š</p><ol><li>Interruptä¹‹è™•ç†ä»éœ€è€—è²»CPU timeï¼Œå¦‚æœ I/Oé‹ä½œæ™‚é–“ <strong>å°æ–¼</strong> Interruptè™•ç†æ™‚é–“ï¼Œå‰‡ä½¿ç”¨Interrupt I/Oå°±ä¸åˆ’ç®—ï¼Œä¸å¦‚ä½¿ç”¨polling I/O</li><li>è‹¥<strong>ä¸­æ–·çš„é »ç‡éé«˜</strong>ï¼Œå‰‡å¤§é‡çš„ä¸­æ–·è™•ç†æœƒå ç”¨å¹¾ä¹å…¨éƒ¨çš„CPU Timeï¼Œå‰‡<strong>ç³»çµ±æ•ˆèƒ½æœƒå¾ˆå·®</strong></li><li>CPUä»éœ€è€—è²»ä¸€äº›æ™‚é–“ç”¨æ–¼ç›£ç£I/O-Diviceèˆ‡Memoryä¹‹é–“çš„Data Transferéç¨‹</li></ol><h3 id=dma-direct-memory-access-io>DMA (Direct Memory Access) I/O</h3><ul><li>å®šç¾©ï¼šDMA Controller è² è²¬ I/O-Device(è¨­å‚™)èˆ‡Memory ä¹‹é–“çš„Data transfer(å‚³è¼¸)å·¥ä½œï¼Œ<strong>éç¨‹ä¸­ä¸éœ€CPUä¹‹åƒèˆ‡ç›£ç£ï¼Œå› æ­¤CPUæœ‰æ›´å¤šæ™‚é–“ç”¨æ–¼Process executeä¸Š</strong></li></ul><p>å„ªé»ï¼š</p><ol><li>CPU Utilizationæ›´é«˜</li><li>é©åˆç”¨åœ¨<strong>Block-Transfer oriented <strong>I/O-Deviceä¸Š(ä»£è¡¨ä¸­æ–·ç™¼ç”Ÿçš„é »ç‡ä¸è‡´æ–¼éé«˜ eg:Disk, ç£ç¢Ÿçš„æ§åˆ¶å™¨æœƒå’ŒDMAçš„æ§åˆ¶å™¨å…©å€‹æœƒç›¸äº’åˆä½œï¼Œç£ç¢Ÿæ§åˆ¶å™¨æœƒå»æŒ‡æ®ç£ç¢Ÿçš„é‹ä½œï¼Œè®€å‡ºä¾†çš„è³‡æ–™æœƒé€šçŸ¥DMAçš„æ§åˆ¶å™¨ï¼ŒDMAæœƒæŠŠè³‡æ–™è¼¸é€²Memoryè£¡) ä¸æ˜¯ç”¨æ–¼</strong>Byte-transger oriented I/O-Device</strong></li></ol><p>ç¼ºé»ï¼š</p><ol><li>å¼•é€²DMA Controlleræœƒå¢åŠ HWè¨­è¨ˆè¤‡é›œåº¦(Complicated the HW design)</li></ol><blockquote><p>åŸå› ï¼šDMAçš„Controlleræœƒè·ŸCPUç«¶çˆ­çˆ­å¥ªMemory(è¨˜æ†¶é«”)ã€Bus(åŒ¯æµæ’)çš„ä½¿ç”¨æ¬Šï¼Œè‹¥DMC Controller å ç”¨äº†memory , Bus æ™‚ï¼ŒCPUè¦è¢«è¿«ç­‰å¾…</p><p>è£œå……ï¼šDMA Controlleré€šå¸¸æ¡ç”¨"Cycle Stealing"æŠ€è¡“ (or Interleaving)èˆ‡CPU è¼ªç•ª(äº¤æ›¿)ä½¿ç”¨memoryè·ŸBusï¼Œå¦‚æœCPUèˆ‡DMA Controllerç™¼ç”Ÿconflict(åŒæ™‚è¦ç”¨Memory èˆ‡ bus)ï¼Œå‰‡æœƒ<strong>çµ¦DMAè¼ƒé«˜çš„çš„å„ªå…ˆæ¬Š</strong></p></blockquote><ol start=2><li><p>é€šå¸¸ç³»çµ±æœƒçµ¦äºˆã€Œå°è©²è³‡æºéœ€æ±‚é‡ã€é »ç‡ç­‰è¼ƒ<strong>å°</strong>ã€çš„å°è±¡æœ‰è¼ƒé«˜çš„å„ªå…ˆæ¬Šï¼Œé€™æ¨£æœƒç²å¾—</p><ol><li>å¹³å‡ç­‰å¾…æ™‚é–“è¼ƒå°</li><li>å¹³å‡ç”¢èƒ½è¼ƒé«˜</li></ol><p>çš„å¥½è™•</p></li><li><p>æ©Ÿå™¨æŒ‡ä»¤çš„Stages (CPUåŸ·è¡Œçš„å¹¾å€‹éšæ®µ)</p></li></ol><div class=table-wrapper><table><thead><tr><th>IF</th><th>DE</th><th>FO</th><th>EX</th><th>WM</th></tr></thead></table></div><ol><li>IFï¼šInstruction Fetch <code>æŠ“æŒ‡ä»¤ï¼šæ ¹æ“šProgramming Counterçš„å€¼ï¼Œåˆ°è¨˜æ†¶é«”å»æŠŠæŒ‡ä»¤æŠ“å‡ºä¾†</code></li><li>DEï¼šDecode <code>è§£ç¢¼ï¼šçŸ¥é“é€™æ¢æŒ‡ä»¤åˆ°åº•åšä»€éº¼äº‹æƒ…</code></li><li>FOï¼šFetch Operands <code>æŠ“å–é‹ç®—å…ƒï¼šé‹ç®—å…ƒå¯èƒ½ä¾†è‡ªè¨˜æ†¶é«”ã€ä¹Ÿå¯èƒ½ä¾†è‡ªæš«å­˜å™¨</code></li><li>Exï¼šExecutionã€€<code>åŸ·è¡Œ</code></li><li>WMï¼šWrite Result to Memoryã€€<code>å°‡çµæœå¯«å…¥è¨˜æ†¶é«”</code></li></ol><div class=table-wrapper><table><thead><tr><th></th><th>CPUæœƒä¸æœƒMemory Accessï¼ˆåˆ°è¨˜æ†¶é«”æŠ“æ±è¥¿ï¼‰</th><th>DMAè¦ç”¨Memory</th></tr></thead><tbody><tr><td>IF</td><td>æœƒ</td><td>è¡çª(Conflict)</td></tr><tr><td>DE</td><td>ä¸æœƒï¼ˆæŒ‡ä»¤å·²ç¶“æ‹¿å‡ºä¾†æ”¾åˆ°IR<code>instructor registor</code>)</td><td>OKï¼Œæ­¡è¿</td></tr><tr><td>FO</td><td>å¯èƒ½ (é‹ç®—å…ƒæœ‰å¯èƒ½åœ¨Registorï¼Œä¹Ÿæœ‰å¯èƒ½æ”¾åœ¨Memory)</td><td>OKï¼Œæˆ–æœ‰è¡çª</td></tr><tr><td>EX</td><td>ä¸æœƒ (ALUå»åšäº†)</td><td>OKï¼Œæ­¡è¿</td></tr><tr><td>WM</td><td>å¯èƒ½ (çµæœæœ‰å¯èƒ½å¯«å›Memoryä¹Ÿæœ‰å¯èƒ½æ˜¯æš«å­˜å™¨)</td><td>OKï¼Œæˆ–æœ‰è¡çª</td></tr></tbody></table></div><p>Cycle Stealingï¼šç•¶CPUæœƒä½¿ç”¨æˆ–ä¸æœƒä½¿ç”¨Memory Accessæ™‚ï¼ŒDMAéƒ½æœƒå»çˆ­å¥ªMemoryçš„ä½¿ç”¨æ¬Šï¼Œäº¦ç‚ºStealing(å·)ï¼Œå› ç‚ºDMAæ“æœ‰æœ€é«˜ä½¿ç”¨æ¬Šã€‚</p><h3 id=dma-six-steps>DMA Six Steps</h3><p><code>(æ—©:ä¸­å¤®ã€æ¸…è¯ã€äº¤å¤§)</code></p><ol><li>Device Driver <code>User Process å‘Šè¨´ I/O subsystem(kernel)å‘Šè¨´ Device Driver</code>is told to transfer Disk data to Buffer address X</li><li>Device Driver tells disk controller to transfer C bytes from disk to Buffer at address X<code>å¾ç£ç¢Ÿè®€C byteçš„é‡ï¼Œåˆ†é…åˆ°è¨˜æ†¶é«”ä½å€Xçš„åœ°æ–¹</code></li><li>Disk controller initiates DMA Transfer</li><li>Disk controller sends each byte to DMA controller</li><li>DMA transfer bytes to Buffer X in creasing memory address and decreasing Counter utill Counter =0</li><li>When C=0, DMA interrupts CPU to signal transfer compeletion</li></ol><p><img src=https://i.imgur.com/0T7eX0t.png loading=lazy alt=image-20221119122438718></p><h3 id=life-cycle-of-io-request-via-interrupted-io>Life cycle of I/O-request via Interrupted I/O</h3><p><img src=https://i.imgur.com/nDEmUKK.png loading=lazy alt=image-20221119161000584></p><h3 id=blocking-and-non-blocking-io>Blocking and Non-Blocking I/O</h3><p>Blocking(æœƒæš«åœçš„) and Non-Blocking(ä¸æœƒæš«åœçš„)I/O</p><blockquote><p>æ‰€è¬‚çš„Blockingçš„æ„æ€æ˜¯ï¼Œç•¶User processç™¼å‡ºI/Oè«‹æ±‚ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†é€™å€‹prcesså°±æœƒsuspendï¼Œç›´åˆ°é€™å€‹I/Oè¢«å®Œæˆ</p></blockquote><h4 id=blocking-io>Blocking-I/O:</h4><p>(ç­‰æ–¼Synchronous)ï¼šProcess suspended until I/O completeed</p><ul><li>å„ªï¼šEasy to use and understand, processåœ¨waitingçš„æ™‚å€™ï¼Œå¯ä»¥æŠŠCPUæ”¾å‡ºå»çµ¦å…¶ä»–processåšä½¿ç”¨</li><li>ç¼ºï¼šInsufficient for some needs</li></ul><p><img src=https://i.imgur.com/WXgFJ0f.png loading=lazy alt=image-20221119221052160></p><h4 id=non-blocking-io>Non-Blocking I/Oï¼š</h4><p>I/O calls returns as much as available <strong>I/Oè«‹æ±‚ç™¼å‡ºå»å¾Œï¼Œæ§åˆ¶æ¬Šç«‹åˆ»è¿”å›çµ¦user process</strong></p><ul><li>exampleï¼šuser interface, data copy</li><li>Implemented via multi-threading</li><li><strong>Returns quickly with count of Bytes read or written</strong></li></ul><h4 id=asynchronous-io>Asynchronous-I/O:</h4><p>(å±¬æ–¼Non-blocking)ï¼šProcess runs while, I/O executes</p><ul><li>Difficult to use</li><li>I/O subsystem signals process when I/O-completed</li></ul><p><img src=https://i.imgur.com/Z3p4rBK.png loading=lazy alt=image-20221119221104281></p><h4 id=asynchronousèˆ‡non-blockingçš„å°å·®ç•°>Asynchronousèˆ‡Non-Blockingçš„å°å·®ç•°</h4><p>Asynchronous I/Oï¼šæ•´å€‹I/Oå®Œæˆï¼Œæ‰é€šçŸ¥Process</p><p>Non-Blocking I/Oï¼šI/Oå®ŒæˆData return as much as possible (èƒ½å›å‚³å°±å›å‚³ï¼Œ å°‘é‡å³å¯å›å‚³)</p><p>èˆ‰ä¾‹èªªæ˜ï¼šuserProcessç™¼å‡º100 byteçš„I/Oè«‹æ±‚</p><ul><li>Asynchronousçš„æ–¹å¼ï¼Œæœƒå°‡100byteçš„I/Oåšå®Œå¾Œï¼Œæ‰å‘Šè¨´Processåšå®Œäº†</li><li>Non-Blockingçš„æ–¹å¼ï¼Œæ¯è®€25Byteå°±é€šçŸ¥ä¸€æ¬¡ï¼Œ é€æ­¥å›å ±çµ¦Processï¼Œæœƒç™¼å‡ºæ¯”è¼ƒå¤šæ¬¡çš„Interrupt</li></ul><h2 id=interrupt-policy-and>Interrupt Policy and</h2><ol><li>ç•¶Interruptç™¼ç”Ÿï¼ŒOSä¹‹è™•ç†Stepså¦‚ä¸‹ï¼š<ol><li>OSæ”¶åˆ°ä¸­æ–·å¾Œ(è‹¥æ­¤ä¸­æ–·è¦è¢«ç«‹å³è™•ç†ï¼Œå‰‡OSæœƒæš«åœç›®å‰Processä¹‹åŸ·è¡Œï¼Œä¸”ä¿å­˜å…¶Status and Registers Contents)</li><li>OSæœƒä¾ç…§Interrupt ID(No.)æŸ¥è©¢Interrupt Vectorä¸­æ–·å‘é‡è¡¨ï¼Œç¢ºèªä½•ç¨®Interruptç™¼ç”Ÿï¼Œä¸”æ‰¾å‡ºå…¶ISRçš„ä½å€</li><li>Jump to ISR ä½å€ï¼ŒåŸ·è¡ŒISR</li><li>ISRå®Œæˆå¾Œï¼Œæ§åˆ¶æ¬Šè¿”å›Kernel</li><li>OSæœƒæ¢å¾©(resume)ä¸­æ–·ä¹‹å‰Processä¹‹åŸ·è¡Œ</li></ol></li></ol><p><img src=https://i.imgur.com/fWGVXob.png loading=lazy alt=image-20221121000410540></p><ol start=2><li><p>Interruptç¨®é¡</p><ol><li><p>æ—©æœŸæé¾åˆ†ç‚ºä¸‰ç¨®</p><ol><li>External Interruptï¼šCPUä»¥å¤–çš„å‘¨é‚Šè¨­å‚™ã€æ§åˆ¶å¡ã€etcï¼Œæ‰€ç™¼å‡ºçš„ä¸­æ–·</li></ol><p>ä¾‹ï¼šI/O-Completed, I/O-error, Machine-check,</p><ol start=2><li>Internal Interruptï¼šCPUåœ¨åŸ·è¡ŒProcesséç¨‹ä¸­ï¼Œé­é‡é‡å¤§éŒ¯èª¤è€Œå¼•ç™¼</li></ol><p>ä¾‹ï¼šDivide-by-zeroé™¤ä»¥é›¶ã€åŸ·è¡Œéæ³•çš„ç‰¹æ¬ŠæŒ‡ä»¤ã€etc</p><ol start=3><li>Software Interruptï¼šuser process åœ¨åŸ·è¡Œä¸­ï¼Œè‹¥é ˆè¦OSæä¾›æœå‹™æ™‚ï¼Œç™¼å‡ºæ­¤é¡å‹çš„ä¸­æ–·ï¼Œç›®çš„æ˜¯<strong>é€šçŸ¥ä½œæ¥­ç³»çµ±</strong>ï¼Œè«‹å®ƒåŸ·è¡Œå°æ‡‰çš„æœå‹™è«‹æ±‚</li></ol><p>ä¾‹ï¼šI/O-request <code>å¥½æ¯”æ˜¯KTVçš„æœå‹™éˆ•ï¼ŒæŒ‰ä¸‹å»å°±æœƒæœ‰äººéä¾†å•ä½ è¦å¹¹å˜›</code></p></li><li><p>ç¾åœ¨æé¾åˆ†ç‚ºå…©ç¨®</p><ol><li>Interruptï¼šç¡¬é«”æ‰€ç”¢ç”Ÿå°±å«Interrupt</li><li>Trapï¼šè»Ÿé«”æ‰€ç”¢ç”Ÿçš„å°±å«Trap</li></ol></li></ol><p><img src=https://i.imgur.com/Gw1lwWA.png loading=lazy alt=image-20221121003713007></p><p>ä¾‹ï¼šè¨­å‚™ç™¼å‡ºI/O-Completed,I/O-Error,Machine-check,etcåŠTime-out by Timer</p><p>ç”¨é€”ä¸»è¦æœ‰äºŒ</p><ul><li>Catch the arithematic error</li></ul><p>ä¾‹ï¼šDivide-by-zero, åŸ·è¡Œéæ³•ç‰¹æ¬ŠæŒ‡ä»¤, illegal memory access</p><ul><li>user process åŸ·è¡Œéœ€è¦OSæä¾›æœå‹™æ™‚ï¼Œä¹Ÿæœƒç™¼trapé€šçŸ¥OS</li></ul><p>ä¾‹ï¼šI/Oã€€Request</p><ol start=3><li>åˆ†æˆå…©é¡<code>èƒŒå¾Œå“²å­¸ï¼šä¸­æ–·ä¹‹é–“ä¹Ÿæœ‰å„ªå…ˆæ¬Šé«˜ä½ä¹‹åˆ†</code><ol><li>Maskable Interrupté®ç½©ï¼šæ­¤é¡ä¸­æ–·ç™¼ç”Ÿå¾Œï¼Œå¯è¢«Ignoredæˆ–<strong>å»¶å¾Œè™•ç†ä¸ä¸€å®šè¦é¦¬ä¸Šè™•ç†</strong><ul><li>ä¾‹å¦‚ï¼šSoftware-interrupt</li></ul></li><li>Non-Maskableä¸å¯é®ç½©ï¼šæ­¤é¡ä¸­æ–·å¿…é ˆç«‹åˆ»è™•ç†<ul><li>Internal interrupt(é‡å¤§error), I/O-error,etc</li></ul></li></ol></li></ol></li></ol><h2 id=hardware-resources-protection>Hardware Resources Protection</h2><ul><li>åŸºç¤å»ºè¨­<ul><li>Dual-modes operation(é›™é‡æ¨¡å¼)</li><li>Privilege instructions</li></ul></li></ul><h3 id=dual-modes-operation>Dual-modes operation</h3><p>å®šç¾©ï¼šSystemä¹‹é‹ä½œæ¨¡å¼<strong>è‡³å°‘</strong>(å¯å†å¾€ä¸‹åˆ†ï¼Œä¾ç…§ç³»çµ±è¨­è¨ˆçš„å¿…è¦æ€§)å¯è¢«å€åˆ†ç‚º2ç¨®modes</p><ol><li>kernel mode</li><li>user mode</li></ol><p><strong>kernel mode</strong></p><p>åˆå«åšsystem mode, supervisor mode, privileged mode, monitor mode(æ—©æœŸæœ‰ï¼Œç¾ç§»é™¤)ï¼Œä»£è¡¨æ­¤åˆ»æ˜¯kernelå–å¾—ç³»çµ±æ§åˆ¶(å–å¾—CPUåŸ·è¡Œæ¬Š)ï¼Œ<strong>å…è¨±</strong>privilege instructions(ç‰¹æ¬ŠæŒ‡ä»¤)åœ¨æ­¤modeä¸‹åŸ·è¡Œ</p><p><strong>user mode</strong></p><p>ä»£è¡¨user processå–å¾—CPUåŸ·è¡Œï¼Œåœ¨æ­¤mode,<strong>ä¸å…è¨±</strong>åŸ·è¡Œprivilege instructions(ç‰¹æ¬ŠæŒ‡ä»¤)ï¼Œè‹¥åŸ·è¡Œå‰‡æœƒç™¼ç”Ÿtrapçš„é‡å¤§éŒ¯èª¤</p><p>æ­¤å¤–ï¼Œ<strong>Dual-modeså¿…é ˆè¦æœ‰HWçš„æ”¯æŒ</strong>ï¼Œæ‰å¯å¯¦ç¾</p><p>ä¾‹å¦‚ï¼šCPUå…§æœƒæœ‰Mode Bitï¼Œç”¨ä»¥å€åˆ†ç¾åœ¨æ˜¯å“ªå€‹mode<code>ç•¶CPUåœ¨åŸ·è¡Œæ©Ÿå™¨æŒ‡ä»¤æ™‚ï¼ŒIFã€DE...ä¹‹é¡çš„éšæ®µï¼Œè‹¥è§£ç¢¼å®Œç™¼ç¾æ˜¯å€‹ç‰¹æ¬ŠæŒ‡ä»¤ï¼Œé€™æ™‚å€™Control unitå°±è¦æª¢æŸ¥ç›®å‰çš„mode bitï¼Œåˆ¤æ–·æ˜¯å¦å¯ä¸å¯ä»¥åŸ·è¡Œï¼Œè‹¥ä¸è¡Œå°±ä¸Ÿå‡ºä¸€å€‹interruptï¼Œä¸å…è¨±åŸ·è¡Œ</code></p><h3 id=priveleged-instructionç‰¹æ¬ŠæŒ‡ä»¤>Priveleged instruction(ç‰¹æ¬ŠæŒ‡ä»¤)</h3><p>å®šç¾©ï¼šä»»ä½•å¯èƒ½æœƒé€ æˆç³»çµ±é‡å¤§å±å®³çš„æŒ‡ä»¤ï¼Œå¯è¨­ç‚ºç‰¹æ¬ŠæŒ‡ä»¤(ç«¯çœ‹å·¥ç¨‹å¸«å¦‚ä½•è¨­è¨ˆ)ï¼Œ<strong>åªå¯ä»¥</strong>åœ¨Kernel Modeå»åŸ·è¡Œï¼Œä¸å¯ä»¥å†User modeä¸‹åŸ·è¡Œï¼Œä¸€æ—¦åœ¨User Modeä¸‹åŸ·è¡Œï¼Œæœƒç™¼<strong>Trap</strong>é€šçŸ¥OSï¼Œå°‡æ­¤user process terminates.</p><p><code>å¦‚æœæŠŠæ‰€æœ‰çš„æŒ‡ä»¤è¨­ç‚ºç‰¹æ¬ŠæŒ‡ä»¤ï¼Œå¥½è™•å°±åªæœ‰è¶…ç´šå®‰å…¨ï¼Œå› ç‚ºé€™äº›æŒ‡ä»¤éƒ½åªæœ‰OSå¯ä»¥åšï¼Œå¦‚æœuseræƒ³åšå°±åªèƒ½å§”è¨—OSåŸ·è¡Œï¼Œä½†é€™æ¨£performanceæœƒå¾ˆå·®ï¼Œå› ç‚ºæ‰€æœ‰äº‹æƒ…éƒ½è¦çµ¦OSè™•ç†</code></p><p>ä¾‹å¦‚ï¼š</p><ul><li><p>Turn-off(Disable) interrupt, clear memory, I/O instruction(for I/O protection),Timerå€¼ set/change (for CPU protect)</p></li><li><p>Base/Limit register ä¿®æ”¹/set (for memory protection)</p></li><li><p><strong>Change mode from user mode to kernel mode</strong></p></li><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-markdown data-lang=markdown>1). Set value of Timer
2). Read the clock
3). Claer memory
4). Turn-off interrupt
5). Switch from user to monitor mode
  
å“ªäº›æ˜¯ç‰¹æ¬ŠæŒ‡ä»¤?
1,3,4,5
</code></pre></td></tr></table></div></div></li><li><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>1. Change to user mode
2. Change to monitor mode
3. Read from monitor memory
4. Write into monitor memory
5. Fetch an instruction from memory
6. Turn on timer interrupt 
7. Turn off timer interrupt
  
å“ªäº›æ˜¯ç‰¹æ¬ŠæŒ‡ä»¤?
2,4,7
  
è©³è§£ï¼š
6. æœ¬èº«å°±æ˜¯æ‰“é–‹çš„ï¼Œå› ç‚ºè¦åšCPUçš„ä¿è­·
7. ä½†é—œæ‰ä¸æ˜¯
  
æœ‰çˆ­è­°çš„éƒ¨åˆ†
3. user processå»è®€kernel processçš„è³‡æ–™ï¼Œæé¾èªç‚ºæ˜¯ï¼Œå› ç‚ºkernelè£¡é¢æŒç®¡æ‰€æœ‰Processçš„informationï¼Œè€Œprocessé–“ä¸æ‡‰è©²å„å€‹processçš„ç‹€æ…‹
5. å¾Monitor memory(Kernel)è£¡é¢å»è®€æŒ‡ä»¤å‡ºä¾†ï¼Œæé¾èªç‚ºä¸æ˜¯ï¼Œå› ç‚ºå°±ç®—æŠ“äº†ï¼Œä½†ä½ çš„modeä¸æ˜¯Privilege instructionå°±æœƒæŠŠä½ æ“‹æ‰
</code></pre></td></tr></table></div></div></li></ul><h3 id=ç‚ºä»€éº¼dual-modeè·Ÿprivilege-isntructionå¯ä»¥æ§‹æˆä¿è­·åŸºç¤>ç‚ºä»€éº¼Dual-modeè·ŸPrivilege Isntructionå¯ä»¥æ§‹æˆä¿è­·åŸºç¤</h3><p>æ‰€æœ‰æœƒå±å®³OSçš„æ“ä½œéƒ½æ˜¯åœ¨Kernel ç™¼ç”Ÿï¼Œå› æ­¤ä¸å¯ä»¥æ”¾ä»»userå¯ä»¥ç›´æ¥æ“ä½œKernel</p><p><img src=https://i.imgur.com/ouBgLdK.png loading=lazy alt=image-20221122221832833></p><h3 id=io-protection>I/O-Protection</h3><p>ç›®çš„ï¼šç”±æ–¼I/Oé‹ä½œè¼ƒç‚ºç¹ç‘£è¤‡é›œï¼Œç‚ºäº†<strong>é™ä½user processes æ“æ§I/Oä¹‹è¤‡é›œåº¦</strong>`ï¼Œè®“user processeså»è™•ç†æ‡‰ç”¨çš„å•é¡Œï¼ŒI/Oå‰‡äº¤ç”±OSå»è™•ç†ï¼›åŠé¿å…user processå°I/O-Devicesä¹‹ä¸ç•¶æ“ä½œï¼Œèƒ¡æçæï¼Œå› æ­¤æ‰æœ‰I/O protectionã€‚ç°¡å–®ä¾†è¬›å°±æ˜¯ä¸è¦è®“user processeså»æ“ä½œI/O</p><p>ä½œæ³•ï¼šæŠŠæ‰€æœ‰I/OæŒ‡ä»¤çš†è¨­ç‚ºprivileged instructioné…åˆDual-modes, ä¸€å¾‹è®“user processå§”è¨— kernelåŸ·è¡ŒI/Oé‹ä½œ</p><h3 id=memory-protection>Memory Protection</h3><p>ç›®çš„ï¼šé˜²æ­¢user process å­˜å–å…¶ä»–user processes ä¹‹ memory area åŠ kernel memory area</p><p>ä½œæ³•ï¼š(ä»¥ contiguous Memory Allocatation ç‚ºä¾‹) é‡å°æ¯å€‹Process, kernelæœƒæä¾›ä¸€å¥—Registersï¼šå«base/limit register, å…¶ä¸­</p><ul><li>Base registerç´€éŒ„Processä¹‹<strong>èµ·å§‹ä½å€</strong></li><li>Limit registerç´€éŒ„Processä¹‹<strong>å¤§å°</strong></li></ul><p>å°‡ä¾†ProcessåŸ·è¡Œï¼Œæœƒé€²è¡Œä¸‹åˆ—çš„Checking</p><p><img src=https://i.imgur.com/Ys8xRSh.png loading=lazy alt=image-20221122234041249></p><blockquote><p>ç‚ºä»€éº¼Addressçš„åˆ¤æ–·æ˜¯ç”±Hardwareä¾†åšè€Œä¸æ˜¯OSä¾†åšå‘¢ï¼Ÿ</p><p>å› ç‚ºäº¤çµ¦OSä¾†åšå°±æœƒç”¢ç”Ÿä¸­æ–·interruptï¼Œåˆå› ç¨‹å¼åœ¨åŸ·è¡Œçš„æ™‚å€™å°è¨˜æ†¶é«”çš„å­˜å–æ˜¯å¾ˆé »ç¹çš„ï¼Œå…©å€‹å½±éŸ¿ä¹‹ä¸‹æœƒå°è‡´ä½ çš„CPUä¸€ç›´è¢«interruptæ‰“æ“¾ï¼Œå› æ­¤äº¤çµ¦Hardwareä¾†åšæœƒæ¯”è¼ƒç¬¦åˆæˆæœ¬ä¸€é»ã€‚</p></blockquote><p>ä¸¦ä¸”ï¼Œé‚„è¦å°‡ Baseèˆ‡Limit register å€¼ä¹‹set/changeé ˆè¨­ç‚º"Privilege Code(ç‰¹æ¬ŠæŒ‡ä»¤)"ï¼Œé¿å…user ProcessæŠŠBaseè·ŸLimitçš„ä½å€ç›´æ¥æ”¹æˆç„¡é™ï¼Œé€™æ¨£å°±å®Œæˆäº†Memoryçš„<strong>Protection</strong></p><h3 id=cpu-protection>CPU Protection</h3><p>ç›®çš„ï¼šé˜²æ­¢user processç„¡é™æœŸ/é•·æœŸä½”ç”¨CPUè€Œä¸é‡‹æ”¾</p><p>ä½œæ³•ï¼šåˆ©ç”¨<strong>Timer</strong>å¯¦æ–½ï¼ŒåŒæ™‚OSæœƒè¦å®šProcessä½¿ç”¨CPU timeä¹‹æœ€å¤§é…é¡å€¼(MAX. Time Quantum)</p><p>ç•¶process å–å¾—CPUå¾Œï¼ŒTimeråˆå€¼å³è¨­ç‚ºMax Time Qauntumå€¼ï¼Œéš¨è‘—ProcessåŸ·è¡Œ timeå¢åŠ , <strong>Timerå€¼æœƒé€æ­¥éæ¸›</strong>ï¼Œç›´åˆ°Timerå€¼ç‚º0, Timeræœƒç™¼å‡º <strong>Time-out</strong>çš„interrupté€šçŸ¥OSï¼ŒOSä¾¿å¯å¼·è¿«æ­¤processæ”¾æ‰CPUï¼Œæ­¤å¤–ï¼ŒTimerå€¼ä¹‹set/change ä¹Ÿé ˆè¨­ç‚ºç‰¹æ¬ŠæŒ‡ä»¤</p><h2 id=os-structure-operating-system>OS Structure Operating-System</h2><blockquote><p>OSä¹‹Development</p><blockquote><p>OSæ‡‰æä¾›çš„æœå‹™é …ç›®</p><p>OSä¹‹<strong>æœå‹™å…ƒä»¶</strong>ç¨®é¡</p><p><strong>System Callsä¹‹ä»‹ç´¹</strong>(ä½¿ç”¨è€…ç¨‹å¼è·ŸOSä¹‹é–“æºé€šçš„ä»‹é¢)</p><p>OSä¹‹Structureç¨®é¡</p><blockquote><p>Simple</p><p>More Complex than simple</p><p>Layered Approach</p><p><strong>Microkernel</strong></p><p>Module</p><p>Hybrid(æ··åˆ?)</p></blockquote><p>è¨­è¨ˆåŸå‰‡ï¼šPolicyèˆ‡Mechanism <code>policyç®¡è¡Œç‚º,æ¯”è¼ƒå¸¸è®Šï¼Œä¾‹å¦‚æ•¸å€¼çš„è®Šå‹•; mechanismè² è²¬è™•ç†how,æ¯”è¼ƒä¸æœƒè®Š,ä¾‹å¦‚é‚è¼¯çš„åˆ¤æ–·</code></p><p>Virtual Machineä»‹ç´¹</p></blockquote></blockquote><h3 id=system-call>System Call</h3><p>å®šç¾©ï¼šä½œç‚ºåŸ·è¡Œä¸­user processèˆ‡kernelä¹‹é–“çš„æºé€šç•Œé¢ï¼Œç•¶user processéœ€è¦OSæä¾›æŸç¨®æœå‹™æ™‚ï¼Œæœƒå…ˆtrapé€šçŸ¥OSï¼Œä¸¦å¸¶å…¥<strong>System call</strong> ID(No)åŠ<strong>æ‰€éœ€åƒæ•¸</strong>ï¼Œç„¶å¾ŒOSåŸ·è¡Œå°æ‡‰çš„System call</p><blockquote><p>It&rsquo;s a programming Interface to the services privided by the OS</p></blockquote><p>ç”¨èˆ‰ä¾‹ä¾†è¬›çš„è©±</p><ul><li>Trap = æœå‹™ç´</li><li>System call = æœå‹™é …ç›®</li></ul><p>System Callçš„ç¨®é¡(ä¸­å¤®è€ƒéé¡ä¼¼çš„é¡Œç›®)</p><blockquote><ol><li>Process Control egï¼šå»ºç«‹ã€çµ‚æ­¢ã€æš«åœã€æ¢å¾©åŸ·è¡Œprocess, set/read attribute</li><li>File Management egï¼šå»ºç«‹ã€read, write, open, close, delete &mldr;</li><li>Device Management egï¼šå»ºç«‹ã€read, write, open, close, delete &mldr;</li><li>Information of Maintenance egï¼šå–å¾—ç³»çµ±æ—¥æœŸ/æ™‚é–“ã€å–å¾—Processå±¬æ€§ etc</li><li>Communications eg: Processesä¹‹é–“çš„é€šè¨Šè€Œä¸”åªé‡å°Message Processingæ–¹å¼æä¾›æœå‹™</li><li>Protectionã€€eg: Hw resources protection, File access contorller, etc</li></ol></blockquote><p><img src=https://i.imgur.com/VvdLNs0.png loading=lazy alt=image-20221124224120796></p><p>System Callçš„åƒæ•¸(Parameters)å‚³éæ–¹å¼ï¼š3ç¨®æ–¹å¼</p><ol><li>åˆ©ç”¨æš«å­˜å™¨(<strong>Registers</strong>)ä¿å­˜åƒæ•¸<ul><li>å„ªé»ï¼š<ol><li>æœ€ç°¡å–®</li><li>å­˜å–é€Ÿåº¦æœ€å¿«( without memory access)</li></ol></li><li>ç¼ºé»:<ol><li>ä¸é©ç”¨æ–¼å¤§é‡åƒæ•¸ä¹‹æƒ…æ³</li></ol></li></ul></li><li>åˆ©ç”¨<strong>Memory</strong>ï¼Œä»¥ä¸€å€‹Block(Table)å„²å­˜é€™äº›åƒæ•¸ï¼Œä¸¦å°‡é€™äº›è¡¨æ ¼çš„èµ·å§‹ä½å€ç½®æ–¼1å€‹Registerä¸­ï¼ŒPassçµ¦OS<ul><li>å„ªé»:<ol><li>é©ç”¨æ–¼å¤§é‡åƒæ•¸</li></ol></li><li>ç¼ºé»:<ol><li>å­˜å–é€Ÿåº¦è¼ƒæ…¢ï¼Œä¸”æ“ä½œè¼ƒç‚ºéº»ç…©</li></ol></li></ul></li><li>åˆ©ç”¨<strong>Stack</strong>å°‡åƒæ•¸pushå…¥æ­¤Stack, OSå†pop from stack, ä»¥å–å¾—åƒæ•¸<ul><li>å„ªé»:<ol><li>é©ç”¨æ–¼å¤§é‡åƒæ•¸ä¹‹æƒ…æ³</li><li>ä¹Ÿå¾ˆç°¡å–®</li></ol></li><li>ç¼ºé»:<ol><li>Stackçš„ç©ºé–“é ˆè¦é å…ˆæº–å‚™ï¼Œé¿å…stackoverflow</li></ol></li></ul></li></ol><h3 id=osä¹‹ç³»çµ±æ¶æ§‹åˆ†é¡>OSä¹‹ç³»çµ±æ¶æ§‹åˆ†é¡</h3><p>OSä¹‹Structureç¨®é¡</p><blockquote><p>Simple: MS-DOSç³»çµ±</p><p>More Complex than simple: UNIXç³»çµ±</p><ul><li>Limited by Hardware functionality</li><li>The original UNIX had limited structuring</li><li>The UNIX åŒ…å«å…©å€‹Separate parts<ol><li>System Programs</li><li>The Kernel</li></ol></li></ul><p><img src=https://i.imgur.com/luyuYF4.png loading=lazy alt=image-20221125013311284></p><ul><li><strong>Beyond simple but not fully layered</strong>(åˆ†å±¤)</li></ul><p>Layered Approach</p><ul><li><p>å®šç¾©ï¼šæ¡å–<strong>Top-Down</strong>æ–¹å¼ï¼Œåˆ‡å‰²ç³»çµ±åŠŸèƒ½/å…ƒä»¶ï¼Œä»¥é™ä½è¤‡é›œåº¦ã€‚å…ƒä»¶/æ¨¡çµ„ä¹‹é–“å‘¼å«é—œä¿‚åˆ†å±¤</p><p>å³<strong>ä¸Šå±¤å¯ä»¥ä½¿ç”¨ä¸‹å±¤çš„åŠŸèƒ½ï¼Œä½†ä¸‹å±¤ä¸å¯ä»¥ä½¿ç”¨ä¸Šå±¤çš„åŠŸèƒ½</strong>ã€‚å®Œæˆå¾Œè¦ä½¿ç”¨<strong>Bottom-up</strong>æ–¹å¼é€²è¡Œæ¸¬è©¦ï¼Œdebugging(ç”±åº•å±¤ä¸€è·¯å¾€å¤–æ¸¬)</p></li><li><p>å±¤æ¬¡çš„åŠƒåˆ†æ²’æœ‰æ˜ç¢ºè¦å®š</p><p><img src=https://i.imgur.com/dkCQyVV.png loading=lazy alt=image-20221125014733544></p></li><li><p>å„ªé»ï¼š</p><ul><li>é™ä½è¨­è¨ˆè¤‡é›œåº¦</li><li>æœ‰åŠ©æ–¼åˆ†å·¥</li><li>æ¸¬è©¦ã€é™¤éŒ¯ã€ç¶­è­·å®¹æ˜“</li></ul></li><li><p>ç¼ºé»ï¼š</p><ul><li>å¾ˆé›£åšåˆ°ç²¾æº–çš„åˆ†å±¤åŠƒåˆ†</li><li>è‹¥Layeræ•¸å¤ªå¤šï¼Œå‰‡System performance is very poor( åˆ‡åˆ°å››å±¤å‰›å¥½ã€äº”å±¤å¤ªå¤šï¼Œæ¥µé™ä¸­çš„æ¥µé™æ˜¯ä¸ƒå±¤)</li></ul></li></ul><p><strong>Microkernel</strong>(å¾®æ ¸å¿ƒ)ï¼šç”±CMU(å¡å…§åŸº-ç¾éš†å¤§å­¸)ç‡å…ˆæå‡ºï¼Œä»£è¡¨ç”¢å“ï¼š<strong>Mach o.s</strong>ã€‚å®ƒå€‘èªç‚ºUNIXçš„æœå‹™é …ç›®å¤ªå¤šã€å¤ªé¾å¤§ï¼Œä¸åˆ©ç§»æ¤</p><ul><li>å®šç¾©ï¼šå°‡Kernelä¸­ä¸€äº›Non-essential services<code>(æ¯”è¼ƒä¸æ˜¯é‚£éº¼åŸºæœ¬ã€é‡è¦ã€å¿…è¦)</code>ï¼Œè‡ªKernelç•¶ä¸­ç§»é™¤ï¼Œæ”¹æˆåœ¨User Mode(Site)æä¾›é€™äº›æœå‹™ï¼Œä»¥System programsæ–¹å¼å­˜åœ¨ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œå¯ä»¥å¾—åˆ°ä¸€å€‹æ¯”è¼ƒå°çš„kernelï¼Œç¨±ä¹‹ç‚ºmicrokernel, ä¸€èˆ¬è€Œè¨€ï¼ŒMicrokernelæä¾›ä¸‹åˆ—ä¸‰å€‹minimum serviceï¼š</li></ul><ol><li>Porcess Controll</li><li>Memory Management(ä¸åŒ…æ‹¬Virtual memory)</li><li>Process Communications(æä¾›message Processingæœå‹™è€Œå·²)</li></ol><p><img src=https://i.imgur.com/R7XWIb1.png loading=lazy alt=image-20221126165547853></p><ul><li>Benefits(å¥½è™•)</li></ul><ol><li>Easier to extend a microkernel<ul><li>æœå‹™çš„å¢åŠ /åˆªé™¤æ˜¯å®¹æ˜“çš„ï¼Œ<strong>å› ç‚ºé€™äº›æœå‹™æ˜¯åœ¨user siteåŸ·è¡Œ</strong>ï¼Œæ‰€ä»¥æœå‹™çš„å¢ã€åˆªä¸éœ€è¦ç‰½æ‰¯åˆ°Kernelä¹Ÿè¦è®Šæ›´ï¼Œå³ä½¿è¦ï¼Œä¹Ÿæ˜¯å°‘é‡</li></ul></li><li>Easier to port the OS to new architectures<ul><li>å› ç‚ºKernelå¾ˆå°ï¼Œæ‰€ä»¥ç§»æ¤åˆ°æ–°çš„ç¡¬é«”å¹³å°ä¹‹æ›´æ”¹å¹…åº¦ä¸å¤§(å› ç‚ºåªæœ‰ä¸‰å€‹æœå‹™runåœ¨kernel)</li></ul></li><li>More Reliable<ul><li>è¬ä¸€æŸä¸€å€‹æœå‹™åœ¨åŸ·è¡Œä¸­æ›æ‰äº†ï¼Œå……å…¶é‡åªæ˜¯ç›¸ç•¶æ–¼ä¸€å€‹user processæ­»æ‰è€Œå·²ï¼Œæ‰€ä»¥å°HW, kernel, å…¶ä»–user processæ²’æœ‰ä¸è‰¯å½±éŸ¿ï¼Œå› ç‚ºæŠŠå¤§éƒ¨åˆ†çš„æœå‹™ç§»åˆ°user modeå»åšäº†ï¼Œå› æ­¤æ›´åŠ å®‰å…¨ã€å¯é </li></ul></li><li>More secure<ul><li>è¬ä¸€æŸä¸€å€‹æœå‹™åœ¨åŸ·è¡Œä¸­æ›æ‰äº†ï¼Œå……å…¶é‡åªæ˜¯ç›¸ç•¶æ–¼ä¸€å€‹user processæ­»æ‰è€Œå·²ï¼Œæ‰€ä»¥å°HW, kernel, å…¶ä»–user processæ²’æœ‰ä¸è‰¯å½±éŸ¿ï¼Œå› ç‚ºæŠŠå¤§éƒ¨åˆ†çš„æœå‹™ç§»åˆ°user modeå»åšäº†ï¼Œå› æ­¤æ›´åŠ å®‰å…¨ã€å¯é </li></ul></li></ol><ul><li>ç¼ºé»</li></ul><ol><li>Performance overhead of user space to kernel space communication(æ•ˆèƒ½è¼ƒå·®)ï¼Œå› ç‚ºprocess Communicationå……æ–¥å¤§é‡è¨Šæ¯å‚³é</li></ol><blockquote><p>Noteï¼šmicrokernelçš„<strong>ç›¸åè©</strong>ï¼š<strong>Monolithic kernel</strong></p><p>å®šç¾©ï¼šæ‰€æœ‰çš„Servicesçš†é ˆRun in kernel modeï¼Œå¤§éƒ¨åˆ†çš„å•†ç”¨OSå¹¾ä¹éƒ½æ˜¯Monolithic kernelï¼Œå› ç‚ºå¦‚æœæŠŠæ‰€æœ‰çš„serviceç§»åˆ°user siteå»åšï¼Œé‚£å®ƒçš„æ§åˆ¶å°±æœƒå¾ˆä½ã€‚ç•¶é€™å€‹æ§åˆ¶åŠ›å¾ˆä½çš„æ™‚å€™ï¼Œuseræˆ–programå°±å¯ä»¥è‡ªå·±å»Inhenceä¸€äº›æ±è¥¿ï¼Œå½±éŸ¿OS</p><p>å„ªé»ã€ç¼ºé»ï¼šå’Œmicrokernelç›¸å</p></blockquote><p>Module</p><ul><li>Many OS implement <strong>loadable</strong>(æœ‰éœ€è¦æ‰è¼‰å…¥) kernel modules</li><li>use Object-oriented approach</li><li>Each core component is <strong>separate</strong></li><li>Each talks to the others over known interface</li><li>Each is loadable as heeded within the Kernel</li><li>ç°¡è€Œè¨€ä¹‹ï¼šsimilar to Layers but with <strong>more flexible, æ•ˆèƒ½æ›´å¥½</strong></li></ul><p><img src=https://i.imgur.com/epQ0WDz.png loading=lazy alt=image-20221126173047816></p><p>ä¾‹å¦‚ï¼šLinux, solaris, etc &mldr;</p><p>Hybrid(æ··åˆ?)ï¼šç¾åœ¨ä½œæ¥­ç³»çµ±å¾ˆé›£ç´”ç²¹æ­¸å±¬æ–¼æŸä¸€å‹</p><ul><li><strong>Linux</strong>(ä¸­å¤®è€ƒé) and Solaris æ˜¯ Monolithic (æ‰€æœ‰æ±è¥¿éƒ½runåœ¨kernel mode)ï¼Œä¸”ä¹Ÿæ˜¯<strong>Modular for dynamic loading</strong></li><li>ä¾‹ï¼šwindows mostly monolithicï¼Œæœ‰æ™‚é‡å°ä¸åŒå®¢æˆ¶éœ€æ±‚ï¼Œæœƒå†åŠ ä¸Šmicrokernel for subsystem</li><li>ä¾‹ï¼šApple Mac Os ä¹Ÿæ˜¯æ··åˆçš„</li></ul><p>kernel åŒ…å«</p><blockquote><p>Mach microkernel</p><p>éƒ¨åˆ†çš„BSD UNIX</p><p>I/O Kit</p><p><strong>dynamic Loadable module(å«åš kernel extension)</strong></p></blockquote><p><img src=https://i.imgur.com/5JwG18g.png loading=lazy alt=image-20221126175630716></p></blockquote><h3 id=virtual-machine>Virtual Machine</h3><p>å®šç¾©ï¼šåˆ©ç”¨sofewareæŠ€è¡“æ¨¡æ“¬å‡ºä¸€ä»½èˆ‡åº•å±¤HWä¸€æ¨¡ä¸€æ¨£çš„åŠŸèƒ½ä»‹é¢ä¹‹æŠ½è±¡ä»£ç†å™¨(abstract machine)ï¼Œç¨±ä¹‹Virtual Machine<code>æ¨¡æ“¬çš„æ–¹å¼é¡ä¼¼æ–¼CPU schdueling</code></p><p>åè©è§£æï¼š</p><p><strong>Host</strong>ï¼šundelying hardware system, os</p><p><strong>VMM(Virtual Machine Manage)æˆ–Hypervisor</strong>ï¼šcreates and managing/ runs virtual machines</p><p><strong>Guest</strong>ï¼šprocess provided with virtual copy of the host</p><blockquote><p>æé¾æœ¬ä¹‹å…¶ä»–è‹±æ–‡</p><ul><li>Abstract hardware of a single computer into several different execution environments</li><li>Similar to layered approach, But layer crates virtual machine(VM)</li></ul></blockquote><p><strong>å„ªé»</strong></p><ul><li><p>ä½œç‚ºæ¸¬è©¦é–‹ç™¼ä¸­çš„OSï¼Œæä¾›ä¸€å€‹è‰¯å¥½çš„è² è¼‰å¹³å°ï¼Œå…·æœ‰ä¸‹åˆ—å¥½è™•ï¼š</p><ol><li>å…¶ä»–user, user processeså·¥ä½œï¼Œä»å¯æŒçºŒé‹ä½œï¼Œä¸é ˆæš«åœ</li><li>è¬ä¸€æ¸¬è©¦ä¸­çš„OSä¸ç©©å®šã€æ›æ‰/å¤±æ•—äº†ï¼Œä¹Ÿä¸æœƒå½±éŸ¿host Hw, OS, å…¶ä»–user processes ä¹‹å·¥ä½œï¼Œå› ç‚ºåªæ˜¯ç›¸ç•¶æ–¼ä¸€å€‹user process failsè€Œå·²ï¼Œä¸æœƒå°systemæœ‰é‡å¤§å±å®³</li></ol><p><img src=https://i.imgur.com/cxdDMTi.png loading=lazy alt=image-20221126221141028></p><ol start=3><li><p>åŒä¸€éƒ¨Host Hardwareä¸Šå¯ä»¥åŸ·è¡Œå¤šå€‹OS running on å¤šå€‹virtual machinesï¼Œ<strong>é€™æ¨£å¯ä»¥ç¯€çœæˆæœ¬</strong></p></li><li><p><strong>Consolidation(åˆä½µ)</strong>ï¼šåœ¨ Cloud computing environmentï¼Œæˆ‘å€‘æœƒç”¨<strong>æœ‰é™çš„</strong>æ©Ÿå™¨ï¼Œå»ºç«‹ç‚ºæ•¸æ³¨çœ¾å¤šçš„virtual machinesï¼Œæˆ‘å€‘å¯ä»¥ä¾VMä¸Šçš„Applicationsä¹‹åŸ·è¡Œè² æ“”è¼•é‡ï¼Œ<strong>èª¿ç”¨Host machinesè³‡æºï¼Œåšå› æ‡‰çš„æ”¯æ´</strong>ï¼Œæœ‰éœ€è¦å°±åœ¨åŠ é–‹ï¼Œæ²’éœ€è¦å°±é—œæ‰ï¼Œåšè³‡æºçš„åˆä½µèˆ‡èª¿åº¦</p></li><li><p>VMè¼ƒç‚ºå®‰å…¨(å¦‚æœVMè¢«ç—…æ¯’å…¥ä¾µï¼Œä¸è‡´æ“´æ•£ï¼Œå› ç‚ºå„VMä¹‹é–“æ˜¯ç›¸äº’ç¨ç«‹çš„)</p></li><li><p>å¯ä»¥Freeze, suspend, running VM, åŠClone(è¤‡è£½) VM</p></li></ol><p><img src=https://i.imgur.com/wQovoui.png loading=lazy alt=image-20221126223550540></p></li></ul><p><strong>VMMçš„Implementation</strong></p><p><code>Hypervisor : è™›æ“¬æ©Ÿç®¡ç†ç¨‹å¼</code></p><ol><li><p>Type0 Hypervisor(ç¡¬é«”å±¤æ¬¡)ï¼š</p><ol><li><strong>Hardware</strong>-based solutions via firmware<ul><li>ä¾‹å¦‚ï¼šIBM LPARS and Oracle LDOMs</li></ul></li></ol></li><li><p>Type1 Hypervisor(Kernel Modeå±¤æ¬¡)</p><ol><li><p>OS-like software</p><ul><li>ä¾‹ï¼š<strong>VMware ESX</strong>, Joyent SmartOS, Crtrix XenServer</li></ul></li><li><p>general purpose OS that provide VMM functions (services)</p><ul><li>ä¾‹å¦‚Microsoft Window Server with HyperV, Redhat Linux with KVM</li></ul></li></ol></li><li><p>Type2 Hypervisor(user modeå±¤æ¬¡)ï¼š</p><ol start=3><li><p><strong>Applications</strong> level provides VMM functionality</p><p>eg. <strong>Paraller</strong> <strong>Desktop</strong>, Oracle VirtualBox</p></li></ol></li></ol><p>é‚„æœ‰ä¸€äº›å…¶ä»–çš„<strong>è®Šå½¢</strong><code>ä¸Šé¢é‚£ä¸‰é¡éƒ½æ˜¯è¦å‰µé€ è·Ÿåº•å±¤ç¡¬é«”(Host HW)ä¸€æ¨£çš„Virtual Machineï¼Œä½†ä¸‹é¢é€™äº›å»ä¸æ˜¯</code></p><ol start=4><li><p><strong>Paravirtualizationâ˜†è€ƒè©¦é‡é»</strong></p><ul><li>The guest OS need modify to work in cooperation with VMM to optimize performance</li><li><strong>presents guest(run åœ¨virtual Machineä¸Šçš„éƒ½å«guest) with similar but Not identical to Host Hardware</strong></li><li>Guest <strong>must be modified(å¿…é ˆè¦è¢«ä¿®æ”¹æ‰å¯ä»¥ç”¨)</strong> to Run ON Paravirtualization virtual hardware</li></ul></li><li><p>Programming-environment virtualization</p><ul><li><p>VMMs do not virtualize, HW but instead <strong>create on optimized virtual system .</strong>(å‰µé€ å…¨æ–°çš„Virtual Machine)</p><p>eg. Java virtual machine(JVM), Microsoft .NET</p><p><strong>JVM is a SPECification(è¦æ ¼), not an implementation</strong></p><p>è¦ç¯„</p><ol><li>Class Loader(æŠŠbype code loadä¸‹ä¾†)</li><li>Class verifier(é©—è­‰å™¨ï¼Œé©—è­‰byte Codeå®‰ä¸å®‰å…¨ï¼Œæ¯”å¦‚æ˜¯å¦åŒ…å«pointer)</li><li>Java interpreter(åŸ·è¡Œbyte code)</li></ol><p><img src=https://i.imgur.com/gZivz4w.png loading=lazy alt=image-20221128233907844></p></li></ul></li><li><p><strong>Emulators</strong>ï¼šAllow application written for one HW to run on a very different HW such as different type of CPUã€‚ä¾‹ï¼šPS4æ¨¡æ“¬å™¨ã€3DSæ¨¡æ“¬å™¨</p></li><li><p><strong>Application containment (åº•å±¤æ²’æœ‰Virtual Machineï¼Œè€Œæ˜¯ å‰µé€ åŸ·è¡Œç’°å¢ƒï¼Œè€Œä¸æ˜¯æ¨¡æ“¬)</strong></p><p>eg. Oracle Solaris Zones BSD Jails, IBM AIX WPARs application</p><p><img src=https://i.imgur.com/EVk8fjP.png loading=lazy alt=image-20221127130242062></p><p><strong>Policy(æ”¿ç­–ã€ç­–ç•¥ ) èˆ‡ Mechanism</strong></p><ol><li><p>Policyå®šç¾©</p><ol><li><strong>&ldquo;What&rdquo; to be proovided</strong></li><li><strong>ç¶“å¸¸æ”¹è®Šã€æœä»¤å¤•æ”¹</strong></li></ol></li><li><p>Mechanismå®šç¾©</p><ol><li><strong>How to do that</strong></li><li>The underlying(åŸºæœ¬çš„) mechanismç”šå°‘æ”¹è®Šæˆ–ä¸è®Š</li></ol></li><li><p>è¨­è¨ˆåŸå‰‡ï¼š</p><p>Policyèˆ‡Mechanismå®œseparateï¼Œä»¥å¢é€²system flexibility</p></li><li><p>èˆ‰ä¾‹</p><ol><li></li></ol><ul><li>é‹ç”¨Timerä½œç‚ºCPU protection > Mechanism</li><li>Max.Time Quantumå¤§å°åˆ¶å®š > Policy</li></ul><ol start=2><li></li></ol><ul><li>CPUæ’ç‰ˆæ¡Priority Scheduling æ’ç­ > Mechanism</li><li>Priorityå¤§å°ä¹‹å®šç¾© > Policy</li></ul></li></ol></li></ol><h1 id=chapter-3-system-structure>Chapter 3 System Structure</h1><p>é€™å€‹éƒ¨åˆ†å’Œç¬¬äºŒç« å¯«åœ¨ä¸€èµ·äº†</p><h1 id=chapter4--process-management-and-thread-management>Chapter4 Process Management And Thread Management</h1><blockquote><p>Process å®šç¾©èˆ‡Progeamæ¯”è¼ƒ</p><p><strong>PCBå…§å®¹ è€ƒè©¦é‡é»</strong></p><p><strong>Process State Transition Diagram (S.T.D)è€ƒè©¦é‡é»</strong></p><p>Schedulerçš„ç¨®é¡(è§£é‡‹åè©)</p><blockquote><p>é•·æœŸ</p><p>çŸ­æœŸ</p><p>ä¸­æœŸ</p></blockquote><p>Context Switching (è§£é‡‹åè©)</p><p>Dispatcher, Dispatch latency(è¼ƒå°‘è€ƒ)</p><p><strong>Process Controller Operations(UNIX, System Callç‚ºä¸»çš„ç¨‹å¼è¿½è¹¤) è€ƒè©¦é‡é»</strong></p><p><strong>è©•ä¼°CPU Scheduling æ•ˆèƒ½çš„å¥½æˆ–ä¸å¥½çš„5å€‹Criteria(æ¸…å¤§å–œæ­¡è€ƒ)</strong></p><p><strong>å„ç¨®CPU æ’ç­æ³•å‰‡(7å€‹)ä»‹ç´¹åŠç›¸é—œåè©(Starvation,Aging,Preemptive,Non-preemptive,Convoy effect) è€ƒè©¦é‡é»</strong></p><p>ç‰¹å®šSystemçš„æ’ç­è¨­è¨ˆ</p><blockquote><p>MultiProcessors System</p><p>Real-time System</p><blockquote><p>Soft (è€ƒç”³è«–é¡Œ)</p><p>Hard(è€ƒè¨ˆç®—é¡Œ)</p></blockquote></blockquote><p>Thread Management</p></blockquote><h2 id=process-definition>Process Definition</h2><p>å®šç¾©ï¼šA program in execution[æ]</p><ul><li>Process å»ºç«‹å¾Œï¼Œå…¶ä¸»è¦çµ„æˆæœ‰ï¼š<ul><li><strong>Process No(ID)</strong>: Processè¢«ç”Ÿæˆå‡ºä¾†æ™‚ï¼Œæœƒæœ‰ä¸€å€‹Process Idï¼Œä½œç‚ºè­˜åˆ¥</li><li>Process State</li><li>Code Section, Data Sectionï¼šProcesså ç”¨çš„ Memory Space</li><li>Programming Counter(PC)ï¼šç¨‹å¼è¨ˆæ•¸å™¨ï¼Œå‘Šè¨´æˆ‘å€‘ç¾åœ¨é€™å€‹ProcessåŸ·è¡Œåˆ°å“ªè£¡ï¼Œè£¡é¢æ”¾ä¸‹ä¸€æ¢æŒ‡ä»¤çš„ä½å€</li><li>Stack</li><li>CPU Register value</li><li>æ˜¯OS åˆ†é… **Resource(CPU,I/O-Divice, Memory) **ä¹‹å°è±¡å–®ä½ï¼šè·ŸThreadçš„å·®åˆ¥</li></ul></li><li>èˆ‡Program(ç¨‹å¼)çš„æ¯”è¼ƒ</li></ul><div class=table-wrapper><table><thead><tr><th>Process</th><th>Program</th></tr></thead><tbody><tr><td>åŸ·è¡Œä¸­çš„ç¨‹å¼</td><td>Just a <strong>File</strong> stored in storage device</td></tr><tr><td>&ldquo;Active&rdquo; entity(æ´»å‹•ä¸­ã€åŸ·è¡Œä¸­)</td><td>&ldquo;Passive&rdquo; entity(æ²’æœ‰æ´»å‹•çš„)</td></tr></tbody></table></div><h2 id=process-control-block>Process Control Block</h2><p>(PCBå…§å®¹)</p><p>å®šç¾©ï¼šOSç‚ºäº†ç®¡ç†æ‰€æœ‰Processesï¼Œæœƒåœ¨Kernel memoryä¸­ï¼Œæ›¿æ¯å€‹Processï¼Œå„è‡ªæº–å‚™ä¸€å€‹Block(Table, è¡¨æ ¼)ï¼Œç”¨ä¾†è¨˜éŒ„Processä¹‹æ‰€æœ‰ç›¸é—œè³‡è¨Š</p><p><strong>PCBçš„ä¸»è¦å…§å®¹æœ‰(è¦èƒŒï¼Œè€ƒé¸æ“‡)ï¼š</strong></p><ol><li><p><strong>Process No(ID)ï¼šæ˜¯Unique(å”¯ä¸€çš„)</strong></p></li><li><p><strong>Process stateï¼šeg. ready, running, wait, etc</strong></p></li><li><p><strong>Programming Counterï¼šå…§æ”¾ the next instruction&rsquo;s address</strong></p></li><li><p>**CPU Registersï¼šeg. ç´€éŒ„ä½¿ç”¨åˆ°çš„æš«å­˜å™¨çš„å€¼ eq. Accumulator, PSW(Process Status Word), Stack Top ,etc **</p></li><li><p><strong>CPU Scheduling Infoï¼šeg. Process çš„å„ªå…ˆæ¬Šï¼ŒFirst-In First-Out(FIFO)</strong></p></li><li><p><strong>Memory Management Info(éš¨OSçš„è¨˜æ†¶é«”ç®¡ç†æ–¹æ³•ä¸åŒï¼Œç´€éŒ„ä¸åŒè³‡è¨Š)ï¼šeg. Base/Limit registeræˆ– Page Table æˆ– Segment Table</strong></p></li><li><p><strong>Accounting Infoï¼šeg. Processå·²ä½¿ç”¨äº†å¤šå°‘CPU Time, å“ªäº›è³‡æº, é‚„å‰©å¤šå°‘è³‡æº,å¤šå°‘CPU Timeå¯ä»¥ç”¨</strong>
Noteï¼šç›®çš„</p><blockquote><p>è¨ˆç®—ä½¿ç”¨é‡ï¼Œè¨˜å¸³ã€æ”¶ï¼„</p><p>Administrator èª¿æ•™Performanceçš„ä¾æ“š</p></blockquote></li><li><p><strong>I/O Status Infoï¼šeg. processå·²ç¶“ç™¼å‡ºå¤šå°‘I/O-Request, å®Œæˆ ç‹€æ³å¦‚ä½•ï¼Œå ç”¨é‚£äº›I/O Resource(ç›®å‰é‚„æ²’é‡‹æ”¾çš„)</strong></p></li></ol><h2 id=process-state-transition-diagram>Process State Transition Diagram</h2><p>ç‹€æ…‹è½‰æ›åœ–(S.T.D)</p><p>ç›®çš„ï¼šæè¿°Processä¹‹Life Cycleï¼Œç”¨ä¾†è¨˜éŒ„Processå»ºç«‹ï¼Œåˆ°å®ƒè¢«çµ‚æ­¢ä¹‹é–“ï¼Œæ‰€ç™¼ç”Ÿçš„äº‹</p><p>å„å€‹ç‰ˆæœ¬çš„STDå®šç¾©éƒ½ä¸å¤ªä¸€æ¨£</p><blockquote><ol><li>[æ] 5å€‹Stateçš„STD</li><li>[Stalling]7å€‹State STD (æ¯”æé¾å¤šå…©å€‹ç‹€æ…‹)</li><li>[Stalling] UNIXçš„STD</li></ol></blockquote><h3 id=5-steps-of-state-transition-diagram>5 Steps of State Transition Diagram</h3><p>è¦æœƒç•«ï¼Œæœƒèªªæ˜ï¼Œè¶…åŸºç¤ï¼Œè€ƒå‡ºä¾†æ˜¯é€åˆ†é¡Œ</p><p><img src=https://i.imgur.com/WlbrMCp.png loading=lazy alt=image-20221204010203958></p><div class=table-wrapper><table><thead><tr><th>State</th><th>Description</th></tr></thead><tbody><tr><td>New(Create)</td><td>Processè¢«å»ºç«‹ï¼Œå·²åˆ†å¾—PCBçš„ç©ºé–“ï¼Œ<strong>å°šæœªè¼‰å…¥è¨˜æ†¶é«”ã€æœªå–å¾—è¨˜æ†¶é«”è³‡æº</strong>ï¼Œå› æ‡‰Batchçš„ç³»çµ±</td></tr><tr><td>Ready</td><td>Processåœ¨è¨˜æ†¶é«”äº†ï¼Œä¸”OSå·²ç¶“æŠŠå®ƒ<strong>æ”¾åˆ°Ready Queueå…§ï¼Œä¸”å…·æœ‰è³‡æ ¼çˆ­å¥ªCPU</strong></td></tr><tr><td>Running</td><td>Processå–å¾—CPU åŸ·è¡Œä¸­</td></tr><tr><td>Wait(Block)</td><td>è¡¨ç¤ºProcesså¾…åœ¨waiting Queueä¸­ï¼ŒWaiting For I/O-Completed or event occurs, <strong>ä¸æœƒèˆ‡å…¶ä»–Processes ç«¶çˆ­CPU</strong></td></tr><tr><td>Exit(Terminate)(Zombie)(Abort)</td><td>Processå®Œæˆå·¥ä½œï¼Œ<strong>æ­£å¸¸çµæŸ</strong>æˆ–<strong>ç•°å¸¸çµ‚æ­¢</strong>ï¼Œå¯èƒ½å…¶PCBå°šæœªå›æ”¶ï¼Œå› ç‚ºè¦ç­‰å…¶<strong>çˆ¶è¦ª(Parent Process)Collect è©²å­processä¹‹æˆæœå¾Œ</strong>ï¼Œæ‰æœƒå›æ”¶PCB Spaceå…¶ä»–è³‡æº(Memory, CPU, I/O-Devices)å·²å›æ”¶</td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>Transition</th><th>Description</th></tr></thead><tbody><tr><td>1.</td><td>ä¹Ÿå«Admitï¼Œç•¶Memory Spaceè¶³å¤ æ™‚ï¼Œå¯ç”±<strong>Long-term Scheduler(in Batch Systemï¼Œå› ç‚ºæ”¾åœ¨Job Queueè£¡é ­)ï¼Œæ±ºå®šå°‡æ­¤Jobè¼‰å…¥åˆ°Memoryä¸­</strong></td></tr><tr><td>2.</td><td>ä¹Ÿå«<strong>Dispatch</strong>,ç”±short-term scheduler(CPU Scheduler)æ±ºå®šï¼Œè®“é«˜å„ªå…ˆæ¬Šçš„Processå–å¾—CPUæ§åˆ¶æ¬Š</td></tr><tr><td>3.</td><td>ä¹Ÿå«<strong>Time-Out/Interrupt</strong>ï¼ŒåŸ·è¡Œä¸­çš„Processæœƒå› æŸäº›äº‹ä»¶ç™¼ç”Ÿè€Œ<strong>è¢«è¿«æ”¾æ£„(ä¸æ˜¯è‡ªé¡˜çš„)CPUï¼Œå›å»Ready Queue, eg. Time-Out, Interruptç™¼ç”Ÿ,æ›´é«˜å„ªå…ˆæ¬Šçš„Processåˆ°é”ï¼Œæ’éšŠ</strong></td></tr><tr><td>4.</td><td>å«wait for I/O-Completed or event occurs(è‡ªé¡˜æ”¾æ£„CPU)</td></tr><tr><td>5.</td><td>I/O-Completed æˆ– Event occurs</td></tr><tr><td>6.</td><td>Processå®Œå·¥æˆ–ç•°å¸¸çµ‚æ­¢ (è‡ªé¡˜æ”¾æ£„CPU)</td></tr></tbody></table></div><h3 id=7-steps-of-state-transition-diagramstalling>7 Steps of State Transition Diagram[Stalling]</h3><p><code>è£œä¸ŠMiddel Term Scheduler</code></p><p>ç‚ºäº†è§£æ±ºä¸€å€‹å•é¡Œ</p><p><code>ç•¶è¨˜æ†¶é«”è¢«å æ»¿äº†ï¼Œæœ‰ä¸€å€‹æ›´é«˜å„ªå…ˆæ¬Šçš„Processè¿‘ä¾†ï¼Œè©²å¦‚ä½•è™•ç†ï¼Ÿ</code></p><p>æŠŠwaitç‹€æ…‹çš„processè¸¢å‡ºå»ï¼Œæ”¾åˆ°ç£ç¢Ÿå»ä¿å­˜</p><p><img src=https://i.imgur.com/3fqSWLb.png loading=lazy alt=image-20221204120509402></p><div class=table-wrapper><table><thead><tr><th>State</th><th>Description</th></tr></thead><tbody><tr><td>Blocked/Suspend</td><td>Processè¢«Swap Outåˆ° Diskä¸­æš«å­˜ï¼Œå³Blocked(asleep) in Disk</td></tr><tr><td>Ready/Suspend</td><td>event occurs or I/O-Completed, <strong>READY IN DISK</strong></td></tr></tbody></table></div><div class=table-wrapper><table><thead><tr><th>Transition</th><th>Description</th></tr></thead><tbody><tr><td>Suspend(Swap Out)</td><td>ç•¶Memoryç©ºé–“ä¸è¶³ï¼Œåˆæœ‰å…¶ä»–é«˜å„ªå…ˆåº¦çš„Processéœ€æ›´å¤šMemoryç©ºé–“æ™‚ï¼Œæœƒç”±Medium-Term Scheduleræ±ºå®šå°‡Blocked Processæˆ–ä½å„ªå…ˆæ¬Šçš„Process Swap outåˆ°Diskï¼Œä»¥ç©ºå‡ºMemory Space</td></tr><tr><td>Activate(Swap In)</td><td>ç•¶Memory spaceæœ‰ç©ºï¼ŒMedium-term schedulerå¯å°‡å®ƒå€‘Swap Inå›memoryä¸­ï¼ŒReady for execution</td></tr><tr><td>Suspend(Swap Out)</td><td>æ”¯æŒæ­¤Transitionä¹‹ç†ç”±æœ‰äºŒ<br>1.æ‰€æœ‰Blocked Processesçš†Swap outå¾Œï¼ŒMemory Spaceä»ä¸è¶³æ™‚<br>2. æ‰€æœ‰Blocked State Processesä¹‹å„ªå…ˆæ¬Šï¼Œçš†é«˜æ–¼Ready State Processæ™‚</td></tr></tbody></table></div><p><img src=https://i.imgur.com/t6Albzn.png loading=lazy alt=image-20221204120421430></p><div class=table-wrapper><table><thead><tr><th>Transition</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td>æŠŠå¾åœ¨ç£ç¢Ÿç¡è¦ºçš„processæ‹‰åˆ°è¨˜æ†¶é«”è£¡é¢ç¡è¦ºï¼Œ<code>This is a poor designï¼Œä½†ä»å¯æ”¯æŒï¼Œç†ç”±å¦‚ä¸‹ï¼šè‹¥æ‰€æœ‰</code>Blocked/suspend` stateä¹‹Processeså„ªå…ˆæ¬Šçš†é«˜æ–¼ready/ suspend processes, ä¸”OS believes them will become ready soon |</td></tr><tr><td>2</td><td>It&rsquo;s also a poor design ä½†å¯æ”¯æŒä¹‹ç†ç”±å¦‚ä¸‹ï¼šè‹¥æœ‰ä¸€å€‹é«˜å„ªå…ˆæ¬Šçš„processå¾blocked/suspendè®Šæˆready/suspendæ™‚ï¼Œå‰‡OSå¯ä»¥å¼·è¿«ä½å„ªå…ˆæ¬Šä½†å·²åŸ·è¡Œçš„processæ”¾æ£„CPUçš„ä½¿ç”¨ä»¥åŠMemoryçš„ç©ºé–“ï¼Œä¾›é«˜å„ªå…ˆæ¬Šä½¿ç”¨</td></tr></tbody></table></div><h3 id=unix-stdstalling>UNIX STD[Stalling]</h3><p><img src=https://i.imgur.com/OWW8dof.png loading=lazy alt=image-20221204131334041></p><h2 id=scheduler-typeimportant>Scheduler Type(Important)</h2><blockquote><ol><li><p>Long-term Scheduler</p><ul><li>å®šç¾©ï¼šåˆå«Job Schedulerï¼Œç›®çš„æ˜¯å¾Job Queueä¸­æŒ‘é¸ä¸€äº›Jobsè¼‰å…¥åˆ°Memoryä¸­</li><li>ç‰¹è‰²ï¼š<ol><li>åŸ·è¡Œé »ç‡æœ€ä½ï¼Œæ‰€ä»¥æ‰å«é•·æœŸ</li><li>å¯ä»¥èª¿æ§Multiprogramming Degree</li><li>å¯ä»¥èª¿æ§ I/O-Bound Jobèˆ‡CPU-Bound Jobä¹‹æ··åˆæ¯”ä¾‹(ä¸‹é¢æœ‰è§£é‡‹)</li><li>Batch Systemæ¡ç”¨ï¼Œä½†æ˜¯real-time systemä»¥åŠtime-sharingä¸æœƒæ¡ç”¨é€™ç¨®æ©Ÿåˆ¶ã€‚å› ç‚ºreal-timeç³»çµ±è™•ç†çš„processéƒ½æ˜¯æ¯”è¼ƒç·Šæ€¥çš„ï¼Œå› æ­¤å°±éœ€è¦ç›´æ¥ä¸Ÿé€²memoryå»åŸ·è¡Œã€‚è€Œtime-sharingç³»çµ±è¦æ±‚å°æ¯ä¸€å€‹userå…¬å¹³ï¼Œæ²’æœ‰å„ªå…ˆåº¦éœ€è¦è™•ç†ï¼Œå¦‚æœmemoryä¸å¤ å‰‡èª¿ç”¨virtual memoryï¼Œå› æ­¤time-sharingç³»çµ±åªå­˜åœ¨medium-termä»¥åŠshort-term</li></ol></li></ul></li><li><p>Short-term Schedulerï¼š</p><ul><li>å®šç¾©ï¼šåˆå«<strong>CPU Schduler</strong>æˆ–<strong>Process Scheduler</strong>ï¼Œç›®çš„æ˜¯å¾<strong>Ready Queue</strong>ä¸­æŒ‘å‡ºä¸€å€‹é«˜å„ªå…ˆæ¬Šçš„processï¼Œåˆ†æ´¾CPUï¼Œçµ¦CPUåŸ·è¡Œ</li><li>ç‰¹è‰²ï¼š<ol><li>åŸ·è¡Œé€Ÿåº¦æ˜¯ä¸‰è€…è£¡é¢æœ€é«˜çš„</li><li><strong>ç„¡æ³•èª¿æ§Multiprogramming Degreeï¼Œå› ç‚ºå®ƒä¸æ˜¯è² è²¬å°‡ç¨‹å¼loadé€²memoryèˆ‡Swap outå‡ºå»çš„äºº</strong></li><li><strong>ç„¡æ³•èª¿æ§I/O-Bound Jobèˆ‡CPU-Bound Jobä¹‹æ··åˆæ¯”ä¾‹ï¼Œé ‚å¤šæ±ºå®šèª°è¦å…ˆåšï¼Œä¸èƒ½æ±ºå®šæ¯”ä¾‹</strong></li><li><strong>æ‰€æœ‰çš„ Systemæ¡ç”¨</strong></li></ol></li></ul></li><li><p>Medium-term Scheduler(æœ€å¸¸è¢«è€ƒ)ï¼š</p><ul><li><p>å®šç¾©ï¼š<strong>Time-Sharing Systemæ¡ç”¨</strong>ï¼Œç•¶<strong>Memoryç©ºé–“ä¸è¶³</strong>ï¼Œä¸”<strong>åˆæœ‰å…¶ä»–é«˜å„ªå…ˆæ¬ŠProcesseséœ€è¦Memory Spaceæ™‚</strong>ï¼Œæ­¤Scheduleræœƒå•Ÿå‹•ï¼Œå®ƒæœƒæŒ‘é¸ä¸€äº›Processes(eg. Blocked Process, ä½å„ªå…ˆProcess) å°‡å…¶Swap Outåˆ°Diskä¸­ï¼Œä¿å­˜ï¼Œä»¥ç©ºå‡ºMemory Spaceï¼Œä¾›å…¶ä»–Processä½¿ç”¨ï¼Œå°‡ä¾†ç­‰åˆ°æœ‰è¶³å¤ çš„Memory Space releasedå¾Œï¼Œæ­¤Schedulerå¯å†å°‡å®ƒå€‘Swap In å›Memory, ready for execution</p></li><li><p>ç‰¹è‰²ï¼š</p><ol><li><p>åŸ·è¡Œé€Ÿåº¦æ˜¯ä¸‰è€…è£¡é¢å±…ä¸­çš„</p></li><li><p><strong>å¯ä»¥èª¿æ§Multiprogramming Degreeï¼Œå› ç‚ºå®ƒä¸æ˜¯è² è²¬å°‡ç¨‹å¼loadé€²memoryèˆ‡Swap outå‡ºå»çš„äºº</strong></p></li><li><p><strong>å¯ä»¥æ³•èª¿æ§I/O-Bound Jobèˆ‡CPU-Bound Jobä¹‹æ··åˆæ¯”ä¾‹ï¼Œé ‚å¤šæ±ºå®šèª°è¦å…ˆåšï¼Œä¸èƒ½æ±ºå®šæ¯”ä¾‹</strong></p></li><li><p><strong>Time-Sharing Systemæ¡ç”¨</strong></p></li></ol></li></ul></li></ol></blockquote><p><code>Multiprogramming Degreeï¼šç³»çµ±å…§çš„Processçš„æ•¸ç›®ï¼šä¸€èˆ¬è€Œè¨€ï¼ŒDegreeè¶Šé«˜ï¼ŒCPUåˆ©ç”¨ç‡å°±è¶Šé«˜ã€‚</code></p><h3 id=io-bound-jobèˆ‡cpu-bound-job>I/O-Bound Jobèˆ‡CPU-Bound Job</h3><ol><li><p>I/O-Bound(å—é™) Job</p><p>å®šç¾©ï¼šæ­¤é¡å‹å·¥ä½œå¤§éƒ½æ˜¯éœ€è¦å¤§é‡çš„I/O operation(resource)ï¼Œä½†å°æ–¼CPU Time(Computation)éœ€æ±‚å¾ˆå°‘ï¼Œ<strong>å› ç‚ºå…¶å·¥ä½œæ•ˆèƒ½å—é™æ–¼I/O-Deviceä¹‹é€Ÿåº¦ï¼Œç¨±ä¹‹I/O-Bound</strong>ï¼Œå°CPUæœ‰æœ€é«˜å„ªå…ˆæ¬Šï¼Œå› ç‚ºå®ƒå ç”¨CPUçš„æ™‚é–“æœ€çŸ­</p><p>ä¾‹å¦‚ï¼šData Base Management, è²¡å ±çš„è™•ç†åˆ—å°</p></li><li><p>CPU-Bound(å—é™) Job</p><p>å®šç¾©ï¼šéœ€è¦å¤§é‡çš„CPUè¨ˆç®—ï¼Œç”¢ç”Ÿæ•¸ç­†è³‡æ–™ï¼Œå°I/Oæœ‰æœ€é«˜å„ªå…ˆæ¬Šï¼Œå› ç‚ºå®ƒå ç”¨CPUçš„æ™‚é–“æœ€çŸ­</p><p>ä¾‹å¦‚ï¼šæ°£è±¡é ä¼°ã€ç§‘å­¸æ¨¡æ“¬</p></li></ol><p><strong>å¦‚æœOSç™¼ç¾I/O-Boundéå¤šï¼Œå‰‡æœƒé€éSchdulerä¾†èª¿æ§å…©è€…ä¹‹é–“çš„æ¯”ä¾‹</strong></p><h2 id=context-switching>Context Switching</h2><ul><li><p>å®šç¾©ï¼šç•¶CPUè¦å¾Running Processåˆ‡çµ¦å¦ä¸€å€‹Processä½¿ç”¨ä¹‹å‰ï¼ŒKernelå¿…é ˆ**ä¿å­˜(Store) Running Processçš„ç›®å‰ç‹€æ…‹è³‡è¨Š(eg. Programming Counterçš„å€¼ï¼ŒStackçš„å€¼ï¼ŒCPU Registerçš„å€¼ï¼Œetc)ï¼Œå³å­˜å›æ­¤Processä¹‹PCB **ã€‚ä¸”è¦è¼‰å…¥(restore)å¦ä¸€å€‹Processä¹‹ç‹€æ…‹è³‡è¨Šfromæ­¤Process PCBï¼Œ<strong>é€™æ¨£çš„è¡Œç‚ºå°±å«åšContext Switching</strong>ï¼ŒContext Switchæœ¬èº«æ˜¯ä¸€å€‹é¡å¤–çš„è² æ“”ï¼Œå› ç‚ºéœ€è¦èŠ±CPUçš„æ™‚é–“å»åšåˆ‡æ›ï¼Œä¸èƒ½ç”¨åœ¨Processçš„åŸ·è¡Œä¸Šï¼Œå› æ­¤æ™‚é–“å¤§å¤šå–æ±ºæ–¼ç¡¬é«”çš„å› ç´ å±…å¤š(eg. Registerçš„æ•¸é‡å¤ ä¸å¤ ï¼ŒMemoryå­˜å–æŒ‡ä»¤é€Ÿåº¦</p></li><li><p>å¦‚ä½•å°‡ä½Context Switchingè² æ“”</p><ol><li>å¦‚æœRegisterçš„æ•¸é‡è¶³å¤ å¤šï¼Œå‰‡å¯ä»¥è®“æ¯ä¸€å€‹Processçš†æœ‰è‡ªå·±çš„(Private) Register Setï¼ŒOSåªè¦åˆ‡æ›PointæŒ‡å‘å¦ä¸€å€‹processä¹‹Register Set å³å¯å®ŒæˆContext Swtitching without memory store/restore ï¼Œå› ç‚ºé€Ÿåº¦å¤ å¿«ã€‚ä½†é€™å€‹æ–¹æ³•ä¸å¤ªåˆ‡å¯¦éš›ï¼Œå› ç‚ºRegisterçš„æˆæœ¬é—œä¿‚</li><li>ä½¿ç”¨<strong>Multithreading</strong>æ©Ÿåˆ¶ã€‚</li><li>è®“System processåŠUser Processå„è‡ªæ“æœ‰è‡ªå·±çš„Register setï¼Œå¦‚æ­¤å…©è€…ä¹‹åˆ‡æ›åªè¦Registers Setçš„Pointerå³å¯</li></ol></li></ul><h2 id=dispatcher-and-dispatch-latency>Dispatcher And Dispatch Latency</h2><p><code>åˆ†æ´¾å™¨èˆ‡åˆ†æ´¾å»¶é²</code></p><ul><li><p>å®šç¾©ï¼šDispatcherï¼Œæ­¤ä¸€æ¨¡çµ„çš„ç›®çš„æ˜¯è¦å°‡CPUæ§åˆ¶æ¬Šæˆäºˆç¶“ç”±CPU Schedulerä¾æ“šCPUæ’ç­æ³•å‰‡æ‰€é¸å‡ºä¹‹Processï¼Œé¸å¥½å¾ŒCPU Scheduleræœƒå°‡å·¥ä½œäº¤çµ¦CPU Dispatcherï¼Œä¸»è¦çš„å·¥ä½œé …æœ‰ä¸‹åˆ—ä¸‰é …</p><ol><li>Context Switching</li><li>Change Mode from to Kernel mode to User Mode</li><li>Jump to the execution entry of that selected proces</li></ol><p>ä¸Šè¿°é€™ä¸‰å€‹å·¥ä½œæ‰€è€—è²»çš„æ™‚é–“ç¸½å’Œå°±æ˜¯<strong>Dispatch Latency</strong></p></li><li><p>å¸Œæœ›<strong>Dispatch Latencyè¶ŠçŸ­è¶Šå¥½</strong>ï¼Œé€™äº›Processå¯ä»¥ç›¡æ—©é–‹å·¥</p></li></ul><h2 id=process-control-operations>Process Control Operationsâ˜†â˜†â˜†â˜†â˜†</h2><h3 id=lession-1-theory>Lession 1 Theory</h3><ul><li><p>å®šç¾©ï¼šProcesså»ºç«‹ã€çµ‚æ­¢ã€æš«åœã€æ¢å¾©åŸ·è¡Œã€è¨­å®šï¼ä¿®æ”¹ï¼è®€å– Process Attributeså€¼ etc.</p><p><strong>ä¸Šè¿°é€™äº›çš†æ˜¯OSæ‡‰è©²æä¾›çš„æœå‹™(i.e System Call)</strong></p></li><li><p>Procssæ˜¯å¯ä»¥å»ºç«‹è‡ªå·±çš„Process(Child Process)ï¼Œ<strong>ç›®çš„æ˜¯è¦Child Processåšå·¥ä½œ</strong></p></li><li><p>Child Processæ‰€åšçš„å·¥ä½œï¼Œå¯ä»¥åˆ†ç‚º2é¡ï¼š</p><ol><li><strong>èˆ‡Parent ç›¸åŒçš„å·¥ä½œ(å­æ‰¿çˆ¶æ¥­)</strong></li><li>ç‰¹å®šå·¥ä½œ(èˆ‡Parentä¸åŒ)</li></ol></li><li><p>Parentèˆ‡Childä¹‹é–“çš„äº’å‹•é—œä¿‚ç‚ºï¼š</p><blockquote><ol><li>Concurrent execution(äº¤éŒ¯ä½¿ç”¨ï¼Œé€šå¸¸æ˜¯åŸ·è¡Œç¬¬ä¸€é¡çš„å·¥ä½œ(å­æ‰¿çˆ¶æ¥­))</li><li>Parent waits for Child until child terminated(ç­‰è‘—æ”¶å‰²Childçš„æˆæœ)</li></ol></blockquote></li><li><p>Child Process æ‰€é ˆçš„è³‡æºç”±ä½•è™•å–å¾—?</p><blockquote><ol><li><strong>OSä¾›æ‡‰</strong>(é€™ç¨®æƒ…æ³OSæœƒå»é™åˆ¶æ¯å€‹processæœ€å¤§å¯ç”¢ç”Ÿå¤šå°‘å€‹Child Process)</li><li>Parentä¾›æ‡‰(æ•´å€‹å®¶æ—Processçš„è³‡æºéƒ½æ˜¯å…±äº«ï¼ŒParent Processçš„Sharing Timeæœ‰ä¸€å°æ™‚ï¼Œé‚£éº¼æ•´å€‹å®¶æ—çš„Sharing Time å°±æ˜¯ä¸€å€‹å°æ™‚</li></ol></blockquote></li><li><p>Parent è‹¥çµ‚æ­¢ï¼Œå‰‡Child Processæœƒå¦‚ä½•è™•ç†?</p><blockquote><ol><li><p><strong>ä¸€ä½µçµ‚æ­¢(æœ€å¸¸è¢«ä½¿ç”¨)</strong> ï¼šç¨±ä¹‹ç‚ºCascading(å±¤ç–Šçš„) termination</p></li><li><p>Parent Processæ­»äº†ï¼Œä½†Child Processå­˜æ´»ï¼Œé‚£Childçš„è³‡æºç”±ä»¥ä¸‹å…©è€…æä¾›</p><blockquote><ul><li><p>å‘OSå–å¾—è³‡æº</p></li><li><p>å‘ç¥–å…ˆProcesså–å¾—è³‡æº</p></li></ul></blockquote></li></ol></blockquote></li></ul><h3 id=lession-2-example---unix-system-call>Lession 2 Example - UNIX System Call</h3><ul><li>fork()ï¼šæ­¤System call. ç”¨ä»¥å»ºç«‹ Child Processï¼Œè€Œfork()ä¹‹å‚³å›çµæœï¼Œå°è±¡å¦‚ä¸‹</li></ul><blockquote><p>å¤±æ•—ï¼šå› ç‚ºè³‡æºä¸è¶³<code>(è¨˜æ†¶é«”ä¸å¤ ï¼ŒPCBä¹Ÿä¸å¤ )</code>ï¼Œç„¡æ³•å»ºç«‹ï¼Œ<strong>æœƒå‚³å›è² å€¼(-1)çµ¦OS, then Pass to parent process</strong>ï¼Œé€šå¸¸å¤±æ•—çš„è©±ï¼ŒOSä¹Ÿæœƒé †ä¾¿æŠŠParent processç æ­»</p><p>æˆåŠŸï¼šOSæœƒå‚³å›ä¸€å€‹å€¼ï¼Œç”¨ä»¥å€åˆ†child or parentï¼š</p><blockquote><p>0å€¼ï¼šçµ¦child process</p><p>.> 0å€¼ï¼šçµ¦Parentï¼Œä¸”æ­¤å€¼ç‚ºChild Process ID</p></blockquote></blockquote><p><img src=https://i.imgur.com/Hkeq0GX.png loading=lazy alt=image-20221205225943369></p><ul><li><p>wait()ï¼šæ­¤System Callç”¨ä»¥<strong>æš«åœ</strong>Process execute, ç›´åˆ°æŸå€‹äº‹ä»¶ç™¼ç”Ÿï¼Œeg. çˆ¶ç­‰å­ç›´åˆ°å­çµ‚æ­¢ ã€‚</p></li><li><p>exit()ï¼šæ­¤System Callç”¨ä»¥çµ‚æ­¢Processçš„åŸ·è¡Œï¼Œå›æ”¶å…¶è³‡æº<code>ä½†PCBçš„ç©ºé–“å¯èƒ½é‚„ç•™è‘—ï¼Œç›´åˆ°çˆ¶æŠŠå­çš„çµæœå›æ”¶å›ä¾†æ‰å›æ”¶</code>é€šå¸¸exit(0)è¡¨ç¤ºæ­£å¸¸çµ‚æ­¢ï¼Œ<strong>exit(-1)è¡¨ç¤ºç•°å¸¸çµ‚æ­¢</strong>ã€‚<strong>å­Processåšå®Œå·¥ä½œå¾Œï¼Œå­Processè¦è‡ªå·±ç™¼å‡ºä¸€å€‹exitçš„System Callï¼Œè®“OSä¾†æ®ºæ‰å­Processã€‚</strong></p></li><li><p>execlp()<code>æˆ–exec(), execve()</code>ï¼šæ­¤system callç”¨æ–¼è«‹OSè¼‰å…¥ç‰¹å®šçš„binary code(å¯åŸ·è¡Œçš„æª”æ¡ˆ)ï¼Œä¾†åŸ·è¡Œã€‚é€™å€‹System callå¯ä»¥äº¤ç”±å­processåŸ·è¡Œï¼Œè®“å­processåŸ·è¡Œç‰¹å®šçš„å·¥ä½œï¼Œ<strong>å»åŸ·è¡Œä¹‹å¾Œå°±ä¸æœƒå†å›ä¾†åŸ·è¡ŒåŸç¨‹å¼ä¸‹é¢çš„æŒ‡ä»¤äº†ï¼Œå› ç‚ºå·²ç¶“å»åŸ·è¡Œç‰¹å®šçš„å·¥ä½œäº†</strong></p><p>eg. execlp(&ldquo;ç›®éŒ„åç¨±&rdquo;,&ldquo;æª”å&rdquo;,åƒæ•¸)</p></li><li><p>getpid()ï¼šæ­¤System Callç”¨ä»¥å–å¾—Prcessçš„Id</p></li></ul><p>â€‹ èªªæ˜ï¼š</p><p><img src=https://i.imgur.com/73BPWL6.png loading=lazy alt=image-20221205232325242></p><p>â€‹ OSæœƒé…ç½®child process memory space, æ­¤ç©ºé–“æ˜¯å ç”¨ä¸åŒçš„è¨˜æ†¶é«”ç©ºé–“ï¼Œä¸”å­processçš„Data section åŠ code sectionå…§å®¹å‡ä¾†è‡ªçˆ¶processçš„copy, initiallyã€‚</p><p>â€‹ <strong>è‹¥å­processæ‰€ä½œä¹‹å·¥ä½œèˆ‡çˆ¶processç›¸åŒï¼Œå‰‡fork()å®Œï¼Œå°±å·²ç¶“é”æˆç›®çš„ã€‚</strong></p><p>â€‹ <strong>è‹¥å­processè¦åšç‰¹å®šå·¥ä½œ(èˆ‡çˆ¶processä¸åŒ)ï¼Œå‰‡å­processå¿…é ˆåŸ·è¡Œexeclp()é€™å€‹system call</strong></p><p>â€‹ <img src=https://i.imgur.com/FVrCZfE.png loading=lazy alt=image-20221205233942669></p><h3 id=lession3-programming>Lession3 Programming</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=c1>//ä¾‹é¡Œ1ï¼›å»ºç«‹Child processåŸ·è¡Œlså‘½ä»¤æª”ï¼Œä¸”çˆ¶ç­‰å­å®Œæˆå¾Œæ‰åˆ—å°Child completed
</span><span class=c1></span>
    <span class=kt>void</span> <span class=nf>main</span><span class=p>(){</span>
    <span class=kt>int</span> <span class=n>pid</span> <span class=p>;</span>
    <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;fork fails </span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
        <span class=n>exit</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span> <span class=c1>//çˆ¸çˆ¸è‡ªå·±è‡ªæ®º
</span><span class=c1></span>    <span class=p>}</span><span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=c1>//å…’å­è¦åšçš„äº‹æƒ…
</span><span class=c1></span>        <span class=n>execlp</span><span class=p>(</span><span class=s>&#34;/bin/ls&#34;</span><span class=p>,</span><span class=s>&#34;ls&#34;</span><span class=p>,</span><span class=n>null</span><span class=p>);</span>
        <span class=n>exit</span><span class=p>();</span> <span class=c1>//é€™æ®µcodeä¸æœƒåŸ·è¡Œï¼ŒåŸå› æ˜¯å› ç‚ºexeclp()æœƒæŠŠprocessæŒ‡å‘/bin/lsçš„binary codeï¼Œæ¥è‘—å°±æ˜¯å»åŸ·è¡Œé‚£æ®µbinary codeäº†ï¼Œå°±ä¸æœƒå›ä¾†åŸ·è¡Œé€™å€‹exit();
</span><span class=c1></span>    <span class=p>}</span><span class=k>else</span> <span class=c1>//pid &gt;0{
</span><span class=c1></span>        <span class=c1>//çˆ¸çˆ¸è¦åšçš„äº‹æƒ…
</span><span class=c1></span>        <span class=n>wait</span><span class=p>();</span> <span class=c1>//çˆ¶Processå­Processç›´åˆ°å­Processçµ‚æ­¢ å­Processåšå®Œå·¥ä½œå¾Œï¼Œå­Processè¦è‡ªå·±ç™¼å‡ºä¸€å€‹exitçš„System Callï¼Œè®“OSä¾†æ®ºæ‰å­Processã€‚
</span><span class=c1></span>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;child Completed&#34;</span><span class=p>);</span>
        <span class=n>exit</span><span class=p>();</span>
    <span class=p>};</span>
	<span class=p>{</span>
        <span class=c1>//ä¸ç®¡æ€æ¨£éƒ½æœƒåŸ·è¡Œçš„åœ°æ–¹
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>	
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/lNzxZM0.png loading=lazy alt=image-20221206002505232></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=c1>//ä¾‹é¡Œ2 å‡è¨­Parent, child ä¹‹process IDç‚º2600, 2603 æ±‚line A, B, C, D å°å‡ºå€¼
</span><span class=c1></span><span class=kt>void</span> <span class=nf>main</span><span class=p>(){</span>
    <span class=n>pid</span><span class=o>-</span><span class=n>t</span> <span class=n>pid</span><span class=p>,</span> <span class=n>pid1</span><span class=p>;</span> <span class=c1>//pid-t: ä¸€å€‹åç‚ºpid çš„typeï¼Œå°±æ˜¯æ•´æ•¸ï¼Œæ˜¯Cèªè¨€çš„å¯«æ³•
</span><span class=c1></span>    <span class=n>pid</span><span class=o>-</span><span class=n>fork</span><span class=p>();</span> <span class=c1>//pid æ”¾çš„æ˜¯å­processçš„IDï¼Œ pid1æ”¾çš„æ˜¯è‡ªå·±processçš„ID
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>pid1</span><span class=o>=</span><span class=n>getpid</span><span class=p>();</span>
        <span class=n>printf</span><span class=p>(</span><span class=n>pid</span><span class=p>);</span> <span class=c1>//A 0
</span><span class=c1></span>        <span class=n>printf</span><span class=p>(</span><span class=n>pid1</span><span class=p>);</span> <span class=c1>//B 2603
</span><span class=c1></span>    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>pid</span> <span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>pid1</span><span class=o>=</span><span class=n>getpid</span><span class=p>();</span> 
        <span class=n>printf</span><span class=p>(</span><span class=n>pid</span><span class=p>);</span> <span class=c1>//C 2603
</span><span class=c1></span>        <span class=n>printf</span><span class=p>(</span><span class=n>pid1</span><span class=p>);</span> <span class=c1>//D 2600
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/3vEaYqb.png loading=lazy alt=image-20221212233944674></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C data-lang=C><span class=c1>//ä¾‹é¡Œ3  å•Açš„å€¼valueæ˜¯å¤šå°‘ 
</span><span class=c1></span>
<span class=kt>int</span> <span class=n>value</span> <span class=o>=</span><span class=mi>5</span><span class=p>;</span>
<span class=kt>void</span> <span class=nf>main</span><span class=p>(){</span>
    <span class=n>pid</span><span class=o>-</span><span class=n>t</span> <span class=n>pid</span><span class=p>;</span>
    <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>pid</span> <span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>value</span> <span class=o>+=</span><span class=mi>15</span><span class=p>;</span>
        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>pid</span> <span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>wait</span><span class=p>(</span><span class=n>null</span><span class=p>);</span>
        <span class=n>print</span><span class=p>(</span><span class=n>value</span><span class=p>);</span>  <span class=c1>//A=5 å°±ç®—æ˜¯globalçš„è®Šæ•¸ï¼Œä¹Ÿæ˜¯åªèƒ½åœ¨è‡ªå·±çš„processä½œç”¨
</span><span class=c1></span>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=c1>//ä¾‹é¡Œ4 æ±‚åˆ—å°çµæœ
</span><span class=c1></span><span class=p>(</span><span class=mf>1.</span><span class=p>)</span>
<span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=kt>int</span> <span class=n>pid</span><span class=p>;</span>
    <span class=n>pid</span> <span class=o>=</span><span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;A</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
    <span class=p>}</span><span class=k>else</span> <span class=c1>//pid &gt;0{
</span><span class=c1></span>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;B</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=nl>Ans</span><span class=p>:</span> <span class=err>çˆ¶èˆ‡å­æ˜¯ä¸¦è¡Œçš„ï¼Œå› ç‚ºçˆ¶</span><span class=n>processæ²’æœ‰wait</span><span class=p>(),</span> <span class=err>å› æ­¤ç­”æ¡ˆå¯èƒ½æ˜¯</span><span class=n>ABæˆ–BA</span>
<span class=p>(</span><span class=mf>2.</span><span class=p>)</span>
<span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=kt>int</span> <span class=n>pid</span><span class=p>;</span>
    <span class=n>pid</span> <span class=o>=</span><span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;A</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
    <span class=p>}</span><span class=k>else</span> <span class=c1>//pid &gt;0{
</span><span class=c1></span>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;B</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
	    <span class=n>wait</span><span class=p>();</span>
    <span class=p>}</span>
	<span class=n>printf</span><span class=p>(</span><span class=s>&#34;C</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
<span class=p>}</span>
<span class=nl>Ans</span><span class=p>:</span> <span class=n>ACBC</span><span class=p>,</span><span class=n>ABCC</span><span class=p>,</span><span class=n>BACC</span><span class=p>,</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=c1>//ä¾‹é¡Œ5 å‡è¨­Countï¼Œæ˜¯ä¸€å€‹çˆ¶èˆ‡å­Processçš„å…±äº«è®Šæ•¸ ï¼Œåˆå€¼ç‚º5
</span><span class=c1></span><span class=p>(</span><span class=mf>1.</span><span class=p>)</span>
<span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=kt>int</span> <span class=n>pid</span><span class=p>;</span>
    <span class=n>pid</span><span class=o>=</span><span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>count</span><span class=o>++</span><span class=p>;</span>
        <span class=n>printf</span><span class=p>(</span><span class=n>count</span><span class=p>);</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>wait</span><span class=p>();</span>
        <span class=n>count</span><span class=o>--</span><span class=p>;</span>
        <span class=n>printf</span><span class=p>(</span><span class=n>count</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=n>Ans</span><span class=mf>.6</span><span class=p>,</span><span class=mi>5</span>
    <span class=p>(</span><span class=mf>2.</span><span class=p>)</span> <span class=c1>//çˆ¶èˆ‡å­ä¸¦è¡Œ
</span><span class=c1></span><span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=kt>int</span> <span class=n>pid</span><span class=p>;</span>
    <span class=n>pid</span><span class=o>=</span><span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>count</span><span class=o>++</span><span class=p>;</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>pid</span> <span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>count</span><span class=o>--</span><span class=p>;</span>
    <span class=p>}</span>
     <span class=n>printf</span><span class=p>(</span><span class=n>count</span><span class=p>);</span>
<span class=p>}</span>
<span class=n>Ans</span><span class=p>.</span> <span class=mi>45</span><span class=p>,</span><span class=mi>54</span><span class=p>,</span><span class=mi>55</span> <span class=c1>//é€™æ˜¯åŸºæœ¬æƒ…æ³
</span><span class=c1></span>    
    <span class=c1>//ä»¥é«˜éšç¨‹å¼èªè¨€çš„è§’åº¦ä¾†çœ‹ï¼Œcount++å¯¦éš›ä¸Šæ˜¯å…©æ¢code
</span><span class=c1></span>    <span class=c1>//count+1è·Ÿcount=count+1
</span><span class=c1></span>    <span class=c1>//å…ˆåŠ ç„¶å¾Œå†é™„å€¼
</span><span class=c1></span>    <span class=c1>//å¦‚æœä»¥çµ„åˆèªè¨€çš„è§’åº¦ä¾†çœ‹ï¼Œå°±æ˜¯ä¸‰è¡Œcode
</span><span class=c1></span>    <span class=c1>//LOAD R1, Count
</span><span class=c1></span>    <span class=c1>//INC R1, 1;
</span><span class=c1></span>    <span class=c1>//STORE Count,R1
</span><span class=c1></span>    <span class=c1>//ä½†Processæ²’æœ‰è¾¦æ³•ä¿è­‰é€™ä¸‰æ¢Codeæœƒé€£çºŒåšå®Œï¼Œæœ‰å¯èƒ½åšåˆ°ä¸€åŠå°±è¢«å¦ä¸€å€‹Processæ¶èµ°äº†
</span><span class=c1></span>    <span class=c1>//æ‰€ä»¥é‚„æœ‰ä¸€ç¨®æƒ…æ³æ˜¯+1å®Œä¹‹å¾Œï¼Œé‚„ä¾†ä¸åŠAssignï¼ŒCPUå°±è¢«å¦ä¸€å€‹Processæ¶èµ°äº†
</span><span class=c1></span>
    <span class=n>Ans</span><span class=mf>.66</span><span class=p>,</span><span class=mi>44</span><span class=p>,</span><span class=mi>46</span><span class=p>,</span><span class=mi>64</span>
    
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/PScmSWQ.png loading=lazy alt=image-20221213223929951></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-C data-lang=C><span class=c1>//ä¾‹é¡Œ6
</span><span class=c1></span><span class=p>(</span><span class=mf>1.</span><span class=p>)</span> <span class=n>How</span> <span class=n>mant</span> <span class=n>processes</span> <span class=n>are</span> <span class=n>created</span><span class=o>?</span> <span class=p>(</span><span class=n>include</span> <span class=n>main</span><span class=p>())</span>
    
    <span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=n>fork</span><span class=p>();</span>
    <span class=n>fork</span><span class=p>();</span>
    <span class=n>fork</span><span class=p>();</span>
<span class=p>}</span>
<span class=n>Ans</span><span class=mf>.8</span>
<span class=p>(</span><span class=mf>2.</span><span class=p>)</span>
    <span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span> <span class=c1>//ç­‰åŒæ–¼ pid=fork(); if(pid ==0) ....
</span><span class=c1></span>        <span class=n>fork</span><span class=p>();</span>
        <span class=n>fork</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=n>fork</span><span class=p>();</span>
<span class=p>}</span>
<span class=n>Ans</span><span class=mf>.10</span>
<span class=p>(</span><span class=mf>3.</span><span class=p>)</span>
    <span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=n>fork</span><span class=p>();</span>
    <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span><span class=o>&gt;</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>fork</span><span class=p>();</span>
    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span> <span class=o>==</span><span class=mi>0</span><span class=p>){</span>
        <span class=n>fork</span><span class=p>();</span>
        <span class=n>fork</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=n>Ans</span><span class=mf>.14</span>
<span class=p>(</span><span class=mf>4.</span><span class=p>)</span>
    <span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>3</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
        <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
            <span class=n>fork</span><span class=p>();</span>
            <span class=n>fork</span><span class=p>();</span>
            <span class=n>fork</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=n>Ans</span><span class=mf>.729</span>
<span class=p>(</span><span class=mf>5.</span><span class=p>)</span>
    <span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mi>3</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
        <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
            <span class=n>fork</span><span class=p>();</span>
        <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>){</span>
            <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
                <span class=n>fork</span><span class=p>();</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=p>(</span><span class=mf>6.</span><span class=p>)</span> 
	<span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
        <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span><span class=mi>2</span><span class=p>;</span>
        <span class=n>fork</span><span class=p>();</span>
        <span class=n>a</span><span class=o>--</span><span class=p>;</span>
        <span class=n>printf</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
        <span class=k>if</span><span class=p>(</span><span class=n>fork</span><span class=p>()</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span>
            <span class=n>a</span><span class=o>--</span><span class=p>;</span>
            <span class=n>printf</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
            <span class=n>fork</span><span class=p>();</span>
        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
            <span class=n>a</span><span class=o>++</span><span class=p>;</span>
            <span class=n>fork</span><span class=p>();</span>
            <span class=n>printf</span><span class=p>(</span><span class=n>a</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>(</span><span class=n>i</span><span class=p>.)</span> <span class=n>printf</span><span class=p>(</span><span class=n>a</span><span class=p>)</span><span class=err>å…±åšäº†å¹¾æ¬¡</span><span class=o>?</span>
<span class=p>(</span><span class=n>ii</span><span class=p>.)</span><span class=err>å°å‡º</span><span class=mi>0</span><span class=err>çš„æœ‰å¹¾æ¬¡</span><span class=o>?</span>
<span class=p>(</span><span class=n>iii</span><span class=p>)</span><span class=err>å°å‡º</span><span class=mi>1</span><span class=err>çš„æœ‰å¹¾æ¬¡</span><span class=o>?</span>
<span class=p>(</span><span class=n>iiii</span><span class=p>.)</span><span class=err>å°å‡º</span><span class=mi>2</span><span class=err>çš„æœ‰å¹¾æ¬¡</span><span class=o>?</span>
</code></pre></td></tr></table></div></div><p>ä¾‹é¡Œ1</p><p><img src=https://i.imgur.com/P7KPC3a.png loading=lazy alt=image-20221213224958887></p><p>ä¾‹é¡Œ2</p><p><img src=https://i.imgur.com/sxHVION.png loading=lazy alt=image-20221213230321504></p><p>ä¾‹é¡Œ3</p><p><img src=https://i.imgur.com/928uNym.png loading=lazy alt=image-20221213231138167></p><p>ä¾‹é¡Œ4</p><p>parse1<img src=https://i.imgur.com/B8YeFxw.jpg loading=lazy alt=image-20221213233229409></p><p>parse2</p><p><img src=https://i.imgur.com/z5Udxxt.jpg loading=lazy alt=image-20221213233442414></p><p>parse3</p><p><img src=https://i.imgur.com/jBQDnnR.png loading=lazy alt=image-20221213233645680></p><p>ä¾‹é¡Œ5</p><p>parse1</p><p><img src=https://i.imgur.com/QNOoXgC.png loading=lazy alt=image-20221213235008337></p><p>parse2,3</p><p><img src=https://i.imgur.com/VLdy9Wu.png loading=lazy alt=image-20221213235124681></p><p>ä¾‹é¡Œ6</p><p><img src=https://i.imgur.com/vNkpGIt.jpg loading=lazy alt=image-20221214001735125></p><h2 id=evalue-cpu-scheduling-performance-5-criteria>Evalue CPU Scheduling Performance 5 criteria</h2><blockquote><ol><li><p>CPU utilizationï¼šcpuèŠ±åœ¨Process exec time / CPU <strong>total time(process exec time + context switching time+ idle time)</strong></p><ul><li>èˆ‰ä¾‹ï¼šProcesså¹³å‡èŠ±5msåœ¨execä¸Š ,context switching = 1ms,å‰‡CPU utilization = 5/5+1 =5/6</li></ul></li><li><p>Throughput(ç”¢èƒ½)ï¼šå–®ä½æ™‚é–“å…§å®Œæˆçš„Jobæ•¸ç›®</p></li><li><p><strong>Waiting Time(ç­‰å¾…æ™‚é–“ï¼Œè€ƒè©¦é‡é»)</strong>ï¼šprocessèŠ±åœ¨ready queueä¸­ç­‰å¾…ç²å¾—CPUä¹‹ç­‰å¾…æ™‚é–“åŠ ç¸½</p><p><img src=https://i.imgur.com/owdeLYf.png loading=lazy alt=image-20221214224920098></p></li><li><p>Turnaround Time(å®Œæˆæ™‚é–“)ï¼šå¾Processé€²å…¥(åˆ°é”)åˆ°å®ƒå·¥ä½œå®Œæˆçš„é€™æ®µæ™‚é–“å·®å€¼</p><p><img src=https://i.imgur.com/1F9T30z.png loading=lazy alt=image-20221214225625777></p></li><li><p>Response Time(å›æ‡‰æ™‚é–“)ï¼šè‡ªuser(user process) input å‘½ä»¤/Data çµ¦ç³»çµ±åˆ°ç³»çµ±ç”¢ç”Ÿ<strong>ç¬¬ä¸€å€‹å›æ‡‰</strong>çš„æ™‚é–“å·®ï¼Œæ²’æœ‰ä¸€å€‹ç‰¹å®šçš„é‡æ³•å»é‡å®ƒï¼Œç¨±ä¹‹Time-sharing system, user-mteractive, <strong>applicationç‰¹åˆ¥é‡è¦–é€™ä¸€å¡Š</strong></p></li></ol></blockquote><p>ç”±ä¸Šè¿°å¾—çŸ¥ï¼Œæ’ç­çš„ç›®æ¨™å¿…æ˜¯ï¼Œ**åˆ©ç”¨åº¦è¶Šé«˜ã€ç”¢èƒ½è¶Šé«˜ï¼Œæ™‚é–“ç›¸é—œçš„æ±è¥¿è¶ŠçŸ­è¶Šå¥½ **</p><h2 id=cpuæ’ç­æ³•å‰‡è¡Œç‚ºä»‹ç´¹>CPUæ’ç­æ³•å‰‡è¡Œç‚ºä»‹ç´¹</h2><blockquote><ol><li>FIFO</li><li>SJF</li><li>SRTF</li><li>Priority</li><li>RR</li><li>Multilevel Queues</li><li>Multilevel Feedback Queues (MFQs)</li></ol></blockquote><h3 id=fifoæ³•å‰‡>FIFOæ³•å‰‡</h3><ul><li><p>å®šç¾©ï¼šåˆ°é”æ™‚é–“æœ€å°çš„processï¼Œå„ªå…ˆå–å¾—CPU</p></li><li><p>ä¾‹å¦‚ï¼š</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>CPU(burst) Time è¦èŠ±çš„CPU time</th></tr></thead><tbody><tr><td>P1</td><td>24</td></tr><tr><td>P2</td><td>3</td></tr><tr><td>P3</td><td>3</td></tr></tbody></table></div><p>åˆ°é”æ™‚é–“çš†ç‚º0(å¾ä¸€é–‹å§‹å°±åˆ°äº†)</p><p>åˆ°é”é †åºç‚ºï¼šP1, P2, P3(æ“ºåˆ°ready queueçš„é †åº)</p><p>Question</p><ol><li>ç•«å‡ºGantt Chart</li><li>æ±‚Avg. waiting time</li><li>æ±‚Avg. Turnaround Time</li></ol><p><img src=https://i.imgur.com/5S4T8z9.png loading=lazy alt=image-20221214235730530></p></li><li><p>åˆ†æ</p><ol><li><p>æ’ç­æ•ˆèƒ½æœ€å·®ï¼Œå³<strong>Waiting time & Turnaround time æœ€é•·</strong></p></li><li><p>å¯èƒ½æœƒæœ‰**Convoy Effect(è­·è¡›æ•ˆæ‡‰ï¼šè¨±å¤šProcesses å‡åœ¨ç­‰å¾…ä¸€å€‹éœ€è¦å¾ˆé•·CPU timeä¹‹process å®Œæˆå·¥ä½œï¼Œæ‰èƒ½å–å¾—CPUï¼Œé€ æˆAvg waiting time å¾ˆé•·ä¹‹ä¸è‰¯æ•ˆæ‡‰) **</p></li><li><p>å…¬å¹³</p></li><li><p>No Starvation</p><ul><li>(æ²’æœ‰<strong>é£¢é¤“ç¾è±¡ï¼šProcesså› ç‚ºé•·æœŸç„¡æ³•å–å¾—å®Œå·¥æ‰€éœ€å„å¼è³‡æºï¼Œå°è‡´å®ƒé²é²ç„¡æ³•å®Œå·¥ï¼Œå½¢æˆIndefinite Blocking ç¾è±¡ï¼Œç¨±ä¹‹Starvationï¼Œå®¹æ˜“ç™¼ç”Ÿåœ¨ä¸å…¬å¹³å°å¾…ä¹‹ç’°å¢ƒï¼Œè‹¥å†åŠ ä¸ŠPreemptiveæ©Ÿåˆ¶ï¼Œå‰‡æ›´æ˜¯å®¹æ˜“ç™¼ç”Ÿï¼Œè£œå„Ÿæ–¹æ¡ˆï¼š&ldquo;Aging(è€åŒ–)&ldquo;æŠ€è¡“ï¼Œéš¨è‘—Processå¾…åœ¨Systemå…§çš„æ™‚é–“é€æ¼¸å¢åŠ ï¼Œæˆ‘å€‘ä¹Ÿé€æ­¥æé«˜æ­¤processçš„å„ªå…ˆæ¬Šï¼Œæ•…å¯å–å¾—Process Resourceså®Œå·¥ï¼Œå› ç‚ºä¸æœƒStarvation</strong>ã€‚æ³¨æ„ï¼šSoft real-time Systemä¸æ¡ç”¨Agingï¼Œå› ç‚ºSoft real-time systemæ˜¯ç‚ºäº†ç¢ºä¿real-time processå–å¾—æœ€é«˜å„ªå…ˆæ¬Šï¼Œå¦‚æœåŠ å…¥Agingæ©Ÿåˆ¶ï¼Œå°±æœ‰å¯èƒ½æœ‰processçš„priorityé«˜æ–¼real time process)</li></ul></li><li><p>Non-preemptive(ä¸å¯æ’éšŠï¼›ä¸å¯æ¶å¥ª)æ³•å‰‡</p><ul><li><p>ç‰ˆæœ¬1(ç™½è©±æ–‡)</p><ol><li><p>Non-preemptiveæ³•å‰‡</p><ul><li>å®šç¾©ï¼šé™¤éåŸ·è¡Œä¸­çš„process<strong>è‡ªé¡˜æ”¾æ‰CPU</strong>ï¼Œå…¶ä»–Processæ‰æœƒæœ‰æ©Ÿæœƒå–å¾—CPUï¼Œå¦å‰‡å°±åªèƒ½waitï¼Œä¸å¯é€•è‡ªæ¶å¥ªCPU</li><li>ä¾‹å¦‚ï¼šå®Œæˆå·¥ä½œã€Wait for I/O-completed after issue I/O-request</li><li>å„ªé»ï¼š<ol><li>Context Switchingçš„æ¬¡æ•¸æ¯”è¼ƒå°‘ï¼Œå› ç‚ºä¸å¯æ’éšŠï¼Œæ‰€ä»¥Switchingçš„é »ç‡å°å¾ˆå¤š</li><li>processä¹‹å®Œå·¥æ™‚é–“é»è¼ƒå¯é æœŸ(Predictable)ï¼Œå› ç‚ºä¸å¯æ’éšŠ</li><li>æ¯”è¼ƒä¸æœƒæœ‰Race Condition Problem</li></ol></li><li>ç¼ºé»ï¼š<ol><li>æ’ç­çš„æ•ˆèƒ½è¼ƒå·®ï¼Œå› ç‚ºå¯èƒ½æœ‰Convoy effect</li><li>ä¸é©åˆç”¨åœ¨Time-sharing System, Real time Systemï¼Œå› ç‚ºé€™å…©å€‹éƒ½éœ€è¦æ’éšŠçš„æ©Ÿåˆ¶</li></ol></li></ul></li><li><p>Preemptiveæ³•å‰‡</p><ul><li>å®šç¾©ï¼šåŸ·è¡Œä¸­çš„Processæœ‰å¯èƒ½<strong>è¢«è¿«æ”¾æ£„CPU</strong>ï¼Œå›åˆ°ready Queueï¼Œå°‡CPUåˆ‡çµ¦åˆ¥äººä½¿ç”¨ï¼Œeg. Time-out, interrupt etc</li><li>å„ªé»ï¼š<ol><li>æ’ç­æ•ˆç›Šè¼ƒä½³ï¼Œå¹³å‡waiting/ turnound Timeè¼ƒå°ï¼Œå¯ä»¥æŠŠè€—æ™‚è¼ƒé•·çš„Process Preemptiveæ‰</li><li>é©ç”¨æ–¼Real-time sysem(è¦èƒ½å¤ æŠŠreal time çš„processæ’å…¥é€²å») åŠTime-Sharing System</li></ol></li><li>ç¼ºé»ï¼š<ol><li>å®Œå·¥æ™‚é–“è¼ƒä¸å¯é æœŸ</li><li>Context Switchingæ¬¡æ•¸å¤šï¼Œè² æ“”è¼ƒé‡</li><li>é ˆæ³¨æ„Race Conditionä¹‹ç™¼ç”Ÿ</li></ol></li></ul></li></ol></li><li><p>ç‰ˆæœ¬2ï¼šå¾CPUæ’ç­æ±ºç­–(å•Ÿå‹•)ä¹‹æ™‚æ©Ÿé»ä¾†åšå€åˆ†(å¯ä»¥åƒè€ƒ State Transitionï¼Œä»¥ä¸‹æ˜¯äº”ç¨®æƒ…æ³åšè§£èªª)</p><blockquote><ol><li>Running &mdash;> Block eg: wait for I/O completed [è‡ªé¡˜æ”¾æ£„]</li><li>Running &mdash;> Ready eg: time-out [è¢«è¿«æ”¾æ£„]</li><li>Wait &mdash;> Ready eg: I/O-completed [å°Šçˆµä¸å‡¡çš„processé†’ä¾†äº†ï¼Œæ‰€ä»¥è¦å•Ÿå‹•CPU schedulingï¼Œç²å¾—CPUï¼Œä½å„ªå…ˆæ¬Šçš„processè¢«è¿«æ”¾æ£„CPU]</li><li>Running &mdash;> Exit eg:å®Œæˆå·¥ä½œ [è‡ªé¡˜æ”¾æ£„]</li></ol></blockquote><p>æ‰€ä»¥è‹¥æ’ç­æ±ºç­–ä¹‹å•Ÿå‹•é»åªåŒ…å«1,4ï¼ŒæœªåŒ…å«2,4ï¼Œå‰‡ç‚ºNon-preemptive,å¦å‰‡preemptã€‚</p><p>Noteï¼šå‡¡æ˜¯ xxx &mdash;> ready çš†åˆ—å…¥preemptiveå…ƒç´ (é¸é …)ï¼Œæ‰€ä»¥</p><p>ready/suspend &mdash;> ready</p><p>New &mdash;> Ready</p><p>çš†åˆ—å…¥preemptive</p></li></ul></li></ol></li></ul><h3 id=sjfshortest-job-firstæ³•å‰‡>SJF(Shortest Job First)æ³•å‰‡</h3><ul><li><p>å®šç¾©ï¼šå…·æœ‰æœ€å°çš„CPU TIMEä¹‹Processï¼Œå„ªå…ˆå–å¾—CPUï¼Œè‹¥éƒ½ä¸€æ¨£å°ï¼Œå‰‡æ¡FIFOã€‚</p></li><li><p>ä¾‹å¦‚ï¼š</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>CPU Time</th></tr></thead><tbody><tr><td>P1</td><td>6</td></tr><tr><td>P2</td><td>8</td></tr><tr><td>P3</td><td>7</td></tr><tr><td>P4</td><td>3</td></tr></tbody></table></div><p>Processåˆ°é”æ™‚é–“çš†ç‚º0ï¼Œæ±‚Avg waiting time</p><p><img src=https://i.imgur.com/VKxulnL.png loading=lazy alt=image-20221217132504544></p></li><li><p>åˆ†æï¼š</p><ol><li><p><strong>æ’ç­æ•ˆç›Šæœ€ä½³(optimal)ï¼Œå³Avg waiting/ turnaround timeæœ€å°</strong></p><ul><li><p>èªªæ˜ï¼šWhy optimal?</p><p><img src=https://i.imgur.com/tZPVenF.png loading=lazy alt=image-20221217133256469></p><p>å› ç‚ºShort Jobæ‰€æ¸›å°‘çš„ç­‰å¾…æ™‚é–“å¿…å®š>= Long-Jobæ‰€å¢åŠ çš„ç­‰å¾…æ™‚é–“ï¼Œå› ç‚ºå¹³å‡ç­‰å¾…æ™‚é–“æœƒæœ€å°</p></li></ul></li><li><p><strong>ä¸å…¬å¹³ï¼Œåå¥½short Job</strong></p></li><li><p><strong>å¯èƒ½æœƒStarvation(for long Job)</strong></p></li><li><p>å¯ä»¥åˆ†æˆ</p><blockquote><p>Non-preemptive &mdash;> SJFåšä»£è¡¨</p><p>Preemptive &mdash;> å¦å¤–<strong>å«åšSRTFæ³•å‰‡</strong></p></blockquote></li><li><p>è¼ƒä¸é©åˆç”¨åœ¨Short-term scheduler(æ¯”è¼ƒä¸æ°ç•¶å•¦ï¼Œä½†ä½ è¦ç”¨ä¹Ÿæ˜¯å¯ï¼Œå› ç‚ºShort-term scheduleråŸ·è¡Œé »ç‡å¤ªé«˜ï¼Œæ‰€ä»¥å¾ˆé›£åœ¨æ¥µçŸ­çš„æ™‚é–“é–“éš”å…§å»é ä¼°å‡ºç²¾ç¢ºçš„CPU Burst time for each process ä¸”æ’å‡ºæœ€å°å€¼ï¼Œä¸æ˜“çœŸæ­£å‘ˆç¾å‡ºSJFä¹‹è¡Œç‚ºï¼Œåå€’æ˜¯<strong>é©åˆç”¨long-term scheduler</strong></p><p><code>Short time scheduleræ˜¯æŒ‡å°ˆé–€è² è²¬è™•ç†çŸ­æš«çš„å·¥ä½œçš„è¨ˆåŠƒç¨‹åºã€‚é€™äº›å·¥ä½œé€šå¸¸æœƒåœ¨çŸ­çŸ­çš„æ™‚é–“å…§å®Œæˆï¼Œä¸¦ä¸”æœ‰è¨±å¤šå·¥ä½œè¦æ±‚åŒæ™‚é€²è¡Œã€‚åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œä½¿ç”¨short job firstï¼ˆSJFï¼‰æ³•å‰‡ä¾†è™•ç†å·¥ä½œå¯èƒ½ä¸æ˜¯æœ€ä½³é¸æ“‡ã€‚é€™æ˜¯å› ç‚ºSJFæ³•å‰‡æ˜¯åŸºæ–¼å·¥ä½œé è¨ˆå®Œæˆæ™‚é–“çš„ï¼Œä¸¦å‡è¨­å·¥ä½œçš„é è¨ˆå®Œæˆæ™‚é–“æ˜¯å¯ä»¥é å…ˆçŸ¥é“çš„ã€‚ä½†æ˜¯ï¼Œåœ¨short time schedulerä¸­ï¼Œå¤§å¤šæ•¸å·¥ä½œçš„é è¨ˆå®Œæˆæ™‚é–“éƒ½æ˜¯æœªçŸ¥çš„ï¼Œå› æ­¤ç„¡æ³•æº–ç¢ºåœ°æ‡‰ç”¨SJFæ³•å‰‡ã€‚å¦ä¸€å€‹åŸå› æ˜¯ï¼ŒSJFæ³•å‰‡æœƒå°‡çŸ­å·¥ä½œæ”¾åœ¨å„ªå…ˆåŸ·è¡Œçš„ä½ç½®ï¼Œå› æ­¤æœƒæŠŠè¨±å¤šçŸ­å·¥ä½œæ’åœ¨ä¸€èµ·ã€‚åœ¨short time schedulerä¸­ï¼Œé€™å¯èƒ½æœƒå°è‡´è¨±å¤šçŸ­å·¥ä½œä¹‹é–“çš„ç«¶çˆ­ï¼Œå¾è€Œå°è‡´æ•ˆç‡é™ä½ã€‚ç¸½çš„ä¾†èªªï¼Œshort time scheduleræ›´é©åˆä½¿ç”¨å…¶ä»–è¨ˆåŠƒç­–ç•¥ï¼Œä¾‹å¦‚åŸºæ–¼å…ˆé€²å…ˆå‡ºï¼ˆFIFOï¼‰æˆ–åŸºæ–¼æœ€çŸ­å‰©é¤˜æ™‚é–“ï¼ˆSRTï¼‰çš„ç­–ç•¥ï¼Œä¾†è™•ç†çŸ­æš«çš„å·¥ä½œã€‚)</code></p><blockquote><p>å¦‚ä½•è©•ä¼°processä¹‹the next cpu burst time?</p><ol><li><p><strong>å…¬å¼(åŠ æ¬ŠæŒ‡æ•¸å¹³å‡å…¬å¼)</strong></p><p><img src=https://i.imgur.com/oysceoz.png loading=lazy alt=image-20221217153209006></p><div class=table-wrapper><table><thead><tr><th></th><th>t0</th><th>t1</th><th>t2</th><th>t3</th><th></th></tr></thead><tbody><tr><td>å¯¦éš›å€¼</td><td>20</td><td>10</td><td>40</td><td>20</td><td></td></tr><tr><td>é ä¼°å€¼</td><td><strong>20</strong>(ä¸€é–‹å§‹é‚„æ²’é ä¼°ï¼Œæ‰€ä»¥éƒ½æ˜¯æŠ“t0çš„å€¼)</td><td></td><td></td><td></td><td>?</td></tr><tr><td></td><td>T0</td><td>T1</td><td>T2</td><td>T3</td><td>T4</td></tr></tbody></table></div><p><img src=https://i.imgur.com/8wvBUc8.png loading=lazy alt=image-20221217154217150></p></li><li><p>æ„ç¾©:ã€€</p><p><img src=https://i.imgur.com/Gx7aClO.png loading=lazy alt=image-20221217160852665></p></li></ol></blockquote></li></ol></li></ul><h3 id=srtfsrjfsrtn-shortest-remaining-time-job-firstnext>SRTF,SRJF,SRTN( Shortest Remaining-Time Job First(Next))</h3><ul><li><p>å®šç¾©ï¼š<strong>å³ç‚ºPreemptive-SJFæ³•å‰‡</strong>ï¼Œå³å‰©é¤˜CPU Burst Time(CPUå®Œæˆä¸€æ¬¡çŸ­æ™‚é–“å·¥ä½œæ‰€éœ€çš„æ™‚é–“)æœ€å°çš„ Processï¼Œå–å¾—CPUã€‚ä¹Ÿå°±æ˜¯è‹¥æ–°åˆ°é”çš„Processå…¶CPU Burst TIme å°æ–¼ç›®å‰åŸ·è¡Œä¸­processå‰©ä¸‹çš„CPU time, å‰‡æ–°åˆ°é”ä¹‹Processå¯ä»¥**æ’éšŠ(preemption)**åŸ·è¡Œã€‚</p></li><li><p>èˆ‰ä¾‹ï¼š</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>åˆ°é”æ™‚é–“</th><th>CPU Time</th></tr></thead><tbody><tr><td>P1</td><td>0</td><td>8</td></tr><tr><td>P2</td><td>1</td><td>4</td></tr><tr><td>P3</td><td>2</td><td>9</td></tr><tr><td>P4</td><td>3</td><td>5</td></tr></tbody></table></div><p>æ±‚Avg waiting Time for</p><ol><li><p>SRTF</p><p><img src=https://i.imgur.com/enr3uhw.png loading=lazy alt=image-20221217234802588></p></li><li><p>SJF(ä¸å¯æ’éšŠ)</p><p><img src=https://i.imgur.com/mMRP8xo.png loading=lazy alt=image-20221217235757038></p></li><li><p>FIFO</p><p><img src=https://i.imgur.com/rVUHVGE.png loading=lazy alt=image-20221217235808248></p></li></ol></li><li><p>åˆ†æï¼š</p><ol><li>èˆ‡SJFç›¸æ¯”ï¼ŒSRTFä¹‹å¹³å‡waiting/Turnaround timeæœƒæ¯”è¼ƒå°(SRTFæ˜¯SJFçš„ä¸€å€‹å­é¡ï¼Œå› ç‚ºSRTF<strong>å¯æ’éšŠ</strong>ï¼Œæ‰€ä»¥æœƒæœ‰æœ€å°çš„waiting time, ä½†æ˜¯ä»˜å‡ºè¼ƒå¤§çš„Context Switchingçš„overhead(è² æ“”)</li><li>ä¸å…¬å¹³ï¼Œåå¥½Short remaining-time Job</li><li>æœƒæœ‰Starvationçš„å•é¡Œ</li><li>Preemptiveæ³•å‰‡</li></ol></li></ul><h3 id=priorityæ³•å‰‡>Priorityæ³•å‰‡</h3><ul><li><p>å®šç¾©ï¼š<strong>å¯åƒæ•¸åŒ–çš„æ³•å‰‡</strong>ï¼Œå…·æœ‰Highest Priorityä¹‹Processï¼Œå„ªå…ˆå–å¾—CPUï¼Œè‹¥å¤šå€‹Processæ¬Šå€¼ç›¸åŒï¼Œå‰‡ä»¥<strong>FIFO</strong>ç‚ºæº–ï¼Œä¹Ÿæœ‰åˆ†æˆNon-preemptive, Preemptiveçš„å·®ç•°ã€‚</p></li><li><p>èˆ‰ä¾‹ï¼šä¸å¯æ’éšŠ</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>CPU time</th><th>Priority No.</th></tr></thead><tbody><tr><td>P1</td><td>10</td><td>3</td></tr><tr><td>P2</td><td>1</td><td>1</td></tr><tr><td>P3</td><td>2</td><td>3</td></tr><tr><td>P4</td><td>1</td><td>4</td></tr><tr><td>P5</td><td>5</td><td>2</td></tr></tbody></table></div><p><strong>ä¸”ï¼ŒPriority Noè¶Šå°ï¼Œå„ªå…ˆæ¬Šè¶Šå¤§The Smaller Priority No. Implies the higher priorityã€‚æ±‚Avg waiting Time</strong></p></li><li><p>åˆ†æï¼š</p><ol><li><p>æ˜¯ä¸€å€‹å…·åƒæ•¸åŒ–çš„æ³•å‰‡ï¼Œå³çµ¦äºˆä¸åŒçš„priorityé«˜ä½å®šç¾©ï¼Œå¯å±•ç¾å‡ºä¸åŒçš„æ’ç­è¡Œç‚ºã€‚</p><div class=table-wrapper><table><thead><tr><th>Priorityå®šç¾©</th><th>è¡Œç‚º</th></tr></thead><tbody><tr><td>æŠµé”æ™‚é–“è¶Šæ—©ï¼Œå„ªå…ˆæ¬Šæ›´é«˜</td><td>FIFO</td></tr><tr><td>CPUã€€Timeè¶Šå°ï¼Œå„ªå…ˆæ¬Šè¶Šé«˜</td><td>SJF</td></tr><tr><td>å‰©é¤˜æ™‚é–“è¶Šå°ï¼Œå„ªå…ˆæ¬Šè¶Šé«˜</td><td>SRTF</td></tr></tbody></table></div><p>å› æ­¤FIFO, SJF, SRTFéƒ½æ˜¯å±¬æ–¼Priorityçš„ä¸€ç¨®</p></li><li><p>ä¸å…¬å¹³</p></li><li><p>æœƒæœ‰Starvation (å¯ç”¨Agingå»è§£æ±º)</p></li><li><p>åˆ†ç‚ºNon-preemptive, preemptiveå…©ç¨®</p></li></ol></li></ul><h3 id=rrround-robinæ³•å‰‡è€ƒè©¦é‡é»>RR(Round Robin)æ³•å‰‡(è€ƒè©¦é‡é»)</h3><ul><li><p>å®šç¾©ï¼š<strong>Time-Sharing Systemæ¡ç”¨</strong>ï¼ŒOSæœƒè¦å®šä¸€å€‹CPU time Quantun(or Slice)ï¼Œç•¶Processå–å¾—CPUåŸ·è¡Œå¾Œï¼Œè‹¥æœªèƒ½åœ¨æ­¤Quantumå…§å®Œæˆå·¥ä½œï¼Œå‰‡Timeræœƒç™¼å‡º"Time-out&rdquo; interrupté€šçŸ¥OSï¼ŒOSæœƒ<strong>å¼·è¿«</strong>æ­¤processæ”¾æ‰CPUï¼Œä¸”å›åˆ°ready queueä¸­ï¼Œç­‰å¾…ä¸‹ä¸€è¼ªå†å–å¾—CPUåŸ·è¡Œï¼Œæ¯ä¸€è¼ªä¹‹ä¸­ï¼Œprocessæ˜¯ä»¥FIFOæ’éšŠæ–¹å¼å–å¾—CPU</p></li><li><p>èˆ‰ä¾‹1ï¼š</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Cpu time</th></tr></thead><tbody><tr><td>P1</td><td>8</td></tr><tr><td>P2</td><td>4</td></tr><tr><td>P3</td><td>9</td></tr><tr><td>P4</td><td>5</td></tr></tbody></table></div><p>åˆ°é”æ™‚é–“çš†ç‚º0ï¼Œé †åºæ˜¯P1~P4, ä½¿ç”¨RR(Quantum=4), æ±‚Avg waiting time</p><p><img src=https://i.imgur.com/RLPckKA.png loading=lazy alt=image-20221218124859568></p><p>èˆ‰ä¾‹2:</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Arrival Time</th><th>Cpu Time</th></tr></thead><tbody><tr><td>P1</td><td>0</td><td>10</td></tr><tr><td>P2</td><td>2</td><td>5</td></tr><tr><td>P3</td><td>7</td><td>3</td></tr><tr><td>P4</td><td>13</td><td>8</td></tr></tbody></table></div><p><img src=https://i.imgur.com/enClm5v.png loading=lazy alt=image-20221218130748491></p></li></ul><p>èˆ‰ä¾‹3:</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Arrival time</th><th>è¡Œç‚º</th></tr></thead><tbody><tr><td>P1</td><td>0</td><td>5CPU+6I/O+4CPU</td></tr><tr><td>P2</td><td>3</td><td>15CPU</td></tr><tr><td>P3</td><td>8</td><td>3CPU+10I/O+9CPU</td></tr><tr><td>P4</td><td>14</td><td>8CPU</td></tr></tbody></table></div><p>Quantum= 5ï¼Œå•turnaound time ? waiting time ?</p><p><img src=https://i.imgur.com/l8iAsbF.png loading=lazy alt=image-20221218200907489></p><ul><li>æ³¨æ„ï¼šæœ‰äº›é¡Œç›®æ˜¯<strong>æœ‰çˆ­è­°çš„</strong></li></ul><p>â€‹ eg.</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>åˆ°é”</th><th>CPU time</th></tr></thead><tbody><tr><td>P1</td><td>0</td><td>6</td></tr><tr><td>P2</td><td>4</td><td>9</td></tr><tr><td>P3</td><td>8</td><td>6</td></tr></tbody></table></div><p>â€‹ æ¡RR(Q=4)</p><p>â€‹ <img src=https://i.imgur.com/n0mJ6DI.png loading=lazy alt=image-20221218201710742></p><ul><li><p>åˆ†æï¼š</p><ol><li>Time-sharing System æ¡ç”¨</li><li>ä¹Ÿæ˜¯ä¸€å€‹å¯åƒæ•¸åŒ–çš„æ³•å‰‡(ie. Quantum)</li><li>å…¬å¹³</li><li>No starvation</li><li>preemptiveæ³•å‰‡(Real-Time, Time-Sharingé©ç”¨ï¼ŒRRè¶…éQuantum timeå¾Œæœƒ<strong>è¢«è¿«</strong>å›åˆ°ready</li></ol></li><li><p>èˆ‰ä¾‹2</p><p>Quantum=âˆ</p><p>å‰‡RRæœƒè®Šæˆ<strong>FIFO</strong>æ³•å‰‡&mdash;> æ’ç­æ•ˆèƒ½å¾ˆå·®</p><p>æ³¨æ„ï¼šä¹Ÿå› æ­¤ï¼ŒFIFOå±¬æ–¼RRçš„ä¸€ç¨®</p></li><li><p>èˆ‰ä¾‹3</p><p>Quantum =æ¥µå°å€¼</p><p>å‰‡Context Switchingå¤ªé »ç¹ï¼ŒCPU Utilizationæœƒå¾ˆä½</p><p>ä¾ç¶“é©—æ³•å‰‡ï¼Œè‹¥Quantumå€¼èƒ½è®“**80%**çš„Jobåœ¨Quantumå…§å®Œæˆï¼Œæ•ˆèƒ½è¼ƒä½³ã€‚</p></li><li><p>è£œå……ï¼šRRé›–ç„¶æ˜¯å…¬å¹³çš„ï¼Œä½†ä¹Ÿå¯æ”¯æŒå·®ç•°åŒ–(å„ªå…ˆæ¬Šå·®ç•°)ä¹‹å¯¦ç¾ï¼ŒHow do you achieve this?</p><p>Ans.</p><ol><li>é‡å°é«˜å„ªå…ˆæ¬ŠProcessåœ¨ready Queueä¸­<strong>ç½®å…¥å¤šå€‹PCB pointer æŒ‡å‘æ­¤Process</strong>ï¼Œä½¿å¾—æ¯ä¸€è¼ªç•¶ä¸­ï¼Œå®ƒæœ‰å¤šæ¬¡å–å¾—CPUä¹‹æ©Ÿæœƒ</li><li>é‡å°<strong>é«˜å„ªå…ˆæ¬ŠProcessçµ¦äºˆè¼ƒå¤§çš„Time Quantum</strong></li></ol></li></ul><h3 id=multilevel-queueså¤šå±¤ä½‡åˆ—æ³•å‰‡>MultiLevel Queues(å¤šå±¤ä½‡åˆ—)æ³•å‰‡</h3><ul><li><p>å®šç¾©ï¼š</p><ol><li>å°‡åŸæœ¬å–®ä¸€ä¸€æ¢ready queueè®Šæˆå¤šæ¢ready queuesä¸”é«˜ã€ä½å„ªå…ˆæ¬Šä¸åŒ</li><li>Queuesä¹‹é–“çš„æ’ç­æ³•å‰‡ï¼Œé€šå¸¸æ¡å–<strong>Preemptive and Priority</strong>æ³•å‰‡</li><li>æ¯å€‹Queue å¯ä»¥æœ‰è‡ªå·±çš„æ’ç­æ³•å‰‡ eg. RR</li><li>Processä¸€æ—¦è¢«ç½®å…¥æ–¼æŸå€‹Queueä¸­ï¼Œ<strong>å°±ä¸å¯(ä¸å…è¨±)åœ¨ä¸åŒready queuesä¹‹é–“ç§»å‹•</strong></li></ol></li><li><p>èˆ‰ä¾‹ï¼šI/O-Boundèˆ‡CPU-Bound Jobä½ æœƒç½®æ–¼å“ªå€‹Queueä¸­?</p><p>Ansï¼š<strong>I/O-Bound Job &mdash;>Q1</strong></p></li></ul><p>â€‹ ã€€ã€€ã€€<strong>CPU-Bound Job &mdash;>Q3</strong></p><ul><li><p>åˆ†æï¼š</p><ol><li><p><strong>å¯åƒæ•¸åŒ–çš„é …ç›®çœ¾å¤š</strong><code>1. Queueçš„æ•¸ç›® 2. Queueä¹‹é–“çš„æ’ç­æ³•å‰‡ 3. æ¯å€‹Queueè‡ªå·±çš„æ’ç­æ³•å‰‡ 4. Processè¢«æ”¾å…¥å“ªå€‹Queueä¹‹Criteria </code>ï¼Œæœ‰åŠ©æ–¼æ’ç­è¨­è¨ˆåŠæ•ˆèƒ½èª¿æ ¡ä¹‹Flexibility</p></li><li><p><strong>ä¸å…¬å¹³</strong></p></li><li><p>æœ‰<strong>Starvation(è¢«æ”¾åœ¨Q3 çš„Processæ°¸ä¸–ä¸å¾—ç¿»èº«ï¼Œå› ç‚ºProcessä¸€æ—¦è¢«ç½®å…¥æ–¼æŸå€‹Queueä¸­ï¼Œå°±ä¸å¯(ä¸å…è¨±)åœ¨ä¸åŒready queuesä¹‹é–“ç§»å‹•â˜†â˜†â˜†â˜†â˜†</strong></p></li><li><p><strong>Preemptive</strong></p></li></ol></li></ul><h3 id=multilevel-feedback-queuesmfqså¤šå±¤å›é¥‹ä½‡åˆ—>MultiLevel Feedback Queues(MFQs)(å¤šå±¤å›é¥‹ä½‡åˆ—)</h3><ul><li>å®šç¾©ï¼šèˆ‡MultiLevel Queueç›¸ä¼¼ï¼Œ<strong>å·®åˆ¥ï¼šå…è¨±Process åœ¨ä¸åŒQueues ä¹‹é–“ç§»å‹•ï¼Œå¯æ¡å–é¡ä¼¼AgingæŠ€è¡“</strong>ï¼Œç”šè‡³å¯ä»¥æ­é…é™ç´šçš„åšæ³•ï¼Œä¾†<strong>é¿å…Starvation</strong></li><li>åˆ†æï¼š<ol><li><strong>å¯åƒæ•¸åŒ–çš„é …ç›®çœ¾å¤š</strong><code>1. Queueçš„æ•¸ç›® 2. Queueä¹‹é–“çš„æ’ç­æ³•å‰‡ 3. æ¯å€‹Queueè‡ªå·±çš„æ’ç­æ³•å‰‡ 4. Processè¢«æ”¾å…¥å“ªå€‹Queueä¹‹Criteria 5.Processåœ¨ä¸åŒä½‡åˆ—ä¹‹é–“ç§»å‹•çš„è¦å‰‡</code>ï¼Œæœ‰åŠ©æ–¼æ’ç­è¨­è¨ˆåŠæ•ˆèƒ½èª¿æ ¡ä¹‹Flexibility</li><li><strong>ä¸å…¬å¹³</strong></li><li>ä¸æœƒæœ‰<strong>Starvation(è¢«æ”¾åœ¨Q3 çš„Processæ°¸ä¸–ä¸å¾—ç¿»èº«ï¼Œå› ç‚ºProcessä¸€æ—¦è¢«ç½®å…¥æ–¼æŸå€‹Queueä¸­ï¼Œå°±ä¸å¯(ä¸å…è¨±)åœ¨ä¸åŒready queuesä¹‹é–“ç§»å‹•â˜†â˜†â˜†â˜†â˜†</strong></li><li><strong>Preemptive</strong></li></ol></li></ul><h3 id=å°çµ>å°çµ</h3><ol><li><p>å“ªäº›æ˜¯Non-preemptiveæ³•å‰‡</p><p>Ans. FIFO,SJF,SRTF, Non-preemptive priority</p></li><li><p>å“ªäº›æ˜¯No Starvation</p><p>Ans. FIFO, RR, MFQs</p></li><li><p>å“ªäº›åŒ…å«æ–¼(âˆŠ)é—œä¿‚æ˜¯éŒ¯çš„</p></li></ol><p>â€‹ A. FIFO âˆŠ Priority</p><p>â€‹ B. SJF âˆŠ Priority</p><p>â€‹ C. FIFO âˆŠ RR</p><p>â€‹ D. SJF âˆŠ RR</p><p>â€‹ E. RR âˆŠ MFQs <code>æ˜¯å–”ï¼ŒMFQsçš„åƒæ•¸å¯ä»¥è¨­å®šæˆä¸€æ¢Queue</code></p><p>â€‹ Ans. (D)</p><h3 id=è£œå……-cpu-utilizationè¨ˆç®—>è£œå…… CPU Utilizationè¨ˆç®—</h3><p>ä¾‹1.</p><p>å‡è¨­æ¡RRæ’ç­</p><p>Time Quantumå€¼= <strong>Q</strong></p><p>Context Switch Time = S</p><p>Process å¹³å‡åŸ·è¡Œæ¯éš”<strong>T</strong>æ™‚é–“æœƒç™¼å‡ºI/O-request, æ±‚ä¸‹åˆ—Caseä¹‹CPU Utilization<code>(cpuèŠ±åœ¨Process exec time / CPU **total time(process exec time + context switching time+ idle time)** )</code></p><ol><li><p>0 &lt; S &lt; T &#171;Q</p><p><img src=https://i.imgur.com/mGdVm6a.png loading=lazy alt=image-20221219205831174></p></li><li><p>0&lt;S&lt;Q&#171;T</p></li></ol><p>â€‹ <img src=https://i.imgur.com/QyGgbtd.png loading=lazy alt=image-20221219210325226></p><ol start=3><li><p>0&lt;S=Q &#171;T</p><p><img src=https://i.imgur.com/9ZIQrps.png loading=lazy alt=image-20221219211653789></p></li><li><p>Qéå¸¸å°</p><p><img src=https://i.imgur.com/vmguH7P.png loading=lazy alt=image-20221219211707198></p></li></ol><p>ä¾‹2. [æ] (çœ‹ä¸æ‡‚)</p><p>10å€‹I/O-Bound Tasks(å¾ˆèŠ±I/O)</p><p>1 å€‹CPU-Bound Tasks(å¾ˆèŠ±CPU)</p><p>I/O-Bound taskåŸ·è¡Œæ¯éš”1ms ç™¼å‡º I/O-requestï¼Œæ¯å€‹I/O-é‹ä½œèŠ±10ms</p><p>Context Switching Time = 0.1 ms, æ±‚CPU utilization, æ¡<strong>RR</strong>æ³•å‰‡</p><ol><li><p>Quantum = 1ms</p><p><img src=https://i.imgur.com/DW7jDRF.png loading=lazy alt=image-20221219215757814></p></li><li><p>Quantum = 10ms</p><p><img src=https://i.imgur.com/qr7YiH4.png loading=lazy alt=image-20221219220609086></p></li></ol><p>â€‹ å¯«å®Œä¹‹å¾Œæœƒç™¼ç¾æœ‰å€‹infoæ²’æœ‰ç”¨åˆ°ã€Œæ¯å€‹I/O-é‹ä½œèŠ±10ms ã€ï¼Œå› ç‚ºæœ‰CPU-Boundçš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸å­˜åœ¨idle Timeï¼Œå¦‚æœä¸å­˜åœ¨CPU-Boundï¼Œå‰‡å¯èƒ½å­˜åœ¨idleçš„æƒ…å½¢ï¼Œå°±éœ€è¦è€ƒæ…®é€™ç¨®æƒ…å½¢</p><h2 id=ç‰¹æ®Šç³»çµ±ä¹‹æ’ç­è¨­è¨ˆè€ƒé‡>ç‰¹æ®Šç³»çµ±ä¹‹æ’ç­è¨­è¨ˆè€ƒé‡</h2><h3 id=multiprocessors-system-1>Multiprocessors System</h3><ol><li><p>Multiprocessorsåˆ†ç‚º</p><ol><li><p>ASMP(éå°ç¨±çš„ï¼ŒMaster-slaveæ¶æ§‹) &mdash;> æ²’æœ‰ä»€éº¼ç‰¹æ®Šè¨­è¨ˆï¼Œå˜»å˜»ï¼Œå› ç‚ºåªæœ‰Masteré€™å€‹CPUå»çœ‹ready queueä»¥åŠjobçš„assignï¼Œæ‰€ä»¥å…¶å¯¦æ²’å•¥ç‰¹æ®Šè¨­è¨ˆ</p></li><li><p>SMP(å°ç¨±å¼) &mdash;></p><ol><li><p>æ¯å€‹CPU<strong>å…±äº«</strong>åŒä¸€æ¢Ready Queueï¼Œç•¶CPUå®ŒæˆæŸProcesså¾Œï¼Œå°±å»å­˜å–ready Queueï¼Œå–èµ°ä¸€å€‹ProcessåŸ·è¡Œã€‚<strong>è¨­è¨ˆé‡é»ï¼šå¿…é ˆæä¾›ready queueçš„äº’æ–¥å­˜å–æ©Ÿåˆ¶ï¼Œè‹¥æœªæä¾›ï¼Œå‰‡å¯èƒ½ç™¼ç”ŸProcessé‡è¤‡åŸ·è¡Œæˆ–Processè¢«ignored(ç„¡äººåŸ·è¡Œ)ä¹‹éŒ¯èª¤</strong>ã€‚</p><p><img src=https://i.imgur.com/DSHiQrv.png loading=lazy alt=image-20221220225037817></p><p>ä¾‹å¦‚ï¼šCPUå»å–å¾—Processä¹‹å·¥ä½œå¦‚ä¸‹</p><ol><li>å–å¾—(read) Ready Queue, Frond Endçš„processä¹‹PCB Pointer</li><li>åˆªé™¤æ­¤Process Pointer from Queue</li></ol><div class=table-wrapper><table><thead><tr><th>CPU1</th><th>CPU2</th></tr></thead><tbody><tr><td>T1: step1: å–å¾—P1 PCB pointer</td><td>T2:step1å–å¾—P1 PCB pointer</td></tr><tr><td>T3: DequeueåŸ·è¡Œ</td><td>T4: DequeueåŸ·è¡Œ</td></tr></tbody></table></div><p>è¨­è¨ˆé‡é»ï¼š</p><ol><li>å¿…é ˆæä¾›ready Queueçš„äº’æ–¥å­˜å–æ©Ÿåˆ¶</li><li>ä¸é ˆè€ƒé‡Load Balancing</li></ol></li><li><p>æ¯å€‹CPUæœ‰<strong>è‡ªå·±</strong>çš„Ready Queue</p><p>æ¯å€‹CPUåªæœƒæª¢æŸ¥è‡ªå·±çš„ready Queue, æœ‰å·¥ä½œå°±åŸ·è¡Œï¼Œç„¡å·¥ä½œå°±idle</p><p>è¨­è¨ˆé‡é»ï¼š</p><ol><li>ä¸é ˆæœ‰äº’æ–¥å­˜å–çš„è€ƒé‡ï¼Œä¸€æ—¦ç™¼ç”Ÿidleï¼Œå‰‡æŠŠå…¶ä»–CPUçš„queueèª¿æ•´éä¾†</li><li>éœ€è€ƒé‡Load Balancingï¼Œé¿å…æœ‰CPUæ²’äº‹ï¼Œæœ‰CPUå¾ˆå¿™ã€‚é€šå¸¸ä½¿ç”¨å…©ç¨®æ©Ÿåˆ¶ä¾†èª¿æ•´CPU Loading<ol><li>Push migration(ç§»è½‰)</li><li>Pull migration(ç§»è½‰)</li></ol></li></ol></li></ol></li></ol></li></ol><h3 id=processor-affinity>Processor affinity</h3><ul><li>å®šç¾©ï¼šåœ¨multiprocessors systemä¸­ï¼Œç•¶processå·²æ±ºå®šæŸCPUä¸ŠåŸ·è¡Œï¼Œå‰‡åœ¨ä»–åŸ·è¡Œéç¨‹ç•¶ä¸­ï¼Œç›¡<strong>é‡ä¸è¦å°‡ä¹‹ç§»è½‰åˆ°å…¶ä»–CPUä¸ŠåŸ·è¡Œ</strong>(é™¤éæœ‰å…¶å¿…è¦ï¼Œeg. processor BAD, load Balancing, etc)é¿å…CPUå…§ä¹‹cacheç­‰å…§å®¹è¦è¤‡è£½ï¼Œä¸”åˆªé™¤ï¼Œå½±éŸ¿åˆ°æ•ˆèƒ½è¡¨ç¾ï¼Œå¯ä»¥æœ‰<ol><li>Hard affinityï¼šè¦å®šprocessä¸å¯ç§»è½‰</li><li>Soft affinityï¼šç›¡å¯èƒ½ä¸è½‰ï¼Œä½†ä¸å¼·åˆ¶é™åˆ¶ï¼Œè‹¥æœ‰éœ€è¦é‚„æ˜¯å¯ä»¥è½‰</li></ol></li></ul><h2 id=real-time-systemæ’ç­è¨­è¨ˆè€ƒé‡>Real-Time Systemæ’ç­è¨­è¨ˆè€ƒé‡</h2><h3 id=hard-real-time-system-1>Hard real-time system</h3><ul><li><p>æ’ç­è¨­è¨ˆè€ƒé‡</p><p>Step</p><ol><li><p>å…ˆç¢ºå®šé€™äº›å·¥ä½œæ˜¯å¦schedulable(å¯æ’ç¨‹åŒ–ï¼ŒCPUå¯ä»¥è² è·çš„äº†)</p></li><li><p>ç¢ºå®šå¯schedulableå¾Œï¼Œç„¶å¾Œåœ¨è€ƒæ…®æ˜¯å¦å¯ä»¥æ»¿è¶³å„å·¥ä½œçš„DeadLine</p><p>å…©å€‹æ’ç­æ³•å‰‡</p><ol><li>Rate-Montonic scheduling</li><li>EDF(Earliest Deadline First)æ³•å‰‡</li></ol></li></ol></li><li><p>Schedulableèˆ‡å¦ä¹‹åˆ¤æ–·å…¬å¼ï¼š</p><p><img src=https://i.imgur.com/YGIRHX0.png loading=lazy alt=image-20221221220452472></p><p>ä¾‹ï¼šæœ‰ä¸‹åˆ—4å€‹Real-time event. å…¶CPU burst time,Period Time åˆ†åˆ¥æ˜¯ï¼š</p><div class=table-wrapper><table><thead><tr><th>CPU Burst Time</th><th>Period Time</th></tr></thead><tbody><tr><td>20ms</td><td>80ms</td></tr><tr><td>50ms</td><td>100ms</td></tr><tr><td>30ms</td><td>30ms</td></tr><tr><td>Xms</td><td>1Sec</td></tr></tbody></table></div><p>ï¼Œå‰‡åœ¨Schedulableè¦æ±‚ä¸‹ï¼Œxä¸å¯è¶…é?ms</p><p>Ans</p><p><img src=https://i.imgur.com/Uz4llsU.png loading=lazy alt=image-20221221222752875></p></li><li><p>æ€éº¼æ’ç¨‹ä»¥æ»¿è¶³å€‹å·¥ä½œDeadLine after Schedulable?</p><ul><li><p>Rate-Monotonicæ³•å‰‡</p><ol><li><p>æ¡å–Static priority(ä¸€æ—¦processçš„å„ªå…ˆæ¬Šé«˜ä½é †åºè¨‚å®šäº†ï¼Œå°±ä¸æœƒå†æ”¹è®Š) ä¸” preemptive æ³•å‰‡</p></li><li><p>Period Timeæ„ˆå°ï¼Œå„ªå…ˆæ¬Šè¶Šé«˜</p></li><li><p>èˆ‰ä¾‹</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Period Time</th><th>CPU time</th></tr></thead><tbody><tr><td>P1</td><td>50</td><td>20</td></tr><tr><td>P2</td><td>100</td><td>35</td></tr></tbody></table></div><p>Q1. schedulableèˆ‡å¦?</p><p><img src=https://i.imgur.com/b4Hvzog.png loading=lazy alt=image-20221221233303344></p><p>Q2. è‹¥è¦å®šP2çš„å„ªå…ˆé«˜ï¼Œä¸”preemptive, é€™æ¨£æ˜¯å¦æ»¿è¶³DeadLine?<code>é€™é¡Œæ„Ÿè¦ºæ€ªæ€ªçš„ï¼Œä¸æ‡‚</code></p><p>â€‹ <img src=https://i.imgur.com/kspYKY2.png loading=lazy alt=image-20221222001538807></p><p>Q3. æ¡ç”¨Rate-Monotonic, æ˜¯å¦æ»¿è¶³Deadline?</p><p>â€‹ <img src=https://i.imgur.com/W1WG2Gm.png loading=lazy alt=image-20221222001627140></p></li><li><p>åˆ†æï¼š</p><ol><li><strong>ä¸¦ä¸ä¿è­‰å¯ä»¥æ»¿è¶³DeadLine</strong></li><li><strong>åœ¨Static priorityè¦æ±‚ä¸‹ï¼Œå®ƒæ˜¯Optimal(è‹¥å®ƒç„¡æ³•æ»¿è¶³DeadLine,å…¶ä»–Static priority æ³•å‰‡ä¹Ÿæ˜¯ç„¡æ³•æ»¿è¶³</strong></li></ol></li></ol></li><li><p>EDF(Earliest Deadline First)</p><ul><li><p>å®šç¾©ï¼šæ¡ç”¨Dynamic priority ä¸”Preemptive</p></li><li><p>è¦å®šï¼šDeadLineè¶Šå°(æ—©)å„ªå…ˆæ¬Šè¶Šé«˜</p></li><li><p>èˆ‰ä¾‹ï¼š</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Period</th><th>CPU Time</th></tr></thead><tbody><tr><td>P1</td><td>50</td><td>25</td></tr><tr><td>P2</td><td>80</td><td>35</td></tr></tbody></table></div><p>æ˜¯å¦æ»¿è¶³Deadline?</p><ol><li><p>Rate-Monotonic</p><p><img src=https://i.imgur.com/37nWeoT.png loading=lazy alt=image-20221222222736843></p></li><li><p>EDF</p><p><img src=https://i.imgur.com/RMT98Qy.png loading=lazy alt=image-20221222231738347></p></li></ol></li><li><p>åˆ†æï¼š</p><ol><li>EDFä¿è­‰æ˜¯optimal in the schedulable case(ä»»ä½•å·¥ä½œéƒ½å¯ä»¥æ»¿è¶³ DeadLine)</li><li>ç†è«–ä¸Šï¼ŒCPU utilization å¯é”100%ï¼Œ<strong>ä½†å¯¦éš›ä¸Šä¸å¯èƒ½</strong>ï¼Œå› ç‚ºæœ‰Context switching, interrupt handling ç­‰é¡å¤–è² æ“”</li></ol></li></ul></li></ul></li></ul><h3 id=soft-real-time-system-1>Soft real-time system</h3><ul><li><p>å®šç¾©ï¼šé€™å€‹ç³»çµ±è¦ç¢ºä¿real-timeçš„processå–å¾—æœ€é«˜å„ªå…ˆæ¬Šï¼ŒåŒæ™‚ï¼Œé€™å€‹real-timeçš„process priorityä¸èƒ½åšè¡°æ¸›</p></li><li><p>å°±CPU Scheduling Design è€Œè¨€ï¼Œå¿…é ˆ</p><ol><li>æ”¯æ´preemptive-priority</li><li>ä¸æ”¯æ´AgingæŠ€è¡“</li><li>ç›¡å¯èƒ½é™ä½Kernel Dispatch latency time, ä½¿å¾—real-time processå¯ä»¥åŠæ—©é–‹å·¥</li></ol></li><li><p><strong>é™ä½kernel Dispatch latency</strong></p><ol><li><p>å›°é›£åº¦(ç·£ç”±) ï¼š<strong>å¤§éƒ¨åˆ†çš„OSï¼Œçš†ä¸å…è¨±ç•¶kernelæ­£åœ¨åŸ·è¡ŒSystem Call or å…¶ä»–System processesæ™‚ï¼Œè¢«user processä»»æ„æ’éšŠ(preemption)ï¼Œç›®çš„æ˜¯ç‚ºäº†ç¢ºä¿kernel Data Structuresçš„æ­£ç¢ºæ€§(å³ä¸è¦æœ‰Race Condition)ï¼Œç„¶è€Œæ­¤ç¨®åšæ³•ï¼Œå°æ–¼Soft real-time systemæ¥µç‚ºä¸åˆ©</strong></p><p>eg. å‡è¨­ç›®å‰kernel æ­£åœ¨åŸ·è¡Œä¸€å€‹Long-time system call(eg. I/O operation)ï¼Œè€Œæ­¤æ™‚real-time processåˆ°é”/fork(),å®ƒå¿…é ˆç­‰åˆ°kernelå®Œæˆæ­¤long-time system callå¾Œï¼Œæ‰èƒ½å–å¾—CPUï¼Œ<strong>æ‰€ä»¥</strong></p><p><strong>Dispache latencyå¤ªé•·ï¼Œè¦è§£æ±ºæ­¤ä¸€å•é¡Œï¼ŒåŸå‰‡æ˜¯: å¿…é ˆæ’éšŠkernel ä¸”è¦ä¿éšœkernel Data Structureä¹‹æ­£ç¢ºæ€§</strong></p><p>æ–¹æ³•</p><ol><li><p>Preemption Pointï¼š</p><ul><li>å®šç¾©ï¼šåœ¨æ­¤System calls codeä¸­ï¼ŒåŠ å…¥ä¸€äº›Preemption Point(åœ¨æ­¤æ™‚é»æ’éšŠæ™‚ï¼ŒKernelæ˜¯å®‰å…¨çš„)å°‡ä¾†ï¼Œ<strong>System callåŸ·è¡Œæ™‚è‹¥é‡åˆ°Preemption Point ï¼ŒSystem callæœƒå…ˆæš«åœï¼ŒKernelæœƒæª¢æŸ¥æ­¤æ™‚æ˜¯å¦é‚„æœ‰real-time processå­˜åœ¨/åˆ°é”ï¼Œè‹¥æœ‰ï¼Œå‰‡Kernel system callæš«åœåŸ·è¡Œï¼ŒCPUåˆ†æ´¾çµ¦real-time Processä½¿ç”¨</strong>ï¼Œè‹¥ç„¡ï¼Œå‰‡System Callç¹¼çºŒåŸ·è¡Œï¼Œç›´åˆ°é‡è¦‹ä¸‹ä¸€å€‹Preemption Point</li><li>ç¼ºé»ï¼šSystem Callä¸­å¯ä»¥åŠ å…¥çš„Preemption Pointæ•¸ç›®ä¸å¤ å¤šï¼Œå› ç‚ºDispatch Latencyä»ç„¶å¾ˆé•·ã€‚</li></ul></li><li><p>Kernelå¯éš¨æ™‚è¢«real-time processæ’éšŠï¼Œä½†è¦å°æ–¼Kernelçš„å…±äº«Data Structure/resoruceæä¾›åš´è¬¹çš„äº’æ–¥å­˜å–(Synchronization æ©Ÿåˆ¶)ï¼Œä»¥ç¢ºä¿è³‡æ–™ä¹‹æ­£ç¢ºæ€§(ç•¶P1å°æŸå€‹Dataé€²è¡Œæ“ä½œï¼ŒåŸ·è¡Œåˆ°ä¸€åŠæ™‚è¢«real-time processçµ¦æ¶èµ°ï¼Œæ­¤æ™‚æœƒæŠŠè©²Dataçµ¦Lockä½ï¼Œä¸è®“real-time processæ“ä½œè©²Dataï¼Œä»¥ä¿è­·è³‡æ–™)</p><ul><li><p>ç¼ºé»ï¼šå¯èƒ½é€ æˆPriority Inversionå•é¡Œ(å„ªå…ˆæ¬Šåè½‰)ï¼Œé«˜å„ªå…ˆæ¬Šçš„Processæ‰€é ˆçš„å…±äº«Data/resourcesæ°å¥½è¢«ä¸€äº›ä½å„ªå…ˆæ¬Šçš„Process<u>æŠŠæŒ</u>ï¼Œç„¡æ³•å­˜å–(æ‰€ä»¥äº’æ–¥å­˜å–æ§åˆ¶ä¹‹æ•…)ï¼Œé€ æˆé«˜å„ªå…ˆæ¬Šç­‰å¾…ä½å„ªå…ˆæ¬ŠProcessä¹‹æƒ…æ³(å³é«˜processè¦ç­‰ä½processé‡‹æ”¾é€™äº›å…±äº«Data/resource)</p><p><img src=https://i.imgur.com/tJ80NeW.png loading=lazy alt=image-20221225000043643></p><p>ç•¶é«˜å„ªå…ˆæ¬Šçš„Processå› ç‚ºé²é²ç­‰ä¸åˆ°Lockè§£é™¤ï¼Œæœƒå› ç‚ºtime-outçš„é—œä¿‚è€Œæ”¾æ£„CPUï¼Œæ­¤æ™‚å¯èƒ½æœ‰å…¶ä»–ä¸­å„ªå…ˆæ¬Šçš„Processå–å¾—CPUçš„ä½¿ç”¨æ¬Šï¼Œå› æ­¤ä½å„ªå…ˆæ¬Šçš„Processå®Œæˆä¸äº†ï¼Œé€²è€Œå®Œæˆå°å…±äº«Data/resourcesä¹‹ä½¿ç”¨é€²è€ŒRelease, æ‰€ä»¥é«˜å„ªå…ˆæ¬Šprocessè¢«è¿«è¦ç­‰ä¸€æ®µå¾ˆä¹…çš„æ™‚é–“</p></li><li><p>è§£æ±ºæ–¹æ³•ï¼šPriority Inheritance</p><ul><li>å®šç¾©ï¼šè®“ä½å„ªå…ˆæ¬Šçš„Processæš«æ™‚<strong>ç¹¼æ‰¿</strong>é«˜å„ªå…ˆæ¬Šä¹‹æ¬Šå€¼ï¼Œä½¿å¾—ä½å„ªå…ˆæ¬ŠProcesså¯ä»¥å¾ˆå¿«å–å¾—CPUå®Œæˆå°å…±äº«Data/Resouceä¹‹ä½¿ç”¨ï¼Œä¸¦release them. åŒæ™‚ï¼Œä¹Ÿç«‹åˆ»æ¢å¾©å…¶åŸæœ¬çš„ä½æ¬Šå€¼</li></ul></li></ul></li></ol></li></ol></li></ul><h3 id=real-time-systemä¹‹dispatch-latency-çµ„æˆ>Real-time systemä¹‹Dispatch Latency çµ„æˆ</h3><p><img src=/C:%5cUsers%5cza546%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20221225005405637.png loading=lazy alt=image-20221225005405637></p><p>Dispatch Latencyæœ‰å…©å€‹phaseçµ„æˆ</p><ol><li><strong>Conflict Phaseï¼š</strong><ol><li><strong>Preempts kernel</strong></li><li><strong>ä½å„ªå…ˆæ¬Šrealseé«˜å„ªå…ˆæ¬Šæ‰€éœ€ä¹‹Data/resource</strong></li></ol></li><li><strong>Dispatch Phase</strong><ol><li><strong>Context Switching</strong></li><li><strong>Change mode to user Mode</strong></li><li><strong>Jump</strong></li></ol></li></ol><h2 id=thread-managementè²å¤šèŠ¬>Thread Management(è²å¤šèŠ¬)</h2><blockquote><p>Thread( or Multithreading)å®šç¾©ã€å„ªé»</p><p>Process(Single-Threaded) vs Thread (Multithreading)</p><p>user-level thread èˆ‡ kernel-level thread</p><p>Multithreading Model(3ç¨®)</p><p>Multithreading issue</p><blockquote><p>fork()</p><p>signal delivery</p><p>Threads pool</p></blockquote><p>ç¨‹å¼è¿½è¹¤(PThread library)</p></blockquote><h3 id=thread>Thread</h3><ul><li><p>å®šç¾©ï¼šåˆå«lightweight-process(å‚³çµ±çš„processå°±å«heavyweight process)ï¼Œæ˜¯OS<strong>åˆ†é…CPU time</strong> ä¹‹å°è±¡å–®ä½**(æï¼šIt&rsquo;s a basic unit of CPU Library)**</p></li><li><p>Thread å»ºç«‹å¾Œï¼Œå…¶ç§æœ‰çš„(private)å…§å®¹çµ„æˆåŒ…å«æœ‰(éƒ½æ˜¯èˆ‡åŸ·è¡Œç›¸é—œçš„)</p><ol><li><strong>Programming Counter</strong></li><li><strong>CPU registers value</strong></li><li><strong>Stack</strong></li><li>Thread ID, State, etc &mldr;(Note: record in TCB[Thread Control Block])æ­¤å¤–ï¼ŒåŒä¸€å€‹Processå…§ä¸åŒä¹‹Threadså½¼æ­¤å…±äº«æ­¤Processçš„<ol><li><strong>Code Section(åˆç¨±Memory space, address space)</strong></li><li><strong>Data Section(åˆç¨±Memory space, address space)</strong></li><li><strong>other OS resources eg. open files, I/O resources ,singal, etc &mldr;</strong></li></ol></li></ol></li><li><p>åœ–ç¤º</p><ol><li><p>MultiThreading Model</p><p><img src=https://i.imgur.com/bJe15zy.png loading=lazy alt=image-20221225124253929></p></li><li><p>Process = Single-Threaded Model</p><p><img src=https://i.imgur.com/gXamqw8.png loading=lazy alt=image-20221225125053668></p><p>Note: é¡æ¯”</p><p>Process &mdash;> æ±½è»Š</p><p>Thread &mdash;> å¼•æ“</p><p>æ±½è»Šæœƒæœ‰ä¸€å€‹å¼•æ“ï¼Œä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šï¼ŒMutliThreadå°±åƒæ˜¯ä¸€éƒ¨è»Šå­æœ‰å¤šå€‹å¼•æ“ï¼Œç„¶å¾Œå…±äº«è»Šå­æœ‰çš„é…ä»¶(å„€è¡¨æ¿ã€æ–¹å‘ç›¤ç­‰ç­‰)ã€‚CPU Timeæ˜¯ä»¥Threadç‚ºå°è±¡åœ¨ç•«åˆ†</p></li></ol></li><li><p><strong>å„ªé»(Benefits)</strong></p><ol><li><strong>Responsiveness</strong>ï¼šç•¶Processå…§åŸ·è¡Œä¸­çš„Threadè¢«Blockedï¼Œå‰‡CPUå¯ä»¥åˆ‡çµ¦æ­¤Processå…§å…¶ä»–available Threads åŸ·è¡Œï¼Œ<strong>æ•…æ•´å€‹Processä¸æœƒè¢«Blocked</strong>ï¼Œä»æŒçºŒGoing, æ‰€ä»¥Multithreadingç”¨åœ¨user-interactive application, å¯å¢åŠ å°User ä¹‹å›æ‡‰ç¨‹åº¦</li><li><strong>Resource Sharing</strong>ï¼šå› ç‚ºProcesså…§ä¹‹å¤šæ¢Threads å…±äº«æ­¤Process code sectionï¼Œæ‰€ä»¥åœ¨åŒä¸€å€‹Memory spaceä¸Šå¯æœ‰å¤šå€‹å·¥ä½œåŒæ™‚åŸ·è¡Œ</li><li><strong>Economy</strong>ï¼šå› ç‚ºåŒä¸€å€‹Processå…§ä¹‹ä¸åŒThreadså½¼æ­¤å…±äº«æ­¤Processçš„memory åŠ other OS resources, å› ç‚º<strong>Thread ä¹‹ ç§æœ‰æˆåˆ†é‡</strong>å°‘ï¼Œæ•…<strong>Threadä¹‹Creation, Context Switching fast, Thread management cost is cheap</strong>(forkä¸€å€‹Processçš„æˆæœ¬é å¤§æ–¼è¤‡è£½ä¸€å€‹Thread)</li><li><strong>Scalability(Utilization of Multiprocessors Architecture)</strong>ï¼šå¯ä»¥åšåˆ°åŒä¸€å€‹Processå…§ä¹‹ä¸åŒThreadså¯ä»¥åœ¨ä¸åŒCPUsä¸Šå¹³è¡ŒåŸ·è¡Œï¼Œæ‰€ä»¥å¯ä»¥å¢åŠ å°Multiprocessors Systemä¹‹æ•ˆç›Š(å¹³è¡Œç¨‹åº¦)æå‡</li></ol></li></ul><h3 id=process-vs-thread>Process Vs Thread</h3><blockquote><p>å…¶å¯¦æ˜¯åœ¨æ¯”Singal Thread and MultiThread</p></blockquote><p>Threadçš„çš„å„ªé»</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Thread</th></tr></thead><tbody><tr><td>Heavyweight process</td><td>Lightweight process</td></tr><tr><td>Single-Threaded Model</td><td>MultiThreading Model</td></tr><tr><td>æ˜¯OSåˆ†é…Resourceä¹‹å°è±¡å–®ä½</td><td>æ˜¯OSåˆ†é…CPU Timeä¹‹å°è±¡å–®ä½</td></tr><tr><td>ä¸åŒçš„Processä¸æœƒæœ‰å…±äº«çš„MemoryåŠOther Resources (é™¤äº†Shared Memoryæºé€šä¹‹å¤–)</td><td>åŒä¸€å€‹Processå…§ä¹‹Threadså½¼æ­¤å…±äº«æ­¤Processä¹‹memory åŠOther Resources</td></tr><tr><td>è‹¥Processå…§çš„single Thread is Blocked, å‰‡æ•´å€‹Processäº¦Blocked</td><td>åªè¦Processå…§å°šæœ‰Available Threadå¯åŸ·è¡Œï¼Œå‰‡æ•´å€‹Processä¸æœƒè¢«Blocked</td></tr><tr><td>Processä¹‹Creation context Switchingæ…¢ï¼Œç®¡ç†æˆæœ¬é«˜</td><td>Threadå¿«ï¼Œæˆæœ¬ä½</td></tr><tr><td>å°æ–¼MultiProcessorsæ¶æ§‹ä¹‹æ•ˆç›Šç™¼æ®è¼ƒå·®</td><td>è¼ƒä½³</td></tr></tbody></table></div><p>Threadçš„çš„ç¼ºé»</p><div class=table-wrapper><table><thead><tr><th>Process</th><th>Thread</th></tr></thead><tbody><tr><td>Processç„¡æ­¤è­°é¡Œ(é™¤éæ˜¯æ¡ç”¨Shared Memoryæºé€š)</td><td>å› ç‚ºåŒä¸€å€‹Processå…§ä¹‹Threadså½¼æ­¤å…±äº«æ­¤process Data Sectionï¼Œå› æ­¤å¿…é ˆå°å…±äº«çš„Data æä¾›äº’æ–¥å­˜å–æ©Ÿåˆ¶ï¼Œé˜²æ­¢race Condition</td></tr></tbody></table></div><h3 id=philosophy>Philosophy</h3><p><strong>Processèˆ‡Threadæ²’æœ‰åŠŸèƒ½å·®ç•°ï¼Œåªæœ‰æ•ˆèƒ½å·®ç•°</strong>(ä½ æœƒçš„ï¼Œæˆ‘ä¹Ÿå¯ä»¥ï¼Œä½ ä¸æœƒçš„ï¼Œæˆ‘ä¹Ÿä¸æœƒ)ã€‚</p><p>å“ªäº›å·¥ä½œé©åˆç”¨MultiThreads?</p><p>Ans. <strong>ä¸€å€‹æ™‚é–“é»æœ‰å¤šå€‹å·¥ä½œè¦åŸ·è¡Œã€‚ä¾‹ï¼šClient-server Model(åŒæ™‚æœ‰äººéä¾†è¦æª”æ¡ˆï¼Œçœ‹æª”æ¡ˆ)</strong></p><p>å“ªäº›å·¥ä½œä¸é©åˆç”¨MultiThreads?</p><p>Ans. ä¸€å€‹æ™‚é–“é»æœ€å¤šåªæœ‰ä¸€å€‹å·¥ä½œå¯ä»¥åšã€‚ä¾‹ï¼šå‘½ä»¤è§£è­¯å™¨(eg. UNIX ä¹‹ Shell)</p><h2 id=threadåˆ†é¡user-threadèˆ‡kernel-thread>Threadåˆ†é¡ï¼šuser-Threadèˆ‡Kernel-Thread</h2><p>å€åˆ†è§’åº¦ï¼š**Thread Managementå·¥ä½œ(å¦‚ï¼šThread Creation, Destroy, Suspend, wakeup, Scheduling, Context Switching, etc)**ç”±èª°è² è²¬</p><ol><li><p>User-Level Thread</p><ul><li>å®šç¾©ï¼šThread Managementæ˜¯ç”±åœ¨User Siteä¹‹Thread Libraryæä¾›APIs, ä¾›User Processå‘¼å«ä½¿ç”¨ï¼Œé€²è€Œç®¡ç†ï¼Œç¨±ä¹‹</li><li>Kernel å®Œå…¨ä¸çŸ¥é“(is Unaware of) Use-Level Threads ä¹‹å­˜åœ¨Noteï¼šåªçŸ¥æœ‰Process(Singal-Threaded)<img src=https://i.imgur.com/E6QHraV.png loading=lazy alt=image-20221227215115098></li><li>Thread managementä¸é ˆKernelä»‹å…¥å¹²é **(kernel unware user-thread)**</li><li>å„ªé»ï¼šThere creation, context switching ç­‰ï¼ŒManagement is fast æˆæœ¬è¼ƒä½</li><li>ç¼ºé»ï¼š<ol><li>ç•¶Processå…§æŸæ¢åŸ·è¡Œä¸­çš„user-thread is blocked(eg. i/o)ï¼Œæœƒå°è‡´æ•´å€‹Processäº¦è¢«Blocked(å³ä½¿processå…§é‚„æœ‰å…¶ä»–available threads)<code>é€™å€‹processéƒ½æ˜¯user Threadï¼Œç™¼å‡ºä¸€å€‹blockingçš„system call, kernelæœƒèªç‚ºæ˜¯é€™å€‹Single processç™¼å‡ºçš„è«‹æ±‚ï¼Œå› ç‚ºkernelä¸çŸ¥é“processè£¡é ­é‚„æœ‰å…¶ä»–user Threadçš„å­˜åœ¨ï¼Œæ–¼æ˜¯å°±æŠŠæ•´å€‹process blockä½ï¼ŒCPUåˆ‡åˆ°å…¶ä»–processå»åŸ·è¡Œ</code></li><li><strong>MultiProcessorsæ¶æ§‹æ•ˆç›Šç™¼æ®è¼ƒå·®</strong>(å› ç‚ºç„¡æ³•åšåˆ°processå…§ä¹‹å¤šæ¢user-threadså¹³è¡ŒåŸ·è¡Œï¼Œä½†é€™æ¨£ä¹Ÿæ˜¯æœ‰å¥½è™•çš„ï¼Œæ•´å€‹threadçš„ç®¡ç†ä¸éœ€è¦kernelçš„å¹²é ï¼Œä¸éœ€è¦å†user, kernelé–“åˆ‡æ›ï¼Œé™ä½ç®¡ç†çš„æˆæœ¬)</li></ol></li><li>ä¾‹ï¼šèˆ‰å‡¡Thread libraryçš†æ˜¯user-threads(eg. POSIX çš„ PThread library<code>æ˜¯è¦æ ¼ï¼Œåªåœ¨UNIXç³»çµ±ä¸Š</code>, Machçš„C-Thread Library, Solaris2ä»¥ä¸Šçš„ UI Thread LibraryåŠGreen Thread Library).</li></ul></li><li><p>Kernel-Level Thread</p><ul><li><p>å®šç¾©ï¼šThread Managementå®Œå…¨ç”±kernelè² è²¬ï¼ŒKernelçŸ¥é“æ¯ä¸€æ¢Threadä¹‹å­˜åœ¨ä¸¦é€²è¡Œç®¡ç†</p></li><li><p>å„ªç¼ºé»èˆ‡user-threadç›¸å</p></li><li><p>ä¾‹ï¼šå¤§éƒ¨åˆ†OSçš†æ”¯æ´ (Windosç³»åˆ— etc. 2000, Xp, UNIX, LINUX, Solaris)</p></li><li><p>èˆ‰ä¾‹ï¼š[Moduleç‰ˆ]</p><p><img src=https://i.imgur.com/3WceJA7.png loading=lazy alt=image-20221227221417715></p><ul><li>CPU Timeä¾åˆ†é…å°è±¡æ•¸ï¼Œå¹³å‡åˆ†é…(10å€‹äººå°±åˆ†10%ï¼Œ20å€‹äººå°±åˆ†5%)</li><li>å‰‡Pa, Pbå„åˆ†åˆ°?%CPU Timeï¼Œif All Threads are<ol><li>User Threadï¼škernelåªçŸ¥é“æœ‰å…©å€‹Processè¦ä¾†æ¶CPUï¼Œä¾†åˆ†CPU Timeï¼ŒPa,Pbå„åˆ†50%</li><li>Kernel Threadï¼škernelçŸ¥é“æœ‰5æ¢Threadè¦åˆ†CPU timeï¼Œ1æ¢åˆ†20%ï¼ŒPaåˆ†åˆ°3æ¢ï¼Œæ‰€ä»¥æ˜¯60%, Pbæ˜¯40%</li></ol></li></ul></li></ul></li></ol><h2 id=multithreading-model-æé¾æœ¬ç¨æœ‰>MultiThreading Model [æé¾æœ¬ç¨æœ‰]</h2><p>æé¾æœ¬ç”¨ä¾†è©®é‡‹user Threadè·ŸKernel Threadçš„è¦‹è§£</p><p>[user thread mapping kernel threadçš„æ•¸ç›®]</p><blockquote><ol><li>Many-to-One Model</li><li>One-to-One Model</li><li>Many-to-Many Model</li></ol></blockquote><ol><li>Many-to-One</li></ol><p><img src=https://i.imgur.com/xsaND6K.png loading=lazy alt=image-20221228220250841></p><ul><li>å®šç¾©ï¼šThis model maps <strong>many</strong> use threads to one kernel Thread. Thread Management is done in <strong>use space</strong></li><li>å„ªã€ç¼ºé»ï¼šå¦‚åŒuser thread</li><li>ä¾‹ï¼šthread libraryçš†æ˜¯</li><li>åœ–ç¤ºï¼š</li></ul><p><img src=https://i.imgur.com/sqCg5Xc.png loading=lazy alt=image-20221228220049555></p><p><img src=https://i.imgur.com/lhpbH4A.png loading=lazy alt=image-20221229212527117></p><ol start=2><li>One-to-One Model</li></ol><ul><li>å®šç¾©ï¼šThis model maps <strong>each</strong> use Threads to <strong>a</strong> kernel Thread. Thread Management is done in <strong>use space</strong></li><li>å„ªé»ï¼šåŒkernel thread</li><li>ç¼ºé»ï¼š<ol><li>Slower</li><li>Processæ¯å»ºç«‹ä¸€æ¢user-thread, systemå°±å¿…é ˆé…åˆç”Ÿä¸€æ¢kernel threadèˆ‡ä¹‹ï¼Œæ‰€ä»¥user threadæ•¸ç›®çœ¾å¤šï¼Œç³»çµ±è² æ“”æœƒå¾ˆé‡ï¼Œè€—è³‡æº</li></ol></li><li>ä¾‹ï¼šWindow NT, Window2000, OS/2, <strong>Linux</strong>(å€‹äººé›»è…¦ç³»åˆ—å¹¾ä¹éƒ½æ˜¯ONE-TO-ONE)</li></ul><p><img src=https://i.imgur.com/IGGT876.png loading=lazy alt=image-20221229220124154></p><ol start=3><li>Many to Many</li></ol><ul><li>å®šç¾©ï¼šThis model maps <strong>many</strong> use Threads to <strong>a small or equal number of</strong> kernel Thread. Thread Management is done in <strong>use space</strong></li><li>å„ªé»ï¼šåŒå‰è¿°kernel thread, è² æ“”ä¹Ÿä¸åƒone to oneçš„modelä¾†çš„é‡</li><li>ç¼ºé»ï¼š1. slower 2. è£½ä½œè¨­è¨ˆä¸Šï¼Œè¼ƒç‚ºè¤‡é›œ</li></ul><p><img src=https://i.imgur.com/suqnx3Q.png loading=lazy alt=image-20221229222340644></p><p><img src=https://i.imgur.com/9IyKGLf.png loading=lazy alt=image-20221229224155328></p><h2 id=multithreading-issue>MultiThreading Issue</h2><p>åŸæœ¬Single Threadæ²’é€™å•é¡Œ</p><ol><li>fork() issue</li></ol><p><img src=https://i.imgur.com/7BGxfOx.png loading=lazy alt=image-20221229230232766></p><ol start=2><li><p>Signal delivery(å‚³é€) issue</p><ol><li><strong>Signalï¼šit is used in UNIX to notify(é€šçŸ¥) the <u>process</u> that a particular event has occurred</strong></li></ol><p><img src=https://i.imgur.com/yqINM2g.png loading=lazy alt=image-20221229231422602></p><p>ç•¶processæ”¶åˆ°signalé€šçŸ¥å¾Œï¼Œå®ƒå¿…é ˆè™•ç†(å¯ç”±processè‡ªå·±è™•ç†æˆ–äº¤çµ¦default signal handlerè™•ç†)</p><p><img src=https://i.imgur.com/g1UOlQ6.png loading=lazy alt=image-20221229232030659></p><ol start=2><li><p>Signalçš„ç¨®é¡</p><ol><li>Synchronous signal[è‡ªä½œè‡ªå—ï¼Œé€™ä»¶äº‹æƒ…æ˜¯ç”±ä½ é€™å€‹Processç™¼ç”Ÿçš„ï¼Œæ‰€ä»¥Signalå°±æ˜¯ç™¼çµ¦ä½ ]eg. Divide-by-zero, illegal memory access,</li><li>Asynchronous signal[æ± é­šä¹‹æ®ƒï¼Œäº‹æƒ…ä¸æ˜¯ä½ åšçš„ï¼Œä½†åˆ¥äººç™¼å‡ºï¼Œå»æ˜¯ç ä½ ] eg. ctrl-c by administrator, time-out by timer</li></ol><p><img src=https://i.imgur.com/gXweQBH.png loading=lazy alt=image-20221229233929050></p><ol start=3><li><p>Signal Delivery issue</p><p>4å€‹options</p><ol><li>ç™¼çµ¦é‚£å€‹thread</li></ol><p><img src=https://i.imgur.com/3sQwWIo.png loading=lazy alt=image-20221230220600034></p><ol start=2><li><p>ç™¼çµ¦å¤§å®¶</p><p><img src=https://i.imgur.com/ug5ei8O.png loading=lazy alt=image-20221230220706683></p></li><li><p>ç™¼çµ¦ä¸€äº›threads</p><p><img src=https://i.imgur.com/2KO94EM.png loading=lazy alt=image-20221230220735243></p></li><li><p>ç™¼çµ¦ä¸€å€‹threadï¼Œé€™å€‹threadå†æŠŠsignalè½‰æ´¾çµ¦å¤§å®¶</p><p><img src=https://i.imgur.com/sZLZfZc.png loading=lazy alt=image-20221230220744830></p></li></ol></li></ol></li></ol></li><li><p>Threads Pool</p><ul><li>ç·£ç”±ï¼šåœ¨Client-Server Modelä¸­ï¼Œç•¶Server æ”¶åˆ°Client&rsquo;s requestå¾Œï¼ŒServeræ‰<strong>å»ºç«‹Threadå»æœå‹™</strong>æ­¤ä¸€è«‹æ±‚ï¼Œç„¶è€Œ<strong>Thread creation ä»é ˆè€—ç”¨ä¸€äº›æ™‚é–“</strong>ï¼Œæ‰€ä»¥å°client ä¹‹å›æ‡‰<strong>ä¸æ˜¯é‚£éº¼è¿…é€Ÿ</strong></li><li>è§£æ³•ï¼šæ¡ç”¨Thread poolæ©Ÿåˆ¶ï¼Œprocess(server)å…ˆå»ºç«‹ä¸€äº›Threadsï¼Œç½®æ–¼threads poolä¸­ï¼Œç•¶æ”¶åˆ°Client&rsquo;s requestå¾Œï¼Œå°±å¾Thread poolä¸­æŒ‡æ´¾ä¸€æ¢ available threadå»æœå‹™æ­¤è«‹æ±‚ï¼Œä¸é ˆcreationå›æ‡‰è¼ƒfastï¼Œç•¶æ­¤Thread å®Œæˆå·¥ä½œä»¥å¾Œï¼Œå†å›åˆ°Threads poolä¸­Stand By å¦‚æœThreads Poolä¸­ç„¡å¯ç”¨çš„Threadsï¼Œ<u>å‰‡Client&rsquo;s request é ˆç­‰å¾…</u></li><li>ç¼ºé»ï¼š<ol><li>è¬ä¸€Processäº‹å…ˆç”Ÿå‡ºéå¤šçš„Threads in the Thread pool, å°System resourceè€—ç”¨å¾ˆé«˜ï¼Œ<code>Note:é€šå¸¸ï¼¯ï¼³æœƒé™åˆ¶Threads pool size</code></li></ol></li></ul></li></ol><h2 id=threadç¨‹å¼è¿½è¹¤>Threadç¨‹å¼è¿½è¹¤</h2><p>(ä»¥PThread libraryç‚ºä¾‹)</p><p>ä¾‹ï¼šP4-49</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=cp>#include</span> <span class=cpf>&lt;Pthread.h&gt;</span><span class=cp>
</span><span class=cp></span><span class=kt>int</span> <span class=n>sum</span><span class=p>;</span>
<span class=kt>void</span> <span class=o>*</span><span class=nf>runner</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span> <span class=n>param</span><span class=p>){</span>
    <span class=n>sum</span> <span class=o>=</span><span class=mi>0</span><span class=p>;</span>
    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;=</span><span class=n>upper</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
        <span class=n>sum</span><span class=o>+=</span> <span class=n>i</span><span class=p>;</span>
        <span class=n>Pthread</span><span class=o>-</span><span class=n>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=c1>//thraedçµ‚æ­¢
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>};</span>
<span class=n>main</span><span class=p>(){</span>
    <span class=n>Pthread</span><span class=o>-</span><span class=n>t</span> <span class=n>tid</span><span class=p>;</span> <span class=c1>//tidå°±ä»£è¡¨Threadçš„id
</span><span class=c1></span>    <span class=n>Pthread</span><span class=o>-</span><span class=n>attr_t</span> <span class=n>arrt</span><span class=p>;</span> <span class=c1>//ä»£è¡¨attributeå±¬æ€§ Thread attributes set
</span><span class=c1></span>    <span class=p>...</span>
   <span class=n>Pthread</span><span class=o>-</span><span class=n>attr</span><span class=o>-</span><span class=n>init</span><span class=p>(</span><span class=o>&amp;</span><span class=n>attr</span><span class=p>)</span> <span class=p>;</span><span class=c1>//å–å¾—attr åˆå§‹å€¼
</span><span class=c1></span>   <span class=err>â˜…</span><span class=n>Pthread</span><span class=o>-</span><span class=n>create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tid</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>attr</span><span class=p>,</span> <span class=n>runner</span><span class=p>,</span> <span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span> <span class=c1>//æ ¹æ“šattr å±¬æ€§å€¼å»ºç«‹ä¸€æ¢Threadï¼ŒIdè¨˜åœ¨tidä¸­ï¼ŒåŸ·è¡Œrunner()å‰¯ç¨‹å¼
</span><span class=c1></span>   <span class=n>Pthread</span><span class=o>-</span><span class=n>join</span><span class=p>(</span><span class=n>tid</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span> <span class=c1>//main() thread åœ¨æ­¤ç­‰å¾…ï¼Œç›´åˆ°tid threadçµæŸ
</span><span class=c1></span>   <span class=n>printf</span><span class=p>(</span><span class=n>sum</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/E96wJWE.png loading=lazy alt=image-20230101163345552></p><p>ä¾‹ï¼šP4-50 ç¨‹å¼äºŒ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> 
<span class=kt>void</span> <span class=nf>main</span><span class=p>(){</span>
    <span class=kt>int</span> <span class=n>pid</span> <span class=p>;</span>
    <span class=n>pthread</span><span class=o>-</span><span class=n>t</span> <span class=n>tid</span><span class=p>;</span>
    <span class=n>Pthread_arrt_t</span> <span class=n>attr</span><span class=p>;</span>
    <span class=n>pid</span> <span class=o>=</span> <span class=n>fork</span><span class=p>();</span> <span class=c1>//create child process
</span><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=n>pid</span><span class=o>==</span><span class=mi>0</span><span class=p>){</span> <span class=c1>//å­prcessè¦åšçš„äº‹æƒ…
</span><span class=c1></span>        <span class=n>pthread_create</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tid</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>attr</span> <span class=p>,</span> <span class=n>runner</span><span class=p>,</span><span class=nb>NULL</span><span class=p>);</span> <span class=c1>//å­Processå»createä¸€æ¢thread
</span><span class=c1></span>        <span class=n>printf</span><span class=p>(</span><span class=n>value</span><span class=p>);</span> <span class=c1>//line C   
</span><span class=c1></span>    <span class=p>}</span><span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=n>pid</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>){</span>
        <span class=n>wait</span><span class=p>();</span>
        <span class=n>printf</span><span class=p>(</span><span class=n>value</span><span class=p>);</span> <span class=c1>//line P
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
<span class=kt>void</span> <span class=o>*</span><span class=nf>runner</span><span class=p>(){</span>
    <span class=n>value</span> <span class=o>=</span><span class=mi>5</span><span class=p>;</span>
    <span class=n>pthread_exit</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/RN22I2X.png loading=lazy alt=image-20230101164807174></p><p>ä¾‹ p4-70</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>shared by threads
A. static local variables(å…±äº«)
B. program text/exec, binary (code sec)å…±äº«
C. register value of CPU(ç§æœ‰)
D. heap memory (code+ Data sec memory space)å…±äº«
E. Programming Counter (ç§æœ‰)
F. Stack memory(ç§æœ‰)
G. Open Files(å…±äº«)
H. I/O resources(å…±äº«)
I. local variable(ç§æœ‰)
J. Global variables(å…±äº«)
</code></pre></td></tr></table></div></div><h1 id=chapter-5-deadlock>Chapter 5 DeadLock</h1><ul><li><p>å®šç¾©ï¼š<strong>æˆç«‹çš„å››å€‹å¿…è¦æ¢ä»¶</strong>ï¼Œä¾‹å­, <strong>èˆ‡Starvationåšæ¯”è¼ƒ</strong></p></li><li><p><strong>Deadlockçš„è™•ç†æ–¹æ³•</strong></p><blockquote><ol><li>Deadlock Prevention â˜…â˜…â˜…â˜…</li><li>Deadlock Avoidance(Banker&rsquo;s Algoâ˜…â˜…â˜…â˜…â˜…)</li><li>Deadlock Detection and Recoveryâ˜…â˜…</li><li>Ignores it .</li></ol></blockquote></li><li><p>å®šç†â˜…â˜…â˜…â˜…â˜…ï¼š</p></li><li><p>ç›¸é—œåœ–å½¢</p><blockquote><p>Resource Allocation Graph(RAG)+3é»çµè«–â˜…â˜…â˜…â˜…â˜…</p><p>Claim edgy+RAG(for Avoidance)</p><p>wait for Graph(for Detection)â˜…</p></blockquote></li></ul><h2 id=deadlock>DeadLock</h2><ul><li><p>å®šç¾©ï¼šç³»çµ±ä¸­å­˜åœ¨ä¸€çµ„Processeså½¼æ­¤å½¢æˆ<strong>å¾ªç’°ç­‰å¾…</strong>ä¹‹æƒ…æ³ï¼Œé€ æˆé€™äº›Processesçš†<strong>ç„¡æ³•å¾€ä¸‹åŸ·è¡Œ(å’Œstarvationä¸åŒï¼ŒStarvationé‚„æœ‰ä¸€çµ²å¯èƒ½æœƒåšåˆ°)</strong>ï¼Œä¸¦é™ä½Throughputä¹‹ç¾è±¡ã€‚</p></li><li><p>æ­»çµæˆç«‹çš„4å€‹å¿…è¦æ¢ä»¶(4 necessary condition)ï¼Œå³ç¼ºä¸€å€‹ï¼Œæ­»çµå°±ä¸æœƒç™¼ç”Ÿ. Ex. if there 4 conditions are true, then the deadlock <strong>will</strong> arise. Ans. <strong>False</strong>ï¼Œéƒ½æœ‰ä¸ä»£è¡¨ä¸€å®šæœƒç™¼ç”Ÿ</p><ol><li><p><strong>Mutual Exclusion</strong></p><p>äº’æ–¥æ€§è³ªï¼Œ<strong>é€™æ˜¯å°Resource(æ­£åœ¨æ¶å¥ªçš„è³‡æº)è€Œè¨€</strong>ï¼Œå…·æœ‰æ­¤æ€§è³ªçš„Resouceï¼Œ<strong>åœ¨ä»»ä½•æ™‚é–“é»æœ€å¤šåªå…è¨±ä¸€å€‹ProcessæŒæœ‰ä½¿ç”¨</strong>ï¼Œä¸å¯å¤šå€‹processåŒæ™‚æŒæœ‰/ä½¿ç”¨ã€‚</p><p>ä¾‹ï¼šå¤§å¤šæ•¸çš„è³‡æºçš†å…·æ­¤æ€§è³ªï¼Œeg. CPU, Memory, Disk, printer, etc &mldr;</p><p>ä¾‹ï¼šread-only fileï¼šä¸å…·äº’æ–¥æ€§è³ª</p></li><li><p><strong>Hold & wait</strong></p><p><strong>æŒæœ‰ä¸¦ç­‰å¾…ï¼ŒProcessæŒæœ‰éƒ¨åˆ†è³‡æºï¼Œä¸”åˆåœ¨ç­‰å¾…å…¶ä»–ProcessæŒæœ‰çš„è³‡æº</strong></p></li><li><p><strong>No preemption</strong></p><p>ä¸å¯æ¶å¥ªï¼Œ**Processä¸å¯ä»¥ä»»æ„å‰å¥ªå…¶ä»–Processæ‰€æŒæœ‰çš„è³‡æºï¼Œ**å¿…é ˆç­‰åˆ°å°æ–¹é‡‹æ”¾è³‡æºå¾Œæ‰æœ‰æ©Ÿæœƒå–å¾—è³‡æº<code>è‹¥å¯Preemptionï¼Œå‰‡å¿…ç„¡DeadLockï¼Œé ‚å¤šåªæœ‰Starvation</code></p></li><li><p><strong>Circular Waiting</strong></p><p>å¾ªç’°ç­‰å¾…ï¼Œç³»çµ±ä¸­å­˜åœ¨ä¸€çµ„Processeså½¢æˆå¾ªç’°ç­‰å¾…ä¹‹æƒ…æ³ï¼Œeg.</p><p><img src=https://i.imgur.com/KZA7hIH.png loading=lazy alt=image-20230102162108560></p></li></ol><p>æé¾æœ¬ï¼š4 implies 2</p><p>å…¶ä»–ç‰ˆæœ¬ï¼š4 implies 1,2,3eeeee</p><p>ex. Why Singl-processä¸æœƒé€ æˆDeadLock?</p><p>Aï¼šå› ç‚ºCircular waiting ä¸å­˜åœ¨ï¼Œåªå°‘è¦æœ‰å…©å€‹processæ‰å¯ä»¥å½¢æˆå¾ªç’°ç­‰å¾…ï¼Œå› æ­¤å››å€‹å¿…è¦æ¢ä»¶æœ‰ä¸€å€‹ä¸ç¬¦åˆï¼Œå³ä¸æœƒé€ æˆDeadLock</p></li><li><p>ä¾‹å­ï¼š</p><p><img src=https://i.imgur.com/dAckLzV.png loading=lazy alt=image-20230102163619321></p><ul><li><p>èˆ‡Starvatiomæ¯”è¼ƒ</p><p>ä¸åŒé»ï¼š</p><div class=table-wrapper><table><thead><tr><th>DeadLock</th><th>Starvation</th></tr></thead><tbody><tr><td>ä¸€çµ„Processeså½¢æˆCircular waitingï¼Œé€ æˆé€™äº›Processesçš†ç„¡æ³•å¾€ä¸‹åŸ·è¡Œï¼Œ<strong>Waiting forever</strong></td><td>Processå› ç‚ºé•·æœŸç„¡æ³•å–å¾—å®Œå·¥æ‰€éœ€çš„å„å¼è³‡æºï¼Œé€ æˆå®ƒé²é²ç„¡æ³•å®Œå·¥ï¼Œ<strong>æœ‰å®Œå·¥çš„æ©Ÿæœƒå–”ï¼Œåªæ˜¯æ©Ÿæœƒæ¸ºèŒ«</strong></td></tr><tr><td>æœƒé€£å¸¶é€ æˆthroughputä½è½</td><td>èˆ‡throughputé«˜ä½ç„¡é—œ</td></tr><tr><td>æœ‰4å€‹å¿…è¦æ¢ä»¶ï¼Œå…¶ä¸­ä¸€å®šæ˜¯No preemptive</td><td>å®¹æ˜“ç™¼ç”Ÿåœ¨Preemptionçš„ç’°å¢ƒ(æ²’æœ‰ä¸€å®šï¼Œåªæ˜¯å®¹æ˜“)</td></tr><tr><td>è§£æ³•æœ‰prevention, Avoidance, Detection & recovery</td><td>æ¡ç”¨AgingæŠ€è¡“é˜²æ­¢</td></tr></tbody></table></div><p>ç›¸åŒé»ï¼š</p><div class=table-wrapper><table><thead><tr><th>DeadLock 7 Starvation</th></tr></thead><tbody><tr><td>çš†æ˜¯è³‡æºåˆ†é…ç®¡ç†æ©Ÿåˆ¶è¨­è¨ˆä¸æ°ç•¶ç›¸é—œã€‚</td></tr></tbody></table></div></li></ul></li></ul><h2 id=resource-allocation-graphrag>Resource Allocation Graph(R.A.G)</h2><blockquote><p>è³‡æºåˆ†é…åœ–</p></blockquote><ul><li><p>å®šç¾©ï¼šä»¤ï¼§=&lt;V,E> æœ‰å‘åœ–ä»£è¡¨RAGï¼Œå…¶ä¸­</p><ol><li><p>Vertex(é ‚é»)ï¼šæœ‰å…©å€‹é¡å‹ï¼š</p><ol><li><p>Processï¼šä»¥Oä¾†è¡¨ç¤º</p></li><li><p>Resourceï¼šä»¥<img src=https://i.imgur.com/EnZNLpN.png loading=lazy alt=image-20230102171928690>è¡¨ç¤º</p><p>å…¶ä¸­&rdquo;Â·&ldquo;æ•¸ç›®ä»£è¡¨The Number of instances</p></li></ol></li><li><p>Edge(é‚Š)ï¼šåˆ†ç‚ºï¼’ç¨®edgeï¼š</p><ol><li>Allocation Edgeï¼š<img src=https://i.imgur.com/dpQ8jWe.png loading=lazy alt=image-20230102172625471></li><li>Requset Edgeï¼š<img src=https://i.imgur.com/8JBHEw8.png loading=lazy alt=image-20230102172716745></li></ol></li></ol></li><li><p>ä¾‹å­ ï¼š</p><p><img src=https://i.imgur.com/7QY3f61.png loading=lazy alt=image-20230102173423507></p></li></ul><h2 id=ragçš„ä¸‰é»çµè«–å¿…è€ƒ>RAGçš„ä¸‰é»çµè«–â˜†â˜†â˜†â˜†â˜†å¿…è€ƒ</h2><ol><li>No Cycleå‰‡No DeadLock</li><li>æœ‰Cycle<strong>ä¸ä¸€å®š</strong>æœ‰æ­»çµ ä¾‹ï¼š<img src=https://i.imgur.com/9d3b4lv.png loading=lazy alt=image-20230102175224638>å› ç‚ºP3ä¸€å®šå¯ä»¥å®Œå·¥ï¼Œæœƒé‡‹æ”¾1å€‹R2, å¯ä½©çµ¦P2ï¼Œæ­¤æ™‚åœ–ç„¡Cycleï¼ŒNo DeadLock</li><li>é™¤é(è‹¥)æ¯ä¸€é¡å‹çš„è³‡æºï¼Œçš†ç‚ºSingle instance(å–®ä¸€æ•¸é‡)ï¼Œå‰‡æœ‰Cycleå¿…ç‚ºæ­»çµ</li></ol><h2 id=deadlockè™•ç†æ–¹å¼>DeadLockè™•ç†æ–¹å¼</h2><blockquote><ol><li>DeadLock Prevention</li><li>DeadLock Avoidance(é¿å…) Banker&rsquo;s Algo</li><li>DeadLock Detection & Recovery</li></ol></blockquote><p>1.2</p><ul><li><p>å„ªé»ï¼š</p><ol><li>ä¿è­‰System is Deadlock free (or never enters the deadlock state)</li></ol></li><li><p>ç¼ºé»ï¼š</p><ol><li>å°Resourceçš„ä½¿ç”¨/å–å¾—é™åˆ¶å¤šï¼Œå› ç‚ºresource utilization åä½ï¼Œé€£å¸¶throughput ä¹Ÿåä½</li><li><strong>å¯èƒ½é€ æˆStarvation</strong></li></ol></li></ul><p>3</p><ul><li>å„ªé»ï¼š<ol><li>Resources utilizationç›¸å°è¼ƒé«˜. throughputä¹Ÿé€£å¸¶è¼ƒé«˜</li></ol></li><li>ç¼ºé»ï¼š<ol><li>Systemæœ‰å¯èƒ½é€²å…¥DeadLock state</li><li>Detection & Recoveryä¹‹costç›¸ç•¶é«˜</li></ol></li></ul><h2 id=deadlock-prevention>DeadLock Prevention</h2><ul><li>åŸå‰‡ï¼šç ´é™¤4å€‹å¿…è¦æ¢ä»¶ä¹‹å…¶ä¸­ä¸€å€‹ï¼Œå‰‡æ­»çµå¿…ä¸ç™¼ç”Ÿ</li></ul><ol><li><p>ç ´é™¤ &ldquo;Mutual Exclusion&rdquo; -> å…©å€‹å­—ã€Œ<strong>è¾¦ä¸åˆ°</strong>ã€ï¼å› ç‚ºé€™æ˜¯Resource<strong>èˆ‡ç”Ÿä¿±ä¾†</strong>(inheritance)çš„æ€§è³ª</p></li><li><p>ç ´é™¤ &ldquo;Hold & wait " - > å…©å€‹æ–¹æ³•(protocols)å¯ç”¨ï¼Œæƒ³è¾¦æ³•è®“Holdä¸æˆç«‹ï¼Œæˆ–æ˜¯è®“Waitä¸æˆç«‹</p><ol><li>OSå¯¦æ–½è¦å®šï¼š<strong>é™¤éProcesså¯ä¸€æ¬¡å–å¾—å…¨éƒ¨æ‰€éœ€è³‡æºï¼Œæ‰å‡†è¨±æŒæœ‰è³‡æºï¼Œå¦å‰‡ä¸å¾—æŒæœ‰ä»»ä½•è³‡æº</strong>ï¼Œä½†é€™æ¨£å­æœƒæœ‰è³‡æºåˆ©ç”¨åº¦ä½çš„å•é¡Œ(æ˜æ˜å¯ç”¨ï¼Œä½†å»è¦ç­‰åˆ°å…¨éƒ¨éƒ½å¯ä»¥ç”¨æ‰å¯ä»¥ä½¿ç”¨)</li><li>OSå¯¦æ–½è¦å®šï¼šProcesså¯å…ˆæŒæœ‰éƒ¨åˆ†è³‡æºï¼Œä½†ç•¶Processè¦ç”³è«‹å…¶ä»–è³‡æºæ™‚ï¼Œå¿…é ˆReleaseæŒæœ‰çš„å…¨éƒ¨è³‡æº(ä¸å†Hold)ï¼Œæ‰å¯æå‡ºç”³è«‹ã€‚ä½†è³‡æºåˆ©ç”¨ç‡ä¸€æ¨£å¾ˆä½ï¼Œå› ç‚ºæœ‰å¯èƒ½æœƒæŠŠå³å°‡è¦ä½¿ç”¨çš„è³‡æºé‡‹æ”¾å‡ºå»</li></ol></li><li><p>ç ´é™¤"No preemption&rdquo;ã€€-> æ”¹ç‚º"preemption&rdquo; å³å¯, eg. based on priority-level</p></li><li><p>â˜†â˜†â˜†â˜†â˜†ç ´é™¤"Circular waiting" -> æ–¹æ³•å«åš"resource ordering" ï¼Œ</p><ol><li><p>OSæœƒè³¦äºˆæ¯ä¸€å€‹é¡å‹è³‡æºä¸€å€‹Unique(å”¯ä¸€çš„)Resource id</p></li><li><p>OSæœƒè¦å®šProcesså¿…é ˆæŒ‰ç…§Resource Id Ascending(éå¢ã€éæ¸›éƒ½è¡Œï¼Œä½ çˆ½å°±å¥½)çš„æ–¹å¼å°è³‡æºæå‡ºç”³è«‹</p><div class=table-wrapper><table><thead><tr><th>æŒæœ‰çš„</th><th>æ¬²ç”³è«‹çš„</th><th>å…è¨±æˆ–ä¸å…è¨±</th></tr></thead><tbody><tr><td>R1</td><td>R3</td><td>å…è¨±</td></tr><tr><td>R5</td><td>R3</td><td>å¿…é ˆå…ˆæ”¾åˆ°R5ï¼Œæ‰å¯æR3(å› ç‚ºä¸ç¬¦åˆéå¢)</td></tr><tr><td>R1,R5</td><td>R3</td><td>å¿…é ˆå…ˆæ”¾åˆ°R5ï¼Œæ‰å¯æR3(å› ç‚ºä¸ç¬¦åˆéå¢)</td></tr></tbody></table></div><p>WHY?</p><p>pfï¼šå‡è¨­åœ¨é€™æ¨£çš„è¦å®šä¸‹ï¼Œç³»çµ±ä»å­˜åœ¨ä¸€çµ„Processeså½¢æˆCircular waitingå¦‚ä¸‹</p><p><img src=https://i.imgur.com/vWfXi5r.png loading=lazy alt=image-20230103215842475></p><p>ä¾è¦å®šï¼Œæˆ‘å€‘å¯ä»¥æ¨å°å‡ºè³‡æºIDå¤§å°é—œä¿‚å¦‚ä¸‹</p><p>r0 &lt; r1 &lt; r2 &lt; &mldr; &lt;rn &lt; r0</p><p>ç«Ÿæ¨å‡º r0 &lt;ræ­¤ä¸€çŸ›ç›¾å¼å­ï¼Œå› æ­¤Circular waitingå¿…ä¸å­˜åœ¨</p></li></ol></li></ol><h2 id=deadlock-avoidance>Deadlock Avoidance</h2><ul><li><p>å®šç¾©ï¼šç•¶æŸå€‹Processæå‡ºæŸäº›è³‡æºç”³è«‹æ™‚ï¼Œå‰‡OSå¿…é ˆåŸ·è¡Œ<strong>Banker&rsquo;s Algorithm</strong>ï¼Œä»¥ç¢ºå®š<strong>å€˜è‹¥åˆ†é…çµ¦processå…¶ç”³è«‹è³‡æºå¾Œï¼ŒSystemæœªä¾†è™•æ–¼safe state</strong>ï¼Œè‹¥Safeå‰‡æ ¸å‡†å…¶ç”³è«‹ï¼Œå¦å‰‡(unsage)å‰‡å¦æ±ºå…¶ç”³è«‹ï¼Œprocesså¿…é ˆç­‰ä¸€æ®µæ™‚é–“å¾Œï¼Œå†é‡æç”³è«‹ã€‚</p><p><img src=https://i.imgur.com/TG6PUR9.png loading=lazy alt=image-20230103223800287></p></li><li><p>Deadlockæ˜¯unsafeä¹‹subset</p></li></ul><h2 id=bankers-algo->Banker&rsquo;s Algo â˜†â˜†â˜†â˜†â˜†</h2><p><code>æœ¬ç« çš„è¨ˆç®—é¡Œéƒ½åœ¨é€™ Banker's Alog and Safety Algo</code></p><ul><li><p>å®šç¾©ï¼šä½¿ç”¨çš„Data Structures</p></li><li><p>çœ‹ä¸æ‡‚çš„è©±ç›´æ¥çœ‹ä¸‹é¢ç¯„ä¾‹æ¯”è¼ƒå¿«</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>å‡è¨­
nï¼šprocesså€‹æ•¸
m:  resourceç¨®é¡æ•¸
1. Request i ï¼šï¼»1..mï¼½of int
  -&gt; Piæå‡ºä¹‹å„å¼è³‡æºç”³è«‹é‡
2. Allocation : n*m martrix 
  -&gt; å„å€‹processç›®å‰æŒæœ‰çš„å„å¼è³‡æºæ•¸é‡
3. MAX: n*m martrix
  -&gt; å„processå®Œå·¥æ‰€éœ€ä¹‹å„å¼è³‡æºæœ€å¤§æ•¸é‡
4. Needï¼šn*m martrix(è‡ªå·±ç®—)
  -&gt; å„processå°šé ˆ(æ¬ )å„å¼è³‡æºæ•¸é‡æ‰èƒ½å®Œå·¥ï¼Œå› æ­¤Need= MAX -Allocation
5. Avaliableï¼š[1..m]of int 
  -&gt; ç³»çµ±ç›®å‰å¯ç”¨çš„ï¼Œå„å¼è³‡æºæ•¸é‡ï¼Œå› æ­¤Available=è³‡æºç¸½é‡-Allocation
èˆ‰ä¾‹èªªæ˜ï¼šå‡è¨­æœ‰äººä¾†è²¸æ¬¾3,000è¬ï¼Œé‚£éº¼Requesti =3000è¬ã€Allocationå°±æ˜¯è‡ªå·±çš„å­˜æ¬¾ï¼Œå‡è¨­é€™é‚Šæ˜¯2,000è¬ï¼Œæƒ³è²·ä¸€æ£Ÿ9,000è¬çš„æˆ¿å­ï¼Œé€™9,000è¬å°±æ˜¯ä»–çš„MAXï¼Œé‚£éº¼Need= 9,000-2,000= 7,000è¬ï¼ŒAvailable å°±æ˜¯éŠ€è¡Œç›®å‰é‡‘åº«è£¡èƒ½å€Ÿçµ¦ä½ çš„éŒ¢ï¼Œé€™é‚Šå‡è¨­æ˜¯10,000è¬ã€‚
  
Step1. Check Request &lt;= Need ?è‹¥æˆç«‹ï¼Œå‰‡å¾€ä¸‹åŸ·è¡Œï¼Œè‹¥ä¸æˆç«‹ï¼Œå‰‡çµ‚æ­¢Processã€‚
Request=3,000è¬ï¼ŒNeed= 7,000è¬ã€‚é€™æ¨£å°±æ˜¯åˆç†çš„ï¼Œä½†å‡è¨­ä½ ä»Šå¤©éœ€æ±‚7,000è¬ï¼Œå¯æ˜¯å»è²¸äº†3,000å…†ï¼Œé è¶…æ–¼ä½ çš„éœ€æ±‚ï¼Œé‚£å°±æœ‰å•é¡Œäº†
  
Step2. Check Request &lt;=Available?è‹¥æˆç«‹ï¼Œå‰‡å¾€ä¸‹åŸ·è¡Œï¼Œè‹¥ä¸æˆç«‹ï¼Œå‰‡Pi waits until resouce availalbe
æ¦‚å¿µå°±æ˜¯ä½ å»è²¸3,000è¬ï¼Œå¯æ˜¯éŠ€è¡Œé‡‘åº«ç›®å‰çš„éŒ¢ä¸å¤ ï¼Œéœ€è¦ä½ ç¨ç­‰ä¸€ä¸‹
  
Step3 (è©¦ç®—)
å‡è¨­è²¸æ¬¾æˆåŠŸ
Allocation = Allocation + Request
Need = Need - Request
Available = Available - Request
  
Step4 ä¾ä¸Šè¿°è©¦ç®—å€¼ï¼Œå¿…é ˆåŸ·è¡Œ &#34;safety&#34; algoï¼Œè‹¥å›å‚³&#34;Safe&#34; stateå‰‡æ ¸å‡†Piæ­¤æ¬¡ç”³è«‹ã€‚è‹¥å›å‚³&#34;unsafe&#34; stateï¼Œå‰‡å¦æ±ºPiæ­¤æ¬¡ç”³è«‹ã€‚Piå¿…é ˆç­‰ä¸€æ®µæ™‚é–“å†é‡æç”³è«‹
</code></pre></td></tr></table></div></div></li></ul><h2 id=safety-algorithm>Safety Algorithm</h2><ol><li><p>Data Structures used é™¤ä¸Šè¿°ä¹‹å¤–ï¼Œå¦å¤–åŠ å…¥</p><ol><li><p>Work:[1..m] of int -> è¡¨ç³»çµ±ç›®å‰å¯ç”¨Resourcesä¹‹ç´¯è¨ˆæ•¸é‡</p></li><li><p>Finish:[1..m] of Boolean -> é‡å°Process</p><p>Finish[i]=</p><p>True: è¡¨Piå¯å®Œå·¥</p><p>False: è¡¨Piå°šæœªå®Œå·¥</p><p>âˆ€1&lt;=i&lt;=n</p></li></ol></li><li><p>Procedures</p><p>Step</p><ol><li><p>è¨­å®šåˆå€¼</p><p>Work = Available</p><p>Finish[i]çš†ç‚ºFalse</p><p>âˆ€1&lt;=i&lt;=n</p></li><li><p>çœ‹å¯å¦æ‰¾åˆ°Piæ»¿è¶³ï¼š</p><ol><li>Finish[i]ç‚ºFalseä¸”</li><li>Needi &lt;= Work (æˆ‘æ‰€éœ€è¦çš„è³‡æºï¼Œ)</li></ol><p>è‹¥å¯æ‰¾åˆ°ï¼Œå‰‡é€²3,å¦å‰‡å‰‡é€²4</p></li><li><p>è¨­å®šFinish[i]=Trueï¼Œä¸”Work= Work + Allocationi, then, å›åˆ°2</p></li><li><p>Check Finish Array, è‹¥çš†ç‚ºTrueï¼Œå‰‡å‚³å›Safe Stateï¼Œå¦å‰‡å‚³å›Unsafe state</p></li></ol></li></ol><p>ç¯„ä¾‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>5å€‹Process(P0,P1,P2,P3,P4)
3ç¨®resource(A,B,C)
è³‡æºé‡(A,B,C) = (10,5,7)

1. æ±‚å‡ºNeedåŠAvailable
2. P1æå‡º(A,B,C)= (1,0,2)ç”³è«‹ï¼Œæ˜¯å¦æ ¸å‡†?Why?
</code></pre></td></tr></table></div></div><p>Ans.</p><ul><li>Allocation-å„å€‹Processèº«ä¸Šæ‰€æŒæœ‰çš„è³‡æº</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>P1</td><td>2</td><td>0</td><td>0</td></tr><tr><td>P2</td><td>3</td><td>0</td><td>2</td></tr><tr><td>P3</td><td>2</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>0</td><td>0</td><td>2</td></tr></tbody></table></div><ul><li>MAX- Processå®Œæˆå·¥ä½œæœ€å¤šæ‰€éœ€è¦çš„è³‡æºæ•¸é‡åˆ†åˆ¥æ˜¯å¤šå°‘</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7</td><td>5</td><td>3</td></tr><tr><td>P1</td><td>3</td><td>2</td><td>2</td></tr><tr><td>P2</td><td>9</td><td>0</td><td>2</td></tr><tr><td>P3</td><td>2</td><td>2</td><td>2</td></tr><tr><td>P4</td><td>4</td><td>3</td><td>3</td></tr></tbody></table></div><ul><li>Need= <strong>MAX-Allocation</strong></li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7-0=7</td><td>5-1=4</td><td>3-0=3</td></tr><tr><td>P1</td><td>3-2=1</td><td>2-0=2</td><td>2-0=2</td></tr><tr><td>P2</td><td>6</td><td>0</td><td>0</td></tr><tr><td>P3</td><td>0</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>4</td><td>3</td><td>1</td></tr></tbody></table></div><ul><li>Available= ç³»çµ±ç›®å‰é‚„å‰©çš„å¯ç”¨è³‡æºæ•¸ï¼Œè³‡æºç¸½é‡()-å·²ç¶“é…ç½®å‡ºå»çš„(Allocationå‡ºå»çš„)</li></ul><div class=table-wrapper><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>10-(2+3+2)=3</td><td>5-(1+1)=3</td><td>7-(2+1+2)=2</td></tr></tbody></table></div><p>Request=(1,0,2), Banker&rsquo;s Algo</p><ol><li><p>Check Request &lt;= Need ? (ä½ æ‰€è¦æ±‚çš„å°æ–¼ä½ çœŸæ­£éœ€è¦çš„ï¼Œäº¦å³ä½ è²·æ±è¥¿åªè¦500ï¼Œä¸èƒ½è·ŸéŠ€è¡Œå€Ÿåˆ°500è¬)</p><p><img src=https://i.imgur.com/5QkkGo9.png loading=lazy alt=image-20230107115630812></p></li><li><p>Check Request &lt;= Available (ä½ è¦çš„å€Ÿçš„éŒ¢æ˜¯å¦å°æ–¼éŠ€è¡Œæœ¬èº«æ‰€æŒæœ‰çš„éŒ¢ï¼Œäº¦å³å¦‚æœä½ è¦å€Ÿ1å„„ï¼Œä½†éŠ€è¡Œåªæœ‰ä¸€ç™¾è¬)?</p><p><img src=https://i.imgur.com/rEVlV70.png loading=lazy alt=image-20230107120047287></p></li><li><p>(è©¦ç®—)</p><p>P1:</p><p>Allocation = &lt;2,0,0>+&lt;1,0,2>(ç”³è«‹é‡) = <strong>&lt;3,0,2></strong></p><p>Need = &lt;1,2,2> - &lt; 1,0,2>(ç”³è«‹é‡) = <strong>&lt;0,2,0></strong></p><p>Available = &lt;3,3,2> - &lt;1,0,2>(ç”³è«‹é‡) = <strong>&lt;2,3,0></strong></p></li><li><p>ä¾ä¸Šè¿°èª¿æ•´å€¼ï¼Œä¾†åŸ·è¡Œ"Safety" Algo</p></li></ol><ul><li>Allocation</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>P1(è¦èª¿æ•´)</td><td><u><strong>3</strong></u></td><td><strong><u>0</u></strong></td><td><u><strong>2</strong></u></td></tr><tr><td>P2</td><td>3</td><td>0</td><td>2</td></tr><tr><td>P3</td><td>2</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>0</td><td>0</td><td>2</td></tr></tbody></table></div><ul><li>MAX</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7</td><td>5</td><td>3</td></tr><tr><td>P1</td><td>3</td><td>2</td><td>2</td></tr><tr><td>P2</td><td>9</td><td>0</td><td>2</td></tr><tr><td>P3</td><td>2</td><td>2</td><td>2</td></tr><tr><td>P4</td><td>4</td><td>3</td><td>3</td></tr></tbody></table></div><ul><li>Need</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7</td><td>4</td><td>3</td></tr><tr><td>P1(è¦èª¿æ•´)</td><td>0</td><td>2</td><td><strong>0</strong></td></tr><tr><td>P2</td><td>6</td><td>0</td><td>0</td></tr><tr><td>P3</td><td>0</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>4</td><td>3</td><td>1</td></tr></tbody></table></div><ul><li>Available</li></ul><div class=table-wrapper><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>2</td><td>3</td><td>0</td></tr></tbody></table></div><p>Safety Algo</p><ol><li><p>åˆå€¼çš„è¨­å®š</p><ul><li><p>Work = Abailable = &lt;2,3,0></p></li><li><p>Finish</p><div class=table-wrapper><table><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td></tr></tbody></table></div></li></ul><p>å°‹æ‰¾æœ‰æ²’æœ‰Processé‚„æ²’å®Œæˆå·¥ä½œï¼Œä¸¦ä¸”å®ƒçš„needi &lt;= workçš„</p></li><li><p>å¯æ‰¾åˆ°P1æ»¿è¶³Finish[i]= Falseä¸”Need &lt;=work</p></li></ol><p>â€‹ <img src=https://i.imgur.com/9uFiGp9.png loading=lazy alt=image-20230107123442941></p><ol start=3><li>è¨­å®šFinish[i]=Trueï¼Œä¸”Work= Work+Allocation = (2,3,0) + (3,0,2) = (5,3,2) , then goto 2</li><li>work = <del>(2,3,0)</del> > (5,3,2)</li></ol><p>â€‹ <img src=https://i.imgur.com/qn6JXjh.png loading=lazy alt=image-20230107123951216></p><ol start=5><li><p>é¸æ“‡P3æ»¿è¶³ Need&lt;= Workï¼Œä¸”Finish[i] = False</p></li><li><p>è¨­å®šFinishj[3]=Trueï¼Œä¸”Work=(5,3,2) +(2,1,1) = (7,4,3), then goto 2</p></li><li><p>&mldr; ä»¥æ­¤é¡æ¨ï¼ŒP0, P2, P4çš†å¯Finishï¼Œç›´åˆ°å¤§å®¶éƒ½Finishï¼Œå› æ­¤å¤§å®¶éƒ½æ»¿è¶³äº†ã€‚</p></li><li><p>Check Finishé™£åˆ—ï¼Œå› ç‚ºçš†ç‚ºTrueï¼Œæ‰€ä»¥<strong>å‚³å›Safe State</strong>ï¼Œ<strong>å› æ­¤æ ¸å‡†P1æ­¤æ¬¡çš„ç”³è«‹</strong></p></li><li><p>åˆ—å‡ºä¸Šè¿°å…¶ä¸­ä¸€çµ„<strong>Safe Sequence</strong><code>Safe Sequence/ Safe Stateå®šç¾©ï¼šè‡³å°‘å¯ä»¥æ‰¾åˆ°>=1çµ„ï¼ŒSafe Sequenceï¼Œæˆç‚ºSafe Stateï¼Œå¦å‰‡unsafe stateã€‚ä»£è¡¨OSæœªä¾†ä¾æ­¤Processesé †åºå¯åˆ†é…å„Processæ‰€needçš„è³‡æºï¼Œä½¿å¾—å¤§å®¶çš†å¯é †åˆ©å®Œå·¥</code></p><p>Ans. P1,P3,P0,P2,P4</p></li><li><p>ä¾ç¾åœ¨ç‹€æ³ï¼Œè‹¥P4æå‡º(3,3,0)ç”³è«‹ï¼Œæ˜¯å¦æ ¸å‡†?why? <strong>(ç·´ç¿’é¡Œ)</strong></p><p>Ans. Banker&rsquo;s algo</p><ol><li><p>Check Request (3,3,0) &lt;= Need(4,3,1) <strong>é€šé</strong></p><ul><li>Need</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7</td><td>4</td><td>3</td></tr><tr><td>P1</td><td>0</td><td>2</td><td><strong>0</strong></td></tr><tr><td>P2</td><td>6</td><td>0</td><td>0</td></tr><tr><td>P3</td><td>0</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>4</td><td>3</td><td>1</td></tr></tbody></table></div></li></ol></li></ol><p>â€‹ 2. Check Request4(3,3,0) &lt;= Available (2,3,0)?</p><p>â€‹ ä¸æˆç«‹ï¼Œå› ç‚ºç„¡æ³•æ ¸å‡†ï¼Œ<strong>å¯ç”¨è³‡æºä¸è¶³</strong></p><ol start=11><li><p>ä¾ç¾åœ¨æƒ…æ³ï¼Œè‹¥P0æå‡º(0,2,0)ï¼Œæ˜¯å¦æ ¸å‡†? ï¼·hy?</p><p>Ans. Banker&rsquo;s Algo</p><ol><li><p>å¿«é€Ÿè·‘éï¼Œç¢ºèªå¯ä»¥éï¼Œè³‡æºåˆ†é…æ”¹è®Šå¦‚ä¸‹</p><ul><li><p>Allocation</p><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>0</td><td>3</td><td>0</td></tr><tr><td>P1</td><td>3</td><td>0</td><td>2</td></tr><tr><td>P2</td><td>3</td><td>0</td><td>2</td></tr><tr><td>P3</td><td>2</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>0</td><td>2</td><td>2</td></tr></tbody></table></div></li><li><p>Need</p><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7</td><td>2</td><td>3</td></tr><tr><td>P1</td><td>0</td><td>2</td><td>0</td></tr><tr><td>P2</td><td>6</td><td>0</td><td>0</td></tr><tr><td>P3` | 0 | 1 | 1 |</td><td></td><td></td><td></td></tr><tr><td>P4</td><td>4</td><td>3</td><td>1</td></tr></tbody></table></div></li><li><p>Available</p><div class=table-wrapper><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>2</td><td>1</td><td>0</td></tr></tbody></table></div></li></ul></li><li><p>åŸ·è¡ŒSafety&rsquo;s algo</p><ol><li>è¨­å®šåˆå€¼ï¼ŒWork=(2,1,0)</li><li>æ‰¾å°‹æ˜¯å¦æœ‰ç¬¦åˆNeedi &lt;= Work çš„Processï¼Œä¸”é‚„æœ‰Processç‚ºFalse**(ä¸é€šé)**ï¼Œæ‰€ä»¥unsafe</li></ol></li></ol></li></ol><p>ç¯„ä¾‹äºŒ</p><ul><li><p>Allocation</p><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>0</td><td>3</td><td>0</td></tr><tr><td>P1</td><td>3</td><td>0</td><td>2</td></tr><tr><td>P2</td><td>3</td><td>0</td><td>2</td></tr><tr><td>P3</td><td>2</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>0</td><td>0</td><td>2</td></tr></tbody></table></div></li><li><p>Need</p><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>7</td><td>2</td><td>3</td></tr><tr><td>P1</td><td>0</td><td>2</td><td>0</td></tr><tr><td>P2</td><td>6</td><td>0</td><td>0</td></tr><tr><td>P3</td><td>0</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>4</td><td>3</td><td>1</td></tr></tbody></table></div></li><li><p>Available</p><div class=table-wrapper><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>2</td><td>1</td><td><strong>x</strong></td></tr></tbody></table></div></li></ul><p>æ±‚xçš„æœ€å°å€¼ï¼Œä½¿å…¶æˆç‚ºSafety</p><ol><li>è¨­ç½®åˆå€¼ï¼Œwork= (2,1,x)</li><li>æ‰¾å°‹ Need &lt;= work</li><li>æ‰¾åˆ°äº†ï¼ŒP3ï¼Œå…ˆæš«å®šx=1 (2,1,1)</li><li>P3å› ç‚ºå¯ä»¥å®Œæˆï¼Œå®Œæˆå¾Œè³‡æºå°±å¯ä»¥é‡‹æ”¾å‡ºä¾†ï¼Œå› æ­¤work (2,1,1) > (4,2,2)</li><li>ç¹¼çºŒæ‰¾å°‹Need &lt;=work</li><li>æ‰¾åˆ°äº†ï¼ŒP1</li><li>P1å› ç‚ºå¯ä»¥å®Œæˆï¼Œå®Œæˆå¾Œè³‡æºå°±å¯ä»¥é‡‹æ”¾å‡ºä¾†ï¼Œå› æ­¤work(4,2,2) > (7,2,4)</li><li>&mldr;å¾€å¾©å¾ªç’°ï¼Œä»¥æ­¤é¡æ¨</li></ol><p>â€‹</p><p>x= 1;</p><p><img src=https://i.imgur.com/mo7FIyC.png loading=lazy alt=image-20230107194309689></p><h2 id=bankers-algo-ä¹‹-time-complexity>Banker&rsquo;s Algo ä¹‹ Time Complexity</h2><p>å…ˆè¬›çµè«–ï¼Œ<strong>è¤‡é›œåº¦å°±æ˜¯O(n^2*m)</strong></p><p>(n: Process æ•¸ç›®, m:resource ç¨®é¡æ•¸)</p><p>Banker&rsquo;s Algo Time Complexity</p><p>Step</p><ol><li>O(m)<code>Check Request &lt;= Need</code></li><li>O(m)<code> Check Request &lt;=Available</code></li><li>O(m)<code>è©¦ç®—</code></li><li>Run safety algo</li><li>è¨­ç½®åˆå€¼work -> 1~mçš„ä¸€ç¶­é™£åˆ—ï¼Œå› æ­¤è¤‡é›œåº¦ç‚ºO(m)ã€‚Finish ->1~nçš„ä¸€ç¶­é™£åˆ—ï¼Œå› æ­¤è¤‡é›œåº¦ç‚º O(n)</li><li>å…ˆä¾†çœ‹çœ‹Safety&rsquo;s algoçš„æ­¥é©Ÿ<img src=https://i.imgur.com/sIe7W3D.png loading=lazy alt=image-20230109221851317></li></ol><p>â€‹ ç¬¬ä¸€æ¬¡æœ€å¤šæœƒæª¢æŸ¥næ¬¡ï¼Œå†ä¾†ç¬¬äºŒæ¬¡æª¢æŸ¥n-1æ¬¡&mldr;</p><p>â€‹ =(n+1)n/2å€‹Processesã€‚æ¯æ¬¡æª¢æŸ¥Need &lt;=Work èŠ±O(m)çš„æ™‚ é–“ï¼Œæœ€å¤šèŠ±O(n^2*m) time</p><ol start=7><li>èŠ±O(n) Check Finish</li></ol><p>å› æ­¤<strong>è¤‡é›œåº¦å°±æ˜¯O(n^2*m)</strong></p><h2 id=é‡å°æ¯ä¸€é …é¡å‹è³‡æºçš†ç‚ºsingle-instanceæƒ…æ³ä¸‹æœ‰è¼ƒç°¡æ˜“çš„avoidanceä½œæ³•>é‡å°æ¯ä¸€é …é¡å‹è³‡æºï¼Œçš†ç‚ºSingle-instanceæƒ…æ³ä¸‹ï¼Œæœ‰è¼ƒç°¡æ˜“çš„Avoidanceä½œæ³•</h2><ol><li><p>åˆ©ç”¨RAGï¼Œæ­é…<strong>Claim edge(å®£å‘Šé‚Š)ä½¿ç”¨</strong></p></li><li><p>Claim edge:</p><p><img src=https://i.imgur.com/DbUNSBR.png loading=lazy alt=image-20230110213506269></p><p>ä»£è¡¨Piæœªä¾†æœƒå°Rjæå‡ºç”³è«‹(å³è¡¨MAX/NEEDä¹‹æ„ç¾©)</p></li><li><p>Stepsï¼š</p><p><code>ç•¶Piæå‡ºRjç”³è«‹å¾Œ</code></p><ol><li><p>æª¢æŸ¥æœ‰ç„¡Piå°Rjçš„é€™æ¢å®£å‘Šé‚Š(Claim edge)å­˜åœ¨ï¼Œè‹¥æœ‰ï¼Œå‰‡goto2å¦å‰‡ï¼Œçµ‚æ­¢Pi</p></li><li><p>Check Rjæ˜¯å¦Availableï¼Œè‹¥æ˜¯ï¼Œå‰‡goto3ï¼Œå¦å‰‡<strong>Pi waits</strong>(è®Šæˆç”³è«‹é‚Š)</p></li><li><p>(è©¦ç®—)æš«æ™‚æŠŠå®£å‘Šé‚Šæ”¹ç‚ºé…ç½®é‚Š<img src=https://i.imgur.com/45EmEs2.png loading=lazy alt=image-20230110234601069></p></li><li><p>åŸ·è¡Œsafety&rsquo;s Algo, check åœ–ä¸­æ˜¯å¦æœ‰cycleå­˜åœ¨</p><p>è‹¥æ²’æœ‰ï¼Œå‰‡ç‚ºsafe -> å¯æ ¸å‡†</p><p>æœ‰Cycleï¼Œå‰‡ç‚ºunsafe -> å¦æ±º</p></li></ol></li><li><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/aTNbxz5.png loading=lazy alt=image-20230110233244192></p><ol><li><p>è‹¥P1æå‡ºR2ä¹‹ç”³è«‹ï¼Œæ˜¯å¦æ ¸å‡†?</p><p>Ans.</p><p><img src=https://i.imgur.com/sE32Vh1.png loading=lazy alt=image-20230110235023904></p></li><li><p>è‹¥P2æå‡ºR2ä¹‹ç”³è«‹ï¼Œæ˜¯å¦æ ¸å‡†?</p><p><img src=https://i.imgur.com/VDS6Lz1.png loading=lazy alt=image-20230111000113366></p></li></ol></li></ol><p>è£œå……ï¼š<strong>Deadlockæ˜¯unsafeä¹‹subset(æˆ–unsafeæœ‰å¯èƒ½å°è‡´æ­»çµï¼Œä¹Ÿæœ‰å¯èƒ½ä¸æœƒå°è‡´æ­»çµ)</strong></p><p><img src=https://i.imgur.com/BSN7MhD.png loading=lazy alt=image-20230111001212290></p><ol><li><p>å¯èƒ½<strong>ä¸æœƒ</strong>æ­»çµ</p><p>ans. æä¸å¥½P1åœ¨æå‡ºR2çš„ç”³è«‹æ™‚ï¼Œå°±ä½¿ç”¨å®ŒR1äº†ï¼Œé€™æ™‚å°±ä¸æœƒæœ‰æ­»çµã€‚æˆ–æ˜¯P2åœ¨P1æå‡ºç”³è«‹ä¹‹å‰å°±ä½¿ç”¨å®ŒR2äº†ï¼Œæ­¤æ™‚ä¹Ÿä¸æœƒæœ‰æ­»çµã€‚</p></li><li><p>å¯èƒ½<strong>æœƒæœ‰</strong>æ­»çµ</p><p>ans. P1ç«‹åˆ»å°R2æå‡ºç”³è«‹ï¼Œæ­¤æ™‚RAGæœ‰Cycleï¼Œä¸”è³‡æºéƒ½æ˜¯Single Instance</p></li></ol><p>ä¹Ÿå°±æ˜¯èªªæ­»çµç”¢ç”Ÿèˆ‡å¦å–æ±ºæ–¼å®£å‘Šé‚Šåœ¨å“ªå€‹momentæå‡ºç”³è«‹</p><p>â€‹</p><h2 id=å®šç†>å®šç†</h2><p>ç³»çµ±è‹¥æœ‰<u>n</u>å€‹processesï¼Œmå€‹resourceé‡(å–®ä¸€ç¨®é¡)æ»¿è¶³ä¸‹åˆ—2å€‹æ¢ä»¶ï¼š</p><ol><li><p>1â‰¦MAXiâ‰¦m(æ¯å€‹processçš„æœ€å¤§éœ€æ±‚é‡è‡³å°‘è¦æœ‰1å€‹ï¼Œæœ€å¤šä¸è¶…ém)</p></li><li><p>ä¸”æ‰€æœ‰nå€‹processçš„MaxiåŠ ç¸½ï¼Œå°æ–¼n+m</p><p>$$
\sum_{i=1}^nMAXi&lt;(n+m)
$$</p><p>å‰‡System is <strong>Deadlock free</strong>.</p></li></ol><p>ä¾‹1. æœ‰6éƒ¨printersè¢«processä½¿ç”¨ï¼Œæ¯å€‹processæœ€å¤šéœ€è¦2éƒ¨printersæ‰å¯ä»¥å®Œå·¥ï¼Œå‰‡System æœ€å¤šå…è¨±?å€‹processåŸ·è¡Œä»¥ç¢ºä¿deadlock Free?</p><p>ans. m=6, Max=2</p><p>é–‹å§‹è·‘å®šç†</p><ol><li><p>1 â‰¦ Maxi â‰¦ m -> 1 â‰¦ 2 â‰¦ 6æˆç«‹</p></li><li><p>$$
\sum_{i=1}^nMaxi&lt;(n+m)
$$</p></li></ol><p>â€‹ æ‰€ä»¥2n&lt;n+6ï¼Œn&lt;6ï¼ŒAns:ã€€æœ€å¤šï¼•å€‹processes</p><p>â€‹</p><p>è©³è§£</p><ol><li><p>æ‰€è¬‚æ­»çµçš„ç™¼ç”Ÿï¼Œå°±æ˜¯ç³»çµ±å·²ç¶“å°‡æ‰€æœ‰çš„è³‡æºéƒ½æŠ•å…¥ä¸‹å»ï¼Œä½†ä¾ç„¶æ²’æœ‰ç”¢å‡ºï¼Œä¸æœƒæœ‰ä¸€å€‹ç³»çµ±æ˜¯ä½”æ“šè‘—è³‡æºä¸åˆ†é…ï¼Œçœ‹è‘—åº•ä¸‹çš„Processé€²å…¥Deadlocké‚„å¾ˆé–‹å¿ƒ</p><p><img src=https://i.imgur.com/60Ndyr2.png loading=lazy alt=image-20230112221927497></p></li><li><p>æ‡‰æ­¤å°‡è³‡æºåˆ†é…ä¸‹å»å¾Œï¼Œå°±æ˜¯é•·é€™æ¨£</p><p><img src=https://i.imgur.com/9rc68RH.png loading=lazy alt=image-20230112222025831></p></li><li><p>Processå–å¾—2å€‹Resourceå¾Œå°±å¯ä»¥åŸ·è¡Œï¼ŒåŸ·è¡Œå®Œå¾Œåˆé‡‹æ”¾2å€‹Resourceçµ¦å…¶ä»–çš„Processä½¿ç”¨</p><p><img src=https://i.imgur.com/VDXlZBP.png loading=lazy alt=image-20230112222203015></p></li><li><p>æŒçºŒçš„æŠŠResourceåˆ†é…çµ¦Process&mldr; å¾€å¾©å¾ªç’°ï¼Œå³å¯å®Œæˆã€‚</p></li><li><p>è‹¥å¾ˆä¸å¹¸çš„æ˜¯ï¼Œå¦‚æœä»Šå¤©æ˜¯6å€‹Processï¼Œå°±æœƒç™¼ç”Ÿæ­»çµ</p><p><img src=https://i.imgur.com/k3fiqJr.png loading=lazy alt=image-20230112222340478></p></li><li><p>æ¨å°å…¬å¼ï¼Œè‹¥ä»Šå¤©é¡Œç›®æ”¹æˆï¼Œæ¯å€‹Processéœ€è¦3å°å°è¡¨æ©Ÿï¼Œç¾åœ¨æœ‰10éƒ¨åˆ—è¡¨æ©Ÿï¼Œæœ€å¤šèƒ½å…è¨±å¹¾å€‹Process(MAX=3, m=10)</p><p><code>3n&lt;n+10</code></p><p><code>=2n&lt;10</code></p><p><code>=n&lt;5</code></p></li></ol><p>â€‹ ans. n=4</p><p>ä¾‹2. è­‰æ˜ï¼š</p><p>â€‹ proofï¼šå‡è¨­è³‡æºå…¨éƒ¨é…ç½®å‡ºå»</p><p>$$
å³\sum_{i=1}^n Allocationi = m
$$</p><p>â€‹ åˆå› ç‚º</p><p>$$
\sum_{i=1}^nNeedi = \sum_{i=1}^nMaxi-\sum_{i=1}^n Allocationi(Banker&rsquo;s Algo) \<br>= \sum_{i=1}^nMaxi-m \<br>âˆ´\sum_{i=1}^nMaxi=\sum_{i=1}^nNeedi+m
$$</p><p>â€‹</p><p>â€‹ å†ä¾æ“šæ¢ä»¶(2)</p><p>$$
\sum_{i=1}^nMaxi &lt; (n+m) \<br>âˆ´\sum_{i=1}^nNeedi+m&lt;(n+m) \<br>$$</p><p>â€‹ å¾—å‡ºé€™å€‹çµè«–</p><p>$$
âˆ´ \sum_{i=1}^nNeedi &lt; n
$$</p><p>â€‹ æ­¤äº‹ä»£è¡¨è‡³å°‘æœ‰>=1å€‹Processä¹‹Neediç‚º0ï¼Œä»£è¡¨Processå¯ä»¥å®Œå·¥ï¼Œä¸”Piè‡³å°‘æœƒReleaseå‡º>=1å€‹Resource**(âˆµæ¢ä»¶(1) -> MAX>=1,è€ŒNeedi=0 âˆ´Allocation >=1)**ä½¿å¾—å‰©ä¸‹çš„Processç•¶ä¸­åˆæœƒæœ‰>=1å€‹processä¹‹Needç‚º0åˆå¯ä»¥å®Œå·¥ã€‚ä½¿å¾—å‰©ä¸‹çš„processä¸­åˆæœƒæœ‰>=1å€‹Processä¹‹Needç‚º0åˆå¯ä»¥å®Œå·¥ï¼Œä¾æ­¤é¡æ¨ï¼Œæ‰€æœ‰Processçš†å¯å®Œå·¥ï¼Œâˆ´Deadlock Free</p><p>è§£é‡‹çš„æ•¸å­¸å¼å­å¦‚ä¸‹ï¼Œé¡ä¼¼é›¢æ•£çš„é´¿ç± åŸç†</p><p>$$
\sum_{i=1}^{n-1}Needi&lt;n-1
$$</p><h2 id=deadlock-detection--recovery>Deadlock Detection & Recovery</h2><ol><li><p>å¦‚æœæ”¾ä»»resourceä½¿ç”¨è¼ƒç„¡é™åˆ¶ï¼Œé›–ç„¶Utilizationé«˜ï¼Œ<strong>ä½†æ˜¯Systemæœ‰å¯èƒ½é€²å…¥æ­»çµè€Œä¸è‡ªçŸ¥ã€‚<strong>å› ç‚ºéœ€è¦æœ‰ä¸€å€‹</strong>æ­»çµåµæ¸¬æ¼”ç®—æ³•</strong>ï¼ŒåŠè¬ä¸€åµæ¸¬å‡ºæœ‰æ­»çµï¼Œå¦‚ä½•ç ´é™¤é€™å€‹æ­»çµ(recovery)çš„ä½œæ³•ã€‚</p></li><li><p>Recoveryåšæ³•ï¼š</p><blockquote><ol><li><p><strong>Kill</strong> Process in the deadlock</p><blockquote><p>æ–¹æ³•ä¸€ï¼š<strong>Kill All Processes in the deadlock</strong>å¯¸è‰ä¸ç”Ÿï¼Œçœ¼ä¸è¦‹ç‚ºæ·¨</p><p>ç¼ºé»ï¼šæˆæœ¬å¤ªé«˜ï¼Œå…ˆå‰çš„å·¥ä½œæˆæœå…¨éƒ¨ä½œå»¢ã€‚</p><p>æ–¹æ³•äºŒï¼š<strong>Kill processes one by one</strong>ï¼Œ<strong>Killä¸€å€‹ä¹‹å¾Œï¼Œé ˆå†è·‘åµæ¸¬Algoï¼Œè‹¥æ­»çµä»å­˜åœ¨ï¼Œå†Repeatä¸Šè¿°æ­¥é©Ÿ</strong></p><p>ç¼ºé»ï¼š<strong>æˆæœ¬å¤ªé«˜</strong>ï¼ŒLoopæ¬¡æ•¸*åµæ¸¬æˆæœ¬</p></blockquote></li><li><p>Resource Preemption</p><blockquote><p>æ­¥é©Ÿä¸€ï¼šé¸æ“‡"Victim" process(å‡è¨­æ­¤Processæ“æœ‰è³‡æºA,B,C)</p><p>æ­¥é©ŸäºŒï¼šå‰å¥ªä»–å€‘èº«ä¸Šçš„è³‡æº(å‰å¥ªBï¼Œä¿ç•™A,Bï¼Œé€™æ˜¯æœ€åŸºæœ¬çš„æƒ…æ³)</p><p>æ­¥é©Ÿä¸‰ï¼š<strong>å›å¾©æ­¤Victim processç•¶åˆæœªå–å¾—æ­¤å‰å¥ªè³‡æºçš„ç‹€æ…‹(é€™ä¸€æ­¥éå¸¸å›°é›£ï¼Œæˆæœ¬æ¥µé«˜ï¼Œä¹Ÿä¸ä¸€å®šåšå¾—å¥½ï¼Œæ­¤å¤–ä¹Ÿå¯èƒ½æœ‰Starvationçš„å•é¡Œ)</strong></p></blockquote></li></ol></blockquote></li></ol><h2 id=deadlock-detection-algorithmè€ƒæ¯”è¼ƒå¤šçš„æ˜¯bankerdetectionç¨å¾®çŸ¥é“å°±å¥½>Deadlock Detection Algorithm(è€ƒæ¯”è¼ƒå¤šçš„æ˜¯Banker,Detectionç¨å¾®çŸ¥é“å°±å¥½)</h2><ol><li><p>Data Structures used</p><p>nï¼šprocessæ•¸</p><p>mï¼šresourceç¨®é¡</p><ol><li>Allocationï¼šn*m matrix</li><li>Availavleï¼š[1&mldr;m] of int <code>ç›®å‰å¯ç”¨è³‡æºæ•¸é‡</code></li><li>Work: [1&mldr;m] of int</li><li>Finishï¼š[1&mldr;n] of Boolean</li><li><strong>Requestï¼šn*m matrix</strong>ï¼Œå„processç›®å‰æå‡ºä¹‹å„å¼è³‡æºç”³è«‹é‡</li></ol><p>Noteï¼š</p><ol><li>Avoidance(Banker&rsquo;s Algo)å«æœ‰<u>æœªä¾†(Future)</u>info(MAX,Need)</li><li>Detectionï¼šåªæœ‰ç¾åœ¨(Current)info</li></ol></li><li><p>Procedures</p><p>æ­¥é©Ÿä¸€ï¼šåˆå€¼è¨­å®š</p><p>Work=Available</p><p>Finish[i]= True: <strong>if Allocation ==0</strong></p><p>â€‹ False: **if Allocation â‰ 0 **</p><p>æ­¥é©ŸäºŒï¼šçœ‹å¯å¦æ‰¾åˆ°Piæ»¿è¶³ï¼š</p><ol><li>Finish[i]ç‚ºFalse</li><li>Requesti â‰¦ Work</li></ol><p>è‹¥<strong>æ‰¾åˆ°</strong>ï¼Œå‰‡é€²å…¥æ­¥é©Ÿä¸‰ï¼Œå¦å‰‡é€²å…¥æ­¥é©Ÿå››</p><p>æ­¥é©Ÿä¸‰ï¼šè¨­å®šFinish[i]=Trueï¼Œä¸”Work=Work+Allocationi, then å›åˆ°æ­¥é©ŸäºŒï¼Œæ‰¾ä¸åˆ°å‰‡å›åˆ°ç¬¬å››æ­¥</p><p>æ­¥é©Ÿå››ï¼šCheck Finish Arrayï¼Œè‹¥çš†ç‚ºTrueï¼Œ<strong>å› æ­¤ç›®å‰ç„¡æ­»çµ</strong>ï¼Œå¦å‰‡å‰‡æœ‰æ­»çµï¼Œä¸”Finish[i]= Falseè€…ï¼Œå³ç‚ºé™·å…¥æ­»çµä¸­</p></li><li><p>Timeï¼šO(n^2 *m) &ndash;> æ­»çµåµæ¸¬ä¸€æ¬¡ï¼Œcostå¾ˆé«˜ï¼Œå†åŠ ä¸Š<strong>ä¹˜ä»¥åµæ¸¬é »ç‡</strong></p></li></ol><p>ç¯„ä¾‹1ï¼š</p><ul><li>Allocation</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>0</td><td>1</td><td>0</td></tr><tr><td>P1</td><td>2</td><td>0</td><td>0</td></tr><tr><td>P2</td><td>3</td><td>0</td><td>3</td></tr><tr><td>P3</td><td>2</td><td>1</td><td>1</td></tr><tr><td>P4</td><td>0</td><td>0</td><td>2</td></tr></tbody></table></div><ul><li>Request</li></ul><div class=table-wrapper><table><thead><tr><th></th><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>P0</td><td>0</td><td>0</td><td>0</td></tr><tr><td>P1</td><td>2</td><td>0</td><td>2</td></tr><tr><td>P2</td><td>0</td><td>0</td><td>0</td></tr><tr><td>P3</td><td>1</td><td>0</td><td>0</td></tr><tr><td>P4</td><td>0</td><td>0</td><td>2</td></tr></tbody></table></div><ul><li>Available</li></ul><div class=table-wrapper><table><thead><tr><th>A</th><th>B</th><th>C</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>0</td></tr></tbody></table></div><p>åµæ¸¬ç›®å‰æœ‰å“ªäº›æ­»çµ?</p><p>è‹¥æœ‰ï¼Œé‚£äº›process in the Deadlock</p><p>Ans.</p><ol><li><p>Work = Available = (0,0,0)</p><p>Finish</p><div class=table-wrapper><table><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead><tbody><tr><td>F</td><td>F</td><td>F</td><td>F</td><td>F</td></tr></tbody></table></div><p>å› ç‚ºAllocationçš†â‰ (0,0,0)</p></li><li><p>âˆµå¯ä»¥æ‰¾åˆ°P0æ»¿è¶³Finish[0]ç‚ºFï¼Œä¸”Requestâ‰¤work âˆ´åˆ°ç¬¬ä¸‰æ­¥é©Ÿ</p></li><li><p>è¨­å®šFinish[0]ç‚ºTrueï¼Œä¸”Work=(0,0,0)+(0,1,0)=(0,1,0)ï¼Œå›åˆ°ç¬¬äºŒæ­¥é©Ÿ</p></li><li><p>âˆµå¯ä»¥æ‰¾åˆ°P2æ»¿è¶³Finish[2]ç‚ºFï¼Œä¸”Request2 â‰¤ Workï¼Œâˆ´åˆ°ç¬¬ä¸‰æ­¥é©Ÿ</p></li><li><p>è¨­å®šFinsh[2]ç‚ºTrueï¼Œä¸”Work=(0,1,0)+(3,0,3)=(3,1,3)ï¼Œå›åˆ°ç¬¬ä¸‰æ­¥é©Ÿ</p></li><li><p>åœ¨æ­¥é©ŸäºŒèˆ‡æ­¥é©Ÿä¸‰ä¹‹é–“æŠ½æ’ï¼Œå¾€å¾©å¾ªç’°ï¼ŒP1, P3, P4çš†å¯Finished</p></li><li><p>Check Finish Array âˆµçš†ç‚ºTrueï¼Œâˆ´ç›®å‰ç„¡æ­»çµ</p></li></ol><h2 id=è‹¥æ¯ä¸€é¡å‹è³‡æºè³‡æºçš†ç‚ºsingle-instanceå‰‡æœ‰è¼ƒç°¡åŒ–çš„detectionä½œæ³•-ä½¿ç”¨wait-for-graph>è‹¥æ¯ä¸€é¡å‹è³‡æºè³‡æºçš†ç‚ºSingle-instanceï¼Œå‰‡æœ‰è¼ƒç°¡åŒ–çš„Detectionä½œæ³•-ä½¿ç”¨Wait-For Graph</h2><ul><li>å®šç¾©ï¼šä»¤G=&lt;V,E>æœ‰å‘åœ–ï¼Œä»£è¡¨Wait-For Graphï¼Œå…¶ä¸­</li></ul><ol><li>Vertexï¼šåªæœ‰Process Onlyï¼Œæ²’æœ‰Resourceé ‚é»</li><li>Edgeï¼šPi <code>ç­‰å¾…</code>&mdash;>Pjï¼Œç¨±ä¹‹ç‚ºwait edge</li></ol><ul><li><p><strong>æ˜¯å¾RAGç°¡åŒ–è€Œå¾—</strong>ï¼Œå³è‹¥RAGä¸­å­˜åœ¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>graph LR;
Pi --ç”³è«‹--&gt; R --é…ç½®--&gt; Pj
</code></pre></td></tr></table></div></div><p>å‰‡åœ¨Wait-For Graph ä»¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>graph  LR;
Pi --ç­‰å¾…--&gt; Pj
</code></pre></td></tr></table></div></div><p>å‘ˆç¾</p></li><li><p>åµæ¸¬ä½œæ³•ï¼š<strong>åœ¨Wait-For Graphä¸­ï¼Œè‹¥æœ‰Cycleï¼Œå‰‡ç›®å‰æœ‰æ­»çµï¼Œå¦å‰‡ç›®å‰ç„¡æ­»çµ</strong></p></li><li><p>ä¾‹ï¼šRAGå¦‚ä¸‹</p></li></ul><p><img src=https://i.imgur.com/8OxjTRA.png loading=lazy alt=image-20230115163340361></p><ol><li><p>åŒ–æˆWait-For Graph</p></li><li><p>ç›®å‰æœ‰ç„¡æ­»çµ</p><p>Ans.âˆµæœ‰Cycleï¼Œâˆ´<strong>ç›®å‰æœ‰æ­»çµ</strong></p><p><img src=https://i.imgur.com/Fq0Ku1V.png loading=lazy alt=image-20230115163349303></p></li></ol><h1 id=chapter-6-process-synchronization>Chapter 6 Process Synchronization</h1><p><code>Process Communication</code>,<code>Inter Processes Communication; IPC</code></p><p>Processçš„é—œä¿‚å°±å…©ç¨®</p><ol><li>Independent</li><li><strong>Cooperating</strong>(æœ‰è³‡è¨Šäº¤æ›çš„éœ€æ±‚)</li></ol><p>ä½•è¬‚åŒæ­¥(Synchronization)ï¼ŸProcessåœ¨åŸ·è¡Œçš„éç¨‹ç•¶ä¸­ï¼Œå› ç‚ºæŸä»¶äº‹æƒ…çš„ç™¼ç”Ÿæˆ–æ²’æœ‰ç™¼ç”Ÿï¼Œå°è‡´å®ƒå¿…é ˆåœä¸‹ä¾†ï¼Œç­‰å°æ–¹å®Œæˆï¼Œæ‰å¯ä»¥æ¥è‘—å¾€ä¸‹åšï¼Œç¬¦åˆé€™äº›äº‹æƒ…çš„å°±æ˜¯åŒæ­¥ã€‚</p><blockquote><ul><li><p>Process Communicationå…©å¤§æ–¹å¼</p><ol><li><p>Shared Memory</p></li><li><p>Message Passing</p></li></ol></li><li><p>Race Condition Problem</p></li><li><p>è§£æ±ºRace Conditionä¹‹å…©å¤§ç­–ç•¥</p><ol><li>Disable interrupt</li><li>Critical section design</li></ol></li><li><p>C.S.Design å¿…é ˆæ»¿è¶³çš„3å€‹Criteria(Mutual Exclustion, Progress, Bounded Waiting)</p></li><li><p>C.S Design æ–¹æ³•(æ¶æ§‹)</p><ul><li>SoftWare Solutions</li><li>HardWare Instructions Support(Test-and-Set, SWAP)</li><li><strong>semaphoreâ˜†â˜†â˜†â˜†â˜†</strong>(è™ŸèªŒ)</li><li><strong>Monitor</strong></li><li>è§£æ±ºè‘—åçš„åŒæ­¥å•é¡Œ<ul><li>Producer-Consumer Problem</li><li>Reader/Writer Problem<ol><li>First</li><li>Second</li></ol></li><li>The Sleeping Barber problem</li><li>The Dining-Philosophers Problem</li></ul></li></ul></li><li><p>Message Passing æºé€šæ–¹å¼(è¼ƒå°‘è€ƒ)</p></li></ul></blockquote><h2 id=process-communicationä¹‹å…©å¤§æ–¹å¼>Process communicationä¹‹å…©å¤§æ–¹å¼</h2><h3 id=shared-memoryæœ¬ç¯‡é‡é»>Shared Memory(æœ¬ç¯‡é‡é»)</h3><p>å®šç¾©ï¼šProcessesé€éå…±äº«è®Šæ•¸(shared Variable)ä¹‹å­˜(Write)å–(Read)é”åˆ°æºé€š(Info exchange)ä¹‹ç›®çš„</p><p><img src=https://i.imgur.com/sklBx0M.png loading=lazy alt=image-20230122193004264></p><p>åˆ†æï¼š</p><ol><li><strong>é©ç”¨æ–¼å¤§é‡Data(message)å‚³è¼¸ä¹‹ç‹€æ³</strong></li><li><strong>å‚³è¼¸é€Ÿåº¦è¼ƒå¿«(å› ç‚ºä¸é ˆkernelä»‹å…¥å¹²é /æ”¯æŒï¼ŒShared memoryæ˜¯Programmerçš„è²¬ä»»ï¼ŒProgrammerè¦è² è²¬å»è™•ç†äº’æ–¥çš„å•é¡Œ)</strong></li><li><strong>ä¸é©åˆç”¨æ–¼Distributed System</strong></li><li><strong>Kernelä¸éœ€æä¾›é¡å¤–çš„æ”¯æ´(é ‚å¤šä¾›æ‡‰Shared memory space)</strong></li><li><strong>æ˜¯Programmerçš„è² æ“”ï¼Œå¿…é ˆå¯«é¡å¤–çš„ç¨‹å¼ç¢¼é˜²æ­¢Race Conditionçš„ç™¼ç”Ÿ</strong></li></ol><h3 id=message-passing>Message Passing</h3><p>å®šç¾©ï¼šProcessé›™æ–¹è¦æºé€šå¿…é ˆéµå¾ªä¸‹åˆ—Steps</p><ol><li>å»ºç«‹Communication Link</li><li>è¨Šæ¯å¯é›™å‘å‚³è¼¸</li><li>å‚³è¼¸å®Œç•¢ï¼Œå¿…é ˆRelease</li></ol><p>åˆ†æï¼š</p><ol><li><p><strong>é©ç”¨æ–¼å°‘é‡Data(message)å‚³è¼¸ä¹‹æƒ…æ³</strong></p></li><li><p><strong>å‚³è¼¸é€Ÿåº¦è¼ƒæ…¢(å› ç‚ºéœ€è¦kernelæ”¯æŒ)</strong></p></li><li><p><strong>é©åˆç”¨æ–¼Distribute System</strong></p></li><li><p><strong>Kernelå¿…é ˆæä¾›é¡å¤–çš„æ”¯æ´</strong></p><p><strong>ä¾‹ï¼šsend/recevice system call, Communication Linkç®¡ç†ï¼ŒMessage lostä¹‹åµæ¸¬ã€ä¾‹å¤–ç‹€æ³ä¹‹è™•ç†</strong></p></li><li><p><strong>Programmeræ²’æœ‰ä»€éº¼è² æ“”ï¼Œåªè¦æœƒç”¨send/receiveçš„System Callå°±å¥½</strong></p></li></ol><h2 id=race-condition-problem>Race Condition problem</h2><p>in shared memory Communication</p><p>å®šç¾©ï¼š<strong>In shared memory Communication, è‹¥æœªå°å…±äº«è®Šæ•¸å­˜å–æä¾›ä»»ä½•äº’æ–¥å­˜å–æ§åˆ¶ä¹‹Synchronizationæ©Ÿåˆ¶ï¼Œå‰‡æœƒé€ æˆ"å…±äº«è®Šæ•¸çš„æœ€çµ‚çµæœå€¼æœƒå› ç‚ºProcessä¹‹é–“çš„åŸ·è¡Œé †åºä¸åŒè€Œæœ‰ä¸åŒçš„çµæœå€¼"</strong>ï¼Œæ­¤ç¨®Data inconsistencyæƒ…æ³ï¼Œç¨±ä¹‹ç‚ºRace Condition</p><p>ä¾‹å­ï¼šï¼£æ˜¯å…±äº«è®Šæ•¸ï¼Œåˆå€¼=5ï¼Œæ­¤æ™‚æœ‰2å€‹Process</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>C=C+1</td><td>C=C-1</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table></div><p>Piï¼ŒPjå„åŸ·è¡Œä¸€æ¬¡ï¼Œå‰‡Cçš„æœ€çµ‚å€¼<strong>å¯èƒ½æ˜¯5 or 4 or 6</strong> ï¼Œé€™ç¨®ç¨±ä¹‹ç‚ºRace Condition</p><ul><li><p>çµæœç‚º5ï¼ŒåŸ·è¡Œé †åºå¯èƒ½ç‚º</p><p>T1= Pi = C =C+1</p><p>T2= Pj = C =C -1</p><p>or</p><p>T1 = Pj = C = C - 1</p><p>T2 = Pi = C = C + 1</p></li><li><p>çµæœç‚º4ï¼ŒåŸ·è¡Œé †åºå¯èƒ½ç‚º</p><p>T1ï¼šPiåŸ·è¡ŒC+1ï¼Œå¾—åˆ°6ï¼Œä½†å°šæœªAssignçµ¦Cï¼Œåªæ˜¯å…ˆæ”¾åœ¨ä¸€å€‹ä½”å­˜å™¨</p><p>T2ï¼šPjåŸ·è¡ŒC-1ï¼Œå¾—åˆ°4ï¼Œå°šæœªAssignå›C</p><p>T3ï¼šPi 6 assignå›C</p><p>T4ï¼šPj 4 assignå›C</p><p>Cçš„çµæœç‚º4</p></li><li><p>çµæœç‚º6ï¼ŒåŸ·è¡Œé †åºå¯èƒ½ç‚º</p><p>T1ï¼šPiåŸ·è¡ŒC+1ï¼Œå¾—åˆ°6ï¼Œä½†å°šæœªAssignçµ¦Cï¼Œåªæ˜¯å…ˆæ”¾åœ¨ä¸€å€‹ä½”å­˜å™¨</p><p>T2ï¼šPjåŸ·è¡ŒC-1ï¼Œå¾—åˆ°4ï¼Œå°šæœªAssignå›C</p><p>T3ï¼šPj 4 assignå›C</p><p>T4ï¼šPi 6 assignå›C</p><p>çµæœç‚º6</p></li></ul><p>ç¯„ä¾‹1</p><p>x, y æ˜¯å…±äº«è®Šæ•¸ï¼Œåˆå€¼x=5, y=7</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>x= x+y</td><td>y=x*y</td></tr></tbody></table></div><p>Pi,Pjå„ä½œä¸€æ¬¡ï¼Œæ±‚(x,y)ä¹‹å¯èƒ½å€¼</p><p>Ans.</p><p>(x,y) = (12,84)</p><p>(x,y) = (40,35)</p><p><strong>(x,y) = (12,35)</strong></p><p>ç¯„ä¾‹2</p><p>x=0æ˜¯å…±äº«è®Šæ•¸ï¼Œi æ˜¯å€åŸŸè®Šæ•¸</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>for(i=1;i&lt;=3;i++)x=x+1</td><td>for(i=1;i&lt;=3;i++)x=x+1</td></tr></tbody></table></div><p>Pi,Pjå„ä½œä¸€æ¬¡ï¼Œæ±‚(x)ä¹‹å¯èƒ½å€¼</p><p>æç¤º</p><div class=table-wrapper><table><thead><tr><th></th><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>ç¬¬ä¸€æ¬¡</td><td>x=x+1</td><td>x=x+1</td></tr><tr><td>ç¬¬äºŒæ¬¡</td><td>x=x+1</td><td>x=x+1</td></tr><tr><td>ç¬¬ä¸‰æ¬¡</td><td>x=x+1</td><td>x=x+1</td></tr></tbody></table></div><p>Ans.(3,4,5,6)</p><p>ç¯„ä¾‹3</p><p>x=0æ˜¯å…±äº«è®Šæ•¸ï¼Œi æ˜¯å€åŸŸè®Šæ•¸</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>for(i=1;i&lt;=3;i++)x=x+1</td><td>for(i=1;i&lt;=3;i++)x=x-1</td></tr></tbody></table></div><p>Pi,Pjå„ä½œä¸€æ¬¡ï¼Œæ±‚(x)ä¹‹å¯èƒ½å€¼</p><p>(-3,-2,-1,0,1,2,3)</p><h2 id=è§£æ±ºrace-conditionä¹‹å…©å¤§ç­–ç•¥>è§£æ±ºRace Conditionä¹‹å…©å¤§ç­–ç•¥</h2><h3 id=disable-interrupt>Disable Interrupt</h3><p><code>å°CPUä¸‹æ‰‹</code></p><p>å®šç¾©ï¼š<strong>Processåœ¨å°å…±äº«è®Šæ•¸å­˜å–ä¹‹å‰ï¼Œå…ˆDisable Interruptï¼Œç­‰åˆ°å®Œæˆå…±äº«è®Šæ•¸çš„å­˜å–å¾Œå†æ‰Enable Interruptã€‚å¦‚æ­¤ä¸€ä¾†å¯ä»¥ä¿è­‰Processåœ¨å­˜å–å…±äº«è®Šæ•¸çš„æœŸé–“CPUä¸æœƒè¢«Preempted</strong>ï¼Œå³æ­¤ä¸€å­˜å–æ˜¯<strong>Atomically Executed</strong></p><p>ä¾‹</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>&mldr;Disable interrupt</td><td>&mldr; Disable Interrupt</td></tr><tr><td>C=C+1</td><td>C=C-1</td></tr><tr><td>Enable Interrupt &mldr;</td><td>Enable Interrupt &mldr;</td></tr></tbody></table></div><p>å„ªé»ï¼š</p><ol><li>Simple, Easy implementation</li><li>é©ç”¨æ–¼Uniprocessor System(å–®ä¸€CPU)</li></ol><p>ç¼ºé»ï¼š</p><ol><li>ä¸é©åˆç”¨æ–¼Multiprocessorçš„ç³»çµ±ç•¶ä¸­ï¼Œ<strong>åªDisable å–®ä¸€CPUçš„Interruptï¼Œæ˜¯ç„¡æ³•é˜²æ­¢Race Condition</strong>(å› ç‚ºå…¶ä»–CPUsä¸ŠåŸ·è¡Œçš„Processä»å¯å­˜å–å…±äº«è®Šæ•¸)ï¼Œå¿…é ˆè¦Disableæ‰<strong>å…¨éƒ¨çš„</strong>CPU&rsquo;s Interruptæ‰å¯é˜²æ­¢Race Conditionï¼Œä½†é€™æ¨£æœƒå¤§å¹…é™ä½Performance(å› ç‚ºç„¡æ³•å¹³è¡ŒåŸ·è¡Œ)</li><li>é¢¨éšªå¾ˆé«˜ï¼Œå› ç‚ºå¿…é ˆä¿¡ä»»user processåœ¨Disable interruptå¾Œï¼Œåœ¨å¾ˆçŸ­çš„æ™‚é–“å¯ä»¥åœ¨Enable Interruptï¼Œå¦å‰‡CPU never come back to kernelã€‚<strong>æ³¨æ„ï¼Œé€šå¸¸Disable Interruptåšæ³•æ˜¯ä¸æœƒé–‹æ”¾çµ¦user Processçš„ï¼Œå®ƒé€šå¸¸åªå­˜åœ¨æ–¼kernelçš„è£½ä½œä¸­</strong>(åªæœ‰OS Developerså¯ä»¥ç”¨ï¼Œå› ç‚ºé–‹ç™¼è€…ä¹Ÿè¦é¿å…kernelå…§éƒ¨çš„Race Condition)</li></ol><h3 id=critical-sectionè‡¨ç•Œå€é–“-design>Critical section(è‡¨ç•Œå€é–“) Design</h3><p><code>å°å…±äº«Dataä¸‹æ‰‹</code></p><p><code>æé¾èª¤ç”¨Spinlock, Busy-waiting</code></p><p><code>æ˜¯ä¸€å€‹æ¦‚å¿µ</code></p><p>å®šç¾©ï¼šå°<strong>å…±äº«è®Šæ•¸ä¹‹å­˜å–</strong>é€²è¡Œç®¡åˆ¶ï¼Œç•¶Piå–å¾—å…±äº«è®Šæ•¸å­˜å–æ¬Šåˆ©ï¼Œåœ¨å®ƒå°šæœªå®Œæˆçš„æœŸé–“ï¼Œå³ä½¿åˆ¥çš„Processå–å¾—CPUï¼Œä»»ä½•å…¶ä»–Processä¹Ÿç„¡æ³•å­˜å–å…±äº«è®Šæ•¸ã€‚</p><ul><li><p>Critiacal Sectionï¼šProcessä¸­å°å…±äº«è®Šæ•¸é€²è¡Œå­˜ã€å–çš„æ•˜è¿°ä¹‹é›†åˆ</p></li><li><p>Remainder Section(RS)ï¼šProcessä¸­é™¤äº†Critical Sectionä»¥å¤–çš„å€é–“ï¼Œçµ±ç¨±ç‚ºRemainder Section</p></li><li><p>Processå…§å®¹ï¼š</p><p><img src=https://i.imgur.com/wnFMYbJ.png loading=lazy alt=image-20230123191840993></p><p>æ¯å€‹CSçš„å‰å¾Œï¼ŒProgrammeré ˆè¨­è¨ˆ/åŠ å…¥é¡å¤–çš„æ§åˆ¶ç¢¼ï¼Œå«Entity Sectionï¼Œå³Exit Section</p></li><li><p>è€Œ<strong>CS Designä¸æ˜¯åœ¨è¨­è¨ˆè‡¨ç•Œå€é–“ï¼Œå› ç‚ºè‡¨ç•Œå€é–“æ˜¯å€‹æ¦‚å¿µï¼ŒCS Designæ˜¯åœ¨è¨­è¨ˆEntry SecåŠExit Secçš„Code</strong></p></li><li><p><code>ä¸€å€‹processå¯ä»¥æ“æœ‰ä¸åªä¸€å€‹CS åªæ˜¯ç¯„ä¾‹éƒ½æ˜¯åªç•«ä¸€å€‹è€Œå·²ï¼Œè¦æ³¨æ„</code>,<code>é€²å…¥C=C+1å¾Œï¼ŒCPUå¯ä»¥è¢«Pjæ¶èµ°ï¼Œä½†Pjæƒ³è¦å°Cæ“ä½œæ™‚ï¼ŒPjçš„Enrty Sectionå°±æœƒæŠŠå®ƒæ“‹ä¸‹ä¾†ã€‚</code><img src=https://i.imgur.com/EMZilhy.png loading=lazy alt=image-20230123193312033></p></li><li><p>C.S Design èˆ‡ Disable Interruptç›¸æ¯”(spinlock, Busy waiting)</p><p>å„ªé»ï¼šé©ç”¨æ–¼Multiprocessors system</p><p>ç¼ºé»ï¼š</p><ol><li>è¨­è¨ˆè¼ƒç‚ºè¤‡é›œ</li><li>è¼ƒä¸é©åˆç”¨åœ¨uniprocessor</li></ol></li></ul><h2 id=busy-waiting-skillor-spinlock>Busy-Waiting Skill(or Spinlock)</h2><ul><li>å®šç¾©ï¼šé€éä½¿ç”¨loopingç›¸é—œæ•˜è¿°(eg. for, while, repeat &mldr; util)ï¼Œé”åˆ°è®“process<strong>æš«æ™‚ç­‰å¾…ä¹‹æ•ˆæœ</strong></li></ul><p>ä¾‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-python data-lang=python><span class=k>while</span><span class=p>(</span><span class=err>æ¢ä»¶å¼</span><span class=p>){</span>
    <span class=o>//</span><span class=err>ä¸åšäº‹ï¼Œåªæ˜¯è®“å®ƒè·‘</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>ç•¶æ¢ä»¶å¼ç‚ºTrueæ™‚ï¼Œprocesså°±è¢«å¡åœ¨whileä¸­ï¼Œç„¡æ³•é›¢é–‹whileï¼Œå¦‚æ­¤é”åˆ°Processæš«åœçš„æ•ˆæœï¼Œç›´åˆ°æ¢ä»¶å¼è®Šç‚ºFalseï¼Œprocessæ‰æœƒé›¢é–‹whileï¼Œå¾€ä¸‹åŸ·è¡Œã€‚</p><p>Noteï¼š</p><ol><li><img src=https://i.imgur.com/9OPWIvY.png loading=lazy alt=image-20230125012255548></li><li>[æ]èª¤ç”¨ï¼šå› ç‚ºåœ¨C.S Design Entry sectionä¸­ç¶“å¸¸æ˜¯ä½¿ç”¨Busy waitingçš„æŠ€å·§(æˆ–å«Spinlock)ï¼Œå› æ­¤æé¾æœƒæŠŠspinlock & busy waiting è¦–ä½œC.S Designï¼Œä¾†å»è·ŸDisable Interruptæ¯”è¼ƒ</li></ol><ul><li><p>åˆ†æï¼š</p><p>ç¼ºé»ï¼š<strong>ç­‰å¾…ä¸­çš„Processï¼Œæœƒè·Ÿå…¶ä»–çš„Processesç«¶çˆ­CPUï¼Œå°‡æ¶åˆ°çš„CPU timeæµªè²»æ‰ï¼Œç”¨æ–¼åšç„¡å¯¦è³ªé€²å±•çš„è¿´åœˆæ¸¬è©¦ä¸Š</strong>ã€‚å› æ­¤ï¼Œè‹¥æ­¤Processè¦ç­‰å¾ˆé•·çš„æ™‚é–“æ‰èƒ½exitè¿´åœˆï¼Œå‰‡<strong>æ­¤èˆ‰éå¸¸æµªè²»CPU time</strong></p><p>å„ªé»ï¼šè‹¥Processå¡åœ¨Loopçš„æ™‚é–“å¾ˆçŸ­(i.e å°æ–¼Context Switcing time)ï¼Œå‰‡Spinlockååˆ†æœ‰åˆ©ï¼Œå› ç‚ºLoopçš„æ™‚é–“å¾ˆçŸ­ï¼Œæµªè²»çš„æ™‚é–“ä¹Ÿä¸æœƒå¤ªçŸ­ã€‚</p></li><li><p>å¦ä¸€ç¨®Non-Busy-waiting Skill</p><p>å®šç¾©ï¼šç•¶Processå› ç‚ºåŒæ­¥äº‹ä»¶è¢«å¡ä½ï¼Œä¸”å¦‚è¦å¡å¾ˆä¹…çš„æ™‚é–“ï¼Œ<strong>å‰‡å¯ä»¥ä½¿ç”¨Block(p)çš„System call</strong>ï¼Œå°‡pæš«åœï¼Œå³è®“pé€²å…¥Blockedçš„ç‹€æ…‹ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼ŒPå°±ä¸æœƒèˆ‡å…¶ä»–Processesç«¶çˆ­CPUï¼Œç›´åˆ°åŒæ­¥äº‹ä»¶ç™¼ç”Ÿäº†ï¼Œæ‰wakeup(p) system callï¼Œå°‡På¾blockedè®Šæˆready stateã€‚</p><p><img src=https://i.imgur.com/03E2Ny9.png loading=lazy alt=image-20230125020111751></p><p>å„ªé»ï¼š<strong>ç­‰å¾…ç•¶ä¸­çš„Processä¸æœƒèˆ‡åˆ¥äººç«¶çˆ­CPUï¼Œä¸æœƒæµªè²»CPU Time</strong></p><p>ç¼ºé»ï¼šé¡å¤–ä»˜å‡ºContext Switchçš„äº‹ä»¶<code>å¹¹ é€™çœŸçš„ç®—ç¼ºé»å—</code></p></li></ul><h2 id=cs-designæ‡‰è©²æ»¿è¶³çš„3å€‹æ€§è³ª>C.S Designæ‡‰è©²æ»¿è¶³çš„3å€‹æ€§è³ª</h2><ol><li>Mutual exclusion</li><li>Progress</li><li>Bounded waiting</li></ol><p>åˆ†è¿°å¦‚ä¸‹</p><h3 id=mutual-exclusionç›¸äº’æ’æ–¥>Mutual exclusion(ç›¸äº’æ’æ–¥)</h3><p>å®šç¾©ï¼šæœ€é‡è¦çš„ä¸€é»ï¼Œå¦‚æœæ²’é€™é»çš„è©±è«‡å€‹å±çš„C.S Designï¼ŒRace Conditionéƒ½è™•ç†ä¸äº†äº†ã€‚åœ¨ä»»ä½•æ™‚é–“é»ï¼Œæœ€å¤šåªå…è¨±ä¸€å€‹Processé€²å…¥å®ƒè‡ªå·±çš„CSï¼Œä¸å¯æœ‰å¤šå€‹Processåˆ†åˆ¥é€²å…¥"å„è‡ª"çš„CS</p><p><img src=https://i.imgur.com/h07zzPH.png loading=lazy alt=image-20230125023324542></p><h3 id=progressé€²å±•>Progress(é€²å±•)</h3><ul><li>å®šç¾©ï¼šé ˆ<strong>æ»¿è¶³ä»¥ä¸‹å…©é»æ‰ç®—Progress</strong><ol><li>ä¸æƒ³é€²å…¥C.Sçš„Process(äº¦å³åœ¨Ramaid Sectionæ´»å‹•)ï¼Œä¸å¯ä»¥é˜»ç¤™å…¶ä»–Processé€²å…¥C.S(æˆ–ä¸åƒèˆ‡é€²å…¥C.Sä¹‹æ±ºç­–)<code>ä¸æƒ³é€²å»çš„processä¸æœƒé˜»ç¤™åˆ¥äººé€²å…¥</code></li><li><strong>å¾é‚£äº›æƒ³é€²å…¥C.Sçš„Processesä¸­ï¼Œæ±ºå®šèª°å¯ä»¥é€²å…¥C.Sçš„æ±ºç­–æ™‚é–“æ˜¯æœ‰é™çš„(ä¸å¯ä»¥ç„¡çª®ï¼Œä¹Ÿå°±æ˜¯No Deadlock likes waitgin forever å¤§å®¶éƒ½ç„¡æ³•é€²å…¥CS)</strong></li></ol></li></ul><h3 id=bounded-waitingæœ‰é™çš„ç­‰å¾…>Bounded waiting(æœ‰é™çš„ç­‰å¾…)</h3><ul><li>å®šç¾©ï¼šä»¥å€‹åˆ¥processçš„è§’åº¦ä¾†çœ‹ï¼Œè‡ªæŸprogressæå‡ºç”³è«‹åˆ°æ ¸å‡†é€²å…¥C.Sçš„ç­‰å¾…æ™‚é–“æ˜¯<strong>æœ‰é™çš„</strong>ï¼Œå³è‹¥æœ‰nå€‹Processæƒ³é€²å…¥CSï¼Œå‰‡ä»»ä¸€Processè‡³å¤šç­‰(n-1)æ¬¡å¾Œï¼Œå³å¯é€²å…¥CSï¼Œå³<strong>No Startvation</strong>ï¼Œ<strong>é ˆå…¬å¹³å°å¾…</strong></li></ul><h2 id=cs-designçš„æ–¹æ³•æ¶æ§‹åœ–é‡è¦>C.S Designçš„æ–¹æ³•(æ¶æ§‹åœ–)é‡è¦</h2><div class=table-wrapper><table><thead><tr><th></th><th style=text-align:left></th><th>é—œæ³¨çš„ç„¦é»</th><th>è£œå……</th></tr></thead><tbody><tr><td>é«˜éš</td><td style=text-align:left>Monitorå®šç¾©ã€æ‡‰ç”¨ã€ç¨®é¡ã€è£½ä½œæ–¹å¼</td><td>åŒæ­¥å•é¡Œä¹‹è§£æ±º(<strong>æ‡‰ç”¨</strong>)</td><td></td></tr><tr><td>ä¸­éš</td><td style=text-align:left>Semaphore(è™ŸèªŒ)å®šç¾©ã€æ‡‰ç”¨ã€ç¨®é¡ã€è£½ä½œæ–¹å¼</td><td>C.S Degignæ­£ç¢ºèˆ‡å¦ï¼ŒåŒæ­¥å•é¡Œä¹‹è§£æ±º</td><td></td></tr><tr><td>åŸºç¤</td><td style=text-align:left>Software solutions, Hardware Insturctions support</td><td>C.S Degignæ­£ç¢ºèˆ‡å¦</td><td>åŒä½éšçš„é‚„æœ‰Disable Interrupt</td></tr></tbody></table></div><h2 id=software-solutions>Software Solutions</h2><ul><li><p>ç‰¹è‰²</p><ol><li><p>2å€‹Processes(Pi,Pj)(P0,P1)</p><blockquote><p>Algo1 x</p><p>Algo2 x</p><p>Algo3 o = Peterson&rsquo;s solution</p></blockquote></li><li><p>nå€‹Processes</p><blockquote><p>Peterson&rsquo;s Solution(nå€‹Processes)[ä¸å¤ªæœƒè€ƒäº†ï¼Œå› ç‚ºçœŸçš„å¾ˆçˆ›]</p><p><strong>Bankery&rsquo;s Algo</strong>[éºµåŒ…åº—å–è™Ÿç¢¼ç‰Œçš„æ¼”ç®—æ³•ï¼Œæé¾ç§»æ‰äº†ï¼Œä½†çœŸçš„å¾ˆé‡è¦ï¼Œè¦å­¸]</p></blockquote></li></ol></li></ul><h2 id=2å€‹processesä¹‹cs-designpipjij>2å€‹Processesä¹‹C.S Design(Pi,Pj,iâ‰ j)</h2><h3 id=algo1>Algo1</h3><ol><li><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>turn: int å€¼ç‚ºiæˆ–ç‚ºj
æ„ç¾©ï¼šæ¬Šæ–ï¼Œturnå€¼ç‚ºiï¼Œå°±æ˜¯åªèƒ½è®“Pié€²å…¥(åªæœ‰Piæœ‰è³‡æ ¼é€²å…¥)ï¼Œåä¹‹äº¦ç„¶
</code></pre></td></tr></table></div></div></li><li><p>ç¨‹å¼</p></li></ol><p><img src=https://i.imgur.com/hIwkE4O.png loading=lazy alt=image-20230125222327372></p><ol start=3><li></li></ol><div class=table-wrapper><table><thead><tr><th>CS Designè¦æ»¿è¶³çš„æ¢ä»¶</th><th>æ»¿è¶³èˆ‡å¦</th><th>è§£æ</th></tr></thead><tbody><tr><td>Mutual Exclusion</td><td>O</td><td>å› ç‚ºturnå€¼ä¸æœƒåŒæ™‚ç‚ºiä¸”ç‚ºjï¼Œåªæœƒç‚ºiæˆ–jçš„å…¶ä¸­ä¸€å€‹ï¼Œå› æ­¤åªæœ‰Piæˆ–Pjå…¶ä¸­ä¸€å€‹å¯ä»¥é€²å…¥CSï¼Œä¸æœƒå…©å€‹åŒæ™‚é€²å…¥C.S</td></tr><tr><td>Progress</td><td>X</td><td>å‡è¨­ç›®å‰Piåœ¨RS(Piä¸æƒ³é€²å…¥CS)ï¼Œä¸”Turnå€¼ç‚ºiï¼Œè‹¥æ­¤æ™‚Pjæƒ³é€²å…¥CSå»ç„¡æ³•é€²å…¥ï¼Œè¢«Pié˜»ç¤™ï¼Œå› ç‚ºå”¯æœ‰ä»°è³´Piæ‰èƒ½å°‡Turnçš„å€¼æ”¹ç‚ºjï¼ŒPjæ‰èƒ½é€²å…¥CSï¼Œä½†æ­¤æ™‚Piä¸¦ä¸æœƒå»åšæ­¤è¨­å®š</td></tr><tr><td>Bounded Waiting</td><td>O</td><td>å‡è¨­ç›®å‰turnç‚ºiï¼Œä¸”Piå·²å…ˆæ–¼Pjé€²å…¥CSï¼Œè€ŒPjç­‰å¾…ä¸­ï¼Œç•¶Pié›¢é–‹CSå¾Œï¼Œåˆç«‹åˆ»æƒ³å†é€²å…¥CSï¼Œä½†å› Piæœƒåœ¨é›¢é–‹CSå¾Œï¼Œå°‡turnçš„å€¼è¨­ç‚ºjï¼Œä½¿å¾—Piç„¡æ³•å…ˆæ–¼Pjé€²å…¥CSï¼Œæ‰€ä»¥Pjè‡³å¤šç­‰ä¸€æ¬¡å¾Œå³å¯é€²å…¥CS</td></tr></tbody></table></div><h3 id=algo2>Algo2</h3><ol><li><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>flag[i..j] of boolean;
åˆå€¼çš†ç‚ºFalse
æ„ç¾©ï¼šflag[i] ={
True:Piæœ‰æ„é€²C.S
False:Piç„¡æ„é€²C.S
}
</code></pre></td></tr></table></div></div></li><li><p>ç¨‹å¼ï¼š</p><p><img src=https://i.imgur.com/efUReYc.png loading=lazy alt=image-20230126182421298></p></li><li><p>åˆ†æ</p></li></ol><div class=table-wrapper><table><thead><tr><th>CS Designè¦æ»¿è¶³çš„æ¢ä»¶</th><th>æ»¿è¶³èˆ‡å¦</th><th>è§£æ</th></tr></thead><tbody><tr><td>Mutual Exclusion</td><td>O</td><td>å…©å€‹äººç¢ºå¯¦éƒ½ä¸æœƒåŒæ™‚é€²å»ï¼Œä½†æœ‰å¯èƒ½æœƒå…©å€‹éƒ½æƒ³é€²å»ï¼Œå¡ä½å½¼æ­¤ï¼Œåƒç…§ä¸‹é¢</td></tr><tr><td>Progress</td><td>X</td><td>ç¬¬äºŒé»ä¸ç¬¦åˆï¼Œæœƒ<strong>å½¢æˆDeadlock</strong>ï¼ŒPi,Pjå¯èƒ½æ¥ç„¡æ³•é€²å…¥C.S<code>è§£æåœ¨ä¸‹é¢</code></td></tr><tr><td>Bounded Waiting</td><td>O</td><td>å…©å€‹éƒ½é€²ä¸å»ï¼Œæ˜¯deadlockï¼Œä¸æ˜¯stravation</td></tr></tbody></table></div><p>è§£æï¼š<img src=https://i.imgur.com/RJq3tIi.png loading=lazy alt=image-20230126183442922></p><h3 id=algo3>Algo3</h3><p><code>Peterson's solution</code></p><p><code>æ··åˆAlgo1,Algo2åšæ’’å°¿ç‰›ä¸¸</code></p><p>algo1åªè€ƒæ…®èª°æœ‰è³‡æ ¼ï¼Œæ²’è€ƒæ…®æ„é¡˜ã€‚algo2åªè€ƒé‡æ„é¡˜ï¼Œä½†æœƒé€ æˆæ­»çµã€‚å› æ­¤çµåˆç™¾å®¶ä¹‹é•·ï¼Œä¸åªè€ƒé‡è³‡æ ¼ä¹Ÿè€ƒé‡æ„é¡˜</p><ol><li><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><ol><li>Flag[i&mldr;j] of Booleanåˆå€¼çš†ç‚ºFalse <code>è¡¨æ„é¡˜</code></li><li>Turnï¼šå€¼ç‚ºiæˆ–j only <code>è¡¨è³‡æ ¼</code></li></ol></li><li><p>ç¨‹å¼</p><p><img src=https://i.imgur.com/RdgEoJs.png loading=lazy alt=image-20230126220525905></p></li><li><p>åˆ†æ</p><div class=table-wrapper><table><thead><tr><th>CS Designè¦æ»¿è¶³çš„æ¢ä»¶</th><th>æ»¿è¶³èˆ‡å¦</th><th>è§£æ</th></tr></thead><tbody><tr><td>Mutual Exclusion</td><td>O</td><td><code>ç›¸äº’æ’æ–¥ï¼Œä¸æœƒæœ‰å…©å€‹processåŒæ™‚é€²å…¥C.S</code>ï¼šè‹¥Piï¼ŒPjçš†æƒ³é€²å…¥C.Sï¼Œä»£è¡¨flag[i]è·Ÿflag[j]çµç‚ºTrueï¼Œ ç•¶é›™æ–¹çš†åšåˆ°whileæ¸¬è©¦çš„æ™‚å€™(ä¹Ÿå°±æ˜¯äº¤éŒ¯)ï¼Œè¡¨ç¤ºé›™æ–¹å·²åˆ†åˆ¥åŸ·è¡ŒéTurn=i, Trun=jä¹‹è¨­å®šï¼Œå·®åˆ¥åªæ˜¯å…ˆå¾Œé †åºä¸åŒè€Œå·²ã€‚<strong>è‹¥PiåŸ·è¡Œæ¯”è¼ƒå¿«ï¼ŒæŠŠTurnæ”¹æˆJï¼Œæ¥è‘—Pjå› ç‚ºåŸ·è¡Œæ¯”è¼ƒæ…¢ï¼ŒåˆæŠŠTurnæ”¹æˆiï¼Œæ‰€ä»¥Turnçš„å€¼åªæœƒç‚ºi(æˆ–jå…¶ä¸­ä¸€å€‹)ï¼Œä¸æœƒåŒæ™‚ç‚ºå…©è€…</strong>ï¼Œæ‰€ä»¥åªæœ‰Piæˆ–Pjä¸€å€‹Processå¾—ä»¥é€²å…¥CSï¼Œå› æ­¤ç¬¦åˆMutual Exclustion</td></tr><tr><td>Progress</td><td>O</td><td>å› ç‚ºprogressæœ‰å…©å€‹æƒ…æ³ï¼Œå› æ­¤åˆ†åˆ¥è¨è«–ä¹‹ã€‚<br>1.<code>ä¸æƒ³é€²å»çš„processä¸æœƒé˜»ç¤™åˆ¥äººé€²å…¥</code>ï¼š å‡è¨­turnå€¼ç‚ºiï¼Œä¸”Piä¸æƒ³é€²å…¥C.Sï¼Œä»£è¡¨Flag[i]ç‚ºFalseï¼Œè‹¥æ­¤æ™‚Pjæƒ³é€²å»å‰‡Pjå¿…å¯é›¢é–‹while(å› ç‚ºFlag[i]==False)ï¼Œ<strong>è€Œé€²å…¥CSï¼Œå› ç‚ºPiä¸æœƒé˜»ç¤™Pjé€²CS</strong><br>2.<code>ä¸ç”¢ç”ŸDeadlock</code>ï¼šè‹¥Pi,Pjçš†æƒ³é€²å…¥C.Sï¼Œå‰‡åœ¨æœ‰é™çš„æ™‚é–“å…§å¿…å¯æ±ºå®šå‡ºTurnå€¼ç‚ºiæˆ–ç‚ºjï¼Œè®“Pi or Pjé€²å…¥ï¼Œå…©è€…ä¸æœƒwaiting forever</td></tr><tr><td>Bounded Waiting</td><td>O</td><td><code>å…ˆé€²å»çš„processå‡ºä¾†å¾Œï¼Œä¸æœƒç«‹åˆ»å†é€²å»ï¼Œäº¦å³ä¸æœƒæœ‰Starvationçš„æƒ…å½¢</code>ï¼šå‡è¨­turnç‚ºiï¼ŒPiå·²å…ˆæ–¼Pjé€²å…¥CSï¼Œè€ŒPjç­‰å¾…é€²å…¥ä¸­ï¼ŒFlag[i]==[j]==Trueï¼Œè‹¥Pié›¢é–‹CSä¹‹å¾Œï¼Œåˆç«‹åˆ»æƒ³é€²å…¥CSï¼Œå‰‡Piå¿…å®šæœƒåšä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯**~~æŠŠFlag[i]è‡ªå·±è¨­ç‚ºFalse~~ï¼ŒæŠŠTurnè¨­æˆ=j**ï¼Œä¸€å®šæ˜¯Pjé€²å…¥CSï¼Œå› ç‚ºPjè‡³å¤šç­‰ä¸€æ¬¡å¾Œå³å¯é€²å…¥CSã€‚</td></tr></tbody></table></div></li></ol><h2 id=nå€‹processes-cs-design>Nå€‹Processes C.S Design</h2><h3 id=bankerys-algoéºµåŒ…åº—å–è™Ÿç¢¼ç‰Œ>Bankery&rsquo;s Algo(éºµåŒ…åº—å–è™Ÿç¢¼ç‰Œ)</h3><p><code>è§£æ±ºRace Condition</code></p><ul><li><p>è§€å¿µï¼š</p><ol><li><strong>å®¢äºº(Process)è¦å…ˆå–å¾—è™Ÿç¢¼ç‰Œï¼Œæ‰å¯å…¥åº—å…§(CS)</strong></li><li><strong>åº—å…§(CS)ä¸€æ¬¡åªå®¹ä¸€äºº(Process)é€²å…¥</strong></li><li><strong>è™Ÿç¢¼æœ€å°çš„å®¢äººæˆ–åŒç‚ºæœ€å°è™Ÿç¢¼ä¹‹å¤šå€‹å®¢äººä¸­IDæœ€å°çš„(PID)ï¼Œå¾—ä»¥å„ªå…ˆé€²å…¥åº—(CS)</strong></li></ol></li><li><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹ï¼š</p><ol><li><p>Choosing[0&mldr;n-1] of Boolean åˆå€¼çš†ç‚ºFalseã€‚</p><p>æ„ç¾©ï¼šchoosing[i]=</p><ul><li>Trueï¼š<strong>Piæ­£åœ¨å–å¾—è™Ÿç¢¼ç‰Œ</strong>ï¼Œå°šæœªç¢ºå®šè™Ÿç¢¼</li><li>Falseï¼š<ul><li>Piå–å¾—è™Ÿç¢¼ç‰Œ</li><li>åˆå€¼</li></ul></li></ul></li><li><p>Number [0&mldr;n-1] of int ä»£è¡¨è™Ÿç¢¼ç‰Œ</p><p>æ„ç¾©ï¼šä»£è¡¨P0~Pn-1ï¼Œnå€‹Processä¹‹<strong>è™Ÿç¢¼ç‰Œå€¼</strong>ï¼Œåˆå€¼çš†ç‚º0ã€‚</p><p>number[i]ï¼š</p><ul><li>0ï¼šè¡¨Pi<strong>ç„¡æ„é¡˜</strong>é€²å…¥CS</li><li>.<strong>>0ï¼šè¡¨Piæœ‰æ„é¡˜é€²å…¥CS</strong></li></ul></li><li><p>æ•¸å­¸å‡½æ•¸used</p><ol><li>MAX(&mldr;)ï¼šå–æœ€å¤§å€¼(ç”¨ä¾†<strong>æ±ºå®šè™Ÿç¢¼ç‰Œçš„å€¼</strong>)</li><li>(a,b)&lt;(c,d)è‹¥è¦æˆç«‹ï¼Œå‰‡<strong>å¿…é ˆæ»¿è¶³ä¸‹åˆ—å…©å€‹æ¢ä»¶ä¹‹å…¶ä¸­ä¸€å€‹</strong><ol><li>a&lt;c</li><li>a==c and b&lt;d</li></ol></li></ol></li><li><p>Piä¹‹ç¨‹å¼å¦‚ä¸‹ï¼š</p></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>repeat</span> 
<span class=n>chosing</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span> <span class=n>True</span><span class=p>;</span> <span class=c1>//è¡¨æ˜æ­£åœ¨å–å¾—è™Ÿç¢¼ç‰Œ
</span><span class=c1></span><span class=n>Number</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>MAX</span><span class=p>(</span><span class=n>Number</span><span class=p>[</span><span class=mi>0</span><span class=p>]...[</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span> <span class=c1>//æ±ºå®šè™Ÿç¢¼ç‰Œæ˜¯å¹¾è™Ÿ
</span><span class=c1></span><span class=n>choosing</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span> <span class=n>False</span><span class=p>;</span> <span class=c1>//è¡¨ç¤ºå·²å–å¾—è™Ÿç¢¼ç‰Œ
</span><span class=c1></span>  
<span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span> <span class=c1>// æ­¤for-loopå»æª¢æ¸¬æ‰€æœ‰process
</span><span class=c1></span>  <span class=k>while</span> <span class=p>(</span><span class=n>choosing</span><span class=p>[</span><span class=n>j</span><span class=p>]){</span><span class=k>do</span> <span class=n>noting</span><span class=p>}</span> <span class=c1>//è‹¥åˆ¥äººpjæ­£åœ¨å–è™Ÿç¢¼ç‰Œä¸­ï¼Œå‰‡ç¨ç­‰ä¸€ä¸‹ï¼Œè‹¥éƒ½æ²’æœ‰è¢«å¡ä½ï¼Œå¯ä»¥é †åˆ©è·‘å®Œï¼Œå‰‡é€²å…¥CS
</span><span class=c1></span>  <span class=k>while</span><span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span> <span class=n>and</span> <span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=n>j</span><span class=p>)</span><span class=o>&lt;</span><span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>i</span><span class=p>)){</span><span class=k>do</span> <span class=n>noting</span><span class=p>}</span>  <span class=c1>//iä»£è¡¨è‡ªå·±ï¼Œjä»£è¡¨åˆ¥äººã€‚Pjæœ‰æ„é¡˜é€²å…¥CSï¼Œä¸¦å–Pjè™Ÿç¢¼å°æ–¼æˆ‘æˆ–è·Ÿæˆ‘åŒå¥½ï¼ŒPj Id j &lt;Pi ID iï¼Œå‰‡æˆ‘ç­‰å¾…ã€‚
</span><span class=c1></span><span class=p>}</span>
<span class=n>C</span><span class=p>.</span><span class=n>S</span>
<span class=n>Number</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
<span class=n>R</span><span class=p>.</span><span class=n>S</span>
<span class=n>untill</span> <span class=n>False</span>
</code></pre></td></tr></table></div></div></li></ul><h4 id=ç¶“å…¸å•é¡Œ>ç¶“å…¸å•é¡Œ</h4><h5 id=ç‚ºä½•æœƒæœ‰å¾ˆå¤šå€‹processeså–å¾—ç›¸åŒçš„numberå€¼>ç‚ºä½•æœƒæœ‰å¾ˆå¤šå€‹Processeså–å¾—ç›¸åŒçš„Numberå€¼ï¼Ÿ</h5><p>Ans. å‡è¨­MAX(Number [0]~[n-1]å€¼ç‚ºkï¼ŒPi,Pj(iâ‰ j) 2å€‹Processesä¹‹äº¤éŒ¯åŸ·è¡Œé †åºå¦‚ä¸‹ï¼š</p><p><img src=https://i.imgur.com/4yOA23W.png loading=lazy alt=image-20230211150854314></p><h5 id=æ­£ç¢ºæ€§è­‰æ˜>æ­£ç¢ºæ€§è­‰æ˜ï¼Ÿ</h5><p>Ans.</p><ul><li><p>Mutual Exclusionï¼šOK</p><p>Case1. å‡è¨­Numberå€¼çš†ä¸åŒ(>0)ï¼Œå‰‡å…·æœ‰æœ€å°çš„Numberå€¼ä¹‹Processï¼Œå¾—ä»¥å„ªå…ˆé€²å…¥CSï¼Œå…¶é¤˜Process waitè€Œæœ€å°å€¼å¿…å”¯ä¸€</p><p>Case2. æœ‰å¤šå€‹Processeså…·æœ€å°Numberå€¼ï¼Œå‰‡ä»¥Processesä¹‹PIDæœ€å°è€…å¾—ä»¥é€²å…¥CSï¼Œè€ŒProcessIDå…·å‚™Uniqueæ€§è³ªï¼Œå› ç‚ºæœ€å°å€¼å¿…å®šå”¯ä¸€ã€‚</p><p>è—‰ç”±Case1, Case2çŸ¥é“å”¯ä¸€æ€§ç¢ºå®šï¼Œäº’æ–¥ç¢ºä¿</p></li><li><p>Progressï¼šOK</p><p>Case1. å‡è¨­Pjä¸æƒ³é€²å…¥CSï¼Œä»£è¡¨Number[j]ç‚º0ï¼Œè‹¥æ­¤æ™‚Piæƒ³é€²å…¥CSå‰‡Piæª¢æŸ¥åˆ°Pjï¼ŒPiå¿…å®šä¸æœƒè¢«Pjæ‰€é˜»ç¤™ï¼Œå¯ä»¥exits forä¸­ç¬¬äºŒå€‹While(å› ç‚ºwhile(number[j]>0 )ï¼Œé€™å€‹æ¢ä»¶åˆ¤æ–·ä¸æˆç«‹)</p><p>Case2. è‹¥P0~Pn1-1ï¼Œnå€‹Processesçš†æƒ³é€²å…¥CSï¼Œå‰‡åœ¨æœ‰é™çš„æ™‚é–“å…§ï¼Œå¿…æœ‰ä¸€å€‹Proess(å…¶Numberæœ€å°æˆ–åŒè™Ÿä¸­ProcessIDæœ€å°)ï¼Œå¯ä»¥é †åˆ©è·‘å®Œfor loopé€²å…¥CSï¼Œ<strong>å› ç‚ºNo Deadlock</strong></p></li><li><p>Bouned waitingï¼šOK</p><p>Case1. å‡è¨­P0~Pn-1 nå€‹Processesçš†æƒ³é€²å…¥CSï¼Œå¦Piå…·æœ‰æœ€å¤§çš„ï¼Œnumberå€¼ç‚º=K(number[i]=K)ï¼Œå› æ­¤Piæœƒæ˜¯æœ€å¾Œé€²å»çš„ï¼Œå…¶ä»–(n-1)å€‹Processes:Pj(jâ‰ i)ï¼Œå¿…å®šçš†å…ˆæ–¼Pié€²å…¥CSã€‚è‹¥Pjé›¢é–‹C.Så¾Œï¼Œåˆç«‹åˆ»æƒ³å†é€²å…¥C.Sï¼Œå‰‡Pjå–å¾—çš„è™Ÿç¢¼ç‰Œä¹‹å€¼Number[j]å¿…å®šå¤§æ–¼Kï¼Œæ‰€ä»¥Pjä¸æœƒå†åº¦å…ˆæ–¼Pié€²å…¥CSï¼Œå› æ­¤Pié ‚å¤šç­‰(n-1)æ¬¡å¾Œå³å¯é€²å…¥CS</p></li></ul><h5 id=è¨­è¨ˆå•é¡Œ>è¨­è¨ˆå•é¡Œ</h5><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=k>for</span><span class=p>(</span><span class=n>j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>j</span><span class=o>&lt;</span><span class=n>n</span><span class=p>;</span><span class=n>j</span><span class=o>++</span><span class=p>){</span>
    <span class=k>while</span><span class=p>(</span><span class=n>choosing</span><span class=p>[</span><span class=n>j</span><span class=p>]){</span>
       <span class=c1>// do noting
</span><span class=c1></span>    <span class=p>}</span>
    <span class=k>while</span><span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&gt;</span><span class=mi>0</span> <span class=n>and</span> <span class=n>number</span><span class=p>[</span><span class=n>j</span><span class=p>],</span><span class=n>j</span><span class=o>&lt;</span><span class=p>(</span><span class=n>number</span><span class=p>[</span><span class=n>i</span><span class=p>],</span><span class=n>i</span><span class=p>)){</span> <span class=c1>//å•é¡Œï¼Œæ—¢ç„¶é€™é‚Šéƒ½æœƒæŠŠä¸ç¬¦åˆçš„Processæ””ä¸‹ä¾†ï¼Œå¨œä½•é‚„éœ€è¦ä¸Šé¢çš„choosing[j]ä¾†å¡ä½å‘¢?æ˜¯ä¸æ˜¯å¯ä»¥æŠŠchoosing[j]åˆªæ‰ï¼Œé€™æ¨£çš„é‚è¼¯å°å—?æœƒå‡ºç¾ä»€éº¼å•é¡Œå—
</span><span class=c1></span>        <span class=c1>// do noting
</span><span class=c1></span>    <span class=p>}</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>è§£é‡‹ï¼š</p><p>é•åäº†<strong>äº’æ–¥</strong>ã€‚</p><p>ä¾‹ï¼šä»¤ã€€ç›®å‰Number[0,n-1]<code>éƒ½é‚„æ²’é ˜åˆ°è™Ÿç¢¼ç‰Œ</code>å€¼çš†ç‚º0ï¼ŒPiï¼ŒPj2å€‹Processes(iâ‰ j)æƒ³é€²å…¥CSï¼Œä¸”å‡è¨­ProcessIDæ˜¯i&lt;j</p><p><img src=https://i.imgur.com/9MHjI6c.png loading=lazy alt=image-20230211181602704></p><p>â€‹ å°±å¥½æ¯”ä¸€å€‹é˜¿å©†è·Ÿä¸€å€‹å¹´è¼•å¦¹å¦¹ä¸€èµ·å»éºµåŒ…åº—ï¼Œå¹´è¼•äººå…ˆå–å®Œè™Ÿç¢¼ç‰Œï¼Œè€å¤ªå©†é‚„æ²’å–å®Œã€‚é€™æ™‚å€™å¦¹å¦¹é ˜å®Œå¾Œï¼Œè€å¤ªå©†é‚„æ²’é ˜ï¼ŒåŸæœ¬çš„è¨­è¨ˆä¸‹ï¼Œå¦¹å¦¹æœƒç­‰é˜¿å©†é ˜å®Œæ‰åŸ·è¡Œä¸‹ä¸€æ­¥ï¼Œä½†é€™ç¨®æƒ…æ³ä¸‹ï¼Œå³ä½¿é˜¿å©†é‚„æ²’å–ï¼Œå¦¹å¦¹ä¹Ÿæœƒç›´æ¥é€²å…¥éºµåŒ…åº—è£¡ã€‚æ¥è‘—é˜¿å©†å–å®Œè™Ÿç¢¼ç‰Œï¼Œç™¼ç¾è·Ÿå¦¹å¦¹åŒè™Ÿ(Race Condition)ï¼Œæ­¤æ™‚ä»–ä¹Ÿæƒ³é€²å…¥CSï¼Œé€™æ™‚å€™é˜¿å©†çš„èº«åˆ†è­‰è™Ÿç¢¼(UID)æ¯”å¦¹å¦¹å°ï¼Œæ‰€ä»¥é˜¿å©†ä¹Ÿå¯ä»¥é€²å…¥CSï¼Œé€™ç¨®æƒ…æ³ä¸‹ï¼Œæœ‰å…©å€‹ProcessåŒæ™‚é€²å…¥CSè£¡ï¼Œé•åäº†äº’æ–¥(Mutual Exclustion)</p><h2 id=hardware-solution---cpu-instructions-support>Hardware Solution - CPU Instructions Support</h2><p>è‹¥CPUæœ‰æä¾›ä¸‹åˆ—æŒ‡ä»¤ä¹‹ä¸€</p><blockquote><ol><li>Test-and-Set (Lock)</li><li>SWAP(a,b)</li></ol></blockquote><p>å‰‡Programmerå¯ä»¥é‹ç”¨åœ¨CS Design</p><h3 id=test-and-setlock-æŒ‡ä»¤>Test-and-Set(Lock) æŒ‡ä»¤</h3><p>å®šç¾©ï¼šæ­¤CPU Instructionä¹‹åŠŸèƒ½ç‚ºï¼Œå‚³å‡ºLockåƒæ•¸å€¼<code>Lockçš„è³‡æ–™å‹åˆ¥ç‚ºboolean</code>ä¸”å°‡Lockåƒæ•¸è¨­ç‚ºTrue(1)ï¼Œä¸”CPUä¿è­‰æ­¤æŒ‡ä»¤æ˜¯<strong>â˜†â˜†â˜†"Atomically Executed"â˜†â˜†â˜†</strong>ï¼Œ</p><p>ç¯„ä¾‹ï¼šä»¥ï¼£èªè¨€èªªæ˜æ­¤æŒ‡ä»¤åŠŸèƒ½ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=n>Test</span><span class=o>-</span><span class=n>and</span><span class=o>-</span><span class=n>Set</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=n>Lock</span><span class=p>){</span>
    <span class=kt>int</span>  <span class=n>temp</span> <span class=o>=</span> <span class=o>*</span><span class=n>Lock</span><span class=p>;</span>
    <span class=o>*</span><span class=n>Lock</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=k>return</span> <span class=n>temp</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>ç”¨åœ¨C.S Designä¸Š</p><h3 id=algo1ï½˜ä¸å¯ä»¥ç”¨>[Algo1]ï¼šï¼¸ä¸å¯ä»¥ç”¨</h3><ol><li><p>å…±äº«è®Šæ•¸å¦‚ä¸‹ï¼š</p><p>Lockï¼šboolean = False</p></li><li><p>Piç¨‹å¼å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>repeat</span><span class=p>{</span>
    <span class=k>while</span><span class=p>(</span><span class=n>Test</span><span class=o>-</span><span class=n>and</span><span class=o>-</span><span class=n>Set</span><span class=p>(</span><span class=n>Lock</span><span class=p>)){</span>
        <span class=c1>// do nothing
</span><span class=c1></span>    <span class=p>}</span>
    <span class=n>C</span><span class=p>.</span><span class=n>Så€å¡Š</span><span class=p>;</span>
    <span class=n>Lock</span> <span class=o>=</span> <span class=n>False</span><span class=p>;</span>
    <span class=n>R</span><span class=p>.</span><span class=n>S</span><span class=p>;</span>
    <span class=n>Utill</span> <span class=n>False</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div></li><li><p>åˆ†æï¼š</p><ol><li><p><strong>Mutual Exclustionï¼šOK</strong></p><p><img src=https://i.imgur.com/XtJJRuB.png loading=lazy alt=image-20230211192216510></p></li><li><p><strong>Progressï¼šOK</strong></p><ol><li>ä¸æƒ³é€²å»çš„äººå°±å¾…åœ¨RSè£¡é¢ï¼Œä¸æœƒå»æ¶</li><li>é¿å…æ­»çµï¼Œç¸½æœ‰ä¸€å€‹äººæœƒæ¶åˆ°Test-and-Set(Lock)</li></ol></li><li><p><strong>Bounded Waitingï¼šé•å</strong></p><p>å‡è¨­Piå·²å…ˆæ–¼Pjé€²å…¥CSï¼Œä¸”Pjç­‰å¾…ä¸­ï¼Œç•¶Pié›¢é–‹CSå¾Œï¼Œè‹¥æƒ³åœ¨ç«‹åˆ»é€²å»CSï¼Œå‰‡<strong>Piæ˜¯æœ‰æ©Ÿæœƒåœ¨å„ªå…ˆé€²å»æ¶åˆ°Test-and-setä¹‹åŸ·è¡Œ</strong>ï¼Œå› æ­¤Pj æœ‰å¯èƒ½Starvation</p></li></ol></li></ol><h3 id=algo2-ç©©çš„å¯ä»¥ç”¨>[Algo2] ï¼šç©©çš„ï¼Œå¯ä»¥ç”¨</h3><ol><li><p>å…±äº«è®Šæ•¸å¦‚ä¸‹ï¼š</p><ol><li>Lockï¼šboolean = False; <code>Test and Setæœƒç”¨åˆ°çš„è®Šæ•¸</code></li><li>waiting[0 ..n-1] of booleanåˆå€¼çš†ç‚ºFalseï¼Œè‹¥ç‚ºTrueå‰‡ä»£è¡¨æœ‰æ„é€²å…¥å€é–“ï¼Œè‹¥ç‚ºFalseå‰‡ä»£è¡¨åˆå€¼ï¼Œæˆ–æº–å‚™é€²å…¥C.S</li></ol><p>æ„ç¾©ï¼š</p><p>waiting[i]æœ‰å…©ç¨®ï¼Œè‹¥ç‚º</p><p>Trueï¼š<strong>è¡¨Piæœ‰æ„é€²å…¥CSï¼Œä¸”æ­£åœ¨ç­‰å¾…ä¸­</strong></p><p>Falseï¼š<strong>ä»£è¡¨åˆå€¼ï¼Œæˆ–æ˜¯è¡¨ç¤ºPiä¸éœ€è¦å†ç­‰äº†ï¼Œå¯ä»¥é€²å…¥CS</strong></p></li><li><p>Piä¹‹ç¨‹å¼å¦‚ä¸‹ï¼š [034 17 02 CH6 P 6 71æ™‚24åˆ†02ç§’ 17:57]</p><p>å€åŸŸè®Šæ•¸</p><ul><li><p>Keyï¼šboolean;</p></li><li><p>j: int</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>repeat</span>
    <span class=n>waiting</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span><span class=n>True</span><span class=p>;</span> <span class=c1>//Piæœ‰æ„ï¼Œä¸”ç­‰å¾…ä¸­...
</span><span class=c1></span> <span class=n>key</span><span class=o>=</span> <span class=n>True</span><span class=p>;</span>
 <span class=k>while</span><span class=p>(</span><span class=n>waiting</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>&amp;&amp;</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>key</span> <span class=o>=</span> <span class=n>Test</span><span class=o>-</span><span class=n>and</span><span class=o>-</span><span class=n>set</span><span class=p>(</span><span class=n>Lock</span><span class=p>);</span>
    <span class=p>}</span>
<span class=c1>//--------------------åˆ†éš”ç·š--------------
</span><span class=c1>//åœ¨é‚„æ²’é›¢é–‹whileå‰ï¼Œwaiting[i]çš„å€¼ä¸å¯èƒ½ç‚ºFalseï¼ŒProcess i å€‹äººè€Œè¨€ä¸å¯èƒ½æŠŠwaiting[i]å€¼æ”¹æˆFalseé€²å…¥CSã€‚å› æ­¤åªå‰©Keyå¯ä»¥å‹•äº†
</span><span class=c1>// åˆå› TestAndSet(Lock)æ–¹æ³•æœƒè¿”å›Lockçš„Booleanå€¼ï¼Œä¸¦å°‡Lockè¨­ç‚ºTrueï¼Œä¹Ÿå› æ­¤ï¼ŒæƒŸæœ‰ç¬¬ä¸€å€‹æ¶åˆ°CPUçš„Processï¼Œæ‰æœƒæœ‰Falseçš„Keyå€¼
</span><span class=c1></span><span class=n>waiting</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span> <span class=n>False</span><span class=p>;</span> <span class=c1>//â˜†â˜†â˜†â˜†â˜†è¡¨æ˜Piä¸ç”¨ç­‰äº†ï¼Œå¯ä»¥é€²å…¥CSäº†â˜†â˜†â˜†â˜†â˜†
</span><span class=c1></span> <span class=n>C</span><span class=p>.</span><span class=n>S</span><span class=p>;</span>  
    <span class=n>j</span><span class=o>=</span> <span class=p>(</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=n>n</span><span class=p>;</span> <span class=c1>//næ˜¯é™£åˆ—é•·åº¦, j æ˜¯æŒ‡içš„ä¸‹ä¸€å€‹element of array
</span><span class=c1></span> <span class=k>while</span><span class=p>(</span><span class=n>j</span><span class=err>â‰ </span><span class=n>i</span> <span class=o>&amp;&amp;</span> <span class=n>not</span> <span class=n>waiting</span><span class=p>[</span><span class=n>j</span><span class=p>]){</span> <span class=c1>//è‹¥j=iï¼Œå‰‡è¡¨ç¤ºå·²ç¶“ç¹äº†ä¸€åœˆã€‚waitingè¡¨æ„é¡˜ï¼ŒTrueä»£è¡¨æƒ³ï¼ŒFalseä»£è¡¨ä¸æƒ³
</span><span class=c1></span>        <span class=n>j</span><span class=o>=</span><span class=p>(</span><span class=n>j</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=n>n</span><span class=p>;</span> <span class=c1>//æ‰¾å‡ºä¸‹ä¸€å€‹æƒ³é€²å…¥C.Sä¹‹Pj
</span><span class=c1></span>    <span class=p>}</span>
 <span class=k>if</span><span class=p>(</span><span class=n>j</span><span class=o>==</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span> <span class=c1>//æ­é…ä¸‹é¢çš„case2ï¼Œä»£è¡¨éƒ½æ²’äººæƒ³é€²å…¥CSï¼Œä¸¦ä¸”å› ç‚º Test-and-Set(Lock)æœƒå°‡Lockè¨­ç‚ºTrue(å¯åƒç…§ä¸Šé¢)
</span><span class=c1></span>        <span class=n>Lock</span> <span class=o>=</span><span class=n>False</span><span class=p>;</span> <span class=c1>//å› ç‚ºéƒ½æ²’äººæƒ³é€²å»ï¼Œå› æ­¤å°±æŠŠé–æ‰“é–‹
</span><span class=c1></span>    <span class=p>}</span> <span class=k>else</span><span class=p>{</span>
         <span class=n>waiting</span><span class=p>[</span><span class=n>j</span><span class=p>]</span><span class=o>=</span> <span class=n>False</span><span class=p>;</span> <span class=c1>//Pjä¸ç”¨ç­‰äº†ï¼Œæ›ä½ é€²CS 
</span><span class=c1></span>        <span class=p>}</span>
 <span class=n>R</span><span class=p>.</span><span class=n>S</span><span class=p>;</span>
 <span class=n>utill</span> <span class=n>False</span><span class=p>;</span>
       
</code></pre></td></tr></table></div></div><p>Case1.</p><p><img src=https://i.imgur.com/yLoFE11.jpg loading=lazy alt=S__16056339></p><p><img src=https://i.imgur.com/qdgQnel.jpg loading=lazy alt=S__16056339></p><p>Case2ï¼šç•¶PiåŸ·è¡Œå®Œå¾Œï¼Œç™¼ç¾å¤–é¢éƒ½æ²’ä»»ä½•äººæƒ³é€²ä¾†ï¼Œåªå¥½å†æŠŠLockè¨­å›Falseï¼Œä¸€åˆ‡é‡æ–°ReSet</p><p><img src=https://i.imgur.com/5Dc47tS.png loading=lazy alt=image-20230214225719635></p><p><img src=https://i.imgur.com/tRwC3p0.png loading=lazy alt=image-20230214232435547></p></li></ol><p>Q1ï¼šè­‰æ˜æ­£ç¢ºæ€§</p><p>Ansï¼</p><p>[1] Mutual Exclusionï¼šOK</p><p>pfï¼š Piå¯é€²å…¥C.Sä¹‹æ¢ä»¶æœ‰å…©ç¨®å¯èƒ½</p><p>case1. Keyå€¼ç‚ºFalse</p><p>ä»£è¡¨Piæ˜¯ç¬¬ä¸€å€‹æ¶åˆ°Test-and-Set(Lock)åŸ·è¡Œè€…ï¼Œå¦‚æ­¤æ‰èƒ½å°‡Keyæ”¹ç‚ºFalseï¼Œ==<strong>å› æ­¤å”¯ä¸€æ€§ç¢ºç«‹</strong>==</p><p>case2. waiting[i]ç‚ºFalse</p><p>ä»£è¡¨Piåœ¨é›¢é–‹whileä¹‹å‰ï¼Œæ˜¯<strong>ä¸æœƒ</strong>å°‡waiting[i]æ”¹ç‚ºFalse,==<strong>åªæœƒå°‡å®ƒè¨­ç‚ºTrueï¼Œåªæœ‰åœ¨CSçš„Procesç•¶å®ƒé›¢é–‹CSå¾Œï¼Œæ‰èƒ½æ”¹è®Šå…¶ä»–processesä¸­ä¹‹ä¸€å€‹processçš„waitingå€¼è®ŠFalseï¼Œåœ¨CSä¸­çš„Processåªæœ‰ä¸€å€‹ï¼Œå‡ºä¾†CSå¾Œä¹Ÿåªæ”¹è®Šä¸€å€‹Processä¹‹waitingå€¼ç‚ºFalseï¼Œå› æ­¤å”¯ä¸€æ€§ä¹Ÿç¢ºç«‹ã€‚æ›è¨€ä¹‹ï¼Œä¸€å€‹processä¸æœƒè‡ªå·±æŠŠè‡ªå·±çš„waitiingå€¼è¨­æˆFalseï¼Œä¸€å®šéƒ½æ˜¯åˆ¥çš„processä¾†è¨­çš„ï¼Œå› æ­¤å”¯ä¸€æ€§ç¢ºç«‹</strong>==</p><p>å› æ­¤ç”±case1åŠ2å¾—çŸ¥ï¼Œäº’æ–¥æˆç«‹</p><p>[2] Progressï¼šOK</p><p>pfï¼š==<strong>è‹¥Piä¸æƒ³é€²å…¥C.Sï¼Œå…¶waiting[i]ç‚ºFalseï¼Œè€Œä¸”Piä¸æœƒè·Ÿå…¶ä»–Processç«¶çˆ­Test-and-Set(Lock)çš„åŸ·è¡Œ</strong>ï¼Œä¸”å¾CSé›¢é–‹ä¹‹Processï¼Œä¹Ÿä¸æœƒæ”¹è®ŠPiä¹‹waitingå€¼ï¼Œå› æ­¤Piä¸æœƒåƒèˆ‡é€²è¡ŒCSä¹‹æ±ºç­–ã€‚==</p><p>è‹¥nå€‹Processéƒ½æƒ³é€²å…¥CSï¼Œå‰‡åœ¨æœ‰é™çš„æ™‚é–“å…§å¿…å®šæœƒæ±ºå®šå‡ºç¬¬ä¸€å€‹æ¶åˆ°Tetst-and-Set()åŸ·è¡Œï¼Œä¸¦é€²å…¥CSã€‚å®ƒå¾CSé›¢é–‹å¾Œï¼Œä¹Ÿæœƒåœ¨<strong>æœ‰é™çš„</strong>æ™‚é–“å…§è®“ä¸‹ä¸€å€‹æƒ³é€²å…¥CSä¹‹Processé€²å…¥CSæˆ–Lockè¨­Falseã€‚</p><p>==ä¸æœƒæœ‰Deadlock==</p><p>[3]Bounded Waitingï¼šOK</p><p>pfï¼šå‡è¨­P<sub>0</sub>~P<sub>n-1</sub>ç­‰nå€‹Processesçš†æƒ³é€²å…¥C.Sè¡¨ç¤ºwaiting[0]~[n-1]çš†ç‚ºTrue</p><p><img src=https://i.imgur.com/Xk4eZu4.png loading=lazy alt=image-20230216003256885></p><p>ä»¤Piæ˜¯<strong>ç¬¬ä¸€å€‹</strong>æ¶åˆ°Test-and-SetåŸ·è¡Œä¹‹Processï¼Œç‡å…ˆé€²å…¥CSç•¶Pié›¢é–‹CSå¾Œï¼Œæœƒå°‡P<sub>(n+1)%n</sub>ä¹‹waitingå€¼æ”¹ç‚ºFalseï¼Œè®“P<sub>(n+1)%n</sub>é€²å…¥csï¼Œä¾æ­¤é¡æ¨ï¼ŒProcessæœƒä¾P<sub>i</sub>,P<sub>(i+1)%n</sub>,P<sub>(i+2)%n</sub>&mldr;P<sub>(i-1)%n</sub>FIFO é †åºä¾æ“šé€²å…¥CSï¼Œæ•…ä¸æœƒæœ‰Starvation</p><h2 id=swapabæŒ‡ä»¤>SWAP(a,b)æŒ‡ä»¤</h2><ul><li>å®šç¾©ï¼š<strong>æ­¤CPUæŒ‡ä»¤æ˜¯å°‡a,bå…©å€¼äº’æ›ï¼Œä¸”CPUä¿è­‰å®ƒæ˜¯==Atomically executed==</strong></li></ul><p>è‹¥ä»¥Cèªè¨€æè¿°ï¼ŒåŠŸèƒ½å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>swap</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=kt>int</span> <span class=o>*</span><span class=n>b</span><span class=p>){</span>
    <span class=kt>int</span> <span class=n>temp</span> <span class=o>=</span> <span class=o>*</span><span class=n>a</span><span class=p>;</span>
    <span class=o>*</span><span class=n>a</span> <span class=o>=</span> <span class=o>*</span><span class=n>b</span><span class=p>;</span>
    <span class=o>*</span><span class=n>b</span> <span class=o>=</span> <span class=n>temp</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><ul><li>ç”¨åœ¨C.S designä¸Š</li></ul><p>[algo1]ï¼šï¼¸</p><p>å…±äº«è®Šæ•¸å¦‚ä¸‹</p><p>Lockï¼šboolean=False;</p><p>å€åŸŸè®Šæ•¸å¦‚ä¸‹ï¼š</p><p>keyï¼šboolean</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat;
	key=True;
	{repeat;
		swap(Lock,key);
    utill(key==False)} ; //æˆç«‹æ‰é›¢é–‹ 
    C.S
    Lock=False;
    R.S
until False;
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/MBKeMjT.png loading=lazy alt=image-20230216233043091></p><p>åˆ†æï¼š</p><p>[Algo1]åŒTest-and-Set</p><p>Mutual Exclustion= ok</p><p>progress= ok</p><p><strong>Bounded waiting= Noï¼Œåªæœ‰è¨­æˆFalesè€Œå·²ï¼Œé‚„æ˜¯ç„¡æ³•é¿å…ç„¡é™ç­‰å¾…</strong></p><p>[Algo2] æ­£ç¢ºçš„</p><p>å°‡Test-and-setçš„[algo2]ä¸­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>...
while(...){
  // key=test-and-set(Lock);
  swap(Lock,key); //æ”¹æˆé€™æ¨£å³å¯

}
...

</code></pre></td></tr></table></div></div><p>ç¶œåˆç·´ç¿’</p><p>åœ¨Test-and-set[Algo2]ä¸­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>while(waiting[i] and key){
	key = Test-and-Set(Lock);
}
waiting[i] = False; //Piä¸ç”¨ç­‰äº†ï¼Œå¯é€²å…¥CS
CS
</code></pre></td></tr></table></div></div><p>è‹¥æŠŠ<code>waiting[i] = False; </code>é€™è¡Œåˆªæ‰ï¼Œæ­¤è¡Œremovedæ˜¯å¦æ­£ç¢º?explain in details</p><p><img src=https://i.imgur.com/nYiqTti.png loading=lazy alt=image-20230217001954998></p><p>Ans.</p><p><strong>é•åProgress</strong>ï¼Œä¸æƒ³é€²å…¥çš„progressåƒèˆ‡æ±ºç­–ï¼Œä¸¦ä¸”æœƒç™¼ç”Ÿæ­»çµï¼Œå…©ä»¶äº‹æƒ…éƒ½æœƒç™¼ç”Ÿ</p><p><img src=https://i.imgur.com/e6tghIj.png loading=lazy alt=image-20230217005154344></p><h2 id=semaphoreè™ŸèªŒ>Semaphore(è™ŸèªŒ)</h2><p><strong>è£½ä½œSemaphoreçš„ç›®çš„å°±æ˜¯ç‚ºäº†ç¢ºä¿ ï¼Œè™ŸèªŒçš„å€¼ä¸æœƒRace Condition</strong></p><p>å­¸ç¿’åœ°åœ–</p><blockquote><p>å®šç¾©</p><p>æ‡‰ç”¨</p><blockquote><p>CS Design (è‡¨ç•Œå€é–“è¨­è¨ˆ)</p><p>synchronization problem solution(è§£æ±ºåŒæ­¥å•é¡Œ)</p></blockquote><p>ç¨®é¡</p><blockquote><p>Binary semaphore vs counting semaphore</p><p>spinlock semaphore vs non-busy waiting semaphore</p></blockquote></blockquote><ul><li><p>å®šç¾©ï¼šä»¤ï¼³ç‚ºSemaphore typeè®Šæ•¸ï¼Œæ¶æ§‹åœ¨integer typeé‡å°Sï¼Œæä¾›å…©å€‹<strong>Atomica operations</strong></p><ol><li>wait(S)<code>æˆ–P(S)</code> <code>å› ç‚ºæ˜¯è·è˜­äººï¼Œæ‰€ä»¥ç”¨è·è˜­å‘½å</code></li><li>signal(S)<code>æˆ–V(S)</code> <code>å› ç‚ºæ˜¯è·è˜­äººï¼Œæ‰€ä»¥ç”¨è·è˜­å‘½å</code></li></ol><p>å®šç¾©å¦‚ä¸‹</p></li></ul><h3 id=waits>wait(S)ï¼š</h3><p>==è‹¥Sç‚º0å‰‡å¡ä½ï¼Œè‹¥Sä¸ç‚º0å‰‡é€šé==</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>while(Sâ‰¦ï¼){do no-op;} //è‹¥semaphoreçš„å€¼ç‚º0ï¼Œå‰‡å¡åœ¨é€™é‚Š

S=S-1; //é€€å‡ºå¾Œsemaphoreå€¼-1
</code></pre></td></tr></table></div></div><h3 id=signals>signal(S)ï¼š</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>S=S+1;
</code></pre></td></tr></table></div></div><p>noteï¼šå› ç‚ºAtomical, æ‰€ä»¥Sä¸æœƒæœ‰race condition</p><ul><li>æ‡‰ç”¨ï¼šä¸»è¦ç”¨åœ¨CS Designï¼ŒåŠåŒæ­¥å•é¡Œä¹‹è§£æ±º</li></ul><h3 id=cs-designä½¿ç”¨å¦‚ä¸‹><strong>CS Designä½¿ç”¨å¦‚ä¸‹</strong></h3><ol><li><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><p>mutex<code>å¸¸è¦‹çš„è®Šæ•¸åç¨±ï¼Œä»£è¡¨mutual exclustionçš„æ„æ€</code>ï¼šsemaphore= 1; //åˆå€¼ç‚º1</p></li><li><p>Piç¨‹å¼å¦‚ä¸‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat :
 wait(mutex);
 C.S
 signal(mutex);
 RS
untill False;
</code></pre></td></tr></table></div></div><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>T1ï¼šwait(mutex);<br>å› ç‚ºmutex = 1<br>æ‰€ä»¥Piå¯ä»¥é›¢é–‹whileï¼Œthen,mutexå€¼åœ¨æ¸›1è®Š0ï¼Œthen Pié€²å…¥CS</td><td>T2ï¼šwait(mutex)ï¼Œå› ç‚ºæ­¤æ™‚mutex=0ï¼Œé€™æ™‚å€™Pjæœƒå¡ä½ã€‚ç¬¦åˆ<strong>Mutual exclustion</strong><br><strong>Progressä¹Ÿç¬¦åˆ</strong><br><strong>Bounded waitingä¹Ÿç¬¦åˆ</strong></td></tr></tbody></table></div></li></ol><h3 id=è§£æ±ºç°¡å–®çš„synchronization-problem><strong>è§£æ±ºç°¡å–®çš„Synchronization problem</strong></h3><p>â€‹ ä½•è¬‚Synchronization? Processå› ç‚ºæŸäº›äº‹ä»¶ç™¼ç”Ÿ(oræœªç™¼ç”Ÿ)è€Œè¢«è¿«ç­‰å¾…ï¼Œç„¡æ³•å¾€ä¸‹åŸ·è¡Œï¼Œç›´åˆ°å…¶ä»–Processes do somethingæ‰å¾—ä»¥å¾€ä¸‹</p><p>ç¯„ä¾‹1ï¼š</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>A;</td><td>B;</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table></div><p>è¦å®šï¼šAå¿…é ˆåœ¨Bä¹‹å‰åŸ·è¡Œï¼Œè©¦ç”¨Semaphoreé”åˆ°æ­¤éœ€æ±‚</p><p>Ans. å®£å‘Šä¸€å…±äº«è®Šæ•¸</p><p>S= Semaphore=0;
<img src=https://i.imgur.com/gFkvUDs.png loading=lazy alt=image-20230218153218428></p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>A;<br>signal(S);</td><td>wait(S);<br>B;</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr></tbody></table></div><p>==Noteï¼šsemaphoreçš„åˆå€¼æ˜¯å…·æœ‰æŸäº›æ„ç¾©çš„ï¼Œä¸¦ä¸”åˆå€¼ä¸ä¸€å®šè¦æ˜¯ï¼æˆ–ï¼‘ï¼Œå…¶å¯¦éƒ½å¯ä»¥ï¼Œåªæ˜¯éƒ½ç”¨ï¼è·Ÿï¼‘åšèˆ‰ä¾‹==</p><ul><li>åˆå€¼ç‚º1ï¼šç”¨ä½œäº’æ–¥æ§åˆ¶</li><li>åˆå€¼ç‚º0ï¼šç”¨ä½œå¼·è¿«ç­‰å¾…</li></ul><p>ä¾‹2ï¼š</p><p>S1ï¼šSemaphore= 0;</p><p>S2ï¼šSemaphore= 0;</p><p>è¦å®šåŸ·è¡Œé †åºç‚ºA -> C -> B è©²å¦‚ä½•å®Œæˆ?</p><p>Ansï¼š</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th><th>Pk</th></tr></thead><tbody><tr><td></td><td>wait(s2)</td><td>wait(s1)</td></tr><tr><td>A</td><td>B;</td><td>C;</td></tr><tr><td>signal(s1)</td><td></td><td>signal(s2)</td></tr></tbody></table></div><p>Ex2ï¼šå¸Œæœ›é”æˆ <u>A,B,C,</u><u>A,B,C,</u><u>A,B,C</u> repeatly execuction</p><p>æ‰¿ä¸Šæ€§è³ªï¼ŒS1,S2 semaphore=0;S3 semaphore=1</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th><th>Pk</th></tr></thead><tbody><tr><td>wait(s3)</td><td>wait(s1)</td><td>wait(s2)</td></tr><tr><td>A;</td><td>B;</td><td>C;</td></tr><tr><td>signal(s1)</td><td>signal(s2)</td><td>signal(s3)</td></tr></tbody></table></div><p>Ex3ï¼šCæ˜¯å…±äº«è®Šæ•¸ï¼Œåˆå€¼ç‚º3ï¼Œè«‹å¯«å‡ºæœ€å¾ŒCçš„å€¼ç‚ºå¤šå°‘</p><ul><li>ç¬¬ä¸€å°é¡Œ</li></ul><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>C=C*2</td><td>C=C+1</td></tr></tbody></table></div><p><strong>7æˆ–8æˆ–4æˆ–6</strong></p><ul><li>ç¬¬äºŒå°é¡Œ</li></ul><p>s= semaphore=1</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>wait(s)</td><td>wait(s)</td></tr><tr><td>c=c*2</td><td>c=c+1</td></tr><tr><td>signal(s)</td><td>singal(s)</td></tr></tbody></table></div><p><strong>7æˆ–8</strong></p><ul><li>ç¬¬ä¸‰å°é¡Œ</li></ul><p>s= semaphore = 0</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td></td><td>wait(s)</td></tr><tr><td>c=c*2</td><td>c=c+1</td></tr><tr><td>signal(s)</td><td></td></tr></tbody></table></div><p><strong>7</strong></p><p>EX4</p><p>S1ï¼šSemaphore = 1;</p><p>S2ï¼šSemaphore = 0;</p><p>æ±‚ABCå¯èƒ½åŸ·è¡Œé †åº</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th><th>Pk</th></tr></thead><tbody><tr><td>wait(s1)</td><td>wait(s2)</td><td>wait(s1)</td></tr><tr><td>A;</td><td>B;</td><td>C;</td></tr><tr><td>signal(s2)</td><td>signal(s1)</td><td>signal(s1)</td></tr></tbody></table></div><p>Ansï¼šæŠŠä¸å¯èƒ½çš„åˆªé™¤å°±å¥½</p><p>ABC,</p><p><del>ACB,</del></p><p><del>BAC,</del></p><p><del>BCA,</del></p><p>CAB,</p><p><del>CBA</del></p><h3 id=semaphoreä¹‹èª¤ç”¨æ‰€é€ æˆä¹‹å•é¡Œ>semaphoreä¹‹èª¤ç”¨æ‰€é€ æˆä¹‹å•é¡Œ</h3><p>é•åäº’æ–¥ã€å½¢æˆæ­»çµ</p><p>ä¾‹1</p><p>s= Semaphore=1</p><div class=table-wrapper><table><thead><tr><th>Pi</th></tr></thead><tbody><tr><td>singal(s)</td></tr><tr><td>CS</td></tr><tr><td>Wait(s)</td></tr></tbody></table></div><p>&mdash;> é•åmutual exclusion</p><p>ä¾‹2</p><p>s= semaphore = 2</p><div class=table-wrapper><table><thead><tr><th>Pi</th></tr></thead><tbody><tr><td>wait(s)</td></tr><tr><td>cs</td></tr><tr><td>wait(s)</td></tr><tr><td>rs</td></tr></tbody></table></div><p>&mdash;> å½¢æˆæ­»çµ</p><p>ä¾‹3</p><p>S1,S2 = Semaphore = 1;</p><div class=table-wrapper><table><thead><tr><th>Pi</th><th>Pj</th></tr></thead><tbody><tr><td>T1:wait(s1)</td><td>T2:wait(s2)</td></tr><tr><td>T3:wait(s2)</td><td>T4:wait(s1)</td></tr><tr><td>&mldr;</td><td>&mldr;</td></tr><tr><td>signal(s1)</td><td>signal(s2)</td></tr><tr><td>signal(s2)</td><td>signal(s1)</td></tr></tbody></table></div><p>å¯èƒ½å½¢æˆdeadlockï¼Œå¦‚æœPiï¼ŒPjä¾ç…§T1~T4ä¹‹é †åºäº¤éŒ¯åŸ·è¡Œ</p><h3 id=è‘—åçš„synchronization-problemä¹‹è§£æ±º>è‘—åçš„Synchronization Problemä¹‹è§£æ±º</h3><p><strong>æƒ³çœ‹çœ‹ä½•æ™‚æœƒåœä¸‹ä¾†</strong></p><h4 id=producer-consumer-problemç”Ÿç”¢è€…æ¶ˆè²»è€…å•é¡Œ>Producer-Consumer Problem(ç”Ÿç”¢è€…æ¶ˆè²»è€…å•é¡Œ)</h4><p>Producerï¼šæ­¤processå°ˆé–€ç”¢ç”Ÿè³‡è¨Šä¾›åˆ¥äººä½¿ç”¨</p><p>Consumerï¼šæ­¤processå°ˆé–€æ¶ˆè€—åˆ¥äººç”¢ç”Ÿçš„æˆæœ</p><p>åœ¨sharrd memoryæºé€šæ–¹å¼åº•ä¸‹ï¼Œæœƒæº–å‚™ä¸€å€‹buffer</p><p><img src=https://i.imgur.com/Ms4bWcB.png loading=lazy alt=image-20230219133538935></p><p>ç´°åˆ†ç‚ºå…©å€‹é¡å‹çš„å•é¡Œ</p><ol><li><p>Bounded Buffer Producer-Consumer(Bufferæœ‰é™)</p><p>æœ‰å…©å€‹æƒ…æ³æœƒè¢«è¿«ç­‰å¾…</p><ol><li>ç•¶Bufferæ»¿äº†ï¼ŒProducerè¢«è¿«ç­‰å¾…</li><li>ç•¶Bufferç©ºäº†ï¼ŒConsumerè¢«è¿«ç­‰å¾…</li></ol></li><li><p>Unbounded Buffer Producer-Consumer(Bufferç„¡é™)</p></li></ol><h5 id=algo1-1>algo1</h5><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><ol><li><p>Buffer: [0..n-1] of items;</p></li><li><p>in,out: int = 0;</p></li></ol><p>Producer ç¨‹å¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat:
	produce an item in nextp;
	while((in+1)%n==out) {do noting}; //ç•¶bufferæ»¿çš„è©±ï¼Œå°±å¡åœ¨whileä¸­
	Buffer[in] =nextp;
	in = (in+1)%n;
until false;
</code></pre></td></tr></table></div></div><p>Consumerç¨‹å¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat
	while(in == out ){ do nothing} //bufferç‚ºç©º
	nextc= Buffer[out];
	out=(out+1) % n;
	...
	consumes  the item in nextc;
until false;
</code></pre></td></tr></table></div></div><p><img src=https://i.imgur.com/BkZNIb6.png loading=lazy alt=image-20230219174042582></p><p>æ­¤æ™‚producer ç„¡æ³•åœ¨åŠ itemï¼Œå› ç‚º(in+1)%n == out, å³bufferå·²ç¶“æ»¿äº†ï¼Œå› æ­¤æœ€å¤šåˆ©ç”¨(n-1)æ ¼</p><h5 id=algo2-1>algo2</h5><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><ol><li><p>Buffer: [0..n-1] of items;</p></li><li><p>in,out: int = 0;</p></li><li><p>==<strong>count:int =0</strong>==</p></li></ol><p><strong>é€™å€‹countå€¼æœ‰å¯èƒ½å°è‡´race conditionï¼Œå› æ­¤ä¸å®Œå…¨æ­£ç¢º</strong></p><p>Producer ç¨‹å¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat:
	produce an item in nextp;
	while(count==n) {do noting}; //ç•¶bufferæ»¿çš„è©±ï¼Œå°±å¡åœ¨whileä¸­
	Buffer[in] =nextp;
	in = (in+1)%n;
	count = count +1;
until false;
</code></pre></td></tr></table></div></div><p>Consumerç¨‹å¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat
	while(count ==0 ){ do nothing} //bufferç‚ºç©º
	nextc= Buffer[out];
	out=(out+1) % n;
	count = count -1;
	...
	consumes  the item in nextc;
until false;
</code></pre></td></tr></table></div></div><h4 id=ç”¨semaphoreè§£producer-consumer-problem>ç”¨semaphoreè§£producer-consumer problem</h4><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹ï¼š</p><ol><li>empty : semaphore = n . ä»£è¡¨bufferå…§ç©ºæ ¼æ•¸ï¼Œè‹¥ç©ºæ ¼æ•¸è®Šç‚º0ï¼Œä»£è¡¨æ»¿äº†</li><li>full : semaphore=0. ä»£è¡¨bufferå€ä¸­ï¼Œå¡«å…¥itemä¹‹æ ¼æ•¸ï¼Œè‹¥ç‚º0ï¼Œè¡¨bufferç‚ºç©º</li><li>mutexï¼šsemaphore=1; å°buffer, in , out , countåšäº’æ–¥æ§åˆ¶ï¼Œé˜²æ­¢<strong>race condition</strong></li></ol><h4 id=semaphoreçš„è¨­è¨ˆå“²å­¸>semaphoreçš„è¨­è¨ˆå“²å­¸</h4><blockquote><ol><li>æ»¿è¶³åŒæ­¥æ¢ä»¶ä¹‹è™ŸèªŒè®Šæ•¸<code>empty, full</code></li><li>äº’æ–¥æ§åˆ¶é˜²æ­¢race conditionä¹‹è™ŸèªŒ <code>mutex</code></li><li>å…ˆæ¸¬åŒæ­¥åœ¨æ¸¬äº’æ–¥ï¼Œä¸ç„¶æœƒé€ æˆæ­»çµ</li><li><strong>==å…±äº«è®Šæ•¸å–å­˜ä¹‹å‰éƒ½éœ€è¦ç¶“éäº’æ–¥çš„è™•ç†==</strong></li></ol></blockquote><p>producer</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat
	produce on item in nextp;
	wait(empty) ; //è‹¥ç„¡ç©ºæ ¼å‰‡Pè¢«è¿«ç­‰å¾…
	wait(mutex); 
	add nextp into Bufffer;  //æ¿ƒç¸®å¾ˆå¤šç¨‹å¼åœ¨é€™è¡Œè£¡é¢å–”
	signal(mutex);
	signal(full); //å¡«å…¥itemä¹‹æ ¼æ•¸åŠ 1ï¼Œmaybeæ‹¯æ•‘Consumer
</code></pre></td></tr></table></div></div><p>consumer</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat
	wait(full);
	wait(mutex);
	remove item from Buffer in nextc
	signal(mutex);
	singal(empty)
</code></pre></td></tr></table></div></div><h4 id=readwrite-problem>Read/write Problem</h4><p><img src=https://i.imgur.com/J4nkQh8.png loading=lazy alt=image-20230222215707149></p><p><strong>åŸºæœ¬çš„åŒæ­¥æ¢ä»¶</strong></p><ol><li><strong>Reader writeè¦äº’æ–¥</strong></li><li><strong>writer,writerä¹Ÿè¦äº’æ–¥</strong></li></ol><p>æ­¤å¤–ï¼Œé€™å•é¡Œå†ç´°åˆ†æˆå…©é¡</p><ol><li><p><strong>First read/writer problem</strong></p><p>-> å°Readeræœ‰åˆ©ï¼Œå°writerä¸åˆ©ï¼Œå› æ­¤writerå¯èƒ½starvation</p></li><li><p><strong>Second read/writer problem</strong></p><p>-> å°writeræœ‰åˆ©ï¼Œå°readerä¸åˆ©ï¼Œå› æ­¤readerå¯èƒ½startvation</p></li></ol><h4 id=first-readerwriter-problem>First Reader/Writer Problem</h4><p>ä½•è¬‚ã€Œå°Readeræœ‰åˆ©ï¼ŒWriterä¸åˆ©ã€?</p><p>åªè¦æœ‰æºæºä¸çµ•çš„Readerï¼Œå‰‡W1å¯èƒ½Starvation</p><p><img src=https://i.imgur.com/P4FyOhL.png loading=lazy alt=image-20230222223611353></p><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹ï¼š</p><ol><li><p>wrtï¼šsemaphore =1</p><blockquote><p>æä¾›R/W åŠ W/Wäº’æ–¥æ§åˆ¶ï¼Œä¸¦<strong>å…¼å·®å°Writerä¸åˆ©çš„æ§åˆ¶</strong></p></blockquote></li><li><p>readcntï¼šint = 0;</p><blockquote><p>çµ±è¨ˆReaderå€‹æ•¸ï¼Œç›´åˆ°æ²’æœ‰Readerï¼Œæ‰å¯ä»¥æ”¾writeré€²å»</p><p>Readeråˆ°->Readcnt +1</p><p>Readerèµ° ->Readcnt -1</p></blockquote></li><li><p>mutexï¼šsemaphore=1</p><blockquote><p>ç”±æ–¼readcntæ˜¯ä¸€å…±äº«è®Šæ•¸ï¼Œæœƒæœ‰Race Conditionä¹‹å•é¡Œï¼Œæ•…éœ€é¡å¤–å®£å‘Šä¸€è®Šæ•¸Mutexåšäº’æ–¥æ§åˆ¶</p></blockquote></li></ol><p>ç¨‹å¼ï¼š</p><div class=table-wrapper><table><thead><tr><th>writer</th><th>reader</th></tr></thead><tbody><tr><td>&mldr;<br>wait(wrt)<br>åŸ·è¡Œå¯«å…¥ä½œæ¥­<br>signal(wrt)<br>&mldr;</td><td>&mldr;<br>wait(mutex) ;<br>readcnt = readcnt +1<br>if(readcnt==1)<code>ä»£è¡¨ä½ æ˜¯ç¬¬ä¸€å€‹Reader</code> then wait(wrt)<code>è¦å»åµæ¸¬æ˜¯å¦æœ‰writerå­˜åœ¨ã€‚è‹¥æœ‰å‰‡å¡ä½ï¼Œè‹¥ç„¡å‰‡é€šéï¼Œä¹Ÿé †ä¾¿å¡ä½writer</code><br>signal(mutex);<br>åŸ·è¡Œreadingå·¥ä½œ<br>wait(mutex);<br>readcnt = readcnt -1 //readerèµ°ï¼Œreader-1<br>if(readcnt=.=0) then signal(wrt) //No readerï¼Œæ”¾writeré€²å»<br>singal(mutex)</td></tr></tbody></table></div><p>ç·´ç¿’ï¼š</p><p>è‹¥ç›®å‰W1å·²åœ¨å¯«å…¥ä¸­</p><ol><li>R1åˆ°ï¼Œå‰‡R1æœƒå¡åœ¨wrt è£¡ï¼Œæ­¤æ™‚readcnt=1</li><li>R2åˆåˆ°ï¼Œå‰‡R2æœƒå¡åœ¨mutexï¼Œæ­¤æ™‚readcnt=1</li><li>R3åˆ°ï¼Œå‰‡R3æœƒå¡åœ¨mutexï¼Œæ­¤æ™‚readcnt=1</li></ol><h4 id=second-reader-writer-problem>Second Reader/ writer problem</h4><p>ä½•è¬‚å°Writer æœ‰åˆ©ï¼Œ<strong>å°Readerä¸åˆ©</strong></p><p><img src=https://i.imgur.com/beObzlW.png loading=lazy alt=image-20230306001249076></p><p>T6ï¼šw1é›¢é–‹ï¼Œ<strong>å„ªå…ˆ</strong>æ”¾W2è¿‘ä¾†(ä¸¦éR1)</p><p>T7ï¼šw2é›¢é–‹ï¼Œ<strong>å„ªå…ˆ</strong>æ”¾W2è¿‘ä¾†(ä¸¦éR1)</p><p>&mldr;(ä»¥æ­¤é¡æ¨)</p><p>åªè¦Writeré›¢é–‹ï¼Œç™¼ç¾å°šæœ‰waiting writeråœ¨ï¼Œé‚£å°±æœƒå„ªå…ˆæ”¾writerè¿‘ä¾†ï¼Œæ‰€ä»¥R1æœ‰å¯èƒ½Startvation</p><p><strong>å…±äº«è®Šæ•¸ä¹‹å®£å‘Š</strong></p><ol><li><p>readcntï¼šint=0 ï¼šçµ±è¨ˆreaderå€‹æ•¸</p></li><li><p>wrtcndï¼šint=0ï¼šçµ±è¨ˆwriterå€‹æ•¸</p></li><li><p>xï¼šsemaphoreï¼šï¼‘ã€€//ç”¨ä¾†å°readcntåšäº’æ–¥æ§åˆ¶ï¼Œé˜²æ­¢race condition</p></li><li><p>yï¼šsemaphoreï¼šï¼‘ //ç”¨ä¾†å°wrtcndåšäº’æ–¥æ§åˆ¶ï¼Œé˜²æ­¢race condition</p></li><li><p>zï¼šsemaphoreï¼šï¼‘ã€€//æœ‰çš„ç‰ˆæœ¬æœƒæœ‰ï¼Œæœ‰çš„ç‰ˆæœ¬ä¸æœƒæœ‰ã€‚ä½œç‚ºå°readerä¹‹å…¥å£æ§åˆ¶(è®“å®ƒå¡å¤šä¸€äº›é—œå¡ï¼Œè®“reader slower)</p></li><li><p>rsemï¼šsemaphore=1ã€€//ä½œç‚ºå°readerä¸åˆ©ä¹‹æ§åˆ¶</p></li><li><p>wsemï¼šsemephore=1 //æä¾›R/WåŠW/Wäº’æ–¥æ§åˆ¶</p></li></ol><p><strong>ç¨‹å¼</strong>ï¼š</p><div class=table-wrapper><table><thead><tr><th>writer</th><th>reaeder(ä»¥First readerç¨‹å¼ç‚ºä¸»ï¼Œå†åŠ å…¥æ§åˆ¶)</th></tr></thead><tbody><tr><td>wait(y)<br>wrtcnt = wrtcnt+1;<br>if(wrtcnt==1) then(wait(rsem)) //ç¬¬ä¸€å€‹writer ï¼Œè¦è² è²¬ç¯‰èµ·å°readerä¸åˆ©ä¹‹æ§åˆ¶<br>signal(y);<br>wait(wsem) //<br>åŸ·è¡Œwritingå·¥ä½œ<br><br>wait(y)<br>wrtcnt = wrtcnt-1<br>if(wrtcnt==0) then signal(resm) //è§£é™¤å°readerä¸åˆ©ä¹‹æ§åˆ¶<br>signal(wsem) //è§£é™¤ R/W W/Wäº’æ–¥<br>signal(y)</td><td>wait(z)<br>wait(rsem) //é€šéå°readerä¸åˆ©ä¹‹æ§åˆ¶?<br>wait(x)<br>readcnt = readcnt +1;<br>if(readcnt ==1) then wait(wsem) //R/Wäº’æ–¥<br>signal(x)<br>signal(rsem)<br>signal(z)<br>(åŸ·è¡Œreadingå·¥ä½œ)<br><br>wait(x);<br>readcnt = readcnt -1<br>if(readcnt ==0) then signal(wsem) //è§£é™¤R/Wäº’æ–¥<br>signal(x)</td></tr></tbody></table></div><h4 id=the-sleeping-barbers-problem>The Sleeping Barbers Problem</h4><p><strong>æè¿°</strong>ï¼šæœ‰ä¸€å€‹barberï¼Œä¸€å¼µBarberChairï¼Œnå¼µwaitingChairã€‚ä¸¦ä¸”æœ‰å®¢äººã€‚</p><p>å®¢äººçš„è¡Œç‚ºå¦‚ä¸‹</p><blockquote><p>waiting chairs åæ»¿(nå€‹ç­‰å¾…å®¢äºº)ï¼šä¸å…¥åº—</p><p>waiting chairs å°šæœªåæ»¿ï¼šå…¥åº—å…§ï¼Œååœ¨waitingChairï¼Œé€šçŸ¥(å–šé†’)barber</p><p>å®¢äººç¡è¦º(wait) if barber is busy now&mldr; ç›´åˆ°Barberå«ä»–èµ·åºŠå‰ªé«®ï¼Œå‰ªå®Œé«®Exit</p></blockquote><p>ç†é«®å¸«çš„è¡Œç‚ºå¦‚ä¸‹</p><blockquote><p>ç¡è¦º if no å®¢äºº</p><p>ç›´åˆ°æœ‰å®¢äººå–šé†’(é€šçŸ¥)ä»–</p><p>å«é†’å®¢äººå‰ªé«®</p><p>å‰ªå®Œé«®å¾Œå¦‚æœé‚„æœ‰å®¢äººï¼Œå‰‡å«é†’å®¢äººå‰ªé«®</p><p>å‰ªå®Œé«®å¾Œå¦‚æœæ²’æœ‰å®¢äººï¼Œå‰‡ç¹¼çºŒç¡ï¼Œç¹¼çºŒæ°´æ™‚é–“</p></blockquote><p><strong>å…±äº«è®Šæ•¸å®£å‘Šï¼š</strong> <strong>==å…±äº«è®Šæ•¸å–å­˜ä¹‹å‰éƒ½éœ€è¦ç¶“éäº’æ–¥çš„è™•ç†==</strong></p><ol><li>Customerï¼šsemaphore=0 ï¼šç”¨ä¾†å¡ä½ç†é«®å¸« if no <strong>å®¢äºº</strong></li><li>Barberï¼šsemaphore=0ï¼šç”¨ä¾†å¡ä½å®¢äººçš„ if Barber is busy</li><li>waitingï¼šint=0 // ååœ¨ç­‰å¾…æ¤…ä¸Šçš„å®¢äººæ•¸ç›®ã€‚ä½•æ™‚+1?ä½•æ™‚-1?å®¢äººå…¥åº—ï¼Œåä¸Šæ¤…å­ã€‚Barberå«å®¢äººèµ·ä¾†å‰ªé«®ï¼Œæœƒæœ‰race conditionçš„å•é¡Œ</li><li>mutexï¼šsemaphore=1 //é˜²æ­¢waitingå€¼race condition</li></ol><p>ç¨‹å¼ï¼š</p><div class=table-wrapper><table><thead><tr><th>Barber</th><th>Customer</th></tr></thead><tbody><tr><td>repeat<br>wait((Customer))<br>wait(mutex)<br>waiting = waiting -1;<br>signal(Barber)<br>signal(mutex)<br>å‰ªå®¢äººé ­é«®();<br>until False</td><td>wait(mutex);<br>if(waitng&lt;n){waiting=waiting+1;<br>signal(Customer) //å«é†’ã€é€šçŸ¥barber<br>signal(mutex);<br>wait(barber);<br>è¢«ç†é«®()<br>}else{ signal(mutex)}</td></tr><tr><td></td><td>å®¢äººæ˜¯æ²’æœ‰repear &mldr; until false</td></tr><tr><td></td><td></td></tr></tbody></table></div><h4 id=the-dining-philosophers-problems>The Dining-Philosophers Problems</h4><p>æè¿°</p><p><img src=https://i.imgur.com/Qxdepnt.png loading=lazy alt=image-20230306233039022></p><p><code>æ³¨æ„ï¼š1. åƒä¸­é¤ï¼šå¥‡æ•¸ã€å¶æ•¸å“²å­¸å®¶çš†å¯</code></p><p><code>2. åƒè¥¿é¤ï¼šå¶æ•¸ä½æ‰å¯ä»¥ï¼ˆåˆ€å‰ä¸€å‰¯</code></p><p><strong>å…±äº«è®Šæ•¸ä¹‹å®£å‘Š</strong></p><p>chopstickï¼š[0,1,2,3,4] of semaphoreï¼›åˆå€¼çš†ç‚º1ï¼Œå°5æ ¹ç­·å­åšäº’æ–¥æ§åˆ¶ã€‚</p><p><strong>iè™Ÿå“²å­¸å®¶(i=0~4)å“²å­¸å®¶Piä¹‹ç‹€æ³</strong>(é€™ç¨‹å¼æ˜¯æœ‰å•é¡Œçš„)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat...
hugry now;
wait(chopstick[i]);
wait(chopstick[(i+1)%5])
eating now;
signal(chopstick[i]);
signal(chopstick[(i+1)%5]);
think now;
</code></pre></td></tr></table></div></div><p>æ­¤Solutionæœ‰å•é¡Œï¼Œå¯èƒ½æœƒå½¢æˆDeadlock!!</p><p>è‹¥æ¯ä½å“²å­¸å®¶éƒ½æ‹¿èµ·è‡ªå·±å·¦é‚Šçš„ç­·å­ï¼Œå‰‡æ¯ä½å“²å­¸å®¶éƒ½å¡ä½ï¼Œçš†ç„¡æ³•å–å¾—å³ç­·ï¼Œå½¢æˆcircular waiting</p><p><strong>è§£æ³•ä¸€</strong></p><p>ä¸€æ¬¡æœ€å¤šè®“4ä½å“²å­¸å®¶ä¸Šæ¡Œ</p><p>m=5æ ¹,Maxi=2</p><ol><li><p>1â‰¦Maxiâ‰¦mæˆç«‹</p></li><li><p>$$
\sum_{i=1}^nMaxi &lt; n+m,å› æ­¤2n&lt;n+5, n&lt;5ã€‚æœ€å¤š4ä½
$$</p></li></ol><p>ä¿è­‰DeadLock Free-> å¯é¡å¤–åŠ å…¥å¦ä¸€å€‹è™ŸèªŒ No:semaphore=4ï¼Œåšå…¥å£æ§åˆ¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>repeat...
wait(No);
hugry now;
wait(chopstick[i]);
wait(chopstick[(i+1)%5])
eating now;
signal(chopstick[i]);
signal(chopstick[(i+1)%5]);
think now;
</code></pre></td></tr></table></div></div><p><strong>è§£æ³•äºŒ</strong></p><p>é™¤é<strong>å“²å­¸å®¶å¯åŒæ™‚å–å¾—å·¦å³å…©é‚Šç­·å­</strong>ï¼Œæ‰å‡†è¨±æŒæœ‰ç­·å­ï¼Œå¦å‰‡ä¸å¾—æŒæœ‰ä»»ä½•ç­·å­ã€‚å¦å‰‡ä¸å¾—æŒæœ‰ä»»ä½•ç­·å­</p><p>ç ´é™¤Hold&wait æ¢ä»¶</p><p><strong>è§£æ³•ä¸‰</strong></p><p>ç›¸é„°å“²å­¸å®¶ä¹‹å–ç­·é †åºä¸åŒï¼Œå‰µé€ <strong>Asymmetric mode</strong>ï¼Œä¾‹å¦‚ï¼š</p><div class=table-wrapper><table><thead><tr><th>å¥‡æ•¸è™Ÿ</th><th>å¶æ•¸è™Ÿ</th></tr></thead><tbody><tr><td>å…ˆå–å·¦ï¼Œå†å–å³</td><td>å…ˆå–å³ï¼Œå†å–å·¦</td></tr></tbody></table></div><p>ç ´é™¤Circular waitingæ¢ä»¶</p><p><img src=https://i.imgur.com/M9uGAQg.png loading=lazy alt=image-20230307231842002></p><p>Noteï¼šç­‰åŒæ–¼è¥¿é¤ï¼Œå¤§å®¶è¦å®šï¼šå…ˆå–åˆ€å†å–å‰</p><h4 id=cigarette-smokers-problem>cigarette smokers problem</h4><p>å¾ˆå°‘è€ƒï¼Œå¾50å¹´å‰å°±æ²’è€ƒéäº†ã€‚Pass</p><h3 id=semaphoreä¹‹ç¨®é¡>Semaphoreä¹‹ç¨®é¡</h3><h4 id=åˆ†é¡ä¸€è™ŸèªŒå€¼åŸŸåšå€åˆ†>åˆ†é¡ä¸€ï¼šè™ŸèªŒå€¼åŸŸåšå€åˆ†</h4><p><strong>Binary(äºŒå…ƒ) Semaphore Vs Counting(è¨ˆæ•¸) semaphore</strong></p><ol><li>Binary Semaphore</li></ol><p>å®šç¾©ï¼šSemaphoreä¹‹å€¼<strong>åªæœ‰0,èˆ‡1å…©ç¨®</strong>(C.S Designæ­£å¸¸ä½¿ç”¨ä¸‹)ä¸å¯ç‚ºè² å€¼ï¼Œç„¡æ³•çµ±è¨ˆæœ‰å¤šå°‘å€‹Processå¡åœ¨waitä¸­</p><p>Sï¼šBinary-Semaphore=1;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>Wait</span><span class=p>(</span><span class=n>S</span><span class=p>)</span><span class=err>ï¼š</span>
    <span class=n>While</span><span class=p>)(</span><span class=n>S</span><span class=err>â‰¦</span><span class=mi>0</span><span class=p>)</span>
   <span class=p>{</span><span class=k>do</span> <span class=n>no</span><span class=o>-</span><span class=n>op</span><span class=p>}</span>
    <span class=n>S</span><span class=o>=</span><span class=n>S</span><span class=o>-</span><span class=mi>1</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>Signal</span><span class=p>(</span><span class=n>S</span><span class=p>){</span>
    <span class=n>S</span><span class=o>=</span><span class=n>S</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><ol start=2><li>Counting Semaphore</li></ol><p>å®šç¾©ï¼šSemaphoreå€¼ä¸é™æ–¼0,1 å¯ä»¥ç‚ºè² å€¼ï¼Œä¸”è‹¥å€¼ç‚º-Nï¼Œå¯çŸ¥é“(çµ±è¨ˆå‡º)æœ‰Nå€‹processeså¡åœ¨waitä¸­</p><p>ç¯„ä¾‹1.</p><p>è«‹ç”¨Binary Semaphoreå®šç¾©å‡ºCounting Semaphoreã€‚</p><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹</p><ol><li>Cï¼šint //ä»£è¡¨ Counting Semaphoreè™ŸèªŒå€¼</li><li>S1ï¼šBinary-Semaphore=1 å°Cä½œäº’æ–¥æ§åˆ¶ï¼Œé˜²æ­¢Cå€¼race Condition</li><li>S2ï¼šBinary-Semaphore=0 ï¼Œç•¶Cå€¼&lt;0ï¼Œå¼·è¿«Processæš«åœä¹‹ç”¨</li></ol><p>ç¨‹å¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>wait</span><span class=p>(</span><span class=n>C</span><span class=p>)</span><span class=err>ï¼š</span>
    <span class=n>wait</span><span class=p>(</span><span class=n>S1</span><span class=p>);</span>
	<span class=n>C</span><span class=o>=</span><span class=n>C</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
	<span class=k>if</span><span class=p>(</span><span class=n>c</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span> <span class=n>then</span> <span class=p>{</span>
        <span class=n>signal</span><span class=p>(</span><span class=n>S1</span><span class=p>);</span>
        <span class=n>wait</span><span class=p>(</span><span class=n>S2</span><span class=p>);</span> <span class=c1>//processè‡ªå·±å¡ä½
</span><span class=c1></span>    <span class=p>}</span><span class=k>else</span>
        <span class=n>signal</span><span class=p>(</span><span class=n>S1</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>Signal</span><span class=p>(</span><span class=n>C</span><span class=p>)</span><span class=err>ï¼š</span>
    <span class=n>wait</span><span class=p>(</span><span class=n>S1</span><span class=p>);</span>
	<span class=n>C</span><span class=o>=</span><span class=n>C</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
	<span class=k>if</span><span class=p>(</span><span class=n>c</span><span class=err>â‰¦</span><span class=mi>0</span><span class=p>)</span> <span class=n>then</span> <span class=n>Singal</span><span class=p>(</span><span class=n>S2</span><span class=p>);</span>  <span class=c1>//æ•‘process
</span><span class=c1></span>	<span class=n>signal</span><span class=p>(</span><span class=n>s1</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>Demoå¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>C</span><span class=err>ï¼š</span><span class=n>Counting</span> <span class=n>semaphore</span><span class=o>=</span> <span class=mi>1</span>
<span class=n>wait</span><span class=p>(</span><span class=n>C</span><span class=p>);</span>
<span class=n>C</span><span class=p>.</span><span class=n>S</span> <span class=c1>// è‡¨ç•Œå€é–“
</span><span class=c1></span><span class=n>Singal</span><span class=p>(</span><span class=n>C</span><span class=p>)</span>
<span class=n>R</span><span class=p>.</span><span class=n>S</span>
</code></pre></td></tr></table></div></div><h4 id=åˆ†é¡äºŒæ˜¯å¦æ¡ç”¨busy-waitingspinlockæŠ€å·§ä¾†å®šç¾©semaphore>åˆ†é¡äºŒï¼šæ˜¯å¦æ¡ç”¨Busy-waiting(Spinlock)æŠ€å·§ä¾†å®šç¾©Semaphore</h4><p><strong>Spinlock Vs Non-Busy-waiting Semaphore</strong></p><p><strong>Spinlock</strong></p><p>å®šç¾©ï¼šä»¤ï¼³ç‚ºSemaphoreè®Šæ•¸ï¼Œè€Œ</p><ul><li><p>wait(S)ï¼š</p><p>å®šç¾©ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=k>while</span><span class=p>(</span><span class=n>S</span><span class=err>â‰¦</span><span class=mi>0</span><span class=p>){</span><span class=k>do</span> <span class=n>no</span><span class=o>-</span><span class=n>op</span><span class=p>}</span> <span class=c1>//æ¡ç”¨Busy-waiting Skill
</span><span class=c1></span><span class=n>S</span><span class=o>=</span><span class=n>S</span><span class=o>-</span><span class=mi>1</span>
</code></pre></td></tr></table></div></div></li><li><p>Signal(S)ï¼š</p><p>å®šç¾©ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=err>ï¼³</span><span class=o>=</span><span class=n>S</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
</code></pre></td></tr></table></div></div></li></ul><p>å„ªç¼ºé»ï¼šåƒé–±å‰è¿°Busy-waitingå…§å®¹</p><p>Non-Busy waiting semaphore</p><p>å®šç¾©ï¼šSemaphore typeå®šç¾©å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>Struct</span> <span class=n>semaphore</span><span class=p>{</span>
    <span class=kt>int</span> <span class=n>value</span><span class=p>;</span> <span class=c1>//è™ŸèªŒå€¼
</span><span class=c1></span>    <span class=n>Queue</span> <span class=n>Q</span> <span class=p>;</span> <span class=c1>// FIFO Queue
</span><span class=c1></span><span class=p>}</span>
</code></pre></td></tr></table></div></div><p>ä»¤Sç‚ºSemaphoreè®Šæ•¸ï¼Œå‰‡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>Wait</span><span class=p>(</span><span class=n>S</span><span class=p>)</span><span class=err>ï¼š</span>
    <span class=n>S</span><span class=p>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>S</span><span class=p>.</span><span class=n>value</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span>
	<span class=k>if</span><span class=p>(</span><span class=n>S</span><span class=p>.</span><span class=n>value</span> <span class=o>&lt;</span><span class=mi>0</span> <span class=p>)</span> <span class=n>then</span><span class=p>{</span>
        <span class=n>add</span> <span class=n>process</span> <span class=n>P</span> <span class=n>into</span> <span class=n>S</span><span class=p>.</span><span class=n>Q</span><span class=p>;</span>
        <span class=n>Block</span><span class=p>(</span><span class=n>P</span><span class=p>);</span> <span class=c1>// Pä¹‹ç‹€æ…‹æ”¹ç‚ºblock state
</span><span class=c1></span>    <span class=p>}</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>Signal</span><span class=p>(</span><span class=n>S</span><span class=p>)</span><span class=err>ï¼š</span>
    <span class=n>S</span><span class=p>.</span><span class=n>value</span> <span class=o>=</span> <span class=n>S</span><span class=p>.</span><span class=n>value</span><span class=o>+</span><span class=mi>1</span><span class=p>;</span>
	<span class=k>if</span><span class=p>(</span><span class=n>S</span><span class=p>.</span><span class=n>value</span> <span class=err>â‰¦ï¼</span><span class=p>)</span><span class=n>then</span><span class=p>{</span>
        <span class=n>remove</span> <span class=n>a</span> <span class=n>process</span> <span class=n>form</span> <span class=n>S</span><span class=p>.</span><span class=n>Q</span>
         <span class=n>wakeup</span><span class=p>(</span><span class=n>P</span><span class=p>)</span> <span class=c1>//å°‡Pæ”¹ç‚ºready state
</span><span class=c1></span>    <span class=p>}</span>
</code></pre></td></tr></table></div></div><p>Noteï¼šæ­¤è™ŸèªŒä¹Ÿæ˜¯ä¸€å€‹Counting Semaphore</p><h3 id=è£½ä½œsemaphore>è£½ä½œSemaphore</h3><p>using</p><ol><li>Disable interrupt</li><li>Software solution or Hardware instructions support</li></ol><p><strong>ä½•è¬‚è£½ä½œSemaphore?</strong></p><p>å³æ˜¯å¦‚ä½•ä¿è­‰Semaphoreå€¼ä¸æœƒRace Condition(or å¦‚ä½•ç¢ºä¿waitèˆ‡singalæ˜¯<strong>Atomic operation?</strong>)</p><p><strong>è£½ä½œSemaphoreçš„ç›®çš„å°±æ˜¯ç‚ºäº†ç¢ºä¿ ï¼Œè™ŸèªŒçš„å€¼ä¸æœƒRace Condition</strong></p><div class=table-wrapper><table><thead><tr><th>è£½ä½œæ–¹å¼|è™ŸèªŒå®šç¾©</th><th>Non-Busy waiting Semaphore</th><th>Spinlock Semaphore</th></tr></thead><tbody><tr><td>Disable Interrupt</td><td>[Algo1]</td><td>[Algo3]</td></tr><tr><td>C.S Design(åŸºç¤)<br>software Solution<br>ç¡¬é«”æŒ‡ä»¤</td><td>[Algo2]</td><td>[Algo4]</td></tr></tbody></table></div><h4 id=algo1-2>Algo1</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>wait</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=err>ï¼š</span>
    <span class=n>Disable</span> <span class=n>interrupt</span><span class=p>;</span>
	<span class=n>S</span><span class=p>.</span><span class=n>value</span> <span class=o>=</span>  <span class=n>S</span><span class=p>.</span><span class=n>value</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
	<span class=k>if</span><span class=p>(</span><span class=n>S</span><span class=p>.</span><span class=n>value</span><span class=o>&lt;</span><span class=mi>0</span><span class=p>)</span> <span class=n>then</span><span class=p>{</span>
       	<span class=n>Enable</span> <span class=nf>Interrupt</span><span class=p>();</span> <span class=c1>//åœ¨é€™é‚Šæ‰“é–‹ä¸­æ–·ï¼Œè€Œä¸æ˜¯åœ¨ifä¹‹å¤–ï¼Œé¿å…Block(p)ä¹‹å¾Œï¼Œå› ç‚ºDisable Interruptè€Œç„¡æ³•é‡‹æ”¾CPU
</span><span class=c1></span>        <span class=n>add</span> <span class=n>process</span> <span class=n>P</span> <span class=n>into</span> <span class=n>S</span><span class=p>.</span><span class=n>Q</span><span class=p>;</span>
        <span class=n>block</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
    <span class=p>}</span>

</code></pre></td></tr></table></div></div><h4 id=algo2-2>Algo2</h4><p>å°‡[Algo1]ä¸­çš„Disable Interrupt æ›æˆ Enter Sectionï¼ŒEnable Interruptæ”¹æˆExit Sectionã€‚</p><p>Enter Sectionèˆ‡Exit Sectionä¹‹æ§åˆ¶ç¢¼æ‰¾å€‹åœ°æ–¹å¯«å‡ºä¾†ã€‚å–æ±ºæ–¼é¡Œç›®æ•™ä½ ç”¨Software Solution(Bakery&rsquo;Algo) or Hardware Instrution(Test-and-set or Swapçš„Algo[2]æˆ–Algo[1]<code>æ™‚é–“ä¸å¤ å°±å¯«é€™å€‹ï¼Œä½†é€™å¥½åƒä¸ç¬¦åˆä»€éº¼Bound waité‚„æ˜¯ä»€éº¼é¬¼çš„</code>)</p><h4 id=algo3-1>Algo3</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>wait</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=err>ï¼š</span><span class=k>while</span><span class=p>(</span><span class=n>S</span><span class=err>â‰¦</span><span class=mi>ï¼</span><span class=p>){</span>
    <span class=n>Enable</span> <span class=n>Interrupt</span><span class=p>;</span>
    <span class=n>no</span><span class=o>-</span><span class=n>op</span><span class=p>;</span>
    <span class=n>Disble</span> <span class=n>Interrupt</span>
<span class=p>}</span>
	<span class=n>S</span><span class=o>=</span><span class=n>S</span><span class=o>-</span><span class=mi>1</span>
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>Signal</span><span class=p>(</span><span class=n>S</span><span class=p>)</span><span class=err>ï¼š</span><span class=n>S</span><span class=o>=</span><span class=n>S</span><span class=o>+</span><span class=mi>1</span> 
</code></pre></td></tr></table></div></div><h4 id=algo4>Algo4</h4><p>å°‡[Algo3]ä¸­çš„Disable Interrupt æ›æˆ Enter Sectionï¼ŒEnable Interruptæ”¹æˆExit Sectionã€‚</p><p>Enter Sectionèˆ‡Exit Sectionä¹‹æ§åˆ¶ç¢¼æ‰¾å€‹åœ°æ–¹å¯«å‡ºä¾†ã€‚å–æ±ºæ–¼é¡Œç›®æ•™ä½ ç”¨Software Solution(Bakery&rsquo;Algo) or Hardware Instrution(Test-and-set or Swapçš„Algo[2]æˆ–Algo[1]<code>æ™‚é–“ä¸å¤ å°±å¯«é€™å€‹ï¼Œä½†é€™å¥½åƒä¸ç¬¦åˆä»€éº¼Bound waité‚„æ˜¯ä»€éº¼é¬¼çš„</code>)</p><h3 id=busy-waitingæ˜¯å¦å¯ä»¥å®Œå…¨é¿å…ä¹‹avoid-altogether>Busy-waitingæ˜¯å¦å¯ä»¥å®Œå…¨é¿å…ä¹‹(avoid altogether)</h3><p>Ans. No, ç„¡æ³•å®Œå…¨é¿å…ï¼Œä»¥Semaphoreç‚ºä¾‹</p><p><img src=https://i.imgur.com/pvJx1sC.png loading=lazy></p><h2 id=monitor>Monitor</h2><blockquote><p>å®šç¾©ã€çµ„æˆ</p><p>ç‰¹æ€§(å„ªé»)</p><p>Condition è®Šæ•¸ä½¿ç”¨</p><p>è§£åŒæ­¥å•é¡Œ</p><p>Conditional Monitor</p><p>ç¨®é¡(3ç¨®)</p><p>ç”¨semaphore Monitor</p></blockquote><p>å®šç¾©ï¼šï¼­onitoræ˜¯ä¸€å€‹ç”¨ä¾†è§£æ±ºåŒæ­¥å•é¡Œçš„é«˜éšçµæ§‹<code>class</code>ï¼Œæ˜¯ä¸€ç¨®<strong>ADT(abstract data type</strong>)ï¼ŒMonitorä¹‹å®šç¾©ï¼Œä¸»è¦æœ‰3å€‹</p><p>çµ„æˆï¼š</p><ol><li><strong>å…±äº«è®Šæ•¸å®£å‘Šå€</strong></li><li><strong>ä¸€çµ„local function(or procedures)</strong></li><li><strong>Initialization area(åˆå§‹å€)</strong></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=n>Class</span> <span class=n>MonitorName</span><span class=o>{</span>
    <span class=c1>//å…±äº«è®Šæ•¸å®£å‘Š
</span><span class=c1></span>    
   <span class=n>procedure</span> <span class=n>entry</span> <span class=nf>function1</span><span class=o>(</span><span class=n>åƒæ•¸</span><span class=o>){</span>
       <span class=n>begin</span>
           <span class=n>Body</span><span class=o>;</span>
       <span class=n>end</span> 
	<span class=o>}</span>
    <span class=n>procedure</span> <span class=n>entry</span> <span class=nf>functionX</span><span class=o>(</span><span class=n>åƒæ•¸</span><span class=o>){</span>
        <span class=n>begin</span><span class=o>;</span>
        <span class=n>Body</span><span class=o>;</span>
        <span class=n>end</span><span class=o>;</span>
    <span class=o>}</span>
    
    <span class=n>begin</span><span class=o>;</span>
    <span class=n>åˆå§‹å€</span>
    <span class=n>end</span><span class=o>;</span>
    
   
<span class=o>}</span>
</code></pre></td></tr></table></div></div><p>ç‰¹æ€§(å„ªé»)ï¼š</p><p><strong>Monitoræœ¬èº«å·²ä¿è­‰äº’æ–¥(Mutual excluesive)å³ä»»ä½•æ™‚é–“é»æœ€å¤šåªå…è¨±ï¼Œ1å€‹Processåœ¨Monitorå…§æ´»å‹•(Active)</strong>ï¼Œä¹Ÿå°±æ˜¯èªªï¼šåœ¨ä»»ä½•æ™‚é–“é»ï¼Œæœ€å¤šåªå…è¨±ä¸€å€‹1å€‹Processå‘¼å«(calling)monitorçš„æŸå€‹function(æˆ–procedure)åŸ·è¡Œä¸­ï¼Œä¸å¯ä»¥æœ‰å¤šå€‹processesåŒæ™‚å‘¼å«monitorçš„functions</p><p><img src=https://i.imgur.com/oaFm55Q.png loading=lazy alt=image-20230313232606063></p><blockquote><p>æ­¤ä¸€äº’æ–¥æ€§è³ªå¸¶ä¾†ä½•ç¨®å¥½è™•ï¼Ÿ</p></blockquote><p>å› ç‚ºå…±äº«è®Šæ•¸å€ä¹‹å…±äº«è®Šæ•¸åªèƒ½è¢«monitorçš„local functionç›´æ¥å­˜å–ï¼Œå¤–ç•Œä¸èƒ½ç›´æ¥å­˜å–ï¼Œå¤–ç•Œ(process)åªèƒ½é€éå‘¼å«Monitorçš„Local Functionä¾†å­˜å–å…±äº«è®Šæ•¸ï¼Œè€Œ<strong>Monitorä¿éšœäº’æ–¥</strong>ï¼Œå› æ­¤ä¿éšœäº†å…±äº«è®Šæ•¸ä¸æœƒç™¼ç”ŸRace Conditionï¼Œ<strong>æ‰€ä»¥Programmeræ¯‹é ˆç…©æƒ±Race Condition problem (ä¸ç”¨æ’°å¯«é¡å¤–çš„Codeï¼Œæˆ–æ˜¯ä½¿ç”¨Mutex semaphore)</strong>ï¼Œåªéœ€å°ˆå¿ƒè™•ç†åŒæ­¥å•é¡Œå³å¯ã€‚<strong>æ­¤é»å„ªæ–¼Semaphore</strong></p><p>Questionï¼šSemaphore æ¯” Monitorå®¹æ˜“ä½¿ç”¨ when solving synchronization problem</p><p>Ansï¼šFalseï¼Œåƒç…§å¦‚ä¸Šã€‚ä¸¦ä¸”semaphoreä¸€å¤šï¼Œå®¹æ˜“ç”¢ç”ŸDeadloc</p><h2 id=condition-type>Condition Type</h2><p>å®šç¾©ï¼šCondition å‹åˆ¥æ˜¯ç”¨Monitorä¸­ï¼Œæä¾›çµ¦Programmer<strong>è§£æ±ºåŒæ­¥å•é¡Œ</strong>ä¹‹ç”¨ï¼Œä»¤xæ˜¯Condition Typeè®Šæ•¸ï¼Œ<strong>åœ¨Xä¸Šæä¾›å…©å€‹operationsï¼š</strong></p><p><strong>x.wait åŠ x.signal</strong></p><ol><li>x.waitï¼šåŸ·è¡Œæ­¤é‹ä½œçš„processæœƒè¢«Blockedä¸”ç½®å…¥Monitorå…§xæ‰€å±¬çš„<strong>waiting queueä¸­(é è¨­æ˜¯FIFO)</strong></li><li>x.signalï¼šå¦‚æœå…ˆå‰æœ‰Processeså¡åœ¨xçš„waiting queueä¸­ï¼Œå‰‡æ­¤é‹ä½œæœƒè‡ªæ­¤waiting queueä¸­ç§»èµ°ä¸€å€‹processä¸”æ¢å¾©(resume)å…¶åŸ·è¡Œï¼Œ<strong>å¦å‰‡ç„¡ä»»ä½•ä½œç”¨</strong></li></ol><h2 id=ä½¿ç”¨monitorè§£æ±º-the-dining-philosophers-problem>ä½¿ç”¨Monitorè§£æ±º The dining-philosophers Problem</h2><p>å…ˆå®šç¾©æ‰€éœ€çš„Monitor ADT Type</p><p>Dining-philosophers = Monitor</p><p>Var</p><ol><li>State[0..4] of {thinking, hungry, eating}</li><li>self[0..4] of condition;</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>procedure</span> <span class=n>entry</span> <span class=nf>pickup</span><span class=p>(</span><span class=nl>i</span> <span class=p>:</span> <span class=mf>0.</span><span class=p>.</span><span class=mf>.4</span><span class=p>){</span> <span class=c1>//æ‹¿èµ·ç­·å­
</span><span class=c1></span>    <span class=nl>begin</span><span class=p>:</span>
    	<span class=n>state</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>hungry</span><span class=p>;</span>
    	<span class=n>test</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
    	<span class=k>if</span><span class=p>(</span><span class=n>state</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=err>â‰ </span><span class=n>eating</span><span class=p>)</span> <span class=n>then</span> <span class=n>self</span><span class=p>[</span><span class=n>i</span><span class=p>].</span><span class=n>wait</span><span class=p>;</span> <span class=c1>// Piè‡ªå·±å¡ä½
</span><span class=c1></span><span class=p>}</span>

<span class=n>procedure</span> <span class=nf>test</span><span class=p>(</span><span class=nl>k</span><span class=p>:</span><span class=mf>0.</span><span class=p>.</span><span class=mf>.4</span><span class=p>){</span> <span class=c1>//æ¸¬è©¦
</span><span class=c1></span>    <span class=nl>begin</span><span class=p>:</span>
    	<span class=k>if</span><span class=p>(</span><span class=n>state</span><span class=p>[(</span><span class=n>k</span><span class=o>+</span><span class=mi>4</span><span class=p>)</span><span class=o>%</span><span class=mi>5</span><span class=p>]</span><span class=err>â‰ </span><span class=n>eating</span> <span class=n>and</span> <span class=n>state</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>==</span><span class=n>hungry</span> <span class=n>and</span> <span class=n>state</span><span class=p>[(</span><span class=n>k</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>5</span><span class=p>]</span><span class=err>â‰ </span><span class=n>eating</span><span class=p>)</span>
            <span class=n>then</span><span class=p>{</span>
            <span class=n>state</span><span class=p>[</span><span class=n>k</span><span class=p>]</span><span class=o>=</span> <span class=n>eating</span><span class=p>;</span>
            <span class=n>self</span><span class=p>[</span><span class=n>k</span><span class=p>].</span><span class=n>signal</span>
        <span class=p>}</span>
<span class=p>}</span>

<span class=n>procedure</span> <span class=n>entry</span> <span class=nf>putdown</span><span class=p>(</span><span class=nl>i</span><span class=p>:</span> <span class=mf>0..4</span><span class=p>){</span> <span class=c1>// åƒé£½äº†æ”¾ä¸‹ç­·å­
</span><span class=c1></span>    <span class=n>begin</span>
        <span class=n>state</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span> <span class=n>thinking</span><span class=p>;</span>
    	<span class=n>test</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=mi>4</span><span class=p>)</span><span class=o>%</span><span class=mi>5</span><span class=p>);</span>
        <span class=n>test</span><span class=p>((</span><span class=n>i</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>%</span><span class=mi>5</span><span class=p>);</span>
    <span class=n>end</span>
    <span class=n>begin</span>
        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span> <span class=err>â‰¦</span><span class=mi>4</span> <span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
            <span class=n>state</span><span class=p>[</span><span class=n>i</span><span class=p>]</span><span class=o>=</span> <span class=n>thinking</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=n>end</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><ul><li>ä½¿ç”¨æ–¹å¼</li></ul><p>å…±äº«è®Šæ•¸å®£å‘Šï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>dp</span><span class=err>`è®Šæ•¸åç¨±`ï¼š</span><span class=n>Dining</span><span class=o>-</span><span class=n>ph</span><span class=err>`</span><span class=n>Monitor</span> <span class=n>type</span><span class=err>`</span>
</code></pre></td></tr></table></div></div><p>Pi (iè™Ÿå“²å­¸å®¶)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c++ data-lang=c++><span class=n>repeat</span>
    <span class=n>hungry</span> <span class=n>now</span><span class=p>;</span> 
	<span class=n>dp</span><span class=p>.</span><span class=n>pickup</span><span class=p>(</span><span class=n>i</span><span class=p>);</span> <span class=c1>//åœ¨Monitorä¸­
</span><span class=c1></span>	<span class=n>eating</span><span class=p>;</span>  <span class=c1>//ä¸åœ¨Mnitorä¸­
</span><span class=c1></span>	<span class=n>dp</span><span class=p>.</span><span class=n>putdown</span><span class=p>(</span><span class=n>i</span><span class=p>);</span> <span class=c1>//åœ¨Monitorä¸­
</span><span class=c1></span>	<span class=n>thinking</span><span class=p>;</span>
<span class=n>untill</span> <span class=n>False</span><span class=p>;</span>
</code></pre></td></tr></table></div></div><h2 id=conditional-monitor>Conditional Monitor</h2><ol><li><p>ç·£ç”±ï¼šconditionè®Šæ•¸ï¼Œeg. Xæ‰€é™„å±¬çš„waiting Queue, ä¸€èˆ¬çš†æ˜¯FIFO Queue (ç”šè‡³Monitorçš„Entry Quene ä¹Ÿæ˜¯FIFO,In general)ï¼Œ<strong>å¯æ˜¯æˆ‘å€‘æœ‰æ™‚éœ€è¦Priority Queueï¼Œå„ªå…ˆç§»é™¤é«˜å„ªå…ˆæ¬Šçš„Processï¼Œæ¢å¾©åŸ·è¡Œæˆ–è®“å·²é€²å…¥Monitorå…§active</strong>ï¼Œæ­¤ç¨®monitorç¨±ä¹‹</p></li><li><p>èªæ³•æ”¹è®Šï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>x</span><span class=p>.</span><span class=n>wait</span><span class=p>(</span><span class=n>c</span><span class=p>);</span> <span class=c1>// cä»£è¡¨æ­¤processçš„priority info
</span><span class=c1></span>   
</code></pre></td></tr></table></div></div></li></ol><h2 id=ä½¿ç”¨conditional-monitorè§£æ±ºå•é¡Œ>ä½¿ç”¨Conditional Monitorè§£æ±ºå•é¡Œ</h2><ul><li>ç¯„ä¾‹ä¸€</li></ul><p>ä½¿ç”¨Monitorè§£æ±º<strong>äº’æ–¥è³‡æºçš„é…ç½®å•é¡Œ</strong></p><p><strong>è¦å®šï¼šprocessæœ€å°è€…ï¼Œå„ªå…ˆæ¬Šé«˜ï¼Œå„ªå…ˆå–å¾—è³‡æº</strong></p><p>è§£æ±ºå•é¡Œä¹‹å“²å­¸</p><blockquote><p>ã€Œéã€å„ªå…ˆæ¬Šä¹‹éœ€æ±‚->å¯«å…¥Monitorä¹‹å®šç¾©</p><p>å„ªå…ˆæ¬Šä¹‹éœ€æ±‚->åªè¦å‘ŠçŸ¥è€å¸«èªªä½ ç”¨çš„æ˜¯Priority Queueçš„Monitorå³å¯</p></blockquote><p>Ans.</p><ol><li>å…ˆå®šç¾©Monitor</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>type</span> <span class=n>ResourceAllocator</span> <span class=o>=</span> <span class=n>Monitor</span>

<span class=n>var</span> <span class=nl>Busy</span> <span class=p>:</span> <span class=n>Boolean</span> <span class=c1>//ä»£è¡¨è³‡æºé…ç½®å‡ºå»èˆ‡å¦
</span><span class=c1></span>
<span class=n>var</span> <span class=n>X</span><span class=err>ï¼š</span><span class=n>Condition</span><span class=p>;</span> <span class=c1>//ä»£è¡¨è³‡æºåˆ°åº•å¯ç”¨ä¸å¯ç”¨
</span><span class=c1></span>
<span class=n>procdure</span> <span class=n>entry</span> <span class=nf>Apply</span><span class=p>(</span><span class=nl>processId</span><span class=p>:</span><span class=kt>int</span><span class=p>)</span>
    <span class=n>begin</span>
    	<span class=k>if</span><span class=p>(</span><span class=n>Busy</span><span class=p>)</span> <span class=n>then</span>  <span class=n>x</span><span class=p>.</span><span class=n>wait</span><span class=p>(</span><span class=n>pid</span><span class=p>);</span> 
		<span class=n>Busy</span> <span class=o>=</span> <span class=n>True</span><span class=p>;</span>

<span class=n>procedure</span> <span class=n>entry</span> <span class=nf>Release</span><span class=p>()</span>
    <span class=n>begin</span>
    <span class=n>Busy</span><span class=o>=</span> <span class=n>False</span><span class=p>;</span>
	<span class=n>X</span><span class=p>.</span><span class=n>signal</span><span class=p>;</span>
	<span class=n>end</span><span class=p>;</span>

<span class=n>Begin</span><span class=p>;</span>
	<span class=n>Busy</span><span class=o>=</span> <span class=n>False</span><span class=p>;</span>
<span class=n>end</span><span class=p>;</span>    
</code></pre></td></tr></table></div></div><p>ä½¿ç”¨æ–¹å¼ï¼š</p><p>å…±äº«è®Šæ•¸å®£å‘Šå¦‚ä¸‹ï¼š</p><p>â€‹ RAï¼šResource Allocator;</p><p>â€‹ Pi(iä»£è¡¨processId)ï¼š</p><p>ç¨‹å¼å¦‚ä¸‹ï¼š</p><p>RA.Apply(i);</p><p>ä½¿ç”¨è³‡æº;</p><p>RA.Release();</p><p>æ­¤Monitorçš„X Conditionè®Šæ•¸ä¹‹waiting QueueåŠMoniorçš„entry Queueæ˜¯Priority Queueä¸”processIdå°è€…ï¼Œå„ªå…ˆæ¬Šé«˜ï¼Œå„ªå…ˆç§»å‡º</p><ul><li>ç¯„ä¾‹äºŒ ==(æœ€å¸¸è€ƒ)==</li></ul><p>æœ‰ä¸€å€‹Fileå¯è¢«å¤šå€‹Processesä½¿ç”¨ï¼Œæ¯ä¸€å€‹Processæœ‰Unique priority Noï¼Œä¸¦ä¸”å­˜å–Fileé ˆæ»¿è¶³ä»¥ä¸‹é™åˆ¶</p><ol><li><strong>æ‰€æœ‰æ­£åœ¨å­˜å–fileçš„processä¹‹priority Noä¹‹åŠ ç¸½é ˆ&lt;nï¼Œè¶…éå°±ç„¡æ³•å­˜å–</strong></li><li>process priority Noå°çš„ï¼Œå„ªå…ˆåº¦é«˜</li></ol><p>è©¦è¨­è¨ˆMonitor</p><p>Ans.</p><p>eg n =10</p><p><img src=https://i.imgur.com/ouDhBzn.png loading=lazy alt=image-20230317013644199></p><ol><li><p>å…ˆå®šç¾©Monitor</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>type</span> <span class=n>FileAccess</span> <span class=o>=</span> <span class=n>Monitor</span><span class=p>;</span>
<span class=n>var</span> <span class=nl>sum</span><span class=p>:</span><span class=kt>int</span><span class=p>;</span>
<span class=n>var</span> <span class=nl>x</span><span class=p>:</span><span class=n>condition</span><span class=p>;</span>
   
<span class=n>procedure</span> <span class=n>entry</span> <span class=nf>Access</span><span class=p>(</span><span class=nl>i</span><span class=p>:</span><span class=n>priority</span> <span class=n>No</span><span class=p>){</span>
    <span class=n>begin</span><span class=p>;</span>
    <span class=k>while</span><span class=p>((</span><span class=n>sum</span><span class=o>+</span><span class=n>i</span><span class=p>)</span><span class=err>â‰§</span><span class=n>n</span><span class=p>){</span>
        <span class=k>do</span> <span class=n>x</span><span class=p>.</span><span class=n>wait</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
    <span class=p>}</span>
    <span class=n>sum</span> <span class=o>=</span> <span class=n>sum</span> <span class=o>+</span> <span class=n>i</span> <span class=p>;</span>
    <span class=n>end</span> <span class=p>;</span>
<span class=p>}</span>
<span class=n>procedure</span> <span class=n>entry</span> <span class=nf>Leave</span><span class=p>(</span><span class=nl>i</span><span class=p>:</span><span class=n>priorityNo</span><span class=p>){</span>
    <span class=n>begin</span><span class=p>;</span>
    <span class=n>sum</span> <span class=o>=</span> <span class=n>sum</span> <span class=o>-</span><span class=n>i</span><span class=p>;</span>
    <span class=n>x</span><span class=p>.</span><span class=n>signal</span><span class=p>;</span>
    <span class=n>end</span><span class=p>;</span>
       
    <span class=n>begin</span><span class=p>;</span>
     <span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
    <span class=n>end</span><span class=p>;</span>
<span class=p>}</span>
   
</code></pre></td></tr></table></div></div></li><li><p>ä½¿ç”¨æ–¹å¼ï¼š</p><p>å…±äº«è®Šæ•¸å®£å‘Šï¼š</p><ul><li><p>FAï¼šFileAccess;</p></li><li><p>Pi(iï¼šprocess Priority No)ç¨‹å¼ï¼š</p><p>â€‹ <strong>FA.Access(i);</strong></p><p>â€‹ ä½¿ç”¨File;</p><p>â€‹ <strong>FA.Leave(i);</strong></p></li></ul></li></ol><ul><li>ç¯„ä¾‹ä¸‰</li></ul><p>æœ‰3éƒ¨printer è¢«processesä½¿ç”¨<sub>(ä¸‰å€‹äº’æ–¥è³‡æº)</sub>ï¼Œä¸”è¦å®šProcess Id å°ï¼Œå„ªå…ˆæ¬Šé«˜ã€‚</p><p>Ans.</p><p>å…ˆå®šç¾©Monitor</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=n>var</span> <span class=n>p</span> <span class=p>[</span><span class=mf>0..2</span><span class=p>]</span> <span class=n>of</span> <span class=n>Boolean</span><span class=p>;</span>
<span class=nl>x</span><span class=p>:</span><span class=n>condition</span><span class=p>;</span>
<span class=kt>int</span> <span class=nf>Acquire</span> <span class=p>(</span><span class=nl>i</span><span class=p>:</span><span class=n>processId</span><span class=p>){</span>
    <span class=k>if</span><span class=p>(</span><span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=n>and</span> <span class=n>p</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=n>and</span> <span class=n>p</span><span class=p>[</span><span class=mi>2</span><span class=p>]){</span>
        <span class=n>x</span><span class=p>.</span><span class=n>wait</span><span class=p>(</span><span class=n>i</span><span class=p>)</span>
    <span class=p>}</span>
    <span class=k>if</span><span class=p>(</span><span class=n>not</span> <span class=n>p</span><span class=p>[</span><span class=mi>0</span><span class=p>]){</span>
       <span class=n>y</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>not</span> <span class=n>p</span><span class=p>[</span><span class=mi>1</span><span class=p>]){</span>
        <span class=n>y</span> <span class=o>=</span><span class=mi>1</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=k>else</span><span class=p>{</span>
        <span class=n>y</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>p</span><span class=p>[</span><span class=n>x</span><span class=p>]</span><span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
    <span class=k>return</span> <span class=n>y</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>void</span> <span class=nf>Release</span><span class=p>(</span><span class=nl>y</span><span class=p>:</span> <span class=n>printerNo</span><span class=p>){</span>
    <span class=n>p</span><span class=p>[</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=n>False</span><span class=p>;</span>
    <span class=n>x</span><span class=p>.</span><span class=n>signal</span>
<span class=p>}</span>
</code></pre></td></tr></table></div></div><p>ä½¿ç”¨æ–¹å¼ï¼š</p><ul><li><p>å…±äº«è®Šæ•¸å®£å‘Šï¼š</p><p>PA: Allocator</p></li><li><p>Pi(i=processId)</p></li></ul><p>ç¨‹å¼å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=nl>pNo</span><span class=p>:</span> <span class=n>printerNo</span><span class=p>;</span>
<span class=n>pNo</span><span class=o>=</span><span class=n>PA</span><span class=p>.</span><span class=n>Acquire</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
<span class=c1>//ä½¿ç”¨pnoè™Ÿä¹‹åˆ—è¡¨æ©Ÿ
</span><span class=c1></span>
<span class=n>PA</span><span class=p>.</span><span class=n>Realse</span><span class=p>(</span><span class=n>pno</span><span class=p>);</span>


</code></pre></td></tr></table></div></div><p>ç¯„ä¾‹å›› <strong>ä½¿ç”¨Monitorå®šç¾©Semaphore</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>type semaphore = Monitor;
var value : int; //è™ŸèªŒå€¼
var x : condition;

procedure entry wait(){
    begin
        value = value -1;
        if (value &lt;0) then x.wait;
    end
}

procedure entry Signal(){
	 begin
	 	value = value+1;
	 	x.signal;
	 end 
}
</code></pre></td></tr></table></div></div><h2 id=monitorçš„ç¨®é¡3ç¨®>Monitorçš„ç¨®é¡(3ç¨®)</h2><ol><li><p>å€åˆ†è§’åº¦(ç·£ç”±)</p><p>å‡è¨­Process Aç›®å‰å¡åœ¨ x condition è®Šæ•¸ä¹‹ waiting Queue(å› ç‚º Q å…ˆå‰åŸ·è¡Œäº† X.waitç›®å‰ï¼Œ**Process P is active in the **)</p></li></ol><h2 id=å¹¹ä»–åª½çš„é€™é‚Šä¹Ÿæ‹–å¤ªä¹…äº†æˆ‘å—ä¸äº†æˆ‘æƒ³å…ˆå»çœ‹è¨˜æ†¶é«”ç®¡ç†-2023323>å¹¹ä»–åª½çš„ï¼Œé€™é‚Šä¹Ÿæ‹–å¤ªä¹…äº†ï¼Œæˆ‘å—ä¸äº†ï¼Œæˆ‘æƒ³å…ˆå»çœ‹è¨˜æ†¶é«”ç®¡ç† 2023/3/23</h2><h1 id=chapter-7-memory-management>Chapter 7 Memory Management</h1><p><strong>æœ¬ç« çš„è€ƒè©¦é‡é»æ˜¯åœ–ï¼Œæœ‰åœ–çš„éƒ½å¾ˆé‡è¦</strong></p><blockquote><p>Binding åŠå…¶æ™‚æ©Ÿé»</p><p>Dynamic Binding</p><p>Dynamic Loading, Dynamic Linking</p><p><strong>Contiguous Memory Allocation(Firstt/Best/Worst Fit)â˜†â˜†</strong></p><p>External Fragmentation, Internal Fragmentationâ˜†â˜†â˜†â˜†â˜†</p><p>è§£æ±ºå¤–éƒ¨ç¢è£‚æ–¹æ³•</p><blockquote><p>Compactionâ˜†â˜†</p><p>Page</p></blockquote><p><strong>Page Memory Managementâ˜†â˜†â˜†â˜†â˜†</strong></p><blockquote><p>Schema</p><p>Page Table è£½ä½œ(3å€‹)</p><p>ç›¸é—œè¨ˆç®—</p><p>Page Table Size å¤ªå¤§ä¹‹è§£æ±º(3å€‹)</p></blockquote><p><strong>Segment Memory Managementâ˜†â˜†</strong></p><p><strong>Paged Segment Memory Management</strong> [æé¾æœ¬å·²ç§»é™¤]</p></blockquote><h2 id=binding>Binding</h2><p>å®šç¾©ï¼š<strong>æ±ºå®šç¨‹å¼/processåŸ·è¡Œçš„èµ·å§‹ä½å€</strong>ï¼Œæ­¤ä¸€å‹•ä½œç¨±ä¹‹ç‚ºBinding</p><p>æ™‚æ©Ÿé»ï¼š</p><blockquote><ol><li><p><strong>Compiling Time</strong>ï¼šç”±Compilerä½œBinding</p></li><li><p><strong>Loading Time æˆ– Linking Loading Time</strong>ï¼šç”±Linking Loader æˆ– Linkage Editorä½œ</p><p>&#171;ä»¥ä¸Šå…©è€…éƒ½å«Static Binding&#187;</p></li><li><p><strong>Execution Time</strong>ï¼šç”±OSå‹•æ…‹æ±ºå®šï¼Œä¹Ÿå«<strong>Dynamic Binding</strong></p></li></ol></blockquote><p><img src=https://i.imgur.com/kIEguNv.png loading=lazy alt=image-20230322223226871></p><ol><li><p><strong>Compilerä½œBinding</strong></p><ul><li><p>ç”¢ç”Ÿä¹‹Object Codeå«åš<strong>Absolute object code(çµ•å°å¼ç›®çš„ç¢¼)</strong></p><p>eg:</p><p><img src=https://i.imgur.com/39GeUzp.png loading=lazy alt=image-20230322224154158></p></li><li><p>å¾Œé¢çš„Loaderå«ä½œ<strong>Absolute Loader</strong>ä¸»è¦æ˜¯ä½œAllocationèˆ‡Loading only</p></li><li><p>ç¼ºé»ï¼š<strong>Processè‹¥è¦æ”¹è®Šèµ·å§‹ä½å€ï¼Œå‰‡å¿…é ˆre-compilingéå¸¸ä¸ä¾¿</strong></p></li><li><p>Noteï¼šé€šå¸¸ç”¨æ–¼.COM(å‘½ä»¤æª”)</p></li></ul></li><li><p><strong>Loading Timeç”± Linking Loader ä½œBinding</strong></p><ul><li><p>Compileræ‰€ç”¢ç”Ÿå‡ºçš„Object Codeå«ä½œ<strong>Relocatable Object Code(å¯é‡å®šä½ä¹‹ç›®çš„ç¢¼)</strong></p></li><li><p><img src=https://i.imgur.com/07A826q.png loading=lazy alt=image-20230323000356425></p></li><li><p>ä½•è¬‚Relocationä¿®æ­£ï¼Ÿ</p><blockquote><p><strong>ç•¶æˆæ˜¯åŸ·è¡Œèµ·å§‹ä½å€æ”¹è®Šï¼ŒæŸäº›Object codeå…§å®¹å¿…é ˆéš¨ä¹‹ä¿®æ­£</strong>ï¼Œå°‡ä¾†æ‰èƒ½æ­£ç¢ºåŸ·è¡Œã€‚</p><p>ä¾‹ï¼šæ¡ç”¨<strong>ç›´æ¥å®šå€</strong>(Direct Addressing Mode)æŒ‡ä»¤ï¼Œå‡è¨­ä»Šå¤©èµ·å§‹ä½å€ç‚º0000ï¼Œè®Šæ•¸å„²å­˜æ–¼2000çš„ä½å€ã€‚ä»Šèµ·å§‹ä½å€æ”¹ç‚º1000å¾Œï¼Œè®Šæ•¸å„²å­˜çš„ä½å€éœ€è¦æœ‰ç›¸æ‡‰çš„æ”¹å‹•ï¼Œé€™å€‹æ”¹å‹•å€¼å°±æ˜¯å¯«åœ¨Relocationä¿®æ­£è³‡è¨Š</p></blockquote><p><img src=https://i.imgur.com/I986VNO.png loading=lazy alt=image-20230323015129289></p></li><li><p>ä½•è¬‚Linkingä¿®æ­£ï¼Ÿ</p></li></ul><blockquote><p>è§£æ±ºExternal Symbol reference(å¤–éƒ¨ç¬¦è™Ÿåƒè€ƒ)ä¹‹ä¿®æ­£</p><p>ä¾‹ï¼šå¤–éƒ¨ç¬¦è™Ÿï¼šå‰¯ç¨‹å¼åç¨±</p><p>å¤–éƒ¨è®Šæ•¸(extern)ã€Library, etc</p></blockquote><p><img src=https://i.imgur.com/PHXZ2lg.png loading=lazy alt=image-20230323020626593></p><p><img src=https://i.imgur.com/g4VuPXo.png loading=lazy alt=image-20230324002149684></p><p>Linking Loaderä¸»è¦4å€‹å·¥ä½œ</p><ol><li>Allocationï¼šä¾ç…§ç›®çš„ç¢¼ä¹‹å¤§å°ï¼Œå‘OSè¦æ±‚åˆ†é…èµ·å§‹ä½å€</li><li>Loadingï¼šobj code è¼‰å…¥åˆ°Memory</li><li><strong>Linkingï¼šä¾Compileræ‰€äº¤è¾¦ä¹‹Linkingä¿®æ­£è³‡è¨Šï¼ŒåŸ·è¡ŒLinkingä¿®æ­£</strong>ï¼Œå°‡Jump ????æ”¹ç‚º Jump 8000</li><li><strong>Relocationï¼šä½œé‡å®šä½ä¿®æ­£</strong></li></ol><p>å„ªé»ï¼š<strong>ç¨‹å¼èµ·å§‹ä½å€è‹¥è¦æ”¹è®Šï¼Œå‰‡åªéœ€é‡æ–°Relocation, Linkingå³å¯ï¼Œç„¡é ˆre-compiling</strong></p><p>ç¼ºé»ï¼š</p><ol><li><p>ç¨‹å¼é‡æ–°åŸ·è¡Œï¼Œè‹¥Modulesæ•¸å¤šï¼Œå‰‡re-linking(å¤–éƒ¨ç¬¦è™Ÿåƒè€ƒä¿®æ­£)å¾ˆèŠ±æ™‚é–“ã€‚</p></li><li><p><strong>ProcessåŸ·è¡ŒæœŸé–“ï¼Œä¸å¯æ›´æ”¹èµ·å§‹ä½å€</strong></p><p><code>Noteï¼šå‡¡æ˜¯Static Bindingçš†ç„¡æ³•æ›´æ”¹</code></p></li></ol><p>Linkage Editorçš„ä¸»è¦å·¥ä½œ</p><p><img src=https://i.imgur.com/8StIweF.png loading=lazy alt=image-20230324004823565></p></li></ol><h2 id=dynamic-binding>Dynamic Binding</h2><p>å®šç¾©ï¼šæ±ºå®šProcessèµ·å§‹ä½å€ä¹‹å·¥ä½œï¼Œæ¨é²è‡³<strong>åŸ·è¡Œæ™‚æœŸ(Execution Time)æ‰å‹•æ…‹åŸ·è¡Œ</strong>ï¼Œå³Processåœ¨åŸ·è¡ŒæœŸé–“ï¼Œå¯ä»»æ„è®Šæ›´èµ·å§‹ä½å€ï¼Œä¸”Processä»èƒ½æ­£ç¢ºåŸ·è¡Œã€‚</p><p>éœ€è¦Hardwareé¡å¤–æ”¯æŒ</p><p><img src=https://i.imgur.com/mLdkOxL.png loading=lazy alt=image-20230326195032169></p><ol><li><p>Logical Addressï¼šgenerated by CPU <code>logicalä»£è¡¨ä»¥ä½¿ç”¨è€…è§€é»ä¾†çœ‹</code></p></li><li><p>Physical Addressï¼šå¯¦éš›å»physical memory(ie. RAMå­˜å–ä¹‹ä½å€)<code>physicalä»£è¡¨ä»¥ç¡¬é«”è§€é»ä¾†çœ‹</code></p></li><li><blockquote><p>logical address = physical address = > <strong>static binding</strong></p><p>logical address â‰  Physical address = > Dynamic binding, Page, segment, Paged segmentã€‚æœƒæœ‰ã€Œlogical addressè½‰æˆphysical addressä¹‹é‹ä½œã€ï¼Œ<strong>ä¸”æ­¤é‹ä½œäº¤ç”±Hardwareè² è²¬</strong></p></blockquote></li></ol><p>å„ªé»ï¼š</p><ol><li>Processä¹‹èµ·å§‹ä½å€å¯æ–¼execution time ä»»æ„æ›´å‹•ä¸”èƒ½æ­£ç¢ºåŸ·è¡Œï¼Œæœ‰åŠ©æ–¼OS Memory Managementä¹‹å½ˆæ€§åº¦ã€‚eg. Compactionå¯¦æ–½ã€process swapoutå¾Œå†swap inï¼Œä¸ä¸€å®šè¦ç›¸åŒèµ·å§‹ä½å€\</li></ol><p>ç¼ºé»ï¼š</p><ol><li>éœ€è¦Hardwareé¡å¤–æ”¯æŒ</li><li>ProcessåŸ·è¡Œæ™‚é–“è¼ƒä¹…ã€æ•ˆç›Šè¼ƒå·®</li></ol><h2 id=dynamic-loading>Dynamic Loading</h2><p>å®šç¾©ï¼šä¹Ÿå«<strong>Load-on-Call</strong>ï¼Œåœ¨execution timeï¼Œè‹¥moduleçœŸæ­£è¢«å‘¼å«åˆ°ä¸”ä¸åœ¨memoryä¸­ï¼Œæ­¤æ™‚loaderæ‰å°‡å®ƒè¼‰å…¥åˆ°memoryä¸­ã€‚ç•¶ä¸€å€‹ç¨‹åºåªæœ‰ç•¶å®ƒçœŸæ­£è¢«å‘¼å«æ™‚æ‰è¼‰å…¥åˆ°è¨˜æ†¶é«”ä¹‹ä¸­ã€‚</p><p><strong>ç›®çš„ï¼šç¯€çœMemory space</strong></p><p>å„ªé»ï¼šä¸é ˆè¦OSä¹‹é¡å¤–æ”¯æŒ</p><p><strong>ç¼ºé»ï¼šProcessåŸ·è¡Œæ™‚é–“è¼ƒä¹…</strong></p><p>Noteï¼š<strong>æ—©æœŸä½¿ç”¨overlayçš„æŠ€å·§ï¼Œæ˜¯programmerçš„è²¬ä»»ï¼ŒOSæ²’å•¥è²¬ä»»ã€‚è¿‘ä»£å‰‡æ˜¯OSæä¾›Virtual Memoryä¾†è™•ç†</strong></p><h2 id=dynamic-linking>Dynamic Linking</h2><p>å®šç¾©ï¼šåœ¨Execution Timeï¼Œè‹¥Moduleè¢«å‘¼å«åˆ°ï¼Œæ‰å°‡ä¹‹è¼‰å…¥ï¼Œä¸¦ä¸”èˆ‡<strong>å…¶ä»–Modulesé€²è¡ŒLinkingä¿®æ­£(å¤–éƒ¨ç¬¦è™Ÿåƒè€ƒä¹‹è§£æ±º)ï¼Œé©ç”¨åœ¨Library Linking eg Dynamic Linking Library(DLL)</strong></p><p><strong>ç›®çš„ï¼šç¯€çœä¸å¿…è¦ä¹‹Linking Timeï¼Œéœ€è¦OSé¡å¤–æ”¯æŒ</strong></p><h2 id=contiguous-é€£çºŒæ€§-memory-allocation>Contiguous (é€£çºŒæ€§) Memory Allocation</h2><p>ä¹Ÿå«Dynamic Variable Partitions Memoy Management å‹•æ…‹è®Šå‹•åˆ†å€è¨˜æ†¶é«”ç®¡ç†ã€‚</p><p>OSå¿…é ˆé…ç½®Processä¸€å€‹<strong>é€£çºŒçš„Free Memory Space</strong></p><p><strong>Partitionï¼šProcessæ‰€å ç”¨çš„Memory Space</strong></p><p><strong>Partitionæ•¸ç›®ï¼Processæ•¸ç›®ï¼Multiprogramming Degree</strong>ï¼Œç”±æ–¼ä¸åŒæ™‚æœŸï¼Œç³»çµ±å…§Processæ•¸ç›®ä¸å›ºå®š</p><p>å› æ­¤<strong>Paritionæ•¸ç›®ä¸å›ºå®š(Dynamic)</strong></p><p><strong>ç”±æ–¼å„Process Sizeä¸ç›¡ç›¸åŒï¼Œå› æ­¤å„Partitionå¤§å°ä¹Ÿå°±ä¸ä¸€å®šç›¸åŒ(Variable)</strong></p><p>Memoryä¸­æœƒæœ‰ä¸€äº›<strong>Free Memory Space(or Block)</strong>ï¼Œå«åšHoleï¼Œé€šå¸¸OSæœƒç”¨LinkedListçš„æ¦‚å¿µï¼Œä¾†ç®¡ç†é€™äº›Holesï¼Œå«åšAV-List(Available List å¯ç”¨ç©ºé–“ä¸²åˆ—)</p><p><img src=https://i.imgur.com/k9sGUnf.png loading=lazy alt=image-20230326222005833></p><p>é…ç½®æ–¹æ³•</p><blockquote><ol><li>First-Fit</li><li>Best-Fit</li><li>Worst-Fit</li></ol></blockquote><ol><li>First-Fit</li></ol><p>å®šç¾©ï¼šå¾AV-Listé ­é–‹å§‹æ‰¾èµ·ï¼Œç›´åˆ°æ‰¾åˆ°ç¬¬ä¸€å€‹Holeï¼Œå…¶hole size â‰§ã€€process sizeç‚ºæ­¢ï¼Œå³å¯é…ç½®æˆ–æ‰¾å®Œæ•´æ¢ä¸²åˆ—ï¼Œæˆ–æ‰¾å®Œæ•´æ¢ä¸²åˆ—ï¼Œç„¡ä¾å¤ å¤§ç¬¦åˆç‚ºæ­¢</p><ol start=2><li>Best-Fit</li></ol><p>å®šç¾©ï¼šå¿…é ˆ<strong>æª¢æŸ¥AV-Listä¸­æ‰€æœ‰Holes</strong>æ‰¾å‡ºä¸€å€‹holeï¼Œå…¶hole sizeâ‰§process sizeï¼Œä¸”hole sizeæ¸›å»process sizeå¾Œå·®å€¼æœ€<strong>å°</strong>çš„holeï¼Œäºˆä»¥é…ç½®</p><ol start=3><li>Best-Fit</li></ol><p>å®šç¾©ï¼šå¿…é ˆ<strong>æª¢æŸ¥AV-Listä¸­æ‰€æœ‰Holes</strong>æ‰¾å‡ºä¸€å€‹holeï¼Œå…¶hole sizeâ‰§process sizeï¼Œä¸”hole sizeæ¸›å»process sizeå¾Œå·®å€¼æœ€<strong>å¤§</strong>çš„holeï¼Œäºˆä»¥é…ç½®</p><p>ä¾‹é¡Œä¸€</p><p><img src=https://i.imgur.com/yHsmFuH.png loading=lazy alt=image-20230326223538608></p><p>è‹¥Processå¤§å°=90K</p><p>å‰‡</p><ol><li>First-Fitæœƒé…ç½®"A"Blockä¹‹90Kçµ¦Processï¼Œå‰©ä¸‹"210"Kä¹‹Hole</li><li>Best-Fitæœƒé…ç½®"B"Blockä¹‹90Kçµ¦Processï¼Œå‰©ä¸‹"10"Kä¹‹Hole</li><li>Worst-Fitæœƒé…ç½®"C"Blockä¹‹90Kçµ¦Processï¼Œå‰©ä¸‹410Kä¹‹Hole</li></ol><p>ä¾‹é¡ŒäºŒ</p><p><img src=https://i.imgur.com/wkKh2QS.png loading=lazy alt=image-20230327002539199></p><p>First, Best,Worst Fitï¼Œå“ªå€‹æœ€å¥½ in memory Utilization?</p><p>First-Fit</p><p>æœ€å¾Œæœƒå‰©420Kçš„ç„¡æ³•é…ç½®</p><p><img src=https://i.imgur.com/DS8KcMB.png loading=lazy alt=image-20230326225935843></p><p>Best-Fit</p><p>çš†å¯é…ç½®</p><p><img src=https://i.imgur.com/xMES8xF.png loading=lazy alt=image-20230326230449292></p><h3 id=æ¯”è¼ƒè¡¨>æ¯”è¼ƒè¡¨</h3><div class=table-wrapper><table><thead><tr><th></th><th>æ™‚é–“æ•ˆç‡</th><th>ç©ºé–“åˆ©ç”¨åº¦</th></tr></thead><tbody><tr><td>First-Fit(å‹)</td><td>æœ€ä½³</td><td>ä½³</td></tr><tr><td>Best-Fit</td><td>å·®</td><td>æœ€ä½³</td></tr><tr><td>Worst-Fit</td><td>å·®</td><td>å·®</td></tr></tbody></table></div><h2 id=ä¸Šè¿°contiguous-memory-allocationæ–¹æ³•å‡é­é‡ä¸€å€‹å…±é€šå•é¡Œexternal-fragmentation>ä¸Šè¿°Contiguous Memory Allocationæ–¹æ³•å‡é­é‡ä¸€å€‹å…±é€šå•é¡Œ"External Fragmentation"</h2><p>External Fragmentation</p><p>å®šç¾©ï¼šåœ¨Contiguous Allocationè¦æ±‚ï¼Œç›®å‰AV-Listä¸­ä»»ä½•ä¸€å€‹hole Sizeå‡å°æ–¼process sizeï¼Œä½†é€™äº›holes size åŠ ç¸½å»â‰§process sizeï¼Œç„¶è€Œï¼Œå› ç‚ºé€™äº›holes ä¸¦ä¸é€£çºŒï¼Œå› æ­¤ä»ç„¡æ³•é…ç½®çµ¦æ­¤processï¼Œé€ æˆç©ºé–“é–’ç½®ä¸ç”¨ï¼Œmemory utilizationä½ä¹‹å•é¡Œ</p><p>ç¯„ä¾‹ï¼š</p><p>è‹¥Processå¤§å°ç‚º220Kï¼Œè€Œé€™äº›hole sizeåŠ ç¸½=250K>220Kï¼Œä½†é€™äº›holeä¸é€£çºŒï¼Œä»ç„¡æ³•é…ç½®ï¼Œ[æ]ä¸€èˆ¬è€Œè¨€ï¼Œæ¯é…ç½®Nå¤§å°ï¼Œå¹³å‡æœƒæœ‰0.5Nçš„å¤–ç¢ï¼Œæ‰€ä»¥å¤–ç¢çš„æ¯”ä¾‹ç‚º=1/3ï¼Œæ˜¯å€‹åš´é‡çš„å•é¡Œ</p><p><img src=https://i.imgur.com/aQAS2P1.png loading=lazy alt=image-20230327002915437></p><h2 id=å¦ä¸€å€‹åè©internal-fragmentationå…§éƒ¨ç¢è£‚>å¦ä¸€å€‹åè©Internal Fragmentation(å…§éƒ¨ç¢è£‚)</h2><p>å®šç¾©ï¼šé…ç½®çµ¦Processä¹‹spaceè¶…éprocess sizeï¼Œå…©è€…ä¹‹å·®å€¼ç©ºé–“ï¼Œæ­¤processä½¿ç”¨ä¸åˆ°ä¸”å…¶ä»–processesäº¦ç„¡æ³•ä½¿ç”¨ï¼Œæ­¤ä¸€æµªè²»ç©ºé–“ï¼Œç¨±ä¹‹ç‚ºå…§éƒ¨ç¢è£‚</p><p><img src=https://i.imgur.com/QtWQBwv.png loading=lazy alt=image-20230327004138907></p><h2 id=è§£æ±ºexternal-fragmentation>è§£æ±ºExternal Fragmentation</h2><p>æ–¹æ³•ä¸€ï¼šä½¿ç”¨**Compaction(èšé›†)**æŠ€è¡“</p><p>ä½œæ³•ï¼šç§»å‹•åŸ·è¡Œä¸­çš„processï¼Œä½¿å¾—åŸæœ¬éé€£çºŒçš„holesï¼Œå¾—ä»¥èšé›†å½¢æˆä¸€å€‹å¤ å¤§çš„é€£çºŒçš„Free Memory Space</p><p>ä¾‹å­ï¼šã€€</p><p><img src=https://i.imgur.com/MBzMYFZ.png loading=lazy alt=image-20230327232414541></p><p>å›°é›£è™•ï¼š</p><ol><li><p>ä¸æ˜“åˆ¶å®šæœ€ä½³çš„Compactionç­–ç•¥</p></li><li><p>Processes<strong>å¿…é ˆæ˜¯Dynamic Binding</strong>æ‰å¯æ–¼execution timeç§»å‹•</p></li></ol><p>æ–¹æ³•äºŒï¼š<strong>ä½¿ç”¨Page Memory Management</strong></p><p>æ–¹æ³•ä¸‰ï¼š<strong>Multiple Base/Limit Registeræ–¹æ³•</strong></p><p>é€™å€‹æ–¹æ³•å…¶å¯¦ä¸è¡Œè§£æ±ºï¼Œåªèƒ½é™ä½ã€‚å°‡Processæ‹†æˆCode Sectionèˆ‡Data Sectionå…©éƒ¨åˆ†ï¼Œåˆ†é–‹é…ç½®é€£çºŒçš„holeï¼Œ<strong>ä»¥é™ä½å¤–éƒ¨ç¢è£‚ç™¼ç”Ÿçš„æ©Ÿç‡</strong>ã€‚å› æ­¤ï¼Œæ¯å€‹Processéœ€è¦2å¥— Base/Limit Registersï¼Œåˆ†åˆ¥è¨˜Code SecåŠData Sec çš„èµ·å§‹ä½å€åŠå¤§å°</p><h2 id=pageåˆ†é -memory-management>Page(åˆ†é ) memory Management</h2><ul><li><p><strong>Physical Memory</strong> (i,e RAM)è¦–ç‚ºä¸€çµ„<strong>Frame(é æ¡†)<strong>ä¹‹é›†åˆï¼Œä¸”</strong>å„Frame Sizeç›¸åŒ</strong>ï¼ŒNoteï¼šFrame Sizeæ˜¯HWæ±ºå®šï¼ŒOSåªæ˜¯é…åˆï¼ŒPagingæ˜¯æ¡Physical ViewPointã€‚</p></li><li><p><strong>Logical Memory</strong> (å³User Processå¤§å°)è¦–ç‚ºä¸€çµ„<strong>Page(é é¢)<strong>ä¹‹é›†åˆï¼Œä¸”</strong>Page Size=Frame Size</strong></p></li></ul><p>RAM=400KB=40å€‹Frames</p><p>Frames=10KB</p><p>é…ç½®æ–¹å¼ï¼š<strong>OSæ¡éé€£çºŒæ€§é…ç½®åŸå‰‡</strong>ï¼Œå³è‹¥Processå¤§å°=nå€‹Pagesï¼Œå‰‡OSåªéœ€åœ¨Physical memory æ‰¾å‡º<strong>nå€‹Free Frames(ä¸ä¸€å®šè¦é€£çºŒ)ï¼Œå³å¯é…çµ¦æ­¤process</strong></p><p>OSæœƒæ›¿æ¯å€‹Processå»ºç«‹ä¸€å€‹<strong>Page Table(åˆ†é è¡¨)ï¼Œç´€éŒ„å„å€‹Pageç½®æ–¼å“ªå€‹Frame ä¹‹Frame No</strong></p><p>Noteï¼šPage Table is stoted in PCB</p><p>è‹¥Processå¤§å°=nå€‹Pagesï¼Œå‰‡å®ƒçš„Page Tableå°±æœ‰nå€‹entry(æ ¼å­)</p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/uhe1dwc.png loading=lazy alt=image-20230328205131031></p><h3 id=logical-address-è½‰-physical-address-éç¨‹by-mmuhardware>Logical Address è½‰ Physical Address éç¨‹By MMU(Hardware)</h3><p>Steps [ä¾‹ï¼šå‡è¨­Page size=10]</p><ol><li>LogicalAddressåˆå§‹æ˜¯<strong>å–®ä¸€é‡</strong>ï¼Œè‡ªå‹•æ‹†è§£æˆï¼š<img src=https://i.imgur.com/7sQbMJQ.png loading=lazy alt=image-20230328210819830></li></ol><p>â€‹ å…¶ä¸­pä»£è¡¨PageNoï¼Œdä»£è¡¨Page offset(åç§»é‡)</p><p>$$
å–®ä¸€é‡ä½å€ \div PageSize = å•†æ•¸(p)&mldr;é¤˜æ•¸(d)
$$</p><p><img src=https://i.imgur.com/U3e2Le5.png loading=lazy alt=image-20230328213544244></p><ol start=2><li><p>ä¾PæŸ¥è©¢Page Table, å–å¾—è©²Pageçš„FrameNo(é æ¡†è™Ÿç¢¼)ï¼Œä»¤ç‚ºf</p></li><li><p><strong>fèˆ‡dåˆæˆ<img src=https://i.imgur.com/sLrGWip.png loading=lazy alt=image-20230328213723596>å³ç‚ºPhysical Address</strong></p><p>æˆ– f * PageSize + d = Physical Address</p><p>eg.</p><div class=table-wrapper><table><thead><tr><th>p</th><th>d</th></tr></thead><tbody><tr><td>3</td><td>2</td></tr></tbody></table></div><p>ä¾P=3æŸ¥è¡¨ï¼Œå®ƒçš„Frame No= F7, å› æ­¤</p><div class=table-wrapper><table><thead><tr><th>f</th><th>d</th></tr></thead><tbody><tr><td>7</td><td>2</td></tr></tbody></table></div><p>=Physical Address</p><p>=7*10+2=72</p></li></ol><p><img src=https://i.imgur.com/6hez29T.png loading=lazy alt=image-20230328215606192></p><h3 id=å„ªç¼ºé»æ¯”è¼ƒ>å„ªç¼ºé»æ¯”è¼ƒ</h3><h4 id=å„ªé»>å„ªé»ï¼š</h4><ol><li><strong>æ²’æœ‰å¤–éƒ¨ç¢è£‚</strong></li><li><strong>å¯æ”¯æ´Memory SharingåŠMemory Protectionä¹‹å¯¦æ–½</strong></li><li><strong>å¯æ”¯æŒDynamic Loading, Dynamic LinkingåŠVirtual Memoryä¹‹å¯¦ç¾</strong></li></ol><p>Memory Sharing(å…±äº«)</p><p>è‹¥å¤šå€‹Processeså½¼æ­¤å…·æœ‰å…±é€šçš„<strong>Read-only Code/Data</strong> Pagesï¼Œå‰‡æˆ‘å€‘å¯ä»¥è—‰ç”±processå„è‡ªçš„Page Tableï¼Œå°‡å…±é€šPagesæ˜ å°„åˆ°åŒä¸€å€‹é æ¡†ï¼Œå¦‚æ­¤å¯ä»¥ç¯€çœmemory space</p><p><img src=https://i.imgur.com/j6gQWCf.png loading=lazy alt=image-20230328230158676></p><p>Memory Protection(ä¿è­·)</p><p>åœ¨Page Tableä¸­å¤šåŠ ä¸€å€‹æ¬„ä½ï¼š</p><p><strong>Protection Bit å€¼ç‚º</strong></p><blockquote><p>Rï¼šè¡¨æ­¤Pageåªèƒ½Read-Only</p><p>Wï¼šè¡¨æ­¤Page Read/writeéƒ½å¯ä»¥</p></blockquote><p><img src=https://i.imgur.com/p0B6b2l.png loading=lazy alt=image-20230328231459427></p><h4 id=ç¼ºé»>ç¼ºé»ï¼š</h4><ol><li><p><strong>æœ‰Internal Fragmentation</strong>ï¼Œå› ç‚ºProcesså¤§å°ä¸è¦‹å¾—æ˜¯PageSizeä¹‹æ•´æ•¸å€æ•¸ã€‚eg. PageSize=10KBï¼ŒProcesså¤§å°=32KBï¼Œå› æ­¤éœ€é…ç½®4å€‹Framesï¼Œå› æ­¤å…§ç¢=4*10-32=8KB</p><p><code>Noteï¼šè‹¥PageSizeæ„ˆå¤§ï¼Œå‰‡å…§ç¢è¶Šåš´é‡</code></p></li><li><p><strong>éœ€è¦é¡å¤–Hardwareæ”¯æ´</strong>ï¼Œä¾‹ï¼šPage Tableä¹‹è£½ä½œã€Logical Addressè½‰physical address By <strong>MMU</strong></p></li><li><p>effective memory access time è¼ƒé•·<code>å› ç‚ºæœ‰Logical Addressè½‰physical address çš„æ™‚é–“</code>ï¼Œé€™é‚Šçš„è¼ƒé•·æ˜¯ç›¸å°æ–¼Contiguousä¾†çœ‹</p></li></ol><h2 id=page-tableä¹‹è£½ä½œä¿å­˜>Page Tableä¹‹è£½ä½œ(ä¿å­˜)</h2><p>[æ–¹æ³•ä¸€] ä½¿ç”¨Registerä¿å­˜ï¼ŒPage Tableä¸­æ¯å€‹Entryå…§å®¹(frame No)</p><p>å„ªé»ï¼šå­˜å–page table æ™‚ï¼Œç„¡é ˆmemory accessï¼Œå› ç‚ºé€Ÿåº¦æœ€å¿«</p><p>ç¼ºé»ï¼š<strong>Registeræ•¸é‡æœ‰é™ï¼Œä¸é©ç”¨å¤§å‹çš„Page Table(æˆ–å¤§å‹Process)</strong></p><p>[æ–¹æ³•äºŒ] ä½¿ç”¨<strong>Memory</strong>ä¿å­˜åˆ†é è¡¨ï¼Œä¸”ç”¨ä¸€å€‹Register:PTBR(Page Table Base Register)ç´€éŒ„å®ƒåœ¨memoryä¸­ä¹‹ä½å€ï¼ŒåŠPTLR(Page Table Length Register)ç´€éŒ„Tableå¤§å°</p><p>å„ªé»ï¼š<strong>é©ç”¨æ–¼å¤§å‹Page Table</strong></p><p>ç¼ºé»ï¼š<strong>é ˆé¡å¤–å¤šä¸€æ¬¡Memory Accessä¾†å­˜å–Page Tableï¼Œå› æ­¤é€Ÿåº¦å¾ˆæ…¢</strong></p><p>[æ–¹æ³•ä¸‰] <strong>æœ€æ™®éçš„æ–¹æ³•</strong>ï¼Œ<strong>ä½¿ç”¨TLB(Translation-Lookaside Buffer)</strong> Register(æˆ–å«Associative Registers)ä¿å­˜<strong>Page Tableä¸­ç¶“å¸¸è¢«å­˜å–ä¹‹Page NoåŠFrameNo</strong>ï¼Œä¸”å®Œæ•´çš„age Tableå­˜æ–¼memoryä¸­</p><p><img src=https://i.imgur.com/ssiW1QX.png loading=lazy alt=image-20230329002106932></p><p>ä½¿ç”¨TLBä¹‹effective Memory Access Time =</p><p>$$
effective Memory Access Time=P \times (TLB time+ Memory Access Time)+ (1-P) * (TLB Time +2*Memory Access Time) \<br>where P is TLB Hit Ration
$$</p><blockquote><p>Translation Lookaside Buffer (TLB) æ˜¯ä¸€ç¨®ç¡¬é«”å¿«å–ï¼Œç”¨æ–¼åŠ é€Ÿè™›æ“¬è¨˜æ†¶é«”çš„åœ°å€è½‰æ›éç¨‹ã€‚ç•¶ç¨‹å¼å­˜å–ä¸€å€‹è™›æ“¬è¨˜æ†¶é«”é é¢æ™‚ï¼Œè™•ç†å™¨éœ€è¦å°‡è™›æ“¬åœ°å€è½‰æ›æˆå¯¦é«”åœ°å€ï¼Œæ‰èƒ½å¤ å¾è¨˜æ†¶é«”ä¸­å–å¾—è³‡æ–™ã€‚é€™å€‹è½‰æ›éç¨‹éœ€è¦æŸ¥è©¢ä¸€å€‹ç”±ä½œæ¥­ç³»çµ±ç¶­è­·çš„ç¨±ç‚ºé è¡¨çš„è³‡æ–™çµæ§‹ï¼Œä»¥ç²å–è™›æ“¬åœ°å€å’Œå¯¦é«”åœ°å€çš„å°æ‡‰é—œä¿‚ã€‚ä½†æ˜¯ï¼Œé€™å€‹æŸ¥è©¢éç¨‹éœ€è¦è¨ªå•ä¸»è¨˜æ†¶é«”ï¼Œå› æ­¤éå¸¸è€—æ™‚ã€‚ç‚ºäº†åŠ é€Ÿé€™å€‹éç¨‹ï¼Œè™•ç†å™¨ä½¿ç”¨ TLB å¿«å–äº†æœ€è¿‘çš„åœ°å€è½‰æ›è³‡æ–™ï¼Œä»¥ä¾¿åœ¨ä¸‹ä¸€æ¬¡å­˜å–ç›¸åŒè™›æ“¬é é¢æ™‚å¯ä»¥ç›´æ¥å¾å¿«å–ä¸­å–å¾—è³‡æ–™ï¼Œè€Œä¸å¿…å†æ¬¡æŸ¥è©¢é è¡¨ã€‚</p><p>TLB æ˜¯ä¸€ç¨®é—œéµçš„è™›æ“¬è¨˜æ†¶é«”å­ç³»çµ±ï¼Œå› ç‚ºåœ°å€è½‰æ›æ˜¯è™›æ“¬è¨˜æ†¶é«”ç³»çµ±ä¸­æœ€å¸¸è¦‹ã€æœ€è¤‡é›œå’Œæœ€è€—æ™‚çš„æ“ä½œä¹‹ä¸€ã€‚TLB çš„æ•ˆèƒ½ç›´æ¥å½±éŸ¿äº†ç³»çµ±çš„æ•´é«”æ•ˆèƒ½ï¼Œå› æ­¤è¨­è¨ˆé«˜æ•ˆçš„ TLB æ˜¯éå¸¸é‡è¦çš„ã€‚</p></blockquote><p>ç¯„ä¾‹ï¼š</p><p><strong>Register access Time : 0 ns(ignored)</strong></p><p><strong>Memory Access Timeï¼š200ns</strong></p><p><strong>TLB Timeï¼š100ns</strong></p><p><strong>TLB Hit Rationï¼š90%</strong></p><p>æ±‚Effective Memory Access Time if Page Table is Stored using</p><ol><li>Register</li><li>Memory</li><li>TLB</li></ol><p>Ans.</p><ol><li>200ns(åªè¨ªå•ä¸€æ¬¡è¨˜æ†¶é«”)</li><li>2*200 =400 ns</li><li>0.9 * (100+200) + 0.1 * (100+2*200) = 100+200+0.1*200=320ns</li></ol><h2 id=pagingç›¸é—œè¨ˆç®—>Pagingç›¸é—œè¨ˆç®—</h2><h3 id=å‹ä¸€-ä½¿ç”¨tlbä¹‹effective-memory-access-time>[å‹ä¸€] ä½¿ç”¨TLBä¹‹effective Memory Access Time</h3><h3 id=å‹äºŒ-logical-address-èˆ‡-physical-address-bit-æ•¸ç›®è¨ˆç®—>[å‹äºŒ] Logical Address èˆ‡ Physical Address Bit æ•¸ç›®è¨ˆç®—</h3><p>ä¾‹ä¸€ï¼š</p><ul><li><p>pageSize=1kb;</p></li><li><p>Processæœ€å¤§æœ‰8å€‹Pages</p></li><li><p>Physical Memory æœ‰32å€‹Frames</p></li></ul><p>æ±‚</p><ol><li>Logical Address length</li><li>physical Address length</li></ol><p>Ans.</p><ol><li><p>Logical address</p><div class=table-wrapper><table><thead><tr><th>p</th><th>d</th></tr></thead><tbody><tr><td>13</td><td>10</td></tr></tbody></table></div><p>å› ç‚ºpageSize=1kb= 2 <sup>10</sup>Bytes ï¼Œ<strong>æ‰€ä»¥dä½”10bits</strong>ã€‚åˆå› ç‚ºprocessæœ€å¤š8å€‹processæœ€å¤š8(2<sup>3</sup>>)å€‹Pagesã€‚æ‰€ä»¥Pä½”3bitsï¼Œå› æ­¤3+10 = 13bits</p></li><li><p>physical address</p><div class=table-wrapper><table><thead><tr><th>f</th><th>d</th></tr></thead><tbody><tr><td>15bits</td><td></td></tr></tbody></table></div><p>å› ç‚ºphysical memoryæœ‰32(2<sup>5</sup>)å€‹Framesï¼Œæ‰€ä»¥fä½”5bitsï¼Œæ‰€ä»¥5+10= 15bits</p></li></ol><h3 id=å‹ä¸‰-pagetable-sizeç›¸é—œè¨ˆç®—>[å‹ä¸‰] PageTable sizeç›¸é—œè¨ˆç®—</h3><p>1bit = 0 or 1</p><p>1 KB = 1024 bytes</p><p>1 byte= 8 bits</p><p>1MB = 1024 KB</p><p>ä¾‹ä¸€</p><ul><li>Page size=8KB</li><li>Process å¤§å° = 2MB</li><li>Page Table entry ä½”4bytes</li></ul><p>æ±‚æ­¤processçš„pageTable size?</p><p>ans</p><p>processå¤§å°= 2MB/8KB = 2<sup>21</sup>/2<sup>13</sup>=2<sup>8</sup>å€‹Pagesï¼Œé€™éº¼å¤§</p><p>å› æ­¤ Page Table æœ‰2 <sup>8</sup> entryï¼Œå› æ­¤size = 2<sup>8</sup>*4bytes = 1KB</p><p>ä¾‹äºŒ</p><ul><li>logical address = 32 bits</li><li>page size = 16kb</li><li>page table entry ä½” 4 bytes</li></ul><p>æ±‚MAX page table size?</p><p>ans</p><p><img src=https://i.imgur.com/syWnbGX.png loading=lazy alt=image-20230329231152261></p><p>å› ç‚ºPage size = 16kb = 2 <sup>14</sup> bytesï¼Œæ‰€ä»¥dä½”14bitesï¼Œæ‰€ä»¥pä½”32-14= <strong>18bits</strong></p><p>process æœ€å¤§å¯ä»¥æœ‰2<sup>18</sup>Pagesï¼Œæ‰€ä»¥MAX. page Table size = 2 <sup>18</sup> å€‹entry * 4bytes= 1MB</p><p>Ex. æ‰¿ä¸Š è‹¥Logical Adress = 48 bitså‘¢?</p><p>Ans:</p><p>p ä½” 48-14 = 34 bits</p><p>å› æ­¤MAX page table size = 2<sup>34</sup> * 4 bytes = 64GB</p><p><strong>Noteï¼špage table size å¤ªå¤§æ˜¯å€‹è­°é¡Œï¼ï¼</strong></p><p>ä¾‹ä¸‰</p><ul><li>Page Size = 16 KB</li><li>Page Table entry ä½” 4 bytes</li><li>MAX Page Table Size æ°ç‚ºone Page æ±‚ Logical Address length</li></ul><p>å› ç‚ºPage size = 16KB = 2 <sup>14</sup> bytesï¼Œæ‰€ä»¥dä½”14 bitsï¼Œå› ç‚ºMAX Page Table Size = One Page = 16KBã€‚å› ç‚ºMAX Page Table = 16KB/ 4 bytes = 2<sup>12</sup>entryï¼Œå› æ­¤Pä½”12bitsï¼Œå› æ­¤12+14= 26 bits</p><h3 id=å‹å››-page-table-size-å¤ªå¤§ä¹‹è§£æ³•çš„ç›¸é—œè¨ˆç®—-è€ƒè©¦å¿…è€ƒ>[å‹å››] Page Table Size å¤ªå¤§ä¹‹è§£æ³•çš„ç›¸é—œè¨ˆç®— (è€ƒè©¦å¿…è€ƒ)</h3><h2 id=page-table-size-å¤ªå¤§-ä¹‹è§£æ±ºæ–¹æ¡ˆ>Page Table Size å¤ªå¤§ ä¹‹è§£æ±ºæ–¹æ¡ˆ</h2><ol><li><p><strong>â˜†â˜†â˜†â˜†â˜†MultiLevel Paging(Hierarchical Paging)(Paging the Page Table)(Forward Mapping)</strong></p></li><li><p>Hashing Page Table</p></li><li><p><strong>â˜†â˜†â˜†â˜†â˜†Inverted Page Table</strong></p></li></ol><h3 id=multilevels-paging>Multilevels Paging</h3><p>è€ƒçš„é »ç‡è¼ƒé«˜</p><p>å®šç¾©ï¼šä¸¦ä¸æ˜¯æŠŠåˆ†é è¡¨ç¸®å°ï¼Œè€Œæ˜¯ç¸®æ¸›æŠ“é€²ä¾†çš„åˆ†é è¡¨çš„å…§å®¹ï¼ŒåªæŠ“æœ‰éœ€è¦çš„å€é–“ï¼Œä¸éœ€è¦å°‡æ•´å€‹Page Table è¼‰å…¥é€²memoryä¸­ï¼Œè€Œæ˜¯<span style=color:#ff0>è¼‰å…¥éƒ¨åˆ†éœ€è¦çš„å…§å®¹å°±å¥½</span>ï¼Œå› æ­¤æå‡ºå¤šå±¤æ¬¡çš„Pagingçš„åšæ³•ï¼Œä¾‹ï¼š<strong>ä»¥2-level paging ç‚ºä¾‹</strong>ï¼Œç•¶ç„¶ä½ æƒ³è¦åˆ†3, 4 ,5 å±¤éƒ½å¯ä»¥ï¼Œä½ çˆ½å°±å¥½</p><p><img src=/C:%5cUsers%5cza546%5cAppData%5cRoaming%5cTypora%5ctypora-user-images%5cimage-20230330003135347.png loading=lazy alt=image-20230330003135347></p><ul><li>Level 1 Page Table ï¼šæœ‰2<sup>x</sup>å€‹entryï¼Œæ¯å€‹entry ç´€éŒ„æŸå€‹Level-2 Page Table</li><li>Level 2 Page Table ï¼šæœ‰2<sup>y</sup>å€‹entryï¼Œæ¯å€‹entryç´€éŒ„Frame No.</li></ul><p><img src=https://i.imgur.com/dRpeTZW.png loading=lazy alt=image-20230330003742535></p><ul><li>Processåœ¨åŸ·è¡Œæ™‚åªé ˆ1å€‹Level 1- Page Tableä»¥åŠæŸ1å€‹ Level 2 - Page Tableåœ¨memoryä¸­å³å¯ï¼Œå› æ­¤å¯å¤§å¹…é™ä½Pable Tableå ç”¨ä¹‹Memory Space</li></ul><p>ç¼ºé»ï¼š<strong>effective Memory Access Timeæ›´ä¹…</strong>ï¼Œå› ç‚ºé ˆå¤šæ¬¡Memory Accesså­˜å–Page Table</p><p>ä¾‹å¦‚</p><p>Two-Level Paging -> æ•´å€‹éç¨‹é ˆä¸‰æ¬¡MA</p><p>Three-Level Paging - > æ•´å€‹éç¨‹é ˆå››æ¬¡MA</p><p>ç›¸é—œè¨ˆç®—ï¼š</p><p>ä¾‹ä¸€ï¼š</p><ul><li>TLB Timeï¼š100ns</li><li>TLB Hit Ratioï¼š80%</li><li>Memory Access(MA) Time ï¼š200ns</li><li>Two-Level Paging æ¡ç”¨</li></ul><p>æ±‚æœ‰æ•ˆMemory Access Time</p><p>Ans.</p><p>0.8 * (100ns + 200ms) +0.2 * (100ns+3*200ns)</p><p>ä¾‹äºŒï¼š</p><ul><li>Logical Address= 32 bits</li><li>Page Size = 4KB</li><li>Page Table Entry ä½” 4 bytes</li></ul><p>åœ¨ä»¥ä¸‹å¹¾ç¨®æƒ…ä¸‹ï¼Œæ±‚Max. Page Table Size</p><ol><li>Single-level-paging</li><li>Two-level paging ä¸”Level-1 Pagingèˆ‡Level 2 Paging Bitæ•¸ç›¸ç­‰</li></ol><p>Ans.</p><ol><li><p><img src=https://i.imgur.com/ez1sZgK.png loading=lazy alt=image-20230331005008885></p></li><li><p><img src=https://i.imgur.com/uvmaBGc.png loading=lazy alt=image-20230331005534600></p><p>å› ç‚ºLevel-1åŠLevel-2 Paging å„ä½” 20/2 = 10bitsï¼Œæ‰€ä»¥</p><p>1å€‹level-1 Page Table MAX Size = 2<sup>10</sup>*4bytes = 4 KB,</p><p>1å€‹Level-2 Page Table MAX Size = 2<sup>10</sup>*4bytes=4KB</p><p>å› æ­¤é ‚å¤š4KB+4KB= 8KB in the memory</p></li></ol><p>ä¾‹ä¸‰ï¼š</p><ul><li>Logical Address = 65 bits</li><li>Page Size = 16kb</li><li>Page Table entry ä½” 4 bytes;</li><li><strong>ä»»ä¸€ Level Pagingä¹‹MAX Page Table Sizeé ‚å¤šç‚ºOne Page</strong></li></ul><p>å‰‡è‡³å°‘åˆ†å¹¾å±¤ ?-level Paging</p><p>Ans.</p><p><img src=https://i.imgur.com/5BqLTFC.png loading=lazy alt=image-20230331011238059></p><p>å› ç‚ºä»»ä¸€levelä¹‹MAX Page table Size = One Page = 16KBï¼Œ</p><p>æ‰€ä»¥ä»»ä¸€Levelä¹‹Page Table æœ€å¤šæœ‰ 16KB / 4 bytes =span 2<sup>12</sup>å€‹Entry</p><p>æ‰€ä»¥ä»»æ„Level Paging Bitsæ•¸ â‰¦ 12bits</p><p>50 / 12 = 5 Level</p><p><img src=https://i.imgur.com/DVVkFug.png loading=lazy alt=image-20230331011244762></p><h3 id=hashing-page-table>Hashing Page Table</h3><p>è€ƒçš„æ©Ÿæœƒè¼ƒå°‘</p><p>å®šç¾©ï¼šåˆ©ç”¨Hashing æŠ€å·§ï¼Œå°‡Page Table è¦–ç‚ºHash Tableï¼Œå…·æœ‰ç›¸åŒçš„Hasing Addressçš„Page NoåŠä»–çš„Frame Noè³‡è¨Šï¼Œæœƒç½®å…¥æ–¼åŒä¸€å€‹Entry(Bucket)ä¸­ï¼Œä¸”å·²<strong>Link List</strong>(Chain)ä¸²æ¥ï¼Œåœ–ç¤ºå¦‚ä¸‹ï¼š</p><p><img src=https://i.imgur.com/QqvinfA.png loading=lazy alt=image-20230402145915308></p><p>ç¼ºé»ï¼š<strong>ä½¿ç”¨Linear Search åœ¨Link Listä¸­æ‰¾ç¬¦åˆçš„Page Noï¼Œè¼ƒç‚ºè€—æ™‚</strong></p><p>ä¾‹é¡Œï¼š</p><ul><li>H(x)= X % 53</li><li>Page Table Entry ä½” 4 bytes</li><li>æ±‚Hashing Page Table Size</li></ul><p>Ansï¼šæœ‰53å€‹entry ï¼Œæ‰€ä»¥53 * 4 = 212 bytes</p><h3 id=inverted-page-table>Inverted Page Table</h3><p>åè½‰åˆ†é è¡¨ï¼Œè€ƒçš„é »ç‡è¼ƒé«˜</p><p>å®šç¾©ï¼šå¤§éƒ¨åˆ†çš„è§£æ±ºæ–¹æ¡ˆéƒ½æ˜¯ä»¥Processç‚ºå°è±¡ï¼Œé€™å€‹æ–¹æ³•æ”¹ç‚ºä»¥è¨˜æ†¶é«”ç‚ºå°è±¡ã€‚<strong>æ˜¯ä»¥Physical Memoryç‚ºè¨˜éŒ„å°è±¡ï¼Œä¸¦éä»¥Processç‚ºå°è±¡</strong>ï¼Œå³è‹¥æœ‰Nå€‹Framesï¼Œå‰‡æ­¤è¡¨å°±æœ‰nå€‹entryï¼Œ<span style=color:#ff0><strong>æ¯å€‹entryç´€éŒ„ &lt;Process Id, Page No>ï¼Œé…å°è³‡è¨Šï¼Œä»£è¡¨æ­¤Frameå­˜æ”¾çš„æ˜¯å“ªå€‹Processçš„å“ªå€‹Page</strong>ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œæ•´å€‹ç³»çµ±åªæœ‰ä¸€ä»½è¡¨æ ¼</span></p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/o8CZLoB.png loading=lazy alt=image-20230402153519417></p><p>ç¼ºé»ï¼š</p><ol><li><p>å¿…é ˆä½¿ç”¨&lt;Process Id, Page No> è³‡è¨Šï¼Œä¸€ä¸€æ¯”å°æŸ¥è©¢ï¼Œæ­¤èˆ‰<u>ç”šç‚ºè€—æ™‚</u></p></li><li><p><strong><span style=color:#ff0>å–ªå¤±äº†Memory Sharaingä¹‹å¥½è™•ï¼Œå³ç„¡æ³•æ”¯æŒå…¶å¯¦ç¾</span></strong>ï¼Œå› ç‚ºProcess Idä¸ä¸€æ¨£</p></li></ol><p>ä¾‹é¡Œï¼š</p><ul><li>Page Size = 8 KB</li><li>Physical Memory = 16 GB</li><li>Page Table entry ä½” 4 bytes</li><li>æ±‚Inverted Page Table ä¹‹ size?</li></ul><p>Ans.</p><p><em><em>physical memory æœ‰ 16 GB/ 8 KB= 2<sup>34</sup> / 2<sup>13</sup> = 2 <sup>21</sup>å€‹framesï¼Œæ‰€ä»¥Inverted page table æœ‰2<sup>21</sup>å€‹entryï¼Œæ‰€ä»¥size = 2<sup>21</sup></em> 4 bytes= 8MB</em>*</p><h2 id=segment-memory-management>Segment Memory Management</h2><ol><li><p><span style=color:#ff0><strong>Physical</strong> <strong>Memory</strong></span> è¦–ç‚ºä¸€å€‹å¤ å¤§çš„é€£çºŒå¯ç”¨ç©ºé–“</p></li><li><p><span style=color:#ff0><strong>Logical memory(process)è¦–ç‚ºä¸€çµ„Segment(æ®µ)ä¹‹é›†åˆï¼Œä¸”å„æ®µå¤§å°ä¸ä¸€å®šç›¸åŒï¼Œæ®µçš„è§€é»æ˜¯æ¡ç”¨Logical viewpoint</strong></span>ï¼Œèˆ‡userå°memoryä¹‹çœ‹æ³•ä¸€è‡´</p><p>ä¾‹ï¼š<span style=color:#ff0>code segment, Data segment, stack segment</span> etc&mldr;</p></li><li><p><span style=color:#ff0>é…ç½®åŸå‰‡ï¼š</span></p><ol><li><p><span style=color:#ff0>æ®µèˆ‡æ®µä¹‹é–“å¯ä»¥æ˜¯éé€£çºŒæ€§é…ç½®</span></p></li><li><p><span style=color:#ff0>ä½†å°æ¯ä¸€å€‹æ®µè€Œè¨€ï¼Œå¿…é ˆå ç”¨é€£çºŒçš„(Sapce)ç©ºé–“</span></p></li></ol></li><li><p>Osæœƒæ›¿æ¯å€‹Processå»ºç«‹<strong>Segment Tableåˆ†æ®µè¡¨</strong>ï¼Œç´€éŒ„æ¯å€‹æ®µçš„<strong>Limit</strong>(å¤§å°)å³<strong>Base</strong>(èµ·å§‹ä½å€)</p></li><li><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/2uhiWfP.png loading=lazy alt=image-20230402163145272></p></li><li><p><strong>Logical Addressè½‰physical Address</strong></p><ol><li><p><strong>Logical Address initiallyæ˜¯<u>å…©å€‹é‡</u></strong>ï¼Œ[ s | d ]å…¶ä¸­sæ˜¯æ®µç·¨è™Ÿï¼Œdæ˜¯æ®µçš„offset</p></li><li><p><strong>ä¾SæŸ¥åˆ†æ®µè¡¨ï¼Œå–å¾—å®ƒçš„limitåŠBase</strong></p></li><li><p>**Check d &lt; limit ?**è‹¥æˆç«‹ï¼Œä»£è¡¨åˆæ³•ï¼Œæ‰€ä»¥physical address = Base + dï¼Œè‹¥ä¸æˆç«‹ï¼Œå‰‡ä»£è¡¨éæ³•å­˜å–</p><p><img src=https://i.imgur.com/WoBKZJK.png loading=lazy alt=image-20230402164329222></p></li></ol></li></ol><p>ä¾‹é¡Œï¼š</p><p>åˆ†æ®µè¡¨å¦‚ä¸‹ï¼Œæ±‚ä¸‹åˆ—Logical Address<sub>s,dÂ </sub>ä¹‹physical Address?</p><div class=table-wrapper><table><thead><tr><th></th><th>Limit</th><th>Base</th></tr></thead><tbody><tr><td>0</td><td>100</td><td>4200</td></tr><tr><td>1</td><td>500</td><td>80</td></tr><tr><td>2</td><td>830</td><td>7300</td></tr><tr><td>3</td><td>940</td><td>1000</td></tr></tbody></table></div><ol><li>(0,90)</li><li>(1,380)</li><li>(2,900)</li><li>(3,940)</li></ol><p>Ans.</p><ol><li><p>å› ç‚º90&lt;100ï¼Œæ‰€ä»¥åˆæ³•ã€‚4200+90 = 4290</p></li><li><p>å› ç‚º380&lt; 500ï¼Œæ‰€ä»¥åˆæ³•ã€‚80+380 = 460</p></li><li><p>å› ç‚º900 > 830ï¼Œä¸åˆæ³•ã€‚éæ³•å­˜å–</p></li><li><p>å› ç‚º940 ä¸å°æ–¼940ï¼Œä¸åˆæ³•ã€‚éæ³•å­˜å–</p></li><li><p>å„ªé»</p><ol><li><p><strong>æ²’æœ‰å…§éƒ¨ç¢è£‚</strong></p></li><li><p>å¯æ”¯æŒMemory SharingåŠMemory protectionï¼Œä¸”æ¯”Pageå®¹æ˜“å¯¦æ–½(å› ç‚ºæ®µæ˜¯æ¡ç”¨Logical viewpoint)</p><p>eg. ä»¥Protectionç‚ºä¾‹</p><p><img src=https://i.imgur.com/gau5RjN.png loading=lazy alt=image-20230402171913562></p></li><li><p>å¯æ”¯æŒDynamic Loading , Linking åŠ Vitual Memory å¯¦æ–½</p></li></ol></li><li><p>ç¼ºé»</p><ol><li><strong>æœ‰å¤–éƒ¨ç¢è£‚</strong></li><li>å¿…é ˆè¦æœ‰é¡å¤–ç¡¬é«”æ”¯æŒï¼Œä¾‹å¦‚åˆ†æ®µè¡¨çš„ä¿å­˜ã€logical addressè½‰physical address</li><li>Effective memory access time æ›´ä¹…</li></ol></li></ol><h2 id=pageèˆ‡segmentæ¯”è¼ƒè¡¨>Pageèˆ‡Segmentæ¯”è¼ƒè¡¨</h2><div class=table-wrapper><table><thead><tr><th>Page</th><th>Segment</th></tr></thead><tbody><tr><td>å„Page Sizeç›¸åŒ</td><td>å„æ®µå¤§å°ä¸ä¸€å®šç›¸åŒ</td></tr><tr><td>ç”¨physical viewpoint</td><td>logical viewpoint</td></tr><tr><td>ç„¡å¤–éƒ¨ç¢è£‚</td><td>æœ‰å¤–éƒ¨ç¢è£‚</td></tr><tr><td>æœ‰å…§éƒ¨ç¢è£‚</td><td>ç„¡å…§éƒ¨ç¢è£‚</td></tr><tr><td>Memory protectionåŠSharing<span style=color:#ff0>è¼ƒé›£å¯¦æ–½</span></td><td><span style=color:#ff0>è¼ƒå®¹æ˜“å¯¦æ–½</span></td></tr><tr><td><span style=color:#ff0>ç„¡é ˆ</span>Check page offset &lt; page size</td><td><span style=color:#ff0>é ˆ check æ®µ offset &lt; æ®µå¤§å°</span></td></tr><tr><td>Logical address initially <span style=color:#ff0>å–®ä¸€é‡</span></td><td><span style=color:#ff0>å…©å€‹é‡&lt;s,d></span></td></tr><tr><td>Page Tableç´€éŒ„Frame No</td><td>åˆ†æ®µè¡¨ç´€éŒ„æ®µçš„Limit åŠBase</td></tr></tbody></table></div><h2 id=paged-segment-memory-management>Paged Segment Memory Management</h2><p>[æ]ç¾å·²ç§»é™¤ï¼Œç•¶ä½œè£œå……</p><p>è§€å¿µï¼šprocess &mdash;> æ®µçµ„æˆ &mdash;> Page çµ„æˆã€‚<u>æ®µåœ¨åˆ†é </u><code>(Processç”±ä¸€å †æ®µæ§‹æˆï¼Œæ®µå†ç”±é é¢æ§‹æˆ)</code></p><p>å‹•æ©Ÿï¼šå¸Œæœ›ä¿æœ‰åˆ†æ®µæ¡logical viewpointçš„å¥½è™•ï¼Œä¸”åˆè¦è§£æ±ºå¤–éƒ¨ç¢è£‚ï¼Œæ‰€ä»¥æ®µå†åˆ†é </p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/kwg8e5y.png loading=lazy alt=image-20230403162821988></p><h2 id=å°çµ-1>å°çµ</h2><p>å››å¤§è¨˜æ†¶é«”ç®¡ç†æ–¹å¼ï¼Œ</p><div class=table-wrapper><table><thead><tr><th></th><th>Contiguous Allocation</th><th>Page(ä¸»è§’ï¼Œè€ƒæœ€å¤š)</th><th>Segment</th><th>Paged Segment</th></tr></thead><tbody><tr><td>å¤–éƒ¨ç¢è£‚</td><td>æœ‰</td><td>ç„¡</td><td>æœ‰</td><td>ç„¡</td></tr><tr><td>å…§éƒ¨ç¢è£‚</td><td>ç„¡</td><td>æœ‰</td><td>ç„¡</td><td>æœ‰</td></tr></tbody></table></div><p>047</p><h1 id=ch8-virtula-memory-è™›æ“¬è¨˜æ†¶é«”>Ch8 Virtula Memory (è™›æ“¬è¨˜æ†¶é«”)</h1><blockquote><p>[åŸºæœ¬]ä¸»è¦ç›®çš„(å„ªé»)ä»¥åŠé™„å¸¶å¥½è™•</p><p>[åŸºæœ¬]Demand PagingæŠ€è¡“</p><p>â˜†â˜†â˜†Page fault å³å…¶è™•ç†æ­¥é©Ÿ</p><p>â˜†â˜†â˜†â˜†â˜†Effective Memory Access timeè¨ˆç®— in virtual memory</p><p>å½±éŸ¿Page fault rationä¹‹å› ç´ </p><p>â˜†â˜†â˜†â˜†â˜†Page replacement åŠå…¶æ³•å‰‡ã€è¨ˆç®—é¡Œã€åŠç›¸é—œåè©(Modification Bit, Belady Anomaly, stack property)</p><p>â˜†Frameæ•¸åˆ†é…å¤šå¯¡ä¹‹å½±éŸ¿</p><p>â˜†â˜†â˜†â˜†â˜†Thrashingç¾è±¡åŠå…¶è§£æ³•</p><p>â˜†â˜†Page Size å¤§å°ä¹‹å½±éŸ¿</p><p>â˜†â˜†â˜†Program structure ä¹‹å½±éŸ¿</p><p>â˜†â˜†â˜†â˜†Copy-on-writeä¹‹æŠ€è¡“ (3ç¨®Fork())</p><p>â˜†TLB Reach</p></blockquote><h2 id=ä¸»è¦ç›®çš„å„ªé»ä»¥åŠé™„å¸¶å¥½è™•>ä¸»è¦ç›®çš„(å„ªé»)ä»¥åŠé™„å¸¶å¥½è™•</h2><p>å„ªé»ï¼š<strong>å…è¨±Process size åœ¨è¶…éphysical memory å¯ç”¨ç©ºé–“å¤§å°æƒ…æ³ä¸‹ï¼Œprocessä»èƒ½é€²è¡Œ</strong>ï¼Œæ˜¯OSçš„è²¬ä»»(è² æ“”)ï¼Œprogrammerræ²’ä»€éº¼è² æ“”</p><p>é™„å¸¶å¥½è™•ï¼š</p><ol><li>Memory Utilizationè¼ƒé«˜</li><li>ç›¡å¯èƒ½åœ°çš„æå‡Multiprogramming Degreeï¼Œå¢é«˜CPU Utilizationï¼ŒNoteï¼šThrasingé™¤å¤–</li><li>I/O Transfer(å‚³è¼¸) Timeè¼ƒå° Noteï¼š<strong>I/Oæ¬¡æ•¸ã€Total Timeå¢åŠ </strong></li><li>programmeråªé ˆå°ˆå¿ƒå¯«å¥½ç¨‹å¼å³å¯ï¼Œæ¯‹é ˆç…©æƒ±ç¨‹å¼éå¤§ç„¡æ³•åŸ·è¡Œä¹‹å•é¡Œï¼Œé€™æ˜¯OSçš„è²¬ä»»ï¼Œæ‰€ä»¥Programmerä¹Ÿä¸é ˆè¦ï¼Œéæ™‚çš„overlayæŠ€è¡“</li></ol><h2 id=å¯¦ç¾virtual-memoryçš„æŠ€è¡“ä¹‹ä¸€demand-pagingéœ€æ±‚åˆ†é >å¯¦ç¾Virtual Memoryçš„æŠ€è¡“ä¹‹ä¸€ã€€Demand Paging(éœ€æ±‚åˆ†é )</h2><p>æ˜¯æ¶æ§‹åœ¨Page Memory Management åŸºç¤ä¸Šã€‚å·®åˆ¥åœ¨æ–¼æ¡ç”¨<span style=color:#ff0>Lazy Swapperè§€å¿µ</span><span style=color:#ff0>ï¼Œå³Processåœ¨åŸ·è¡Œä¹‹åˆï¼Œæ¯‹é ˆäº‹å…ˆè¼‰å…¥å…¨éƒ¨çš„Pageï¼Œè€Œæ˜¯æŒ‡è¼‰å…¥éƒ¨åˆ†çš„Pages(ç”šè‡³ä¸è¼‰å…¥ä»»ä½•Pageï¼ŒPure demand paging)</span>ï¼ŒProcesså³å¯åŸ·è¡Œã€‚</p><ul><li>è‹¥ProcessåŸ·è¡Œæ™‚ï¼Œå®ƒæ‰€éœ€è¦çš„Pagesçš†åœ¨Memoryä¸­ï¼Œå‰‡Processæœ¬èº«ä¸€åˆ‡ç„¡èª¤åœ°åŸ·è¡Œ</li><li><span style=color:#ff0>è‹¥ProcessåŸ·è¡Œæ™‚ï¼Œä¼åœ–å­˜å–ä¸åœ¨memoryä¸­çš„Pagesï¼Œå‰‡ç¨±ç‚ºç™¼ç”Ÿ<strong>Page Fault</strong>ï¼ŒOSå¿…é ˆè™•ç†ï¼Œå°‡Processæ‰€éœ€çš„lost Page(missed page)è¼‰å…¥åˆ°Memory ä¸­ from diskï¼Œ</span>processæ‰å¯åŸ·è¡Œ</li></ul><p>åœ¨Page Tableä¸­é ˆå¼•é€²ä¸€å€‹æ¬„ä½ï¼š<span style=color:#ff0>Valid/ Invalid Bit ï¼Œç”¨ä»¥å€åˆ†æ­¤pageæ˜¯å¦åœ¨memoryç•¶ä¸­</span></p><p>Vï¼šè¡¨åœ¨memory</p><p>Iï¼šè¡¨ä¸åœ¨memory</p><p>Noteï¼šæ­¤Bitæ˜¯ç”±OS set and modifyã€‚MMU reference</p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/YqMmrBa.png loading=lazy alt=image-20230403222803230></p><h2 id=page-fault-ä¹‹è™•ç†-steps>Page fault ä¹‹è™•ç† Steps</h2><ol><li>MMUæœƒç™¼å‡ºä¸€å€‹Address error interrupt é€šçŸ¥OS</li><li>OSæ”¶åˆ°ä¸­æ–·å¾Œï¼Œå¿…é ˆè¦æš«åœç›®å‰Processä¹‹åŸ·è¡Œä¸”ä¿å­˜å…¶Status info</li><li>OSæª¢æŸ¥Processä¹‹å­˜å–ä½å€æ˜¯å¦åˆæ³•ã€‚<ol><li>è‹¥éæ³•ï¼Œå‰‡çµ‚æ­¢æ­¤Process</li><li><span style=color:#ff0>è‹¥åˆæ³•ï¼Œå‰‡SOåˆ¤å®šæ˜¯ç”±Page Faultæ‰€å¼•èµ·</span></li></ol></li><li>OSå…ˆå»Memoryä¸­æª¢æŸ¥æœ‰ç„¡Freeçš„Frame<ol><li><span style=color:#ff0>è‹¥æ²’æœ‰ï¼Œå‰‡OSå¿…é ˆåŸ·è¡ŒPage Replacementå·¥ä½œï¼Œ</span>ä»¥ç©ºå‡ºä¸€å€‹Free Frame</li><li>æœ‰çš„è©±å°±æŠŠé é¢æŠ“è¿‘ä¾†</li></ol></li><li><span style=color:#ff0>OSå†åˆ°Diskä¸­æ‰¾å‡ºLost Pageæ‰€åœ¨ä½ç½®ï¼Œå•Ÿå‹•I/Oé‹ä½œï¼Œå°‡Lost Page è¼‰å…¥åˆ°Free Frameä¸­</span></li><li><span style=color:#ff0>ç„¶å¾Œï¼ŒOSä¿®æ”¹Page Table</span>ç´€éŒ„æ­¤Pageçš„Frame No<span style=color:#ff0>ï¼Œä»¥åŠå°‡Invailaid å€¼æ”¹ç‚ºValidå€¼</span></li><li><span style=color:#ff0>OS æ¢å¾©ä¸­æ–·ä¹‹å‰Processçš„åŸ·è¡Œ</span></li></ol><p>No.</p><ol><li>p8-5ç°¡å–®ä¸€é»</li><li>p8-7 æ›´å¤šä¸€äº›stpes</li></ol><h2 id=effective-memory-access-timeè¨ˆç®—-in-virtual-memory>Effective Memory Access Timeè¨ˆç®— in Virtual Memory</h2><p>å…¬å¼ï¼š</p><p>$$
(1-p) \times \begin{matrix}\text{memory} \ \text{Access} \\text{Time}\end{matrix} + P \times \begin{matrix}\text{Page Fault} \ \text{Process Time} \\end{matrix}
$$</p><p><span style=color:#ff0>Process Fault Process Timeçš„æ™‚é–“è¶…ç´šä¹…ï¼</span></p><p>where P is Page Fault Ration</p><p>ç¯„ä¾‹1.</p><ul><li>Memory Access Time: 200ns</li><li>Page Fault process time: 5ms</li></ul><ol><li>è‹¥Page Fault ration = 10 %ï¼Œæ±‚effective memory access time</li></ol><p>ans. <span style=color:#ff0>(1-0.1) * 200ns + 0.1 *5ms = 180ns + 0.1 * 5 % 10 <sup>6</sup>ns = 500180ns</span></p><div class=table-wrapper><table><thead><tr><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>m</td><td>milli</td><td>æ¯«</td><td>10<sup>-3</sup></td></tr><tr><td>u</td><td>micro</td><td>å¾®</td><td>10<sup>-6</sup></td></tr><tr><td>n</td><td>nano</td><td>å¥ˆ</td><td>10<sup>-9</sup></td></tr></tbody></table></div><p>ç¯„ä¾‹2. `</p><p>è‹¥å¸Œæœ›effective memory access timeä¸è¶…é2 msï¼Œå‰‡Page fault rationæ‡‰ç‚º?</p><p>Ans.</p><p><span style=color:#ff0>(1-p) * 200ms + p * 5ms â‰¦ 2msÂ </span></p><p>= p â‰’ 2/5</p><h2 id=å°çµ-2>å°çµ</h2><p><span style=color:#ff0>æ¬²é™ä½effective memory Access Time</span>æå‡VMæ•ˆç›Šï¼Œé—œéµåšæ³•åœ¨æ–¼<span style=color:#ff0>é™ä½Page Fault Ration</span></p><p>[049]</p><h2 id=å½±éŸ¿page-fault-rationå› ç´ >å½±éŸ¿Page Fault rationå› ç´ </h2><blockquote><ol><li>Page Replacement æ³•å‰‡ä¹‹é¸æ“‡</li><li>Frame æ•¸ç›®åˆ†é…å¤šå¯¡ä¹‹å½±éŸ¿</li><li>Page Size å½±éŸ¿</li><li>Program Structure ä¹‹å½±éŸ¿</li></ol></blockquote><h2 id=page-replacementé é¢æ›¿æ›>Page Replacement(é é¢æ›¿æ›)</h2><p>å®šç¾©ï¼šç•¶<span style=color:#ff0>Page Faultç™¼ç”Ÿ</span>ä¸”<span style=color:#ff0>Memoryä¸­ç„¡Free frameæ™‚</span>ï¼ŒOSå¿…é ˆåŸ·è¡Œæ­¤å·¥ä½œï¼Œ<span style=color:#ff0>å³é¸ä¸€å€‹Victim Page (or the replaced page)</span>å°‡å®ƒSwap outåˆ°Diskä¿å­˜ï¼Œä»¥ç©ºå‡ºä¸€å€‹Free Frame</p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/KPYXyYi.png loading=lazy alt=image-20230404114127009></p><p><span style=color:#ff0>æœƒé¡å¤–å¤šå‡ºä¸€å€‹Disk I/Oé‹ä½œï¼Œæ‰€ä»¥Page falut process timeæ›´ä¹…</span></p><p>å¦‚ä½•é™ä½Swap outæ­¤ä¸€é¡å¤–I/Oæ¬¡æ•¸ï¼Ÿ</p><p>ä½œæ³•ï¼šåœ¨Page Table å†å¼•é€²ä¸€å€‹æ¬„ä½ï¼Œ<span style=color:#ff0>Modification Bit æˆ– Dirty Bit</span>ï¼Œç”¨ä»¥è¡¨ç¤ºPageä¸Šæ¬¡è¼‰å…¥å¾Œï¼Œåˆ°ç¾åœ¨ï¼Œå…§å®¹æ˜¯å¦è¢«ä¿®æ”¹é</p><blockquote><p>0ï¼šæ²’æœ‰</p><p>ï¼‘ï¼šæœ‰</p></blockquote><p>å¼•é€²é€™ä»¶äº‹æƒ…å¾Œï¼Œ<span style=color:#ff0>OSå¯æª¢æŸ¥Victim pageçš„modification Bitå€¼ï¼Œè‹¥ç‚º0ï¼Œå‰‡ç„¡éœ€Swap it out</span>ï¼Œå› æ­¤å¯é™ä½I/Oæ¬¡æ•¸ï¼Œ<span style=color:#ff0>åä¹‹ï¼Œå‰‡éœ€Swap it outÂ </span></p><p>Noteï¼šæ­¤Bitç”±MMU set(0&mdash;>1)ï¼ŒOS Reference åŠ Reset (1 &mdash;> 0)</p><p>ä¾‹é¡Œï¼š</p><ul><li>Page Fault process timeï¼š8ms</li></ul><p>â€‹ if æœ‰å¯ç”¨é æ¡†ï¼Œæˆ– the replaced page is not modified</p><ul><li>Page fault process tiem if victim page is modified : 20ms</li><li>memory access timeï¼š100ns</li><li>victim page is modified ä¹‹æ©Ÿç‡ ï¼š70%</li></ul><p>æ±‚Page fault ration â‰¦ ? if effective memory access time â‰¦ 200ns</p><p>Ans.</p><p>(1-p) * 100ns + p * page fault process time<code>(0.3 * 8ms + 0.7 * 20ms)=16.4ms</code></p><p>= (1-p * 100ns + p * 16.4 ms â‰¦ 200ns )</p><p>= 100 - 100p + P* 16.4 * 10 <sup>6</sup> â‰¦ã€€200 <span style=color:#ff0>pÂ  â‰¦ 1/ 163999</span></p><p>ä¾‹é¡Œï¼š</p><ul><li><p>1æ¬¡ I/O time ï¼š10 ms</p></li><li><p>page Fault Rationï¼š10 %</p></li><li><p>Victim page modified rationï¼š60%</p></li><li><p>memory access timeï¼š200ns</p></li></ul><p>æ±‚Effective memory access time</p><p>Ans .</p><p><span style=color:#ff0>0.9 * 200ns + 0.1 *(page fault process time)<code>(0.4 * 10 ms + 0.6 * 10ms *2 å…©æ¬¡I/O)</code></span></p><p>replacement policy æœ‰å…©ç¨®</p><ol><li>Local replacement policy</li><li>Global replacement policy</li></ol><ul><li><p>Localï¼šOSåªèƒ½å¾ç™¼ç”ŸPage Fault çš„process ä¹‹Pagesä¸­ï¼Œå»æŒ‘victim page ï¼Œ<span style=color:#ff0>ä¸å¯ä»¥å¾å…¶ä»–processesä¹‹pages<code>(in memory)</code>æŒ‘victim page</span></p><p>ç¼ºé»ï¼š</p><ul><li><span style=color:#ff0>Memory utilizationè¼ƒå·®</span></li></ul><p>å„ªé»ï¼š</p><ul><li><span style=color:#ff0>å¯é™ç¸®Thrashing çš„ç¯„åœ</span></li></ul></li><li><p>Globalï¼šOSå¯å¾å…¶ä»–processesæŒ‘victim page(ç›®å‰éƒ½æ˜¯æ¡æ­¤æ–¹æ¡ˆ)
ç¼ºé»ï¼š</p><ul><li>ä¸èƒ½é™ç¸®Thrasingçš„ç¯„åœ</li></ul><p>å„ªé»ï¼š</p><ul><li>Memory Utilizationè¼ƒä½³</li></ul></li></ul><h2 id=page--replacementæ³•å‰‡ä»‹ç´¹>Page replacementæ³•å‰‡ä»‹ç´¹</h2><ol><li>FIFO</li><li>OPT</li><li>LRU</li><li>LRUUè¿‘ä¼¼<ol><li>Additional Reference Bitws Usage</li><li>Second chance</li><li>Enhanced Second Chance</li></ol></li><li>LFUèˆ‡MFU</li><li>Page Buffering algo (åå‘æ©Ÿåˆ¶)</li></ol><h3 id=fifo-æ³•å‰‡>FIFO æ³•å‰‡</h3><p>å®šç¾©ï¼šæœ€æ—©è¼‰å…¥<span style=color:#ff0;font-size:17px>(Loading Timeæœ€å°)</span>çš„Pageï¼Œä½œç‚ºVictim page</p><p>[049 00:45:00]</p><p>ç¯„ä¾‹ï¼šçµ¦äºˆ<u>3å€‹</u>Frames, Initially, they are all empty(æˆ– pure demand paging)æœ‰ä¸‹åˆ—çš„<span style=color:#ff0>Page Reference String </span>ï¼Œæ±‚Page Faultæ¬¡æ•¸</p><p>é é¢ç·¨è™Ÿï¼š7,0,1,2,0,3,0,4,2,3,0,3,2,1,2,0,1,7,0,1</p><p>æˆ–ã€€Page Size = 100ï¼Œä¸‹åˆ—å­˜å–ä½å€ï¼š731, 008, 117, 258, 039 , 331, 047 &mldr;</p><p>æˆ–ã€€Logical address= 12 bits, Page Noä½”3 bitsï¼Œå­˜å–ä½å€å¦‚ä¸‹ï¼š7AF, 8BD, 259, 047, EAF, D72</p><p>Ans.</p><p><img src=https://i.imgur.com/PfZ4cK2.png loading=lazy alt=image-20230404143314093></p><p>åˆ†æï¼š</p><ol><li><p><span style=color:#ff0>Simple , easy, implementation</span></p></li><li><p><span style=color:#ff0>æ•ˆèƒ½ä¸æ˜¯å¾ˆå¥½ï¼ŒPage Fault rationç›¸ç•¶é«˜</span></p><p>Noteï¼šPage replacementæ³•å‰‡ä¸­ï¼Œ<span style=color:#ff0>åªæœ‰æœ€ä½³ï¼Œæ²’æœ‰æœ€å·®</span></p></li><li><p>å¯èƒ½æœ‰<span style=color:#ff0>Belady Anormaly(ç•°å¸¸ç¾è±¡)</span></p></li></ol><h2 id=belady--anormaly>Belady Anormaly</h2><p>å®šç¾©ï¼š<span style=color:#ff0>process åˆ†é…åˆ°çš„é æ¡†æ•¸å¢åŠ ï¼Œå…¶Page Fault rationå»ä¸é™åå‡ä¹‹ç•°å¸¸ç¾è±¡</span></p><p>ä¾‹å­ï¼š</p><p>é é¢ç·¨è™Ÿï¼š1,2,3,4,1,2,5,1,2,3,4,5</p><ol><li>3å€‹é æ¡†</li></ol><p>â€‹ <img src=https://i.imgur.com/BsK6dO1.png loading=lazy alt=image-20230404145501311></p><ol start=2><li><p>4å€‹é æ¡†</p><p><img src=https://i.imgur.com/GGBSJWi.png loading=lazy alt=image-20230404145029156></p></li></ol><h2 id=stack-property>Stack Property</h2><p>å®šç¾©ï¼šï¼š<span style=color:#ff0>ï½å€‹Framesæ‰€åŒ…å«çš„Page Setä¿è­‰æ˜¯(n+1)å€‹Frames &mldr; ä¹‹å­é›†åˆ(subset)</span>ï¼Œæ­¤æ€§è³ªç¨±ä¹‹</p><p>æ€§è³ªï¼š<span style=color:#ff0>è‹¥å…·æœ‰ stack propertyï¼Œä¿è­‰ä¸æœƒæœ‰Belady Anormaly</span>ï¼Œåªæœ‰<span style=color:#ff0>OPT</span>èˆ‡<span style=color:#ff0>LRU</span>æ³•å‰‡ï¼Œå…·æœ‰stack propertyï¼Œ<span style=color:#ff0>æ‰€ä»¥ä»–å€‘ä¸æœƒç™¼ç”Ÿbelady anomaly</span></p><p><img src=https://i.imgur.com/HwcvNND.png loading=lazy alt=image-20230404150301566></p><h2 id=opt-uoptuional-æœ€ä½³æ³•å‰‡>OPT (<u>Opt</u>ional æœ€ä½³)æ³•å‰‡</h2><p>å®šç¾©ï¼š<span style=color:#ff0>é¸æ“‡å°‡ä¾†(æœªä¾†)é•·æœŸä¸æœƒç”¨åˆ°çš„Pageç‚ºVictim Page</span></p><p>ç¯„ä¾‹ï¼š</p><p><img src=https://i.imgur.com/31vOE5C.png loading=lazy alt=image-20230404170523441></p><p>åˆ†æï¼š</p><ol><li><p><span style=color:#ff0>Page Fault rationæœ€ä½ï¼Œå› æ­¤æœ€ä½³</span></p></li><li><p><span style=color:#ff0>ä¸æœƒæœ‰Belady AnomalyS</span></p></li><li><p><span style=color:#ff0>ç„¡æ³•è¢«å¯¦ä½œ</span>(å› ç‚º needs the future knowledge)ï¼Œé€šå¸¸åšç‚ºç†è«–ä¸Šç ”ç©¶æ¯”è¼ƒå°è±¡ä¹‹ç”¨</p></li></ol><h2 id=lruulueast-uruecently-uuusedæ³•å‰‡>LRU(<u>L</u>east <u>R</u>ecently <u>U</u>sed)æ³•å‰‡</h2><p>å®šç¾©ï¼š<span style=color:#ff0>é¸æ“‡éå»ä¸å¸¸ä½¿ç”¨çš„Page</span>ä½œç‚ºVictim Pageï¼Œå³<span style=color:#ff0>ç›¸ç•¶æ–¼æ˜¯OPT reverse (ä¾æ­·å²info åšæ±ºå®šçš„OPT)</span>å³æŒ‘é¸the last reference time æœ€å°çš„page</p><p><img src=https://i.imgur.com/0tQ7M1w.png loading=lazy alt=image-20230404180556546></p><p>åˆ†æï¼š</p><ol><li><span style=color:#ff0>Page fault rationå¯ä»¥æ¥å—</span></li><li><span style=color:#ff0>ä¸æœƒç™¼ç”ŸBelady Anomaly</span></li><li><span style=color:#ff0>LRUçš„è£½ä½œï¼Œé ˆè¦å¤§é‡Hardwareæ”¯æŒï¼Œå› æ­¤Costå¾ˆé«˜</span>ï¼Œå› æ­¤æ‰æœ‰LRUè¿‘</li></ol><h2 id=lruçš„è£½ä½œæ–¹æ³•>LRUçš„è£½ä½œæ–¹æ³•</h2><h3 id=æ–¹æ³•ä¸€counteræ³•>æ–¹æ³•ä¸€ï¼šCounteræ³•</h3><p>æ­¥é©Ÿ</p><ol><li>æ¯ç™¼ç”Ÿmemory Acessï¼ŒCounterå€¼++</li><li>Copy Counterå€¼åˆ°Access Pageçš„"the last reference time"æ¬„ä½ï¼Œ<span style=color:#ff0>å°‡ä¾†OSè¦é¸LRU Pageæ™‚ï¼Œå°±æŒ‘the last reference timeæœ€å°çš„Page</span></li></ol><h3 id=æ–¹æ³•äºŒstack-æ³•>æ–¹æ³•äºŒï¼šStack æ³•ã€€</h3><p><code>æ­¤ç‚ºStack propertyä¹‹ç”±ä¾†</code></p><p>å®šç¾©ï¼š</p><ul><li>æœ€å¾Œä¸€æ¬¡å­˜å–ä¹‹Page å¿…ç½®æ–¼Stack <span style=color:#ff0>Topç«¯</span></li><li>Stack ä¹‹ <span style=color:#ff0>Botton(åº•ç«¯)</span>ï¼Œå³ç‚º<span style=color:#ff0>LRU Page</span></li><li><span style=color:#ff0>Stackå¤§å°=Frameæ•¸ç›®</span></li></ul><p>é‡‹ä¾‹ï¼š</p><p><img src=https://i.imgur.com/oQbJlwZ.png loading=lazy alt=image-20230404183208550></p><h2 id=lruè¿‘ä¼¼æ³•å‰‡>LRUè¿‘ä¼¼æ³•å‰‡</h2><p>ä¸»è¦æ˜¯ä»¥<span style=color:#ff0>Reference Bit(åƒè€ƒä½å…ƒ)</span>ç‚ºåŸºç¤ï¼Œæ­¤ä½œæ³•è¼ƒç‚ºç°¡å–®</p><p>0ï¼šæ­¤Page<span style=color:#ff0>ä¸æ›¾è¢«åƒè€ƒé</span></p><p>1ï¼šæ­¤Page<span style=color:#ff0>æ›¾è¢«åƒè€ƒé</span></p><p>[050]</p><h2 id=additional-reference-bits-usage>Additional Reference Bits usage</h2><p>ä½œæ³•ï¼šæ¯å€‹Page æœ‰ä¸€å€‹æ¬„ä½(or Register) ï¼Œä¾‹å¦‚ï¼š8 bits</p><p>ç•¶ç™¼ç”ŸMemory Accessï¼Œè©²è¢«Access Pageä¹‹Ref Bit æœƒ Setç‚º1</p><p><span style=color:#ff0>ç³»çµ±æ¯éš”ä¸€æ®µæ™‚é–“æœƒå°‡å„pageçš„registerå€¼å³ç§»ä¸€ä½(ç©ºå‡ºæœ€é«˜ä½å…ƒï¼Œæœ€å³ä½å…ƒæ¨å»)ä¸¦å°‡å„Pageä¹‹Ref Bitå€¼Copyåˆ°Registerä¹‹æœ€é«˜ä½å…ƒï¼Œä¸”Reset å„Page ä¹‹ref bit ç‚º0</span>ï¼Œå°‡ä¾†è¦æ’victim pageæ™‚ï¼Œ<span style=color:#ff0>å°±æŒ‘Registeræœ€å°ä¹‹Page</span>ï¼Œè‹¥å¤šå€‹Pageå…·ç›¸åŒå€¼ï¼Œå‰‡ä»¥FIFOç‚ºæº–</p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/2oAdti0.gif loading=lazy alt=æœªå‘½åçš„ä½œå“></p><p>çŠ§ç‰²é é¢æœƒæŒ‘Page2ï¼Œå› ç‚ºæš«å­˜å™¨çš„å€¼æœ€å°</p><p><img src=https://i.imgur.com/iB3xYEE.png loading=lazy alt=image-20230406010708144></p><h2 id=second-chance>Second Chance</h2><p>äºŒæ¬¡æ©Ÿæœƒæ³•å‰‡</p><p>å®šç¾©ï¼šä»¥FIFOç‚ºåŸºç¤ï¼Œæ­é…Reference Bitä½¿ç”¨ï¼ŒæŒ‘victim pageä¹‹Stepså¦‚ä¸‹</p><ol><li><p><span style=color:#ff0>å…ˆä»¥FIFO order æŒ‘å‡ºä¸€å€‹Page</span></p></li><li><p><span style=color:#ff0>æª¢æŸ¥æ­¤pageçš„Reference Bitå€¼</span></p><p>Case 1ï¼šè‹¥ç‚º0ï¼Œå‰‡å®ƒå³Victim Page</p><p>Case 2ï¼š<span style=color:#ff0>è‹¥ç‚º1ï¼Œå‰‡çµ¦å®ƒæ©Ÿæœƒï¼Œä¸è®“å®ƒç•¶çŠ§ç‰²é é¢ã€‚ä½†Reset its Reference Bitå€¼ç‚º0ã€‚ä¸¦å°‡å®ƒçš„Loading Time(è¼‰å…¥æ™‚é–“)æ›´æ”¹ç‚ºç¾åœ¨ï¼Œå› æ­¤FIFOæŒ‡é‡å¾€ä¸‹æŒ‡ã€‚æ¥å›Step1</span></p></li></ol><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/2F59EKU.png loading=lazy alt=image-20230407230307064></p><p>æŒ‘çŠ§ç‰²é é¢</p><p><img src=https://i.imgur.com/6WhmKL2.png loading=lazy alt=image-20230407230516510></p><p>ä¾‹ï¼š3å€‹Frames</p><p>é é¢åƒè€ƒï¼š1,2,3,4,2,5,2,6,1,2ï¼Œæ±‚Second Change</p><p><img src=https://i.imgur.com/tiyTry7.gif loading=lazy alt=æœªå‘½åçš„ä½œå“></p><p>Noteï¼šç•¶æ‰€æœ‰Pagesä¹‹Reference Bitçš†ç›¸åŒï¼Œ<span style=color:#ff0>å‰‡é€€åŒ–æˆFIFOã€‚ä¹Ÿå«Clock Algorithm</span></p><h2 id=enhanced-second-chance>Enhanced Second Chance</h2><p>åŠ å¼·å‹äºŒæ¬¡æ©Ÿæœƒ</p><p>å®šç¾©ï¼š<span style=color:#ff0>ä»¥&lt;Reference Bit, Modification Bit>é…å°å€¼</span>ï¼Œä½œç‚ºæŒ‘é¸Victim Pageä¹‹ä¾æ“šï¼Œ<span style=color:#ff0>å€¼æœ€å°ä¹‹Pageï¼Œä½œç‚ºVictim</span>ã€‚è‹¥æœ‰å¤šå€‹Pageså…·ç›¸åŒå€¼ï¼Œå‰‡ä»¥FIFOç‚ºæº–</p><div class=table-wrapper><table><thead><tr><th style=text-align:center>å€¼</th><th>&lt;R bit, M bit></th></tr></thead><tbody><tr><td style=text-align:center>ç¬¬ä¸€å°</td><td>&lt;0,0></td></tr><tr><td style=text-align:center>ç¬¬äºŒå°</td><td>&lt;0,1></td></tr><tr><td style=text-align:center>ç¬¬ä¸‰å°</td><td>&lt;1,0></td></tr><tr><td style=text-align:center>ç¬¬å››å°</td><td>&lt;1,1></td></tr></tbody></table></div><h2 id=lfuèˆ‡mfuæ³•å‰‡>LFUèˆ‡MFUæ³•å‰‡</h2><p>å®šç¾©ï¼šä»¥Pageçš„<span style=color:#ff0>ç´¯ç©åƒè€ƒç¸½æ¬¡æ•¸</span>ä½œç‚ºæŒ‘Victim Pageä¹‹ä¾æ“šï¼Œåˆ†ç‚ºå…©ç¨®ï¼š</p><ol><li><p><span style=color:#ff0>LFU(Least Frequently Used)</span></p><p>æ¬¡æ•¸æœ€å°çš„Pageç‚ºVictim</p></li><li><p><span style=color:#ff0>MFU(Most Frequently Used)</span></p><p>æ¬¡æ•¸æœ€å¤§çš„page ç‚ºVimtim</p></li></ol><p>è‹¥å¤šå€‹Pageså…·ç›¸åŒå€¼ï¼Œä¹Ÿæ˜¯FIFOç‚ºæº–</p><p>åˆ†æï¼šè¨ˆç®—é¡ŒFIFO,OPT,LRUæœ€å¸¸è€ƒã€‚</p><ol><li><span style=color:#ff0>Page Fault Rationç›¸ç•¶é«˜ã€€</span></li><li><span style=color:#ff0>æœ‰Belady Anomoaly</span></li><li><span style=color:#ff0>è£½ä½œéœ€å¤§é‡Hardwareæ”¯æŒï¼Œå› æ­¤Costå¾ˆé«˜</span></li></ol><p><span style=color:#ff0></span></p><p>ä¾‹ï¼š</p><div class=table-wrapper><table><thead><tr><th>Page</th><th>Loadingã€€TIme</th><th>The Last reference Time</th><th>R bit</th><th>M Bit</th><th>åƒè€ƒæ¬¡æ•¸</th></tr></thead><tbody><tr><td>Page1</td><td>493</td><td>800</td><td>0</td><td>0</td><td>410</td></tr><tr><td>Page2</td><td>172</td><td>700</td><td>1</td><td>1</td><td>235</td></tr><tr><td>Page3</td><td>333</td><td>430</td><td>0</td><td>1</td><td>147</td></tr><tr><td>Page4</td><td>584</td><td>621</td><td>1</td><td>0</td><td>875</td></tr><tr><td>Page5</td><td>256</td><td>564</td><td>0</td><td>1</td><td>432</td></tr></tbody></table></div><p><span style=color:#ff0>åœ¨ä¸‹åˆ—æƒ…æ³ä¸­ï¼Œvictim pageç‚º</span></p><ol><li><p>FIFOï¼šPage2</p></li><li><p>LRUï¼šPage3</p></li><li><p>Second Chanceï¼šPage5</p></li><li><p>Enhanced Second Chanceï¼šPage1</p></li><li><p>LFUï¼šPage3</p></li><li><p>MFUï¼šPage4</p></li></ol><h2 id=page-bufferingæ©Ÿåˆ¶>Page Bufferingæ©Ÿåˆ¶</h2><p>ç·£ç”±ï¼šç•¶æŒ‘å‡ºVictim Pageä¹‹å¾Œï¼Œä¸”å®ƒè¢«Modifiedéï¼Œæ­¥é©Ÿå¦‚ä¸‹</p><p><span style=color:#ff0>1. å‰‡æŠŠVictim Page<u>Swap Out</u> åˆ° Disk</span></p><p><span style=color:#ff0>2. <u>è¼‰å…¥</u>Lost Page</span></p><p><span style=color:#ff0>3. Process resume execution</span></p><p>&ndash;> IOå¤ªå¤šï¼Œ<u>Processæ¢å¾©åŸ·è¡Œçš„æ™‚é–“é»æ‹–å¤ªä¹…ï¼Œæƒ³è¦æ”¹å–„</u></p><h3 id=æ–¹æ³•ä¸€>æ–¹æ³•ä¸€</h3><p><span style=color:#ff0>OS æœƒ Keepsä¸€å€‹ Free Frames Pool</span>(OSçš„ç§æˆ¿éŒ¢ï¼Œä¸æ˜¯é…ç½®çµ¦Processçš„)</p><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/oiSstEn.png loading=lazy alt=image-20230408011210426></p><p>æµç¨‹ï¼š</p><p>OSæŒ‘å®ŒçŠ§ç‰²é é¢(Modified)</p><p><span style=color:#ff0>æ­¥é©Ÿæ›´æ”¹å¦‚ä¸‹</span></p><p><span style=color:#ff0>1. OSå¾Free Frame poolä¸­ï¼Œå–å‡ºä¸€å€‹Free Frameï¼Œä¾›Lost Pageä½¿ç”¨ï¼Œè®“å®ƒå…ˆè¼‰å…¥</span></p><p><span style=color:#ff0>2. è¼‰å…¥å®Œå¾Œï¼ŒProcessæ¢å¾©åŸ·è¡Œ</span></p><p><span style=color:#ff0>3. Process Resume execution</span></p><p>OSå¯ç¨å¾Œå°‡Victim Page å¯«å›Diskï¼Œç©ºå‡ºFrame<span style=color:#ff0>å†é‚„çµ¦OSï¼ŒåŠ å…¥Free Frame Poolä¸­</span></p><p><img src=https://i.imgur.com/p5vQabo.png loading=lazy alt=image-20230408012305710></p><h3 id=æ–¹æ³•äºŒ>æ–¹æ³•äºŒ</h3><p>OSæœƒKeepä¸€æ¢<span style=color:#ff0>Modification Listï¼Œè¨˜éŒ„æ‰€æœ‰è¢«Modifiedéçš„Page info(å³Modification Bitå€¼=1ä¹‹Pages)</span>ï¼ŒOSæœƒç­‰Paging I/O Deviceæœ‰ç©ºæ™‚ï¼Œå°‡æ­¤Listä¸­æŸäº›Pageså¯«å›Diskï¼Œ<span style=color:#ff0>åŒæ™‚è‡ªæ­¤Listä¸­ï¼Œç§»èµ°é€™äº›Pagesï¼ŒReset their Modification Bitå€¼ç‚º0ã€‚å¦‚æ­¤å¯å¢åŠ Victim pagesæ˜¯unmodified ä¹‹æ©Ÿç‡ï¼Œé€™æ¨£ç›´æ¥æŠŠLost PageæŠ“é€²ä¾†å°±å¥½</span>ï¼Œé€™æ¨£Processæœ‰è¼ƒé«˜æ©Ÿæœƒå¿«é€Ÿresume exec</p><p>[051 00:00:00 ~00:40:00]</p><h3 id=æ–¹æ³•ä¸‰>æ–¹æ³•ä¸‰</h3><p><span style=color:#ff0>å¸Œæœ›é€£ä¸€æ¬¡I/Oéƒ½ä¸è¦æœ‰ã€‚æ˜¯ä»¥æ–¹æ³•ä¸€ç‚ºåŸºç¤ï¼Œå·®åˆ¥åœ¨æ–¼é‡å°Free Frames Pool(ç§æˆ¿éŒ¢)ä¸­çš„æ¯å€‹Frameï¼Œç´€éŒ„æ”¾çš„æ˜¯å“ªå€‹Processçš„å“ªå€‹Page(&lt;process ID, Page No>)ï¼Œé€™äº›Pageå…§å®¹å¿…å®šæ˜¯æœ€æ–°çš„</span></p><p>æµç¨‹ï¼š</p><ol><li>OSé¸å®ŒVictim Page(modified)</li><li><span style=color:#ff0>OSå»Free Frames Poolä¸­å°‹æ‰¾æœ‰ç„¡Lost Pageå­˜åœ¨ã€‚è‹¥å­˜åœ¨ï¼Œä»£è¡¨å…¶å…§å®¹ç‚ºæœ€æ–°çš„ï¼Œå‰‡å°‡æ­¤Free FrameåŠ å…¥Resident Frames Poolä¸­ï¼ŒProcesså³å¯Resume execï¼Œé€£ä¸€æ¬¡I/Oéƒ½ä¸ç”¨ï¼</span>ï¼ŒOSå¯«å›Victim Pageå¾Œï¼Œå†åŠ å…¥(é‚„çµ¦)Free Frames Poolï¼Œ<span style=color:#ff0>è‹¥ä¸å­˜åœ¨ï¼Œå‰‡ä¾æ–¹æ³•ä¸€æ­¥é©Ÿè™•ç†</span></li></ol><p>.
.</p><p>.</p><p><span style=color:red;font-size:32px>é€™é‚Šçœ‹ä¸å¤ªæ‡‚ï¼Œå…ˆPass</span></p><p>.</p><p>.</p><p>.</p><h2 id=frame-æ•¸ç›®åˆ†é…å¤šå¯¡ä¹‹å½±éŸ¿>Frame æ•¸ç›®åˆ†é…å¤šå¯¡ä¹‹å½±éŸ¿</h2><ol><li><span style=color:#ff0;font-size:16px>ä¸€èˆ¬è€Œè¨€</span>Processåˆ†é…åˆ°çš„é æ¡†æ•¸å¢åŠ ï¼Œå…¶Page Fault Rationç†æ‡‰ä¸‹é™</li><li><span style=color:#ff0;font-size:16px>OSåœ¨åˆ†é…Processé æ¡†æ•¸æ™‚ï¼Œå¿…é ˆæ»¿è¶³æœ€å°‘åŠæœ€å¤šæ•¸ç›®ä¹‹é™åˆ¶ï¼Œé€™å…©å€‹é™åˆ¶å‡ç”±<u>Hardware</u>æ±ºå®šçš„ï¼ŒéOS</span></li></ol><p><span style=color:#ff0;font-size:16px>æœ€å¤šæ•¸ç›®é™åˆ¶</span>å³æ˜¯Physical Memory Size(é æ¡†ç¸½æ•¸)</p><p><span style=color:#ff0;font-size:16px>æœ€å°‘æ•¸ç›®é™åˆ¶å³æ˜¯CPUå®Œæˆæ©Ÿå™¨æŒ‡ä»¤åŸ·è¡Œéç¨‹ä¸­ï¼Œæœ€å¤šçš„å¯èƒ½Memoryå­˜å–æ¬¡æ•¸</span>ï¼Œå¦å‰‡æ©Ÿå™¨æŒ‡ä»¤å¯èƒ½æ°¸é ç„¡æ³•å®Œæˆ</p><p>ä¾‹ï¼š</p><p>[051] 01:10:00 çœ‹ä¸å¤ªæ‡‚ï¼Œéœ€è¦è¨ˆçµ„çŸ¥è­˜</p><p><img src=https://i.imgur.com/V6mHUyB.png loading=lazy alt=image-20230408163437049></p><ul><li><span style=color:#ff0;font-size:16px>å‡è¨­æŒ‡ä»¤ä¸è·¨é é¢</span></li><li><span style=color:#ff0;font-size:16px>é‹ç®—å…ƒ(memoryè®Šæ•¸)æ˜¯æ¡ç”¨Direct AddressingÂ </span></li></ul><p>å‰‡æœ€å¤šå¯èƒ½éœ€è¦3æ¬¡Memory Access(M.A.)ï¼Œ<span style=color:#ff0;font-size:16px>å› æ­¤osè‡³å°‘è¦åˆ†çµ¦process â‰§3å€‹Frames</span></p><h2 id=thrashingç¾è±¡->Thrashingç¾è±¡ â˜†â˜†â˜†â˜†â˜†</h2><p>Thrashing meaning å¾’å‹ç„¡åŠŸ</p><p>å®šç¾©ï¼š<span style=color:#ff0;font-size:16px>è‹¥Processåˆ†é…åˆ°çš„é æ¡†æ•¸ä¸è¶³æ™‚</span>ï¼Œå‰‡æ­¤Processæœƒç¶“å¸¸Page Faultï¼Œä¸”OSè¦åšPage Replacementï¼Œè‹¥OSæ¡ç”¨Global replacement policyï¼Œæ‰€ä»¥OSå¯èƒ½æŒ‘å…¶ä»–Processä¹‹Pageï¼Œè€Œé€™ä¹Ÿæœƒé€ æˆå…¶ä»–Process Page Faultï¼Œå®ƒå€‘ä¹Ÿæœƒå»æ¶å¥ªåˆ¥çš„Processä¹‹Frameä¾†ç”¨ï¼Œå¦‚æ­¤ä¸€ä¾†ï¼Œå¹¾ä¹æ‰€æœ‰çš„Processesçš†Page Faultï¼Œ<span style=color:#ff0;font-size:16px>å¤§å®¶çš†åœ¨ç­‰å¾…Paging I/O Device ä¹‹I/O é‹ä½œ(swapÂ  out/in)å®Œæˆï¼ŒCPU Utilizationä¸‹é™ï¼Œç³»çµ±æœƒä¼åœ–èª¿é«˜Multiprogramming degree</span>ï¼Œå¼•å…¥æ›´å¤šProcessé€²å…¥åŸ·è¡Œï¼Œ<span style=color:#ff0;font-size:16px>ä½†æ˜¯Memoryæœ¬ä¾†å°±ä¸å¤ ï¼Œ</span>Processä¹Ÿç«‹åˆ»Page Faultï¼Œç³»çµ±<span style=color:#ff0;font-size:16px>åˆ</span>èª¿é«˜Multiprogramming Degreeï¼Œ<span style=color:#ff0;font-size:16px>å¦‚æ­¤å¾ªç’°ä¸‹å»ï¼Œæ­¤æ™‚ç³»çµ±å‘ˆç¾</span></p><ol><li>CPU Utilizationæ€¥é€Ÿä¸‹é™</li><li>Paging I/O Device ç•°å¸¸å¿™ç¢Œ</li><li>ProcessesèŠ±åœ¨Page Fault Processing Time(å°±æ˜¯é–’ç½®æ™‚é–“å•¦)é å¤§æ–¼æ­£å¸¸åŸ·è¡Œæ™‚é–“ï¼Œæ­¤ä¸€ç¾è±¡ç¨±ç‚ºThrashing</li></ol><h2 id=è§£æ±ºé é˜²-thrashing>è§£æ±º/é é˜² Thrashing</h2><h3 id=æ–¹æ³•ä¸€-1>æ–¹æ³•ä¸€</h3><p><span style=color:#ff0;font-size:16px>æ¸›å°‘ Multiprogramming DegreeÂ </span></p><p>ä¾‹å¦‚æŒ‘é¸ä¸€äº›lower-priority æˆ–å®Œæˆåº¦ä½ Process swap-out</p><h3 id=æ–¹æ³•äºŒ-1>æ–¹æ³•äºŒ</h3><p>åˆ©ç”¨<span style=color:#ff0;font-size:16px>Page Fault Frequency Control æ©Ÿåˆ¶ï¼Œä¾†é˜²æ­¢/é é˜²Thrashimgç™¼ç”Ÿ</span></p><p>ä½œæ³•ï¼š<span style=color:#ff0;font-size:16px>OSæœƒå»åˆ¶å®šprocess Page Fault Rationä¹‹åˆç†çš„ä¸Šé™èˆ‡ä¸‹é™å€¼</span></p><p><img src=https://i.imgur.com/3Tzqy5P.png loading=lazy alt=image-20230408173939031></p><p><img src=https://i.imgur.com/vXUwbG3.png loading=lazy alt=image-20230408173954495></p><p><span style=color:#ff0;font-size:16px>OSè‹¥ç™¼ç¾Processçš„Page Fault ration</span></p><ol><li>é«˜æ–¼ä¸Šé™ï¼Œå‰‡OSæ‡‰å¢åŠ é¡å¤–Frameæ•¸ç›®çµ¦æ­¤Processï¼Œé™ä½å…¶Ratioï¼Œå›åˆ°åˆç†å€é–“</li><li>ä½æ–¼ä¸‹é™ï¼Œå‰‡OSè‡ªæ­¤Processå–èµ°å¤šé¤˜çš„Frameï¼Œåˆ†çµ¦å…¶ä»–æœ‰éœ€è¦ä¹‹Processes</li></ol><p><span style=color:#ff0;font-size:16px>è‹¥OSèƒ½å¤ æ§åˆ¶æ‰€æœ‰processesä¹‹Page Fault ratio åœ¨åˆç†å€é–“ï¼Œå‰‡ç†ç•¶ä¸æœƒæœ‰Thrashing</span></p><p>æ–¹æ³•ä¸‰</p><p>é‹ç”¨<span style=color:#ff0;font-size:16px>Working Set ModelæŠ€è¡“é ä¼°</span>Processåœ¨ä¸åŒåŸ·è¡Œæ™‚æœŸæ‰€éœ€ä¹‹é æ¡†æ•¸ï¼Œä¸¦ä¾æ­¤åˆ†é…å„Process<span style=color:#ff0;font-size:16px>è¶³å¤ çš„Frameæ•¸ç›®ï¼Œä»¥é˜²æ­¢Thrashing</span></p><h2 id=working-set-model-æŠ€è¡“>Working Set Model æŠ€è¡“</h2><p><span style=color:#ff0;font-size:16px>æ˜¯æ¶åœ¨"Locality Mode"ä¹‹ç†è«–åŸºç¤ä¸Š</span></p><p>å®šç¾©ï¼šProcessåŸ·è¡Œæ™‚ï¼Œå°æ–¼æ‰€å­˜å–çš„Memory Areaï¼Œ<span style=color:#ff0;font-size:16px>ä¸¦éæ˜¯å‡å‹»çš„ï¼Œè€Œæ˜¯å…·æœ‰æŸç¨®å±€éƒ¨/é›†ä¸­å€åŸŸå­˜å–ä¹‹ç‰¹æ€§</span>ï¼Œä¸€èˆ¬åˆ†ç‚ºå…©ç¨®Locality</p><ol><li>Temporal<code>æ™‚é–“</code> Locality</li><li>Spatial<code>ç©ºé–“</code> Locality</li></ol><h3 id=temporal-locality>Temporal Locality</h3><p>ç›®å‰æ‰€å­˜å–çš„å€åŸŸï¼Œ<span style=color:#ff0;font-size:16px>éä¸ä¹…</span>åˆæœƒå†åº¦è¢«å­˜å–<span style=color:#ff0;font-size:16px>(æˆ–æ­¤å€åŸŸç¶“å¸¸è¢«å­˜å–)</span></p><p>ä¾‹ï¼š<span style=color:#ff0;font-size:16px>For LoopÂ </span>(while, for , repeat &mldr;), <span style=color:#ff0;font-size:16px>Subroutine</span><code>å‰¯ç¨‹å¼</code>(function, pure code), <span style=color:#ff0;font-size:16px>Counter</span>, <span style=color:#ff0;font-size:16px>Stack</span></p><h3 id=spatial-locality>Spatial Locality</h3><p>å®šç¾©ï¼šç›®å‰æ‰€å­˜å–ä¹‹å€åŸŸï¼Œ<span style=color:#ff0;font-size:16px>å…¶é„°è¿‘çš„å€åŸŸï¼Œä¹Ÿå³æœ‰å¯èƒ½è¢«å­˜å–</span></p><p>ä¾‹ï¼š<span style=color:#ff0;font-size:16px>Array, Sequential Code Execution, Common Data area, Linear Search, Vector operat</span></p><p>[052]</p><p>åªè¦Programä¸­ç”¨åˆ°çš„æŒ‡ä»¤, Data Structures, algo ç¬¦åˆ Locality Model å‰‡ç‚º<span style=color:#ff0;font-size:16px>Good(æ‰€ä»¥ Page Fault Ratio åº¦æœƒä¸‹é™) è‹¥é•åï¼Œå‰‡ç‚ºBad</span></p><p>ä¾‹ï¼šBAD Samples</p><p>Ansï¼š<span style=color:#ff0;font-size:16px>Hashing<code>(åˆ†æ•£åœ¨å„å€‹è¨˜æ†¶é«”é é¢ï¼Œä¸ç¬¦ç©ºé–“å±€éƒ¨æ€§)</code>, Binary Search<code>(è·³ä¾†è·³å»)</code>, LinkedList<code>(æ•£è½åœ¨ä¸åŒé é¢)</code>, goto JumpæŒ‡ä»¤<code>(è·³ä¾†è·³å»)</code>, Indirect Addressing mode(é–“æ¥å®šå€æ¨¡å¼)</span></p><p>Working Set Modelç›¸é—œè¡“èªè§£æï¼š</p><ol><li><span style=color:#ff0;font-size:16px>Working Set window</span>ï¼šè¨˜ç‚º<span style=color:#ff0;font-size:16px>â–³</span>è¡¨ç¤ºä»¥<span style=color:#ff0;font-size:16px>â–³æ¬¡ã€€Pages reference ä½œç‚ºçµ±è¨ˆWorking Setä¹‹ä¾æ“š</span></li><li><span style=color:#ff0;font-size:16px>Working Set:Â </span> åœ¨â–³æ¬¡Pageåƒè€ƒä¸­ï¼Œ<span style=color:#ff0;font-size:16px>æ‰€åƒè€ƒåˆ°çš„ä¸åŒPagesä¹‹é›†åˆ</span></li><li><span style=color:#ff0;font-size:16px>Working Set Size(WSS)</span>ï¼šworking Setä¹‹ å…ƒç´ (Page)å€‹æ•¸ï¼Œ<span style=color:#ff0;font-size:16px>ä»£è¡¨Process æ­¤æ™‚æ‰€éœ€ä¹‹é æ¡†æ•¸</span></li></ol><p>[052] 00:13:00</p><p><span style=color:red;font-size:32px>ä¾‹é¡Œï¼šåˆ°æ™‚å€™å†ä¾†è£œ</span></p><h2 id=page-size-ä¹‹å½±éŸ¿>Page Size ä¹‹å½±éŸ¿</h2><p>è‹¥Page Sizeè¶Šå°ï¼Œå‰‡</p><blockquote><ol><li>Page Fault ratioï¼š<span style=color:#ff0;font-size:16px>ä¸Šå‡</span></li><li>Page Table Size ï¼š<span style=color:#ff0;font-size:16px>è®Šæ•¸</span></li><li>I/Oæ¬¡æ•¸(total Time)ï¼š<span style=color:#ff0;font-size:16px>å¢åŠ </span></li><li>å…§éƒ¨ç¢è£‚ï¼š<span style=color:#ff0;font-size:16px>è¼•å¾®</span></li><li>I/O Transfer Timeï¼š<span style=color:#ff0;font-size:16px>è®Šå°</span></li><li>Localityï¼š<span style=color:#ff0;font-size:16px>è¶Šä½³</span></li></ol></blockquote><p><span style=color:#ff0;font-size:16px>è¶¨å‹¢ï¼šæœPage sizeå¤§çš„æ›´æ–°ï¼Œå› ç‚ºæˆ‘å€‘åªé—œå¿ƒPage Fault ration</span></p><h2 id=program-structures-ä¹‹å½±éŸ¿>Program Structures ä¹‹å½±éŸ¿</h2><ul><li><p><span style=color:#ff0;font-size:16px>è‹¥Proframä¸­ä½¿ç”¨çš„æŒ‡ä»¤Data Structure, Algo ç¬¦åˆ &ldquo;Locality Model&rdquo;ï¼Œå‰‡ç‚ºGOOD(æœ‰åŠ©æ–¼é™ä½Page Fault Ratio)</span>ï¼Œåä¹‹ï¼Œè‹¥é•åï¼Œå‰‡ç‚ºBAD</p></li><li><p><span style=color:#ff0;font-size:16px>ç¨‹å¼ä¸­å°æ–¼Arrrayå…ƒç´ çš„è™•ç†é †åºæœ€å¥½èˆ‡Arrayå…ƒç´ åœ¨Memoryä¸­çš„å„²å­˜æ–¹å¼(Row-Majoræˆ–Column-mahor)å°æ‡‰ï¼Œæœ‰åŠ©æ–¼é™ä½Page FaultÂ  ratio</span></p><p>ä¾‹ï¼šAï¼šArray[1..128,1..128] of int;</p><p>æ¯å€‹int ä½” 1 bytes</p><p>Aä»¥<span style=color:#ff0;font-size:32px>Row-major</span><code>(ç¬¬ä¸€åˆ—æ”¾å®Œå†æ”¾ç¬¬äºŒåˆ—åœ¨æ”¾ç¬¬ä¸‰åˆ—...)</code>æ–¹å¼å­˜æ–¼Memory</p><p>Page Size= 128 byte</p><p>çµ¦3å€‹Framesï¼Œä¸”ç¨‹å¼å·²åœ¨Memoryä¸­</p><p>æ¡FIFO Replacemenrt policy</p><p>æ±‚ä¸‹åˆ—Codeä¹‹Page Faultæ¬¡æ•¸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>for i = 1 to 128 do
  for j = 1 to 128 do
      A[i,j]=0
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>for j=1 to 128 do
  for i to 128 do
      A[i,j] = 0
</code></pre></td></tr></table></div></div><ol><li><span style=color:#ff0;font-size:32px>Row-Major</span> çš„æ’åˆ—æ–¹å¼<img src=https://i.imgur.com/KDo64vw.png loading=lazy alt=image-20230409122905579></li><li><span style=color:#ff0;font-size:32px>Column-Major</span><img src=https://i.imgur.com/EPP3g9a.png loading=lazy alt=image-20230409123224894></li></ol><p>ä¾‹2ï¼šAï¼šArray[1..100,1..100] of int;</p><p>æ¯å€‹int ä½” 1 bytes</p><p>Aä»¥<span style=color:#ff0;font-size:32px>Row-major</span><code>(ç¬¬ä¸€åˆ—æ”¾å®Œå†æ”¾ç¬¬äºŒåˆ—åœ¨æ”¾ç¬¬ä¸‰åˆ—...)</code>æ–¹å¼å­˜æ–¼Memory</p><p>Page Size= <span style=color:#ff0;font-size:16px>200</span> byte</p><p>çµ¦3å€‹Framesï¼Œä¸”ç¨‹å¼å·²åœ¨Memoryä¸­</p><p>æ¡<span style=color:#ff0;font-size:16px>LRU</span> Replacemenrt policy</p><p>æ±‚ä¸‹åˆ—Codeä¹‹Page Faultæ¬¡æ•¸</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>for i = 1 to 100 do
  for j = 1 to 100 do
      A[i,j]=0
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>for j=1 to 100 do
  for i to 100 do
      A[i,j] = 0
</code></pre></td></tr></table></div></div><ol><li><img src=https://i.imgur.com/vrNwxGu.png loading=lazy alt=image-20230409124706967></li><li><img src=https://i.imgur.com/qHVjqWq.png loading=lazy alt=image-20230409124835188></li></ol></li></ul><h2 id=copy-on-writeæŠ€è¡“>Copy-On-WriteæŠ€è¡“</h2><p>(æ­¤è™•ä¸»è¦æ˜¯è¨è«–3ç¨®Fork())</p><ol><li><p><span style=color:#ff0;font-size:16px>å‚³çµ±çš„Fork() <code>ch4</code></span></p><p>(fork () without &ldquo;copy-on-write&rdquo;)</p><p>å®šç¾©ï¼šParent process fork() å»ºç«‹å‡ºChild processï¼Œ<span style=color:#ff0;font-size:16px>OSæœƒé…ç½®New Framesçµ¦Child Process</span>(å³Child èˆ‡ Parent å ç”¨ä¸åŒçš„Memory Space)ï¼Œ<span style=color:#ff0;font-size:16px>åŒæ™‚OSä¹Ÿè¦è¤‡è£½(Copy)Parent Processå…§å®¹(code Sec åŠ Data Sec)çµ¦Child Process initially</span></p><p><span style=color:#ff0;font-size:16px>æ­¤èˆ‰æœƒå°è‡´å…©å€‹ç¼ºå¤±</span></p><ol><li><span style=color:#ff0;font-size:16px>Memory(Frames)éœ€æ±‚é‡å¤§å¢</span></li><li><span style=color:#ff0;font-size:16px>Slower Child Process Creation</span></li></ol><p>è€Œä¸”ä¸Šè¿°åšæ³•åœ¨<span style=color:#ff0;font-size:16px>Child ç”Ÿå‡ºå¾Œï¼Œç«‹åˆ»åŸ·è¡Œexeclp()ä½œå…¶ä»–Taskæ™‚ï¼Œæ›´åŠ é¡¯å¾—ç„¡ç”¨ unnecessary(ä¸é©åˆï¼Œå› ç‚ºæ²’æœ‰å…±é€šçš„æ±è¥¿ï¼Œå»è¦Copyä¸ç”¨çš„æ±è¥¿çµ¦child)</span></p></li><li><p><span style=color:#ff0;font-size:16px>Fork() with copy-on-write</span></p><p>å®šç¾©ï¼šç•¶Parent Process ç”Ÿå‡ºchild process ä¹‹åˆï¼Œ<span style=color:#ff0;font-size:16px>OSæœƒè®“childå…±äº«parent processä¹‹memory(frames)ç©ºé–“</span>ï¼Œå¦‚æ­¤ï¼Œ<span style=color:#ff0;font-size:16px>ç„¡é ˆé…ç½®çµ¦Child process New Frames ä¸”ä¹Ÿä¸ç”¨Copy Parent å…§å®¹çµ¦Childï¼Œå› æ­¤å¯é™ä½é æ¡†éœ€æ±‚é‡åŠåŠ é€ŸSpeed Up process Creation</span>ã€‚</p><p><img src=https://i.imgur.com/owOY29K.png loading=lazy alt=image-20230409161126347></p><p>ä½†æ˜¯ï¼Œ<span style=color:#ff0;font-size:16px>ä»»ä½•ä¸€æ–¹æ”¹è®Šäº†æŸPageå…§å®¹ï¼Œå‰‡å¦ä¸€æ–¹æœƒå—åˆ°å½±éŸ¿(æ­¤ç‚ºrisk)ï¼Œæ‰€ä»¥å¼•å…¥</span><span style=color:#ff0;font-size:16px>Copy-on-writeæŠ€è¡“ï¼Œå³eg. è‹¥Child Process æƒ³è¦æ›´æ”¹æŸPageå…§å®¹(eg. Stackå…§å®¹)ï¼Œå‰‡OSæœƒé…ç½®ä¸€å€‹New Frameçµ¦Childï¼Œä¸”Copy Pageå…§å®¹åˆ°new Frameä¸­ï¼Œä¸”ä¿®æ”¹Childçš„page Table æŒ‡å‘ New Frameï¼Œä¾›Child ä½¿ç”¨/ä¿®æ”¹</span>ï¼Œå¦‚æ­¤ï¼Œå‰‡ä¸æœƒå½±éŸ¿Parent</p><p><img src=https://i.imgur.com/Exzz7a8.png loading=lazy alt=image-20230409161809333></p><p>å› æ­¤é‚£äº›æœ‰Modifiedå¯èƒ½çš„Pagesï¼Œé ˆæ¨™ç¤ºCopy-on-writeï¼Œè€Œæœ‰äº›ä¸æœƒModified çš„Page(eg: read-only code/data)å‰‡ä¸é ˆæ¨™ç¤ºï¼Œ<span style=color:#ff0;font-size:16px>å‰‡å¯å…±äº«</span></p></li><li><p><span style=color:#ff0;font-size:16px>Vfork() <code>(virtual memory fork())</code></span></p><p>å®šç¾©ï¼šParent ç”Ÿå‡ºChild ä¹‹åˆï¼Œ<span style=color:#ff0;font-size:16px>ä¹Ÿæ˜¯è®“Childå…±äº«parentç›¸åŒçš„framesï¼Œä½†æ˜¯ï¼Œå®ƒ<u>ä¸¦æœªæä¾›Copy-on-weiteæŠ€è¡“</u></span>ï¼Œæ‰€ä»¥ï¼Œ<span style=color:#ff0;font-size:16px>ä»»ä½•ä¸€æ–¹æ”¹è®Šäº†æŸPageå…§å®¹ï¼Œå‰‡å¦ä¸€æ–¹æœƒå—åˆ°å½±éŸ¿</span>ï¼Œæ•…å‹™å¿…å°å¿ƒä½¿ç”¨ã€‚<span style=color:#ff0;font-size:16px>é€™å€‹æ±è¥¿ç‰¹åˆ¥é©åˆç”¨åœ¨ï¼šç•¶ç”Ÿå‡ºChild å¾Œï¼ŒChildç«‹åˆ»åŸ·è¡Œexeclp()å»ä½œå…¶ä»–taskæ™‚ï¼ŒVfork()éå¸¸æœ‰æ•ˆç‡ã€‚ä¾‹å¦‚ï¼šCommand Interpreterè£½ä½œ(egï¼šUnix shell)</span></p></li></ol><h2 id=tlb-reach>TLB Reach</h2><p>å®šç¾©ï¼šç¶“ç”±TLB Mapping æ‰€èƒ½å­˜å–åˆ°çš„Memory Areaå¤§å°ï¼Œ<span style=color:#ff0;font-size:16px>å³TLB ReachÂ  = TLB Entryæ•¸ç›® * Page Size</span></p><p>eg. TLBæœ‰8å€‹Entryï¼Œä¸”Page Szie= 16 KBï¼Œæ‰€ä»¥TLB reach = 8 * 16kb = 128 kb</p><p><span style=color:#ff0;font-size:16px>Noteï¼šå¸Œæœ› TLB Reach è¶Šå¤§è¶Šå¥½</span></p><p>Qï¼šå¦‚ä½•åŠ å¤§TLB Reach?</p><h3 id=æ–¹æ³•ä¸€-2>æ–¹æ³•ä¸€</h3><p>æé«˜TLB Entryæ•¸ç›®</p><p><span style=color:#ff0;font-size:16px>å„ªé»ï¼š</span></p><ol><li><span style=color:#ff0;font-size:16px>TLB Reach è®Šå¤§</span></li><li><span style=color:#ff0;font-size:16px>é€£å¸¶TLB Hit Ratioä¹Ÿè¼ƒé«˜</span></li></ol><blockquote><p>TLB (Translation Lookaside Buffer) Hit Ratio æ˜¯è¨ˆç®—è™›æ“¬è¨˜æ†¶é«”ç®¡ç†ä¸­ TLB å‘½ä¸­ç‡çš„ä¸€å€‹æŒ‡æ¨™ã€‚TLB æ˜¯è™•ç†å™¨ä¸­ä¸€ç¨®ç¡¬é«”å¿«å–ï¼Œç”¨æ–¼åŠ é€Ÿè™›æ“¬è¨˜æ†¶é«”çš„åœ°å€è½‰æ›éç¨‹ã€‚ç•¶ç¨‹å¼å­˜å–ä¸€å€‹è™›æ“¬è¨˜æ†¶é«”é é¢æ™‚ï¼Œè™•ç†å™¨æœƒå…ˆåœ¨ TLB ä¸­æŸ¥æ‰¾æ˜¯å¦å·²ç¶“æœ‰è©²é é¢çš„è½‰æ›è³‡æ–™ã€‚å¦‚æœæœ‰ï¼Œå°±å¯ä»¥ç›´æ¥é€²è¡Œåœ°å€è½‰æ›ï¼Œç¨±ç‚º TLB å‘½ä¸­ã€‚å¦‚æœæ²’æœ‰ï¼Œå‰‡éœ€è¦å¾ä¸»è¨˜æ†¶é«”ä¸­è®€å–è½‰æ›è³‡æ–™ï¼Œä¸¦ä¸”æ›´æ–° TLB ä¸­çš„å…§å®¹ï¼Œç¨±ç‚º TLB éŒ¯èª¤ã€‚</p><p>TLB Hit Ratio å°±æ˜¯ TLB å‘½ä¸­ç‡ï¼Œå³åœ¨è™›æ“¬è¨˜æ†¶é«”ç®¡ç†ä¸­ï¼ŒTLB å‘½ä¸­çš„æ¬¡æ•¸èˆ‡ç¸½å­˜å–æ¬¡æ•¸ä¹‹æ¯”ã€‚é€™å€‹æŒ‡æ¨™åæ˜ äº† TLB çš„æ•ˆç‡ï¼Œä¹Ÿå¯ä»¥ç”¨ä¾†è©•ä¼°è™›æ“¬è¨˜æ†¶é«”å­ç³»çµ±çš„æ•ˆèƒ½ã€‚ä¸€èˆ¬ä¾†èªªï¼Œé«˜çš„ TLB Hit Ratio è¡¨ç¤ºè™•ç†å™¨èƒ½å¤ æ›´å¿«é€Ÿåœ°å®Œæˆåœ°å€è½‰æ›ï¼Œå› ç‚ºæœ‰æ›´å¤šçš„è½‰æ›è³‡æ–™è¢«å¿«å–åœ¨ TLB ä¸­ã€‚</p></blockquote><p><span style=color:#ff0;font-size:16px>ç¼ºé»ï¼š</span></p><ol><li><span style=color:#ff0;font-size:16px>æˆæœ¬è²´(é«˜)</span></li><li><span style=color:#ff0;font-size:16px>æœ‰æ™‚TLB Entryæ•¸ä»ä¸è¶³ä»¥æ¶µè“‹Process</span></li></ol><h3 id=æ–¹æ³•äºŒ-2>æ–¹æ³•äºŒ</h3><p>åŠ å¤§Page Size</p><p><span style=color:#ff0;font-size:16px>å„ªé»ï¼š</span></p><ol><li><span style=color:#ff0;font-size:16px>åŠ å¤§TLB Reach Costå¯æ¥å—</span></li></ol><p><span style=color:#ff0;font-size:16px>ç¼ºé»ï¼š</span></p><ol><li><p><span style=color:#ff0;font-size:16px>å…§éƒ¨ç¢è£‚æœƒå¾ˆåš´é‡</span></p><ul><li><p>è§£æ±ºæ–¹æ³•ï¼šç¾ä»£å¾ˆå¤šç¡¬é«”å‡æä¾›ä¸€äº›ä¸åŒå¤§å°çš„Page<span style=color:#ff0;font-size:16px>(Multiple Page Size)</span></p></li><li><p>eg . æä¾›ä¹™çµ„Page Size (4 KB, 2 MB)</p></li><li><p><span style=color:#ff0;font-size:16px>å› æ­¤TLB ç´€éŒ„é …ç›®å¤šå¢åŠ ä¸€å€‹Page(Frame) Size</span></p></li><li><div class=table-wrapper><table><thead><tr><th>Page No</th><th>Frame No</th><th><span style=color:#ff0;font-size:16px>Page(Frame) Size</span></th></tr></thead></table></div></li><li><p>æ­¤å¤–ï¼ŒTLBç®¡ç†ä»¥å‰æ˜¯Hardwareç®¡ç†ï¼Œ<span style=color:#ff0;font-size:16px>ç¾åœ¨å§”ç”±OSç®¡ç†ï¼Œé€™æ¨£å¸¶ä¾†çš„å¥½è™•é å¤§æ–¼æ•ˆèƒ½ä¸‹é™çš„å£è™•</span></p></li></ul></li></ol><p>[053 1:29:23]</p><h1 id=ch9-disk-management>Ch9 Disk Management</h1><blockquote><p>Disk System çµ„æˆå³å¤§å°è¨ˆç®— â˜†â˜†</p><p>Disk Access Time çµ„æˆ è¨ˆç®— â˜†â˜†â˜†â˜†</p><p>Disk Free Space Management(4ç¨®) <code>å¾ˆå°‘è€ƒ</code></p><p>File Allocatation Method(3ç¨®) â˜†â˜†â˜†â˜†â˜†</p><p>Disk Scheduling Algo (6ç¨®) â˜†â˜†â˜†â˜†â˜†</p><p>å…¶ä»–åè© <code>è€ƒå€‹ä¸€å…©æ¬¡å§</code></p><blockquote><p>Formatting â˜†</p><p>Raw-I/O x</p><p>Bootstrap loader, Boot Disk â˜†â˜†</p><p>Bad Sectors è™•ç†æ–¹æ³•(3ç¨®) â˜†â˜†â˜†</p><p>Swap Space Mangement (2æ–¹æ³•) â˜†</p><p>RAID ä»‹ç´¹ â˜†â˜†â˜†â˜†</p></blockquote></blockquote><p>â€‹</p><h2 id=disk-systemçµ„æˆ>Disk Systemçµ„æˆ</h2><p>å®šç¾©ï¼šDisk System ç”±å¤šç‰‡Disksçµ„æˆï¼Œ</p><ul><li>æ¯ç‰‡Diské€šå¸¸<u>é›™é¢(Double-side)</u>ï¼Œå¯å­˜Data</li><li>æ¯ä¸€é¢(surface)åŠƒåˆ†ç‚ºå¤šå€‹åŒå¿ƒåœ“è»Œé“ï¼Œå«åšç£è»Œ(Track)</li><li>æ¯æ¢Trackç”±å¤šå€‹Sector(ç£å€)æ‰€çµ„æˆ</li><li>ä¸åŒé¢ä¹‹ç›¸åŒTrack Noçµ„æˆä¹‹Track é›†åˆï¼Œå«åšCylinder(ç£æŸ±)</li></ul><p>åœ–ç¤ºï¼š</p><p><img src=https://i.imgur.com/5CCRoN2.png loading=lazy alt=image-20230409175639147></p><p>ä¾‹ï¼šDisk Systemæœ‰10ç‰‡Disk</p><ul><li>æ¯ç‰‡çš†é›™é¢å¯å­˜</li><li>æ¯é¢æœ‰2048æ¢Tracks</li><li>æ¯æ¢Trackæœ‰4096å€‹Sectors</li><li>æ¯å€‹Sectorå¯å­˜16KB Data</li></ul><p>æ±‚Disk System Size?</p><p>Ans.</p><p>10 * 2 * 2048 * 4096 * 16KB = 20 * 2<sup>11</sup> * 2 <sup>12</sup> * 2 <sup>14</sup> Bytes</p><p>= 10 * 2<sup>38</sup> bytes = 2.5 * 2 <sup>40</sup> bytes = 2.5 TB</p><h2 id=disk-access-time>Disk Access Time</h2><p>å®šç¾©ï¼šDisk Access Time ç”±ä¸‹åˆ—3å€‹æ™‚é–“åŠ ç¸½è€Œå¾—</p><ol><li><span style=color:#ff0;font-size:16px>Seek Time</span></li><li><span style=color:#ff0;font-size:16px>Latency Time (or Rotation<code>æ—‹è½‰</code> Time)</span></li><li><span style=color:#ff0;font-size:16px>Transfer Time</span></li></ol><p>åˆ†è¿°å¦‚ä¸‹ï¼š</p><ol><li>Seek Timeï¼š<span style=color:#ff0;font-size:16px>å°‡Head(ç£é ­)ç§»åˆ°æ¬²å­˜å–ä¹‹Trackä¸Šæ–¹</span>æ‰€èŠ±çš„æ™‚é–“</li><li><span style=color:#ff0;font-size:16px>Latency Timeï¼šå°‡æ¬²å­˜å–ä¹‹Sector è½‰åˆ°Head ä¸‹æ–¹æ‰€èŠ±çš„æ™‚é–“</span></li><li>Transfer Timeï¼š<span style=color:#ff0;font-size:16px>Â Dataåœ¨Disk èˆ‡ Memory ä¹‹é–“çš„å‚³è¼¸æ™‚é–“</span>ï¼Œèˆ‡å‚³è¼¸é‡æˆæ­£æ¯”</li></ol><p><img src=https://i.imgur.com/GpPfT5M.png loading=lazy alt=image-20230409225106416></p><p>æ­¤å¤–ä¸Šè¿°3è€…é€šå¸¸<span style=color:#ff0;font-size:16px>ä»¥ Seek time ä½”æ¯”è¼ƒå¤§</span></p><p>è¨ˆç®—ï¼š</p><p>ä¾‹1ï¼š</p><p>Disk è½‰é€Ÿ 7200 rpmï¼Œæ±‚Avg Latency (rotation) Time?</p><p>Ans.</p><p>7200 rpm = ä¸€åˆ†é˜è½‰7200æ¬¡ = ä¸€ç§’é˜120æ¬¡ = è½‰ä¸€åœˆ1/120 ç§’</p><p>å¹³å‡Rotation Time = 1/2 * 1/120 = 1/240 ç§’</p><p>ä¾‹2ï¼š</p><p>Disk System æœ‰3ç‰‡Disksï¼Œé›™é¢å¯å­˜</p><ul><li>æ¯é¢æœ‰1024æ¢Tracks</li><li>æ¯æ¢Trackæœ‰40%å€‹Sectors</li><li>æ¯å€‹Sectorå¯å­˜32KB</li><li>è½‰é€Ÿ6000 rpm</li></ul><p><span style=color:#ff0;font-size:16px>æ±‚Transfer Rate(å³æ¯ç§’å¯å‚³è¼¸å¤šå¤§é‡Data)</span></p><p>Ans.</p><p>6000 Rpm = 1ç§’å¯è½‰ 6000/60 = 100åœˆ</p><p><span style=color:#ff0;font-size:16px>æ¯è½‰ä¸€åœˆå¯å‚³è¼¸ä¸€å€‹Cylinderå®¹é‡(å¤šé¢æ™‚)</span></p><p><span style=color:#ff0;font-size:16px>å› ç‚ºä¸€æ¢Trackå®¹é‡ = 4096 * 32 Kb</span></p><p><span style=color:#ff0;font-size:16px>ä¸€æ¢Cylinderå®¹é‡ = 6æ¢Track * 4096 * 32KB</span></p><p>= 6 * 128 MB</p><p><span style=color:#ff0;font-size:16px>Transfer Rate = 100 * 6 * 128 MB/secÂ </span></p><p>= 600 * 128 Mb/Sec</p><p>ä¾‹3ï¼š</p><p>æ‰¿ä¸Šï¼Œè‹¥Diskå¹³å‡Seek Time = 10 msï¼Œä»Šæœ‰ä¸€å€‹Fileå¤§å°=2MBï¼Œæ¬²read this fileï¼Œè¦èŠ±å¤šå°‘I/O TIme?</p><p>Ans.</p><p>SeekTime + Latency time + Transfer Time = 10 ms +(1/2 * 1/100)ç§’ + 2MB / 500 * 128MB</p><p>= 10 ms + ms + 10 / 3*128 ms</p><h2 id=disk-free-space-management>Disk Free Space Management</h2><p>æœ‰å››ç¨®æ–¹æ³•</p><ol><li><span style=color:#ff0;font-size:16px>Bit Vector(æˆ–Bit Map)</span></li><li><span style=color:#ff0;font-size:16px>Link List</span></li><li><span style=color:#ff0;font-size:16px>Grouping</span></li><li><span style=color:#ff0;font-size:16px>Counting</span></li></ol><h3 id=bit-vectorbit-map>Bit Vector(Bit Map)</h3><p>(ä½å…ƒå‘é‡/åœ°åœ–)</p><p>å®šç¾©ï¼šæ¯ä¸€å€‹Blockçš†ç”¨ä¸€å€‹Bitè¡¨ç¤ºFreeèˆ‡å¦</p><p><span style=color:#ff0;font-size:16px>0ï¼šè¡¨Free</span></p><p><span style=color:#ff0;font-size:16px>1ï¼šè¡¨Allocated</span></p><p>Diskæœ‰<span style=color:#ff0;font-size:16px>nå€‹Block</span>ï¼Œå‰‡Bit Vectorå¤§å°= <span style=color:#ff0;font-size:16px>n Bit</span></p><p>ä¾‹</p><p><img src=https://i.imgur.com/B5Olcdc.png loading=lazy alt=image-20230411000727084></p><div class=table-wrapper><table><thead><tr><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td><td>1</td><td>1</td><td>0</td><td>0</td><td>0</td><td>1</td><td>0</td></tr></tbody></table></div><p>å„ªé»ï¼š</p><ul><li>ç°¡å–®æ˜“å¯¦æ–½</li><li><span style=color:#ff0;font-size:16px>å®¹æ˜“æ‰¾åˆ°é€£çºŒçš„Free Block</span>(å³é€£çºŒçš„0)</li></ul><p>ç¼ºé»ï¼š</p><ul><li><span style=color:#ff0;font-size:16px>å°å‹Diské©ç”¨ï¼Œä½†å¤§å‹Diskä¸é©ç”¨</span>ï¼Œå› ç‚ºBlockæ•¸ç›®é¾å¤§ï¼Œé€ æˆBlock Vector Sizeå¾ˆå¤§ï¼Œå¾ˆä½”Memory Spaceç”šè‡³è¢«è¿«ç½®æ–¼Disk</li></ul><h3 id=link-list>Link List</h3><p>å®šç¾©ï¼šOSç›´æ¥åœ¨Diskä¸Šï¼Œå°‡é€™äº›Free Blocksä»¥Linkingæ–¹å¼ä¸²æ¥ï¼Œé€²è¡Œç®¡ç†</p><p><img src=https://i.imgur.com/7TpScYL.png loading=lazy alt=image-20230411004147771></p><p>å„ªé»ï¼š</p><p><span style=color:#ff0;font-size:16px>1. å¤§å‹Diské©ç”¨</span></p><p><span style=color:#ff0;font-size:16px>2. æ’å…¥/åˆªé™¤ Free Blockæ–¹ä¾¿</span></p><p>ç¼ºé»ï¼š</p><p><span style=color:#ff0;font-size:16px>1. ä¸å¤ è¿…é€Ÿå»æ‰¾å¤§é‡çš„å¯ç”¨å€å¡Šï¼Œå› ç‚ºDiskä¸Šè®€å–Link Infoè€—æ™‚(I/O)</span></p><p>Noteï¼šç”¨Groupingæ³•æ”¹å–„</p><p><span style=color:#ff0;font-size:16px>2. ä¸å®¹æ˜“æ‰¾åˆ°é€£çºŒçš„Free Blocks</span></p><p>Noteï¼šç”¨Countingæ³•æ”¹å–„</p><h3 id=grouping>Grouping</h3><p>å®šç¾©ï¼šæ˜¯Link Listæ³•ä¹‹è®Šå½¢ï¼Œ<span style=color:#ff0;font-size:16px>åœ¨Free Blockå…§é™¤äº†ç´€éŒ„ Link Infoä¹‹å¤–ï¼Œå¦é¡å¤–ç´€éŒ„å…¶ä»–Free Blockä¹‹No(Address)</span></p><p>ä¾‹ï¼š(Assume one Block å¯è¨˜5å€‹æ¬„ä½)</p><p><img src=https://i.imgur.com/r200h5S.png loading=lazy alt=image-20230411005506514></p><p><span style=color:#ff0;font-size:16px>å„ªé»ï¼šå¯è¿…é€Ÿæ‰¾åˆ°å¤§é‡çš„Free Blocks</span></p><h3 id=counting>Counting</h3><p>å®šç¾©ï¼šåˆ©ç”¨é€£çºŒæ€§é…ç½®åŠé€£çºŒæ€§æ­¸é‚„ä¹‹ç‰¹æ€§ï¼Œç¨åŠ æ”¹è®ŠLink Listè¨˜éŒ„æ–¹å¼ï¼ŒFree Block å…§é™¤äº†ç´€éŒ„Linking infoä»¥å¤–ï¼Œ<span style=color:#ff0;font-size:16px>å¦å¤–ç´€éŒ„åœ¨æ­¤Free Blockä¹‹å¾Œçš„é€£çºŒFree Blockä¹‹å€‹æ•¸</span></p><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/IZjL1OX.png loading=lazy alt=image-20230411013244700></p><p>å„ªé»ï¼š</p><p><span style=color:#ff0;font-size:16px>é©ç”¨æ–¼é€£çºŒæ€§é…ç½®ï¼Œæ–¹ä¾¿æ‰¾åˆ°é€£çºŒæ€§çš„Free Blockï¼Œä¸”è‹¥é€£çºŒçš„Free Blockå¾ˆå¤šï¼ŒLink Listé•·åº¦ä¹Ÿå¯å¤§å¹…ç¸®çŸ­</span></p><p>[054]</p><h2 id=file-allocation-methods->File Allocation Methods â˜†â˜†â˜†â˜†â˜†</h2><p>ä¸»è¦æœ‰ä¸‰å¤§æ–¹æ³•</p><ol><li>Contiguous Allocation(é€£çºŒæ€§)</li><li>Linked Allocation(éˆçµå¼)<ul><li>æœ‰ä¸€å€‹è®Šå½¢å«åš FAT metohd</li></ul></li><li>Index Allocation(ç´¢å¼•å¼)<ul><li>ä¾‹ï¼šUNIXçš„I-Node Structure</li></ul></li></ol><h3 id=contiguous-allocation>Contiguous Allocation</h3><p>å®šç¾©ï¼šè‹¥Fileå¤§å°=nå€‹Blocksï¼Œå‰‡<span style=color:#ff0;font-size:16px>OSå¿…é ˆåœ¨Diskä¸­æ‰¾åˆ°nå€‹é€£çºŒæ€§çš„Free Blocks</span>æ‰èƒ½é…ç½®çµ¦å®ƒï¼Œæ­¤å¤–OSåœ¨Physical Directoryï¼Œæœƒè¨˜éŒ„ä¸‹åˆ—è³‡è¨Š</p><div class=table-wrapper><table><thead><tr><th>File Name</th><th>Strat Block No</th><th>Size(å€å¡Šæ•¸)</th></tr></thead><tbody><tr><td></td><td></td><td></td></tr></tbody></table></div><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/jPTzaSV.png loading=lazy alt=image-20230411230013638></p><p>è‹¥File1å¤§å°=3å€‹Blocksï¼Œå‰‡OSé…ç½®<span style=color:#ff0;font-size:16px>6,7,8è™Ÿ</span>Blockçµ¦å®ƒï¼Œä¸”Physical Directoryç´€éŒ„å¦‚ä¸‹</p><div class=table-wrapper><table><thead><tr><th>File Name</th><th>State No</th><th>Size</th></tr></thead><tbody><tr><td>File1</td><td>6</td><td>3</td></tr></tbody></table></div><p><span style=color:#ff0;font-size:16px>å„ªé»</span>ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>å¹³å‡SeekTimeè¼ƒå°(å› ç‚ºBlockså¤§éƒ½è½åœ¨åŒä¸€æ¢Trackæˆ–é„°è¿‘Trackä¸Š)</span></li><li><span style=color:#ff0;font-size:16px>å¯æ”¯æŒRamdom(Direct) AccessåŠSequential Access</span></li><li><span style=color:#ff0;font-size:16px>å¯é åº¦è¼ƒé«˜(than Linked Allocation)</span></li><li><span style=color:#ff0;font-size:16px>å¾ªåºå­˜å–é€Ÿåº¦è¼ƒå¿«(than LinkedList)</span></li></ol><p><span style=color:#ff0;font-size:16px>ç¼ºé»ï¼š</span></p><ol><li><span style=color:#ff0;font-size:16px>æœƒæœ‰External Fragmentation(å¤–éƒ¨ç¢è£‚)</span>(Noteï¼šDiskç”¨Repack(ç£ç¢Ÿé‡çµ„)æ–¹å¼è§£æ±ºï¼Œ<span style=color:#ff0;font-size:16px>é¡ä¼¼Memoryçš„Compaction</span>)<span style=color:#ff0;font-size:16px>(Noteï¼šæ‰€æœ‰Fileé…ç½®æ–¹æ³•çš†æœ‰å…§éƒ¨ç¢è£‚)</span></li></ol><ul><li>eg. Block Size = 10KB, Fileå¤§å°=44 KB, é…5å€‹Blocksï¼Œå…§ç¢=5*16-44 = 6KB</li></ul><ol start=2><li><span style=color:#ff0;font-size:16px>Fileå¤§å°ä¸æ˜“å‹•æ…‹æ“´å……</span></li><li><span style=color:#ff0;font-size:16px>å»ºæª”ä¹‹å‰é ˆè¦äº‹å…ˆå®£å‘Šå¤§å°</span></li></ol><h3 id=linked-allocation>Linked Allocation</h3><p>å®šç¾©ï¼šè‹¥Fileå¤§å°=nå€‹ Blocksï¼Œå‰‡OSåªé ˆåœ¨Diskä¸­æ‰¾åˆ°nå€‹Free Blocks<span style=color:#ff0;font-size:16px>(ä¸é ˆé€£çºŒ)</span>ï¼Œå³å¯é…ç½®ä¸”<span style=color:#ff0;font-size:16px>Allocated Blocksä¹‹é–“ä»¥Linkæ–¹å¼ä¸²é€£</span>ï¼Œå¦OSåœ¨Physical Directoryç´€éŒ„ä¸‹åˆ—Info</p><div class=table-wrapper><table><thead><tr><th>File Name</th><th>Start Block No</th><th>End Block No</th></tr></thead><tbody><tr><td>File2</td><td>3</td><td>4</td></tr></tbody></table></div><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/VbqucJ1.png loading=lazy alt=image-20230411234232077></p><p><span style=color:#ff0;font-size:16px>å„ªç¼ºé»èˆ‡Contiguousç›¸å</span></p><p><span style=color:#ff0;font-size:16px>å„ªé»</span>ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æ²’æœ‰å¤–éƒ¨ç¢è£‚</span></li><li><span style=color:#ff0;font-size:16px>Fileå¤§å°å®¹æ˜“å‹•æ…‹æ“´å……</span></li><li><span style=color:#ff0;font-size:16px>å»ºFileå‰ç„¡éœ€äº‹å…ˆå®£å‘Šå¤§å°</span></li></ol><p><span style=color:#ff0;font-size:16px>ç¼ºé»ï¼š</span></p><ol><li><span style=color:#ff0;font-size:16px>Seek Timeè¼ƒé•·(å› ç‚ºä¸é€£çºŒçš„blockå¯èƒ½æ•£è½åœ¨è¨±å¤šä¸åŒçš„Trackä¸Š)</span></li><li><span style=color:#ff0;font-size:16px>ä¸æ”¯æ´Random Access</span></li><li><span style=color:#ff0;font-size:16px>å¯é åº¦è¼ƒå·®(å› ç‚ºè¬ä¸€Linkæ–·è£‚ï¼ŒData Lost)</span></li><li><span style=color:#ff0;font-size:16px>å¾ªåºå­˜å–é€Ÿåº¦æ…¢(å› ç‚ºè¦åœ¨Diskä¸Šè®€å–Linkè³‡è¨Šï¼Œæ‰çŸ¥ä¸‹ä¸€å€‹Blockç‚ºä½•)</span></li></ol><p><span style=color:#ff0;font-size:16px></span></p><p>è‹¥File2å¤§å°=3å€‹Blocksï¼Œå‰‡OSå¯é…ç½® <span style=color:#ff0;font-size:16px>3, 1, 4 è™Ÿ</span></p><p>[055]</p><h2 id=fatfile-allocation-table>FAT(File Allocation Table)</h2><p>å®šç¾©ï¼šæ˜¯<span style=color:#ff0;font-size:16px>LinkedAllocation</span>ä¹‹è®Šå½¢ï¼Œä¸»è¦å·®ç•°å¦‚ä¸‹</p><p><span style=color:#ff0;font-size:16px>Allocated Blockä¹‹é–“çš„Linked Infoå­˜æ–¼OS Memory Areaä¸­çš„ä¸€å€‹è¡¨æ ¼ï¼Œå«FAT</span>ï¼Œè€Œéå­˜æ–¼Diskä¸­</p><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/BupNs2O.png loading=lazy alt=image-20230412000447471></p><p>File Directory</p><div class=table-wrapper><table><thead><tr><th>File Name</th><th>FAT Entry</th></tr></thead><tbody><tr><td>File 2</td><td>3</td></tr></tbody></table></div><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æƒ³è¦åŠ é€ŸRandom Access In the Linked Allocation</span>(å› ç‚ºå¯ä»¥åœ¨memoryä¸­çš„FATæ‰¾åˆ°ç¬¬iå€‹å€å¡Šçš„è™Ÿç¢¼ï¼Œç›¸æ¯”æ–¼åœ¨Diskä¸­æ‰¾æ›´å¿«ã€‚æ‰¾å®Œå¾Œå†å»Disk Access i th Block)ï¼Œ<span style=color:#ff0;font-size:16px>ä¸ç”¨åœ¨Disk ä¸­Traverse LinkedList</span></li></ol><h2 id=index-allocation>Index Allocation</h2><p>å®šç¾©ï¼šè‹¥Fileå¤§å°=nå€‹Blocksï¼Œå‰‡OSé™¤äº†é…ç½®nå€‹Blocks<span style=color:#ff0;font-size:16px>(ç„¡é ˆé€£çºŒ)</span>å­˜æ”¾Dataä¹‹å¤–ï¼Œ<span style=color:#ff0;font-size:16px>å¦é ˆé¡å¤–é…ç½®Index Blockï¼Œå„²å­˜æ‰€æœ‰Data Block ä¹‹No(address)</span> ï¼Œä¸”OSåœ¨Physical Directory</p><p>ç´€éŒ„ï¼š</p><div class=table-wrapper><table><thead><tr><th>File Name</th><th>Index Block No</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><p>ä¾‹ï¼šFile3å¤§å°=3å€‹Blocksï¼Œå‰‡OSå¯é…ç½®<u>11,0,14è™Ÿ</u>Blockçµ¦å®ƒå­˜æ”¾Dataï¼Œå¦å¤–é…ç½®<u>15</u>è™ŸBlockä½œç‚º<span style=color:#ff0;font-size:16px>Index Block è€ŒIndex Blockå…§å®¹ç‚º</span></p><div class=table-wrapper><table><thead><tr><th>File Name</th><th>Index Block No</th></tr></thead><tbody><tr><td>File3</td><td>15</td></tr></tbody></table></div><p><img src=https://i.imgur.com/r5VjRQY.png loading=lazy alt=image-20230412214600748></p><p>æƒ³è¦èåˆé€£çºŒæ€§é…ç½®èˆ‡éˆçµå¼é…ç½®éƒ¨åˆ†çš„å¥½è™•</p><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>ä¸æœƒæœ‰å¤–éƒ¨ç¢è£‚</span></li><li><span style=color:#ff0;font-size:16px>æ”¯æ´Ramdom Access</span>åŠSequential Access</li><li>Fileå¤§å°å®¹æ˜“å‹•æ…‹æ“´å……</li><li>å»ºFileä¹‹å‰ç„¡é ˆäº‹å…ˆå®£å‘Šå¤§å°ï¼Œ<span style=color:#ff0;font-size:16px></span></li></ol><p>ç¼ºé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>Index Block å ç”¨é¡å¤–ç©ºé–“</span></li><li><span style=color:#ff0;font-size:16px>Linking Spaceæµªè²»(OverHead)æ¯”Linked Allocation</span></li><li><span style=color:#ff0;font-size:16px>è‹¥Fileå¾ˆå¤§ï¼Œå‰‡å–®ä¸€å€‹Index Blockå¯èƒ½ç„¡æ³•å®¹ç´(ä¿å­˜)Fileçš„æ‰€æœ‰Data Block Noï¼Œ</span>æ­¤å•é¡Œé ˆè¢«è§£æ±º</li></ol><h2 id=è§£æ±ºå–®ä¸€index-block-ä¸å¤ å­˜æ”¾æ‰€æœ‰data-block-noä¹‹å•é¡Œ>è§£æ±ºå–®ä¸€Index Block ä¸å¤ å­˜æ”¾æ‰€æœ‰Data Block Noä¹‹å•é¡Œ</h2><h3 id=æ–¹æ³•ä¸€-3>æ–¹æ³•ä¸€</h3><p>ä½¿ç”¨å¤šå€‹Index Blocksï¼Œ<span style=color:#ff0;font-size:16px>ä¸”å½¼æ­¤ä»¥Linkæ–¹å¼ä¸²é€£</span></p><p>ä¾‹ï¼š</p><p>Assumeä¸€å€‹index Blockå¯å­˜5å€‹No</p><p><img src=https://i.imgur.com/BBxjv7d.png loading=lazy alt=image-20230412224917945></p><p>ç¼ºé»ï¼š</p><p>Random Access of i th Blockä¹‹å¹³å‡I/Oæ¬¡æ•¸å¤§å¹…å¢é•·(ç·šæ€§æˆé•·)</p><h3 id=æ–¹æ³•äºŒ-3>æ–¹æ³•äºŒ</h3><p><span style=color:#ff0;font-size:16px>ä½¿ç”¨éšå±¤å¼Index StructureÂ </span></p><p>ä¾‹ï¼š</p><p>Two-Level Index Structure</p><p><img src=https://i.imgur.com/eqLbyUn.png loading=lazy alt=image-20230412230302769></p><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>RandomÂ  Access of i th Blockä¹‹I/Oæ¬¡æ•¸æ˜¯å›ºå®šå€¼</span> eg 2å±¤-> 3æ¬¡I/O</li><li>é©åˆå¤§å‹æª”æ¡ˆ</li></ol><p>ç¼ºé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>å°å°å‹æª”æ¡ˆæ¥µä¸åˆé©</span>ï¼Œå› ç‚ºIndex Blockså¤ªä½”ç©ºé–“ï¼Œç”šè‡³å¤šæ–¼Data Block æ•¸ç›®(ç›®éŒ„20é ï¼Œå…§æ–‡2é )</li></ol><h3 id=æ–¹æ³•ä¸‰-1>æ–¹æ³•ä¸‰â˜†â˜†â˜†â˜†â˜†</h3><p>æ··åˆæ³•ï¼Œå³<span style=color:#ff0;font-size:16px>UNIXçš„I-Nodeçµæ§‹</span>ï¼Œä¸€å®šè¦æœƒï¼Œç‹ ç‹ åœ°è¨˜ä¸‹ä¾†</p><p>ä¾‹ï¼šI-Nodeæœ‰15æ ¼(entry)</p><p><img src=https://i.imgur.com/9qQrFgJ.png loading=lazy alt=image-20230412232955337></p><p><span style=color:#ff0;font-size:16px>ç¬¬1~ç¬¬12æ ¼ï¼š</span>ç›´æ¥ç”¨ä¾†è¨˜éŒ„Data Block No</p><p><span style=color:#ff0;font-size:16px>ç¬¬13æ ¼ï¼špointer to Single-Level Index</span></p><p><span style=color:#ff0;font-size:16px>ç¬¬14æ ¼ï¼špointer To Two-Level Index</span></p><p><span style=color:#ff0;font-size:16px>ç¬¬15æ ¼ï¼špointer To Three-Level Index</span></p><p>&mldr; ä»¥æ­¤é¡æ¨</p><p>MAX.FILE size = (12+n<sup>2</sup>+n<sup>3</sup>+&mldr; ) å€‹Data Blocks</p><p>å„ªé»ï¼š</p><p><span style=color:#ff0;font-size:16px>å°å‹ã€å¤§å‹Fileçš†é©åˆ</span></p><p>[055 1:20:00]</p><p>ä¾‹é¡Œ1ï¼š</p><p>I-Nodeä¹‹å®šç¾©åŒä¸Šæ‰€è¿°(15å€‹Entry)</p><ul><li>Block-Size = 16Kb</li><li>Block No(Address) ä½”4Bytes</li></ul><p>æ±‚MAX File Sizeå¤šå¤§?</p><p>Ans</p><p>ä¸€å€‹Index Blockå¯ä»¥å­˜ 16KB/4Byte = 2<sup>12</sup>Data Block No</p><p>å› æ­¤MAX File SIZE</p><p>=12+2<sup>12</sup>+(2<sup>12</sup>)<sup><sup>2</sup></sup>+(2<sup>12</sup>)<sup><sup>3</sup></sup></p><p>=(12+2<sup>12</sup>+2<sup>24</sup>+<sup>36</sup>) * 16kb</p><p>= 2<sup>50</sup> byte</p><p>â‰’ 1PB</p><p>ä¾‹é¡Œ2ï¼š</p><p>æ‰¿ä¸Šï¼Œè‹¥Fileå¤§å° = 8000å€‹Blocksï¼Œå‡è¨­I-Nodeå·²åœ¨Memoryä¸­ï¼Œå‰‡è¦å­˜å–æ­¤Fileçš„ç¬¬6000å€‹Data Blockï¼Œéœ€è¦?æ¬¡I/O</p><p>Ans.</p><p>å‰12å€‹ï¼š6000-12 = 5988</p><p>ç¬¬13å€‹ï¼š5988-4096= 1892</p><p>ç¬¬14å€‹ï¼šå¤§æ¦‚å°±åœ¨é€™</p><p>å…±3æ¬¡çš„I/O</p><p>ä¾‹é¡Œ3ï¼š</p><p><span style=color:#ff0;font-size:16px>å¾ªåºå­˜å–å‰é¢6000å€‹Data Blocksï¼Œå‰‡è¦?æ¬¡I/O</span></p><p>Ans.</p><p>6000+3= 6003æ¬¡ I/O</p><p>[055 1:39:00]</p><h2 id=disk-scheduling-algo>Disk Scheduling Algo</h2><p>ç›®çš„åœ¨æ–¼é™ä½è»Œé“ç§»å‹•ç¸½æ•¸</p><ol><li>FCFS</li><li>SSTF</li><li>SCAN</li><li>C-SCAN (C:Cirular)</li><li>Look</li><li>C-Look</li></ol><h3 id=fcfsfirst-come-first-service>FCFS(First-Come-First-Service)</h3><p>å®šç¾©ï¼š<span style=color:#ff0;font-size:16px>æœ€æ—©åˆ°é”çš„Track requestï¼Œå„ªå…ˆæœå‹™</span></p><p>ä¾‹å­ï¼š</p><p>Diskæœ‰200è»Œï¼Œç·¨è™Ÿ0~199ï¼Œ<u>Headç›®å‰åœåœ¨ç¬¬53è»Œ</u>ï¼Œå‰›å‰›æœå‹™å®Œç¬¬40è»Œï¼Œç¾åœ¨Disk Queueä¸­æœ‰ä¸‹åˆ—Track requestä¾åºç‚º</p><p><u>98, 183, 37, 122, 14, 124, 65, 67</u></p><p>æ±‚Trackç§»å‹•ç¸½æ•¸</p><p>Ans</p><p>(183-53)+(183-37)+(122-37)+(122-14)+(124-14)+(124-65)+(67-65) = 640è»Œ</p><p>åˆ†æï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æ’ç­æ•ˆæœä¸¦ä¸æ˜¯å¾ˆå¥½ï¼ŒTrackç§»å‹•æ•¸è¼ƒå¤šï¼ŒSeek TimeÂ  è¼ƒé•·</span></li></ol><p>Noteï¼šDisk Schedulingæ³•å‰‡ï¼Œ<span style=color:#ff0;font-size:16px>æ—¢ç„¡æœ€ä½³ï¼Œä¹Ÿç„¡æœ€å·®</span></p><ol start=2><li>å…¬å¹³ï¼Œ<span style=color:#ff0;font-size:16px>No Starvation</span></li></ol><h3 id=sstfshortest-seek-time-track-first>SSTF(Shortest Seek-Time Track First)</h3><p>å®šç¾©ï¼š<span style=color:#ff0;font-size:16px>è·é›¢Headç›®å‰ä½ç½®æœ€è¿‘çš„Track requestï¼Œå„ªå…ˆæœå‹™</span></p><p>ä¾‹ï¼š</p><p><u>98, 183, 37, 122, 14, 124, 65, 67</u></p><p>ans</p><p>53->65->67->37->14->98->122->124->183</p><p>= 236è»Œ</p><p>åˆ†æï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æ’ç­æ•ˆæœä¸éŒ¯ï¼ŒTrackç§»å‹•æ•¸è¼ƒå°‘ï¼ŒSeek Timeå°ï¼Œä½†ä¸¦éæ˜¯Optimal</span></li><li><span style=color:#ff0;font-size:16px>ä¸å…¬å¹³ï¼Œæœ‰å¯èƒ½Starvation</span></li></ol><h3 id=scanæ³•å‰‡>SCANæ³•å‰‡</h3><p>SCAN is Suck Do not Use</p><p>å®šç¾©ï¼šHeadä¾†å›é›™å‘ç§»å‹•æƒæï¼Œé‡æœ‰Track requestï¼Œå³è¡Œæœå‹™ï¼ŒHeadé‡åˆ°Tracké–‹ç«¯æˆ–ç›¡é ­æ™‚ï¼Œæ‰æœƒæŠ˜è¿”æä¾›æœå‹™</p><p>ç¤ºæ„åœ–ï¼š</p><p><img src=https://i.imgur.com/qzzII7w.png loading=lazy alt=image-20230415025348792></p><p>åˆ†æï¼š</p><ol><li>æ’ç­æ•ˆèƒ½å¯æ¥å—<span style=color:#ff0;font-size:16px>é©ç”¨æ–¼å¤§é‡è² è¼‰ä¹‹æƒ…æ³</span>(å› ç‚ºåœ¨Track Requestæœ‰è¼ƒå‡å‹»ä¸€è‡´ä¹‹ç­‰å¾…æ™‚é–“)</li></ol><p>Noteï¼š<span style=color:#ff0;font-size:16px>Lookä¹Ÿæ˜¯</span></p><ol start=2><li><span style=color:#ff0;font-size:16px>åœ¨æŸäº›æ™‚åˆ»å°æŸäº›Track Requestï¼Œä¼¼ä¹ä¸ç›¡å…¬å¹³</span></li></ol><p><img src=https://i.imgur.com/pVPUioT.png loading=lazy alt=image-20230415030344217></p><p>â€‹ Noteï¼šç”¨C-SCANè§£</p><ol start=3><li>Headéœ€è¦é‡åˆ°Track é–‹ç«¯æˆ–ç›¡é ­æ‰æŠ˜è¿”ï¼Œ<span style=color:#ff0;font-size:16px>æ­¤èˆ‰è€—è²»ä¸å¿…è¦çš„Seek Time</span></li></ol><p>â€‹ Noteï¼šç”¨Lookè§£æ±º</p><p>[056]</p><h3 id=c-scan>C-SCAN</h3><p>å®šç¾©ï¼šC Stand for circulerï¼Œæ˜¯SCANè®Šå½¢</p><p><span style=color:#ff0;font-size:16px>å·®åˆ¥ï¼šåªæä¾›å–®é …æœå‹™</span>ï¼ŒæŠ˜è¿”å›ç¨‹ä¸æä¾›æœå‹™</p><p>ç¤ºæ„ï¼š</p><p><img src=https://i.imgur.com/ca6UODu.png loading=lazy alt=image-20230415032118760></p><p><span style=color:#ff0;font-size:16px>çˆ­è­°åœ¨è¨ˆç®—ä¸Šï¼ŒæŠ˜è¿”çš„Trackç§»å‹•æ•¸è¦åˆ—å…¥é‚„æ˜¯ä¸åˆ—å…¥è¨ˆç®—?</span></p><h3 id=look>Look</h3><p>å®šç¾©ï¼š<span style=color:#ff0;font-size:16px>æ˜¯SCANä¹‹è®Šå½¢</span></p><p>å·®åˆ¥ï¼šHeadæœå‹™å®Œè©²æ–¹å‘æœ€å¾Œä¸€å€‹Track Requestå¾Œï¼Œå³å¯<span style=color:#ff0;font-size:16px>æŠ˜è¿”</span>æä¾›å›ç¨‹æœå‹™</p><p>ç¤ºæ„åœ–ï¼š</p><p><img src=https://i.imgur.com/gcbuHUo.png loading=lazy alt=image-20230415032803987></p><h3 id=c-look>C-LOOK</h3><p>å®šç¾©ï¼šLookä¹‹è®Šå½¢</p><p><span style=color:#ff0;font-size:16px>å·®åˆ¥ï¼šåªæä¾›å–®å‘æœå‹™</span>ï¼ŒæŠ˜è¿”çš„Track<span style=color:#ff0;font-size:16px>åˆ—å…¥è¨ˆç®—</span></p><p><img src=https://i.imgur.com/huKsRAG.png loading=lazy alt=image-20230415033339377></p><h3 id=è£œå……>è£œå……</h3><div class=table-wrapper><table><thead><tr><th>[æ]</th><th>[Modern]å…¶ä»–ç‰ˆ</th></tr></thead><tbody><tr><td>SCAN</td><td>x</td></tr><tr><td>C-SCAN</td><td>x</td></tr><tr><td>Look</td><td>SCAN</td></tr><tr><td>C-Look</td><td>C-SCAN</td></tr></tbody></table></div><p><img src=https://i.imgur.com/HPad7CS.png loading=lazy alt=image-20230415033647324></p><h2 id=å…¶ä»–åè©é …>å…¶ä»–åè©é …</h2><h3 id=formatting-æ ¼å¼åŒ–>Formatting (æ ¼å¼åŒ–)</h3><p>åˆ†ç‚ºå…©ç¨®</p><ol><li><p><span style=color:#ff0;font-size:16px>Physical format</span></p><p>åˆç¨±<span style=color:#ff0;font-size:16px>low-level format</span></p><ol><li><p>å·¥å» ç”Ÿç”¢Disk Systemæ™‚åŸ·è¡Œ</p></li><li><p>ä¸»è¦æ˜¯åŠƒåˆ†å‡ºDisk Controllerå¯ä»¥å­˜å–çš„Sector</p><p><img src=https://i.imgur.com/dVrGobS.png loading=lazy alt=image-20230415122707706></p></li><li><p>åµæ¸¬æœ‰ç„¡ä¸è‰¯Sector</p></li></ol></li><li><p><span style=color:#ff0;font-size:16px>Logical formatting</span></p><ol><li>useråœ¨ä½¿ç”¨Diskä¹‹å‰ï¼Œå¿…é ˆåšå…©ä»¶äº‹æƒ…<ol><li>Partitionï¼šåˆ‡å‰²åˆ†å€ï¼Œå³Logical driveï¼Œec: C,D,Eç£ç¢Ÿæ©Ÿ</li><li><span style=color:#ff0;font-size:16px>Logical Formatï¼šOSè£½ä½œ(å¯«å…¥) File Management System æ‰€éœ€ä¹‹è³‡æ–™çµæ§‹</span><ol><li>Free Spaceç®¡ç†(eg. Bit Vector)</li><li>FAT, I-Node (é…ç½®æ–¹æ³•)</li><li>ç©ºçš„Physical Directory</li></ol></li></ol></li></ol></li></ol><h3 id=rowåŸå§‹çš„-io-åŸºæœ¬ä¸Šæ²’è€ƒé>Row<code>åŸå§‹çš„</code>-I/O (åŸºæœ¬ä¸Šæ²’è€ƒé)</h3><p>å®šç¾©ï¼šå°‡Diskè¦–ç‚ºå¤§å‹Arrayåœ¨ä½¿ç”¨ï¼Œä¸€å€‹Sectorå¥½æ¯”æ˜¯Arrayçš„ä¸€æ ¼ï¼Œ<span style=color:#ff0;font-size:16px>ç„¡File Systemä¹‹è³‡æº</span>ï¼Œé€™æ¨£çš„å„ªé»æ˜¯<span style=color:#ff0;font-size:16px>æª”æ¡ˆå­˜å–é€Ÿåº¦å¿«é€Ÿ</span>ï¼Œç¼ºé»æ˜¯<span style=color:#ff0;font-size:16px>Userä¸æ˜“ä½¿ç”¨ï¼Œ</span><span style=color:#ff0;font-size:16px>é€šå¸¸åœ¨DBMSåº•å±¤ä½¿ç”¨</span></p><p>[057]</p><h3 id=bootstrap-loader->Bootstrap Loader â˜†â˜†â˜†â˜†â˜†</h3><p>ä¸»è¦ç›®çš„ï¼š<span style=color:#ff0;font-size:16px>é–‹æ©Ÿæ™‚ï¼Œç”¨ä»¥å¾Diskè¼‰å…¥ OS Object Code åˆ°Memory(RAM) çš„ç‰¹æ®ŠLoader</span></p><h4 id=æ—©æœŸçš„ä½œæ³•>æ—©æœŸçš„ä½œæ³•</h4><p><img src=https://i.imgur.com/EFdPndB.png loading=lazy alt=image-20230415130102305></p><p><span style=color:#ff0;font-size:16px>ç¼ºé»ï¼š</span></p><ol><li><p><span style=color:#ff0;font-size:16px>Bootstrap Loaderç„¡æ³•ä»»æ„è®Šæ›´</span></p></li><li><p><span style=color:#ff0;font-size:16px>ROM Sizeæœ‰é™ï¼ŒBootStrap Loader ç„¡æ³•å¾ˆå¤§</span></p></li></ol><h4 id=ç¾ä»£çš„åšæ³•>ç¾ä»£çš„åšæ³•</h4><p><img src=https://i.imgur.com/rlv7vxW.png loading=lazy alt=image-20230415133110047></p><h2 id=bad-sectors-ä¹‹è™•ç†æ–¹æ³•>BAD Sectors ä¹‹è™•ç†æ–¹æ³•</h2><p>Sectoræœƒå£çš„åŸå› </p><ol><li>å·¥å» ç”Ÿç”¢æ™‚å·²Bad</li><li>æ­£å¸¸ä½¿ç”¨ä¸€æ®µæ™‚é–“å¾Œï¼ŒBad</li></ol><p>è™•ç†æ–¹æ³•ï¼š</p><h3 id=æ–¹æ³•ä¸€-4>[æ–¹æ³•ä¸€]</h3><p><span style=color:#ff0;font-size:16px>Mark(æ¨™ç¤º) Bad Sectors</span>ï¼Œä»¥å¾Œä¸ç”¨</p><p>ä¾‹ï¼š<span style=color:#ff0;font-size:16px>IDE Disk Controller</span></p><h3 id=æ–¹æ³•äºŒ-4>[æ–¹æ³•äºŒ]</h3><p><span style=color:#ff0;font-size:16px>Spare(å‚™å“) Sectorsæ–¹æ³•</span></p><p>ä¾‹ï¼šSCSI Disk Controlleræ¡ç”¨</p><p>ä½œæ³•ï¼š</p><p><img src=https://i.imgur.com/26P30P5.png loading=lazy alt=image-20230415150125529></p><p>ä¸€æ—¦æœ‰BAD Sector(eg 87è™Ÿ Sector BAD)ï¼Œå‰‡Disk Controller æœƒå¾ <span style=color:#ff0;font-size:16px>Spare Sectorsé¸æ“‡ä¸€å€‹Spare Sector (eg. 333è™Ÿ Sector) ä¾†æ›¿ä»£BAD Sector</span>ã€‚å°‡ä¾†OSåœ¨å­˜å–87è™ŸSectoræ™‚ï¼ŒSCSI Controlleræœƒå°‡å®ƒ<span style=color:#ff0;font-size:16px>è½‰å‘æˆå°333è™Ÿä¹‹å­˜å–</span>(ä½†OSä¸çŸ¥é“é€™ä»¶äº‹æƒ…)</p><p>ç¼ºé»ï¼š</p><p><span style=color:#ff0;font-size:16px>æ­¤ä¸€Sectorè½‰å‘å­˜å–ä¹‹å‹•ä½œï¼Œå¯èƒ½æœƒç ´å£æ‰OS Disk Schedulingä¹‹æœ€é©æ•ˆç›Šï¼Œç ´å£ç£ç¢Ÿæ’ç­æ•ˆèƒ½</span></p><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/NaycwX0.png loading=lazy alt=image-20230415153156232></p><p><span style=color:#ff0;font-size:16px>æ”¹å–„ä½œæ³•ï¼š</span></p><p>å°‡Spare Sectors åˆ†æ•£åˆ°æ¯æ¢Track (or cylinder)ä¸Šï¼Œä¸è¦é›†ä¸­å­˜æ”¾</p><p>è‹¥Sector BADï¼Œå‰‡ç”¨<span style=color:#ff0;font-size:16px>ç›¸åŒè»Œé“æˆ–é„°è¿‘çš„Track ä¸Šçš„Spare Sectorä½œæ›¿ä»£</span></p><p>èˆ‰ä¾‹ä¾†èªªï¼šç¶­ä¿®ä¸­å¿ƒå¦‚æœéƒ½åœ¨å°æ±ï¼Œé‚£é‹é€æ™‚é–“æœƒæ‹–å¾ˆé•·ï¼Œè¦è®“æ™‚é–“é™ä½çš„åšæ³•å°±æ˜¯è®“å…¨çœå„åœ°éƒ½æœ‰ç¶­ä¿®ä¸­å¿ƒï¼Œé™ä½é‹é€æ™‚é–“</p><h3 id=æ–¹æ³•ä¸‰-2>[æ–¹æ³•ä¸‰]</h3><p><span style=color:#ff0;font-size:16px>Sector Sliping æ³•</span></p><p>ä¾‹ï¼š</p><p><img src=https://i.imgur.com/Cp7JpAT.png loading=lazy alt=image-20230415155647865></p><h2 id=swap-space-management>Swap Space Management</h2><p>[äº¤å¤§æˆå¤§æœ‰è€ƒéä¸€æ¬¡ï¼Œè‡³æ­¤ä¹‹å¾Œæ»…è·¡]</p><p>åœ¨Virtual Memory, Medium-term Schedulerï¼Œæœƒå°‡Diskä½œç‚ºSwap outçš„pageæˆ–process imageä¹‹æš«å­˜è™•</p><p>Swap Spaceç©ºé–“å¤§å°ï¼Œ<span style=color:#ff0;font-size:16px>å®œè¶…ä¼°ï¼Œæ¯”è¼ƒå®‰å…¨</span></p><p>å¦‚æœç•™å¤ªå°çš„ç¤ºæ„åœ–ï¼š</p><p><img src=https://i.imgur.com/8HR7DK7.png loading=lazy alt=image-20230415235501768></p><p><span style=color:#ff0;font-size:16px>Swap Space Managementæ–¹å¼</span></p><p>(ç”¨ä»€éº¼æ–¹å¼ä¿å­˜Swap out page/process image?)</p><p>æ–¹æ³•ä¸€</p><p><span style=color:#ff0;font-size:16px>ç”¨File Sy(stemï¼Œä»ç„¶ä»¥Fileå‹å¼ä¿å­˜(.temp)</span></p><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>Easy implementation</span></li></ol><p>ç¼ºé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æœ‰å¤–éƒ¨ç¢è£‚(å› ç‚ºå¤§éƒ½æ¡Contiguous Allocatation)</span></li><li><span style=color:#ff0;font-size:16px>æ•ˆèƒ½æ¯”è¼ƒå·®</span></li></ol><p>æ–¹æ³•äºŒ</p><p><span style=color:#ff0;font-size:16px>ä½¿ç”¨ä¸€å€‹ç¨ç«‹çš„Partitionä¾†ä¿å­˜(ä½¿ç”¨è€…çœ‹ä¸åˆ°)</span></p><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æ•ˆèƒ½ä½³ï¼Œå› ç‚ºæ¡ç”¨Row-I/Oï¼Œç„¡File System æ”¯æŒ</span></li></ol><p>ç¼ºé»ï¼š</p><ol><li>å…§éƒ¨ç¢è£‚(ä½†è€å¯¦èªªï¼Œè¶…ä¼°æ¯”ä½ä¼°å®‰å…¨)</li><li><span style=color:#ff0;font-size:16px>è‹¥Partitionä¸€é–‹å§‹åˆ‡ä¸å¤ å¤§ï¼Œå°è‡´ä¸å¤ ç”¨ï¼Œå‰‡éœ€è¦é‡æ–°re-partition</span></li></ol><h2 id=æå‡disk-data-access-performanceæ•ˆèƒ½ä¹‹æŠ€è¡“-datadisk-stripinginterleaving--æŠ€è¡“>æå‡Disk Data Access Performance(æ•ˆèƒ½)ä¹‹æŠ€è¡“-Data(Disk) Striping(Interleaving) æŠ€è¡“</h2><p>å®šç¾©ï¼šæŠŠå¤šéƒ¨Physical Disksï¼Œçµ„æˆå–®ä¸€çš„Logical Diskï¼Œ<span style=color:#ff0;font-size:16px>é‹ç”¨å¹³è¡Œå­˜å–æŠ€å·§ä¾†æå‡æ•ˆèƒ½</span>ï¼Œä¸€ç­åˆ†ç‚ºå…©ç¨®</p><ol><li><span style=color:#ff0;font-size:16px>Bit-Level Striping</span></li><li><span style=color:#ff0;font-size:16px>Block-Level Stirping</span></li></ol><p>ç¤ºæ„åœ–ï¼šã€€ã€€</p><p><img src=https://i.imgur.com/5Z0BPFi.png loading=lazy alt=image-20230416004324667></p><h2 id=æå‡disk-reliabilityå¯é åº¦ä¹‹æŠ€è¡“>æå‡Disk Reliability(å¯é åº¦)ä¹‹æŠ€è¡“</h2><p>ç•¶Blockå£äº†ï¼ŒData Lostï¼Œå¦‚ä½•ä½œData Recovery?</p><p>å…©ç¨®</p><ol><li><span style=color:#ff0;font-size:16px>Mirror(æˆ–Shadow)æŠ€è¡“</span></li><li><span style=color:#ff0;font-size:16px>Parity-checkæŠ€è¡“</span></li></ol><h3 id=mirror>Mirror</h3><p>å®šç¾©ï¼šæ¯ä¸€éƒ¨æ­£å¸¸çš„Diskï¼Œå‡é…å‚™æœ‰å°æ‡‰çš„<span style=color:#ff0;font-size:16px>Mirror Disk</span>ï¼Œè³‡æ–™å¿…é ˆåŒæ™‚å­˜å…¥æ­£å¸¸DiskåŠits Mirror Diskï¼Œå°‡ä¾†ï¼Œè‹¥æ­£å¸¸Disk is Badï¼Œå‰‡ç”¨its Mirror Diskæ›¿ä»£</p><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>å¯é åº¦æœ€é«˜</span></li><li><span style=color:#ff0;font-size:16px>Data Recovery é€Ÿåº¦æœ€å¿«</span></li></ol><p>ç¼ºé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æˆæœ¬é«˜(è²´)</span></li></ol><h3 id=parity-check-æŠ€è¡“>Parity-Check æŠ€è¡“</h3><p>å®šç¾©ï¼šå¤šæº–å‚™ä¸€éƒ¨Diskä½œç‚ºå„²å­˜<span style=color:#ff0;font-size:16px>Parity-Check Blockä¹‹ç”¨</span>ï¼Œè³‡æ–™å¯«å…¥æ™‚ï¼Œéœ€è¦é¡å¤–ç®—å‡ºPariry-check Blockå…§å®¹</p><p><img src=https://i.imgur.com/wy7aE4F.png loading=lazy alt=image-20230416012116833></p><p><span style=color:#ff0;font-size:16px>å°‡ä¾†ï¼Œè‹¥æŸä¸€å€‹Block BADï¼Œåªè¦ç”¨å…¶ä»–BlockåŠPariry Blockä½œå¶åŒä½ï¼Œå³å¯Recovery Data</span></p><p>å„ªé»ï¼š</p><ol><li><span style=color:#ff0;font-size:16px>æˆæœ¬æ¯”Mirrorä¾¿å®œè¨±å¤š</span></li></ol><p>ç¼ºé»ï¼š</p><ol><li>å¯é åº¦ä½ï¼Œå› ç‚ºå¦‚æœåŒæ™‚æœ‰å¤šå€‹Blockå£æ‰ï¼Œå‰‡ç„¡æ³•å¾©åŸ</li><li>è³‡æ–™æ¢å¾©é€Ÿåº¦æ…¢æ–¼Mirror</li><li><span style=color:#ff0;font-size:16px>è³‡æ–™å¯«å…¥é€Ÿåº¦ä¹Ÿæ…¢</span></li></ol><h2 id=raid-è¦æ ¼>RAID è¦æ ¼</h2><p>(Redundant Array Of Independent Disks)</p><p>ç£ç¢Ÿå†—é¤˜é™£åˆ—</p><ul><li><span style=color:#ff0;font-size:16px>RAID 0~6</span></li><li><span style=color:#ff0;font-size:16px>RAID-0èˆ‡RAID-1çµ„åˆ</span></li></ul><p>ç¯„ä¾‹ï¼š</p><p>çš†ä»¥4éƒ¨æ­£å¸¸ä½¿ç”¨çš„Diskç‚ºä¾‹ï¼Œ</p><h3 id=span-stylecoloryellowfont-size16pxraid-0span><span style=color:#ff0;font-size:16px>RAID-0</span></h3><p>åªæä¾›<span style=color:#ff0;font-size:16px>Block-Level Striping(Interleaving)</span>è€Œå·²ï¼Œ<span style=color:#ff0;font-size:16px>æœªæä¾›ä»»ä½•å¯é åº¦æŠ€è¡“(eg. mirror, parity-Check</span>ï¼Œç”¨åœ¨å¼·èª¿<span style=color:#ff0;font-size:16px>å­˜å–æ•ˆèƒ½è¦æ±‚é«˜ï¼Œä½†å¯é åº¦ä¸é‡è¦ä¹‹å ´åˆ</span></p><p>eg. VOD(Video Of Demand) Server</p><h3 id=raid-1>RAID-1</h3><p>å°±æ˜¯Mirror</p><h3 id=raid-2>RAID-2</h3><p>æ¡ç”¨Memoryçš„ECCæŠ€è¡“ä¾†æ”¹å–„å¯é åº¦ï¼Œå¸Œæœ›é™ä½Mirroræˆæœ¬ï¼Œ<span style=color:#ff0;font-size:16px>ä½†æ˜¯æˆæœ¬é™ä½æœ‰é™(åªæ¯”Mirrorå°‘ä¸€éƒ¨Diskè€Œä»¥)</span></p><p>ä¾‹</p><p>Diskæ•¸=2n-1</p><p><img src=https://i.imgur.com/xGQayhh.png loading=lazy alt=image-20230416014729591></p><p><span style=color:#ff0;font-size:16px>æ­¤å¤–ï¼Œèˆ‡RAID-3ç›¸æ¯”ï¼Œå¯é åº¦ä¸€æ¨£ï¼Œä½†æˆæœ¬é«˜æ–¼RAID-3ï¼Œå› æ­¤RAID-2ç„¡å¯¦éš›ç”¢å“ï¼Œè·ŸRAID-6ä¸€æ¨£ï¼Œè·ŸRAID-2ä¸€æ¨£æ²’å¯¦éš›ç”¢å“ï¼Œå£è¨£2266</span></p><h3 id=raid-3>RAID-3</h3><p><span style=color:#ff0;font-size:16px>æ¡ç”¨Bit-Level Striping åŠ Parity-CheckæŠ€è¡“</span></p><p>DisKæ•¸=n+1</p><p><img src=https://i.imgur.com/Hqdhh6j.png loading=lazy alt=image-20230416015642161></p><h3 id=raid-4>RAID-4</h3><p>æ¡ç”¨<span style=color:#ff0;font-size:16px>Block-Level</span>åŠPariry-CheckæŠ€è¡“</p><p><img src=https://i.imgur.com/Hqdhh6j.png loading=lazy alt=image-20230416015642161></p><h3 id=raid-5>RAID-5</h3><p><span style=color:#ff0;font-size:16px>æ¡ç”¨Block-Level StripingåŠParity-CheckæŠ€è¡“</span>ï¼Œèˆ‡RAID-3,RAID-4ä¹‹ä¸»è¦å·®åˆ¥åœ¨ï¼Œ<span style=color:#ff0;font-size:16px>å°‡parity Blockåˆ†æ•£å­˜æ–¼ä¸åŒDiskï¼Œä¸¦éé›†ä¸­åœ¨ä¸€éƒ¨Disk</span></p><p><img src=https://i.imgur.com/VfC0Xtp.png loading=lazy alt=image-20230416020200561></p><h3 id=raid-6>RAID-6</h3><p>ä¸ç”¨Parity-CheckæŠ€è¡“ï¼Œæ”¹ç”¨é¡ä¼¼Reed-SolomonæŠ€è¡“ï¼Œå¯ä»¥åšåˆ°2éƒ¨Disk BlockåŒæ™‚å‡ºéŒ¯ï¼Œ</p><p>é‚„èƒ½Recoveryï¼Œ<span style=color:#ff0;font-size:16px>ä½†Costå¤ªé«˜(â‰§ Mirroræˆæœ¬)ï¼Œå› æ­¤ä¹Ÿç„¡å¯¦éš›ç”¢å“</span></p><h3 id=raid-0--raid-1-ä¹‹çµ„åˆ>RAID-0 & RAID-1 ä¹‹çµ„åˆ</h3><p>ç”¨åœ¨é«˜æ•ˆèƒ½ä»¥åŠé«˜å¯åº¦è¦æ±‚ä¹‹å ´åˆï¼Œé›–ç„¶å¾ˆé«˜ï¼Œä½†ä¸è¨ˆä»»ä½•ä»£åƒ¹</p><p>çµ„åˆæ–¹å¼æœ‰ï¼š</p><ol><li>RAID0+1</li><li><span style=color:#ff0;font-size:16px>RAID1+0[å„ªç§€]</span></li></ol><p><span style=color:#ff0;font-size:32px>é€™é‚Šè€ƒç•«åœ–</span></p><h3 id=raid01>RAID0+1</h3><p>å…ˆStripingï¼Œå†æ•´é«”Mirror</p><p><img src=https://i.imgur.com/t6yfRfz.png loading=lazy alt=image-20230416021106242></p><p>ä¸€éƒ¨Disk BADï¼Œæ•´çµ„çš„Diskéƒ½è¦æ›æˆMirrorçš„ï¼Œä¸å¯ä»¥åªæ›ä¸€å€‹Disk</p><h3 id=raid10>RAID1+0</h3><p>å…ˆMirrorï¼Œå†Striping</p><p><img src=https://i.imgur.com/zAYamYe.png loading=lazy alt=image-20230416021307561></p><p><span style=color:#ff0;font-size:16px></span></p><p><u></u></p><p><sup></sup></p><p><sub></sub></p><p><span style=color:#ff0;font-size:16px></span></p><p><u></u></p><p><u></u></p><p><u></u></p></section><footer class=article-footer><section class=article-tags></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true}]});})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/%E8%B3%87%E6%96%99%E7%B5%90%E6%A7%8B%E7%AD%86%E8%A8%98/><div class=article-image><img src=https://i.imgur.com/NiqSvey.png loading=lazy data-key data-hash=https://i.imgur.com/NiqSvey.png></div><div class=article-details><h2 class=article-title>è³‡æ–™çµæ§‹ç­†è¨˜</h2></div></a></article><article class=has-image><a href=/p/%E8%AB%96value%E8%88%87environment%E4%B9%8B%E5%84%AA%E5%8A%A3/><div class=article-image><img src=https://i.imgur.com/UDvSvgw.png loading=lazy data-key data-hash=https://i.imgur.com/UDvSvgw.png></div><div class=article-details><h2 class=article-title>è«–@Valueèˆ‡Environmentä¹‹å„ªåŠ£</h2></div></a></article><article class=has-image><a href=/p/%E9%81%8B%E7%94%A8arraylist%E8%88%87%E8%87%AA%E5%8B%95%E9%85%8D%E7%BD%AE%E5%B0%87swich%E8%AA%9E%E6%B3%95%E6%8B%86%E8%A7%A3/><div class=article-image><img src=https://i.imgur.com/rfkvgRO.png loading=lazy data-key data-hash=https://i.imgur.com/rfkvgRO.png></div><div class=article-details><h2 class=article-title>é‹ç”¨ArrayListèˆ‡è‡ªå‹•é…ç½®å°‡Swichèªæ³•æ‹†è§£</h2></div></a></article><article class=has-image><a href=/p/gitlab-ci/cd%E7%AD%86%E8%A8%98/><div class=article-image><img src=https://i.imgur.com/b9bWXWs.jpg loading=lazy data-key data-hash=https://i.imgur.com/b9bWXWs.jpg></div><div class=article-details><h2 class=article-title>GitLab-CI/CDç­†è¨˜</h2></div></a></article><article class=has-image><a href=/p/%E4%BD%BF%E7%94%A8ssh%E4%BE%86%E9%80%A3%E5%8B%95gitscm/><div class=article-image><img src=https://i.imgur.com/8ocM55M.png%20 loading=lazy data-key data-hash=https://i.imgur.com/8ocM55M.png></div><div class=article-details><h2 class=article-title>ä½¿ç”¨SSHä¾†é€£å‹•GITSCM</h2></div></a></article></div></div></aside><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:"bf152013e92e48c1495f",clientSecret:"bed32f8438cb1e00d8628d9b6d148003bb4bf25d",repo:"comment",owner:"Hoxton019030",admin:["Hoxton019030"],distractionFreeMode:false,id:md5(location.pathname),});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk-container").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return;}
gitalk.render("gitalk-container");})();</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2023 Hoxton</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.14.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#chapter1-intruduction>Chapter1 Intruduction</a><ol><li><a href=#hardware>Hardware</a></li><li><a href=#operating-system>Operating System</a></li><li><a href=#application-programs>Application Programs</a></li><li><a href=#multiprogramming-system>Multiprogramming System</a></li><li><a href=#time-sharing-system>Time-Sharing System</a></li><li><a href=#multiprocessors-system>Multiprocessors System</a><ol><li><a href=#two-subtype-in-multiprocessors-system>Two SubType in Multiprocessors System</a></li><li><a href=#multiprocessors-system-vs-multicores-cpu>Multiprocessors System VS MultiCores CPU</a></li></ol></li><li><a href=#distribute-system>Distribute System</a><ol><li><a href=#advantage-of-distribute-system>Advantage of Distribute-System</a></li></ol></li><li><a href=#real-time-system>Real-Time System</a><ol><li><a href=#hard-real-time-system>Hard real-time system</a></li><li><a href=#soft-real-time-system>Soft real-time system</a></li><li><a href=#batch-system>Batch System</a></li><li><a href=#hand-held--system>Hand Held system</a></li></ol></li></ol></li><li><a href=#chapter2-computer-system-architecture>Chapter2 Computer System Architecture</a><ol><li><a href=#io-operating-and-hardware-resources-protection>I/O Operating And Hardware Resources Protection</a></li><li><a href=#io-operating>I/O Operating</a><ol><li><a href=#polling-io-io>Polling I/O I/O</a></li><li><a href=#interrupted-io>Interrupted I/O</a></li><li><a href=#dma-direct-memory-access-io>DMA (Direct Memory Access) I/O</a></li><li><a href=#dma-six-steps>DMA Six Steps</a></li><li><a href=#life-cycle-of-io-request-via-interrupted-io>Life cycle of I/O-request via Interrupted I/O</a></li><li><a href=#blocking-and-non-blocking-io>Blocking and Non-Blocking I/O</a><ol><li><a href=#blocking-io>Blocking-I/O:</a></li><li><a href=#non-blocking-io>Non-Blocking I/Oï¼š</a></li><li><a href=#asynchronous-io>Asynchronous-I/O:</a></li><li><a href=#asynchronousèˆ‡non-blockingçš„å°å·®ç•°>Asynchronousèˆ‡Non-Blockingçš„å°å·®ç•°</a></li></ol></li></ol></li><li><a href=#interrupt-policy-and>Interrupt Policy and</a></li><li><a href=#hardware-resources-protection>Hardware Resources Protection</a><ol><li><a href=#dual-modes-operation>Dual-modes operation</a></li><li><a href=#priveleged-instructionç‰¹æ¬ŠæŒ‡ä»¤>Priveleged instruction(ç‰¹æ¬ŠæŒ‡ä»¤)</a></li><li><a href=#ç‚ºä»€éº¼dual-modeè·Ÿprivilege-isntructionå¯ä»¥æ§‹æˆä¿è­·åŸºç¤>ç‚ºä»€éº¼Dual-modeè·ŸPrivilege Isntructionå¯ä»¥æ§‹æˆä¿è­·åŸºç¤</a></li><li><a href=#io-protection>I/O-Protection</a></li><li><a href=#memory-protection>Memory Protection</a></li><li><a href=#cpu-protection>CPU Protection</a></li></ol></li><li><a href=#os-structure-operating-system>OS Structure Operating-System</a><ol><li><a href=#system-call>System Call</a></li><li><a href=#osä¹‹ç³»çµ±æ¶æ§‹åˆ†é¡>OSä¹‹ç³»çµ±æ¶æ§‹åˆ†é¡</a></li><li><a href=#virtual-machine>Virtual Machine</a></li></ol></li></ol></li><li><a href=#chapter-3-system-structure>Chapter 3 System Structure</a></li><li><a href=#chapter4--process-management-and-thread-management>Chapter4 Process Management And Thread Management</a><ol><li><a href=#process-definition>Process Definition</a></li><li><a href=#process-control-block>Process Control Block</a></li><li><a href=#process-state-transition-diagram>Process State Transition Diagram</a><ol><li><a href=#5-steps-of-state-transition-diagram>5 Steps of State Transition Diagram</a></li><li><a href=#7-steps-of-state-transition-diagramstalling>7 Steps of State Transition Diagram[Stalling]</a></li><li><a href=#unix-stdstalling>UNIX STD[Stalling]</a></li></ol></li><li><a href=#scheduler-typeimportant>Scheduler Type(Important)</a><ol><li><a href=#io-bound-jobèˆ‡cpu-bound-job>I/O-Bound Jobèˆ‡CPU-Bound Job</a></li></ol></li><li><a href=#context-switching>Context Switching</a></li><li><a href=#dispatcher-and-dispatch-latency>Dispatcher And Dispatch Latency</a></li><li><a href=#process-control-operations>Process Control Operationsâ˜†â˜†â˜†â˜†â˜†</a><ol><li><a href=#lession-1-theory>Lession 1 Theory</a></li><li><a href=#lession-2-example---unix-system-call>Lession 2 Example - UNIX System Call</a></li><li><a href=#lession3-programming>Lession3 Programming</a></li></ol></li><li><a href=#evalue-cpu-scheduling-performance-5-criteria>Evalue CPU Scheduling Performance 5 criteria</a></li><li><a href=#cpuæ’ç­æ³•å‰‡è¡Œç‚ºä»‹ç´¹>CPUæ’ç­æ³•å‰‡è¡Œç‚ºä»‹ç´¹</a><ol><li><a href=#fifoæ³•å‰‡>FIFOæ³•å‰‡</a></li><li><a href=#sjfshortest-job-firstæ³•å‰‡>SJF(Shortest Job First)æ³•å‰‡</a></li><li><a href=#srtfsrjfsrtn-shortest-remaining-time-job-firstnext>SRTF,SRJF,SRTN( Shortest Remaining-Time Job First(Next))</a></li><li><a href=#priorityæ³•å‰‡>Priorityæ³•å‰‡</a></li><li><a href=#rrround-robinæ³•å‰‡è€ƒè©¦é‡é»>RR(Round Robin)æ³•å‰‡(è€ƒè©¦é‡é»)</a></li><li><a href=#multilevel-queueså¤šå±¤ä½‡åˆ—æ³•å‰‡>MultiLevel Queues(å¤šå±¤ä½‡åˆ—)æ³•å‰‡</a></li><li><a href=#multilevel-feedback-queuesmfqså¤šå±¤å›é¥‹ä½‡åˆ—>MultiLevel Feedback Queues(MFQs)(å¤šå±¤å›é¥‹ä½‡åˆ—)</a></li><li><a href=#å°çµ>å°çµ</a></li><li><a href=#è£œå……-cpu-utilizationè¨ˆç®—>è£œå…… CPU Utilizationè¨ˆç®—</a></li></ol></li><li><a href=#ç‰¹æ®Šç³»çµ±ä¹‹æ’ç­è¨­è¨ˆè€ƒé‡>ç‰¹æ®Šç³»çµ±ä¹‹æ’ç­è¨­è¨ˆè€ƒé‡</a><ol><li><a href=#multiprocessors-system-1>Multiprocessors System</a></li><li><a href=#processor-affinity>Processor affinity</a></li></ol></li><li><a href=#real-time-systemæ’ç­è¨­è¨ˆè€ƒé‡>Real-Time Systemæ’ç­è¨­è¨ˆè€ƒé‡</a><ol><li><a href=#hard-real-time-system-1>Hard real-time system</a></li><li><a href=#soft-real-time-system-1>Soft real-time system</a></li><li><a href=#real-time-systemä¹‹dispatch-latency-çµ„æˆ>Real-time systemä¹‹Dispatch Latency çµ„æˆ</a></li></ol></li><li><a href=#thread-managementè²å¤šèŠ¬>Thread Management(è²å¤šèŠ¬)</a><ol><li><a href=#thread>Thread</a></li><li><a href=#process-vs-thread>Process Vs Thread</a></li><li><a href=#philosophy>Philosophy</a></li></ol></li><li><a href=#threadåˆ†é¡user-threadèˆ‡kernel-thread>Threadåˆ†é¡ï¼šuser-Threadèˆ‡Kernel-Thread</a></li><li><a href=#multithreading-model-æé¾æœ¬ç¨æœ‰>MultiThreading Model [æé¾æœ¬ç¨æœ‰]</a></li><li><a href=#multithreading-issue>MultiThreading Issue</a></li><li><a href=#threadç¨‹å¼è¿½è¹¤>Threadç¨‹å¼è¿½è¹¤</a></li></ol></li><li><a href=#chapter-5-deadlock>Chapter 5 DeadLock</a><ol><li><a href=#deadlock>DeadLock</a></li><li><a href=#resource-allocation-graphrag>Resource Allocation Graph(R.A.G)</a></li><li><a href=#ragçš„ä¸‰é»çµè«–å¿…è€ƒ>RAGçš„ä¸‰é»çµè«–â˜†â˜†â˜†â˜†â˜†å¿…è€ƒ</a></li><li><a href=#deadlockè™•ç†æ–¹å¼>DeadLockè™•ç†æ–¹å¼</a></li><li><a href=#deadlock-prevention>DeadLock Prevention</a></li><li><a href=#deadlock-avoidance>Deadlock Avoidance</a></li><li><a href=#bankers-algo->Banker&rsquo;s Algo â˜†â˜†â˜†â˜†â˜†</a></li><li><a href=#safety-algorithm>Safety Algorithm</a></li><li><a href=#bankers-algo-ä¹‹-time-complexity>Banker&rsquo;s Algo ä¹‹ Time Complexity</a></li><li><a href=#é‡å°æ¯ä¸€é …é¡å‹è³‡æºçš†ç‚ºsingle-instanceæƒ…æ³ä¸‹æœ‰è¼ƒç°¡æ˜“çš„avoidanceä½œæ³•>é‡å°æ¯ä¸€é …é¡å‹è³‡æºï¼Œçš†ç‚ºSingle-instanceæƒ…æ³ä¸‹ï¼Œæœ‰è¼ƒç°¡æ˜“çš„Avoidanceä½œæ³•</a></li><li><a href=#å®šç†>å®šç†</a></li><li><a href=#deadlock-detection--recovery>Deadlock Detection & Recovery</a></li><li><a href=#deadlock-detection-algorithmè€ƒæ¯”è¼ƒå¤šçš„æ˜¯bankerdetectionç¨å¾®çŸ¥é“å°±å¥½>Deadlock Detection Algorithm(è€ƒæ¯”è¼ƒå¤šçš„æ˜¯Banker,Detectionç¨å¾®çŸ¥é“å°±å¥½)</a></li><li><a href=#è‹¥æ¯ä¸€é¡å‹è³‡æºè³‡æºçš†ç‚ºsingle-instanceå‰‡æœ‰è¼ƒç°¡åŒ–çš„detectionä½œæ³•-ä½¿ç”¨wait-for-graph>è‹¥æ¯ä¸€é¡å‹è³‡æºè³‡æºçš†ç‚ºSingle-instanceï¼Œå‰‡æœ‰è¼ƒç°¡åŒ–çš„Detectionä½œæ³•-ä½¿ç”¨Wait-For Graph</a></li></ol></li><li><a href=#chapter-6-process-synchronization>Chapter 6 Process Synchronization</a><ol><li><a href=#process-communicationä¹‹å…©å¤§æ–¹å¼>Process communicationä¹‹å…©å¤§æ–¹å¼</a><ol><li><a href=#shared-memoryæœ¬ç¯‡é‡é»>Shared Memory(æœ¬ç¯‡é‡é»)</a></li><li><a href=#message-passing>Message Passing</a></li></ol></li><li><a href=#race-condition-problem>Race Condition problem</a></li><li><a href=#è§£æ±ºrace-conditionä¹‹å…©å¤§ç­–ç•¥>è§£æ±ºRace Conditionä¹‹å…©å¤§ç­–ç•¥</a><ol><li><a href=#disable-interrupt>Disable Interrupt</a></li><li><a href=#critical-sectionè‡¨ç•Œå€é–“-design>Critical section(è‡¨ç•Œå€é–“) Design</a></li></ol></li><li><a href=#busy-waiting-skillor-spinlock>Busy-Waiting Skill(or Spinlock)</a></li><li><a href=#cs-designæ‡‰è©²æ»¿è¶³çš„3å€‹æ€§è³ª>C.S Designæ‡‰è©²æ»¿è¶³çš„3å€‹æ€§è³ª</a><ol><li><a href=#mutual-exclusionç›¸äº’æ’æ–¥>Mutual exclusion(ç›¸äº’æ’æ–¥)</a></li><li><a href=#progressé€²å±•>Progress(é€²å±•)</a></li><li><a href=#bounded-waitingæœ‰é™çš„ç­‰å¾…>Bounded waiting(æœ‰é™çš„ç­‰å¾…)</a></li></ol></li><li><a href=#cs-designçš„æ–¹æ³•æ¶æ§‹åœ–é‡è¦>C.S Designçš„æ–¹æ³•(æ¶æ§‹åœ–)é‡è¦</a></li><li><a href=#software-solutions>Software Solutions</a></li><li><a href=#2å€‹processesä¹‹cs-designpipjij>2å€‹Processesä¹‹C.S Design(Pi,Pj,iâ‰ j)</a><ol><li><a href=#algo1>Algo1</a></li><li><a href=#algo2>Algo2</a></li><li><a href=#algo3>Algo3</a></li></ol></li><li><a href=#nå€‹processes-cs-design>Nå€‹Processes C.S Design</a><ol><li><a href=#bankerys-algoéºµåŒ…åº—å–è™Ÿç¢¼ç‰Œ>Bankery&rsquo;s Algo(éºµåŒ…åº—å–è™Ÿç¢¼ç‰Œ)</a><ol><li><a href=#ç¶“å…¸å•é¡Œ>ç¶“å…¸å•é¡Œ</a><ol><li><a href=#ç‚ºä½•æœƒæœ‰å¾ˆå¤šå€‹processeså–å¾—ç›¸åŒçš„numberå€¼>ç‚ºä½•æœƒæœ‰å¾ˆå¤šå€‹Processeså–å¾—ç›¸åŒçš„Numberå€¼ï¼Ÿ</a></li><li><a href=#æ­£ç¢ºæ€§è­‰æ˜>æ­£ç¢ºæ€§è­‰æ˜ï¼Ÿ</a></li><li><a href=#è¨­è¨ˆå•é¡Œ>è¨­è¨ˆå•é¡Œ</a></li></ol></li></ol></li></ol></li><li><a href=#hardware-solution---cpu-instructions-support>Hardware Solution - CPU Instructions Support</a><ol><li><a href=#test-and-setlock-æŒ‡ä»¤>Test-and-Set(Lock) æŒ‡ä»¤</a></li><li><a href=#algo1ï½˜ä¸å¯ä»¥ç”¨>[Algo1]ï¼šï¼¸ä¸å¯ä»¥ç”¨</a></li><li><a href=#algo2-ç©©çš„å¯ä»¥ç”¨>[Algo2] ï¼šç©©çš„ï¼Œå¯ä»¥ç”¨</a></li></ol></li><li><a href=#swapabæŒ‡ä»¤>SWAP(a,b)æŒ‡ä»¤</a></li><li><a href=#semaphoreè™ŸèªŒ>Semaphore(è™ŸèªŒ)</a><ol><li><a href=#waits>wait(S)ï¼š</a></li><li><a href=#signals>signal(S)ï¼š</a></li><li><a href=#cs-designä½¿ç”¨å¦‚ä¸‹><strong>CS Designä½¿ç”¨å¦‚ä¸‹</strong></a></li><li><a href=#è§£æ±ºç°¡å–®çš„synchronization-problem><strong>è§£æ±ºç°¡å–®çš„Synchronization problem</strong></a></li><li><a href=#semaphoreä¹‹èª¤ç”¨æ‰€é€ æˆä¹‹å•é¡Œ>semaphoreä¹‹èª¤ç”¨æ‰€é€ æˆä¹‹å•é¡Œ</a></li><li><a href=#è‘—åçš„synchronization-problemä¹‹è§£æ±º>è‘—åçš„Synchronization Problemä¹‹è§£æ±º</a><ol><li><a href=#producer-consumer-problemç”Ÿç”¢è€…æ¶ˆè²»è€…å•é¡Œ>Producer-Consumer Problem(ç”Ÿç”¢è€…æ¶ˆè²»è€…å•é¡Œ)</a><ol><li><a href=#algo1-1>algo1</a></li><li><a href=#algo2-1>algo2</a></li></ol></li><li><a href=#ç”¨semaphoreè§£producer-consumer-problem>ç”¨semaphoreè§£producer-consumer problem</a></li><li><a href=#semaphoreçš„è¨­è¨ˆå“²å­¸>semaphoreçš„è¨­è¨ˆå“²å­¸</a></li><li><a href=#readwrite-problem>Read/write Problem</a></li><li><a href=#first-readerwriter-problem>First Reader/Writer Problem</a></li><li><a href=#second-reader-writer-problem>Second Reader/ writer problem</a></li><li><a href=#the-sleeping-barbers-problem>The Sleeping Barbers Problem</a></li><li><a href=#the-dining-philosophers-problems>The Dining-Philosophers Problems</a></li><li><a href=#cigarette-smokers-problem>cigarette smokers problem</a></li></ol></li><li><a href=#semaphoreä¹‹ç¨®é¡>Semaphoreä¹‹ç¨®é¡</a><ol><li><a href=#åˆ†é¡ä¸€è™ŸèªŒå€¼åŸŸåšå€åˆ†>åˆ†é¡ä¸€ï¼šè™ŸèªŒå€¼åŸŸåšå€åˆ†</a></li><li><a href=#åˆ†é¡äºŒæ˜¯å¦æ¡ç”¨busy-waitingspinlockæŠ€å·§ä¾†å®šç¾©semaphore>åˆ†é¡äºŒï¼šæ˜¯å¦æ¡ç”¨Busy-waiting(Spinlock)æŠ€å·§ä¾†å®šç¾©Semaphore</a></li></ol></li><li><a href=#è£½ä½œsemaphore>è£½ä½œSemaphore</a><ol><li><a href=#algo1-2>Algo1</a></li><li><a href=#algo2-2>Algo2</a></li><li><a href=#algo3-1>Algo3</a></li><li><a href=#algo4>Algo4</a></li></ol></li><li><a href=#busy-waitingæ˜¯å¦å¯ä»¥å®Œå…¨é¿å…ä¹‹avoid-altogether>Busy-waitingæ˜¯å¦å¯ä»¥å®Œå…¨é¿å…ä¹‹(avoid altogether)</a></li></ol></li><li><a href=#monitor>Monitor</a></li><li><a href=#condition-type>Condition Type</a></li><li><a href=#ä½¿ç”¨monitorè§£æ±º-the-dining-philosophers-problem>ä½¿ç”¨Monitorè§£æ±º The dining-philosophers Problem</a></li><li><a href=#conditional-monitor>Conditional Monitor</a></li><li><a href=#ä½¿ç”¨conditional-monitorè§£æ±ºå•é¡Œ>ä½¿ç”¨Conditional Monitorè§£æ±ºå•é¡Œ</a></li><li><a href=#monitorçš„ç¨®é¡3ç¨®>Monitorçš„ç¨®é¡(3ç¨®)</a></li><li><a href=#å¹¹ä»–åª½çš„é€™é‚Šä¹Ÿæ‹–å¤ªä¹…äº†æˆ‘å—ä¸äº†æˆ‘æƒ³å…ˆå»çœ‹è¨˜æ†¶é«”ç®¡ç†-2023323>å¹¹ä»–åª½çš„ï¼Œé€™é‚Šä¹Ÿæ‹–å¤ªä¹…äº†ï¼Œæˆ‘å—ä¸äº†ï¼Œæˆ‘æƒ³å…ˆå»çœ‹è¨˜æ†¶é«”ç®¡ç† 2023/3/23</a></li></ol></li><li><a href=#chapter-7-memory-management>Chapter 7 Memory Management</a><ol><li><a href=#binding>Binding</a></li><li><a href=#dynamic-binding>Dynamic Binding</a></li><li><a href=#dynamic-loading>Dynamic Loading</a></li><li><a href=#dynamic-linking>Dynamic Linking</a></li><li><a href=#contiguous-é€£çºŒæ€§-memory-allocation>Contiguous (é€£çºŒæ€§) Memory Allocation</a><ol><li><a href=#æ¯”è¼ƒè¡¨>æ¯”è¼ƒè¡¨</a></li></ol></li><li><a href=#ä¸Šè¿°contiguous-memory-allocationæ–¹æ³•å‡é­é‡ä¸€å€‹å…±é€šå•é¡Œexternal-fragmentation>ä¸Šè¿°Contiguous Memory Allocationæ–¹æ³•å‡é­é‡ä¸€å€‹å…±é€šå•é¡Œ"External Fragmentation"</a></li><li><a href=#å¦ä¸€å€‹åè©internal-fragmentationå…§éƒ¨ç¢è£‚>å¦ä¸€å€‹åè©Internal Fragmentation(å…§éƒ¨ç¢è£‚)</a></li><li><a href=#è§£æ±ºexternal-fragmentation>è§£æ±ºExternal Fragmentation</a></li><li><a href=#pageåˆ†é -memory-management>Page(åˆ†é ) memory Management</a><ol><li><a href=#logical-address-è½‰-physical-address-éç¨‹by-mmuhardware>Logical Address è½‰ Physical Address éç¨‹By MMU(Hardware)</a></li><li><a href=#å„ªç¼ºé»æ¯”è¼ƒ>å„ªç¼ºé»æ¯”è¼ƒ</a><ol><li><a href=#å„ªé»>å„ªé»ï¼š</a></li><li><a href=#ç¼ºé»>ç¼ºé»ï¼š</a></li></ol></li></ol></li><li><a href=#page-tableä¹‹è£½ä½œä¿å­˜>Page Tableä¹‹è£½ä½œ(ä¿å­˜)</a></li><li><a href=#pagingç›¸é—œè¨ˆç®—>Pagingç›¸é—œè¨ˆç®—</a><ol><li><a href=#å‹ä¸€-ä½¿ç”¨tlbä¹‹effective-memory-access-time>[å‹ä¸€] ä½¿ç”¨TLBä¹‹effective Memory Access Time</a></li><li><a href=#å‹äºŒ-logical-address-èˆ‡-physical-address-bit-æ•¸ç›®è¨ˆç®—>[å‹äºŒ] Logical Address èˆ‡ Physical Address Bit æ•¸ç›®è¨ˆç®—</a></li><li><a href=#å‹ä¸‰-pagetable-sizeç›¸é—œè¨ˆç®—>[å‹ä¸‰] PageTable sizeç›¸é—œè¨ˆç®—</a></li><li><a href=#å‹å››-page-table-size-å¤ªå¤§ä¹‹è§£æ³•çš„ç›¸é—œè¨ˆç®—-è€ƒè©¦å¿…è€ƒ>[å‹å››] Page Table Size å¤ªå¤§ä¹‹è§£æ³•çš„ç›¸é—œè¨ˆç®— (è€ƒè©¦å¿…è€ƒ)</a></li></ol></li><li><a href=#page-table-size-å¤ªå¤§-ä¹‹è§£æ±ºæ–¹æ¡ˆ>Page Table Size å¤ªå¤§ ä¹‹è§£æ±ºæ–¹æ¡ˆ</a><ol><li><a href=#multilevels-paging>Multilevels Paging</a></li><li><a href=#hashing-page-table>Hashing Page Table</a></li><li><a href=#inverted-page-table>Inverted Page Table</a></li></ol></li><li><a href=#segment-memory-management>Segment Memory Management</a></li><li><a href=#pageèˆ‡segmentæ¯”è¼ƒè¡¨>Pageèˆ‡Segmentæ¯”è¼ƒè¡¨</a></li><li><a href=#paged-segment-memory-management>Paged Segment Memory Management</a></li><li><a href=#å°çµ-1>å°çµ</a></li></ol></li><li><a href=#ch8-virtula-memory-è™›æ“¬è¨˜æ†¶é«”>Ch8 Virtula Memory (è™›æ“¬è¨˜æ†¶é«”)</a><ol><li><a href=#ä¸»è¦ç›®çš„å„ªé»ä»¥åŠé™„å¸¶å¥½è™•>ä¸»è¦ç›®çš„(å„ªé»)ä»¥åŠé™„å¸¶å¥½è™•</a></li><li><a href=#å¯¦ç¾virtual-memoryçš„æŠ€è¡“ä¹‹ä¸€demand-pagingéœ€æ±‚åˆ†é >å¯¦ç¾Virtual Memoryçš„æŠ€è¡“ä¹‹ä¸€ã€€Demand Paging(éœ€æ±‚åˆ†é )</a></li><li><a href=#page-fault-ä¹‹è™•ç†-steps>Page fault ä¹‹è™•ç† Steps</a></li><li><a href=#effective-memory-access-timeè¨ˆç®—-in-virtual-memory>Effective Memory Access Timeè¨ˆç®— in Virtual Memory</a></li><li><a href=#å°çµ-2>å°çµ</a></li><li><a href=#å½±éŸ¿page-fault-rationå› ç´ >å½±éŸ¿Page Fault rationå› ç´ </a></li><li><a href=#page-replacementé é¢æ›¿æ›>Page Replacement(é é¢æ›¿æ›)</a></li><li><a href=#page--replacementæ³•å‰‡ä»‹ç´¹>Page replacementæ³•å‰‡ä»‹ç´¹</a><ol><li><a href=#fifo-æ³•å‰‡>FIFO æ³•å‰‡</a></li></ol></li><li><a href=#belady--anormaly>Belady Anormaly</a></li><li><a href=#stack-property>Stack Property</a></li><li><a href=#opt-uoptuional-æœ€ä½³æ³•å‰‡>OPT (<u>Opt</u>ional æœ€ä½³)æ³•å‰‡</a></li><li><a href=#lruulueast-uruecently-uuusedæ³•å‰‡>LRU(<u>L</u>east <u>R</u>ecently <u>U</u>sed)æ³•å‰‡</a></li><li><a href=#lruçš„è£½ä½œæ–¹æ³•>LRUçš„è£½ä½œæ–¹æ³•</a><ol><li><a href=#æ–¹æ³•ä¸€counteræ³•>æ–¹æ³•ä¸€ï¼šCounteræ³•</a></li><li><a href=#æ–¹æ³•äºŒstack-æ³•>æ–¹æ³•äºŒï¼šStack æ³•ã€€</a></li></ol></li><li><a href=#lruè¿‘ä¼¼æ³•å‰‡>LRUè¿‘ä¼¼æ³•å‰‡</a></li><li><a href=#additional-reference-bits-usage>Additional Reference Bits usage</a></li><li><a href=#second-chance>Second Chance</a></li><li><a href=#enhanced-second-chance>Enhanced Second Chance</a></li><li><a href=#lfuèˆ‡mfuæ³•å‰‡>LFUèˆ‡MFUæ³•å‰‡</a></li><li><a href=#page-bufferingæ©Ÿåˆ¶>Page Bufferingæ©Ÿåˆ¶</a><ol><li><a href=#æ–¹æ³•ä¸€>æ–¹æ³•ä¸€</a></li><li><a href=#æ–¹æ³•äºŒ>æ–¹æ³•äºŒ</a></li><li><a href=#æ–¹æ³•ä¸‰>æ–¹æ³•ä¸‰</a></li></ol></li><li><a href=#frame-æ•¸ç›®åˆ†é…å¤šå¯¡ä¹‹å½±éŸ¿>Frame æ•¸ç›®åˆ†é…å¤šå¯¡ä¹‹å½±éŸ¿</a></li><li><a href=#thrashingç¾è±¡->Thrashingç¾è±¡ â˜†â˜†â˜†â˜†â˜†</a></li><li><a href=#è§£æ±ºé é˜²-thrashing>è§£æ±º/é é˜² Thrashing</a><ol><li><a href=#æ–¹æ³•ä¸€-1>æ–¹æ³•ä¸€</a></li><li><a href=#æ–¹æ³•äºŒ-1>æ–¹æ³•äºŒ</a></li></ol></li><li><a href=#working-set-model-æŠ€è¡“>Working Set Model æŠ€è¡“</a><ol><li><a href=#temporal-locality>Temporal Locality</a></li><li><a href=#spatial-locality>Spatial Locality</a></li></ol></li><li><a href=#page-size-ä¹‹å½±éŸ¿>Page Size ä¹‹å½±éŸ¿</a></li><li><a href=#program-structures-ä¹‹å½±éŸ¿>Program Structures ä¹‹å½±éŸ¿</a></li><li><a href=#copy-on-writeæŠ€è¡“>Copy-On-WriteæŠ€è¡“</a></li><li><a href=#tlb-reach>TLB Reach</a><ol><li><a href=#æ–¹æ³•ä¸€-2>æ–¹æ³•ä¸€</a></li><li><a href=#æ–¹æ³•äºŒ-2>æ–¹æ³•äºŒ</a></li></ol></li></ol></li><li><a href=#ch9-disk-management>Ch9 Disk Management</a><ol><li><a href=#disk-systemçµ„æˆ>Disk Systemçµ„æˆ</a></li><li><a href=#disk-access-time>Disk Access Time</a></li><li><a href=#disk-free-space-management>Disk Free Space Management</a><ol><li><a href=#bit-vectorbit-map>Bit Vector(Bit Map)</a></li><li><a href=#link-list>Link List</a></li><li><a href=#grouping>Grouping</a></li><li><a href=#counting>Counting</a></li></ol></li><li><a href=#file-allocation-methods->File Allocation Methods â˜†â˜†â˜†â˜†â˜†</a><ol><li><a href=#contiguous-allocation>Contiguous Allocation</a></li><li><a href=#linked-allocation>Linked Allocation</a></li></ol></li><li><a href=#fatfile-allocation-table>FAT(File Allocation Table)</a></li><li><a href=#index-allocation>Index Allocation</a></li><li><a href=#è§£æ±ºå–®ä¸€index-block-ä¸å¤ å­˜æ”¾æ‰€æœ‰data-block-noä¹‹å•é¡Œ>è§£æ±ºå–®ä¸€Index Block ä¸å¤ å­˜æ”¾æ‰€æœ‰Data Block Noä¹‹å•é¡Œ</a><ol><li><a href=#æ–¹æ³•ä¸€-3>æ–¹æ³•ä¸€</a></li><li><a href=#æ–¹æ³•äºŒ-3>æ–¹æ³•äºŒ</a></li><li><a href=#æ–¹æ³•ä¸‰-1>æ–¹æ³•ä¸‰â˜†â˜†â˜†â˜†â˜†</a></li></ol></li><li><a href=#disk-scheduling-algo>Disk Scheduling Algo</a><ol><li><a href=#fcfsfirst-come-first-service>FCFS(First-Come-First-Service)</a></li><li><a href=#sstfshortest-seek-time-track-first>SSTF(Shortest Seek-Time Track First)</a></li><li><a href=#scanæ³•å‰‡>SCANæ³•å‰‡</a></li><li><a href=#c-scan>C-SCAN</a></li><li><a href=#look>Look</a></li><li><a href=#c-look>C-LOOK</a></li><li><a href=#è£œå……>è£œå……</a></li></ol></li><li><a href=#å…¶ä»–åè©é …>å…¶ä»–åè©é …</a><ol><li><a href=#formatting-æ ¼å¼åŒ–>Formatting (æ ¼å¼åŒ–)</a></li><li><a href=#rowåŸå§‹çš„-io-åŸºæœ¬ä¸Šæ²’è€ƒé>Row<code>åŸå§‹çš„</code>-I/O (åŸºæœ¬ä¸Šæ²’è€ƒé)</a></li><li><a href=#bootstrap-loader->Bootstrap Loader â˜†â˜†â˜†â˜†â˜†</a><ol><li><a href=#æ—©æœŸçš„ä½œæ³•>æ—©æœŸçš„ä½œæ³•</a></li><li><a href=#ç¾ä»£çš„åšæ³•>ç¾ä»£çš„åšæ³•</a></li></ol></li></ol></li><li><a href=#bad-sectors-ä¹‹è™•ç†æ–¹æ³•>BAD Sectors ä¹‹è™•ç†æ–¹æ³•</a><ol><li><a href=#æ–¹æ³•ä¸€-4>[æ–¹æ³•ä¸€]</a></li><li><a href=#æ–¹æ³•äºŒ-4>[æ–¹æ³•äºŒ]</a></li><li><a href=#æ–¹æ³•ä¸‰-2>[æ–¹æ³•ä¸‰]</a></li></ol></li><li><a href=#swap-space-management>Swap Space Management</a></li><li><a href=#æå‡disk-data-access-performanceæ•ˆèƒ½ä¹‹æŠ€è¡“-datadisk-stripinginterleaving--æŠ€è¡“>æå‡Disk Data Access Performance(æ•ˆèƒ½)ä¹‹æŠ€è¡“-Data(Disk) Striping(Interleaving) æŠ€è¡“</a></li><li><a href=#æå‡disk-reliabilityå¯é åº¦ä¹‹æŠ€è¡“>æå‡Disk Reliability(å¯é åº¦)ä¹‹æŠ€è¡“</a><ol><li><a href=#mirror>Mirror</a></li><li><a href=#parity-check-æŠ€è¡“>Parity-Check æŠ€è¡“</a></li></ol></li><li><a href=#raid-è¦æ ¼>RAID è¦æ ¼</a><ol><li><a href=#span-stylecoloryellowfont-size16pxraid-0span><span style=color:#ff0;font-size:16px>RAID-0</span></a></li><li><a href=#raid-1>RAID-1</a></li><li><a href=#raid-2>RAID-2</a></li><li><a href=#raid-3>RAID-3</a></li><li><a href=#raid-4>RAID-4</a></li><li><a href=#raid-5>RAID-5</a></li><li><a href=#raid-6>RAID-6</a></li><li><a href=#raid-0--raid-1-ä¹‹çµ„åˆ>RAID-0 & RAID-1 ä¹‹çµ„åˆ</a></li><li><a href=#raid01>RAID0+1</a></li><li><a href=#raid10>RAID1+0</a></li></ol></li></ol></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script></body></html>